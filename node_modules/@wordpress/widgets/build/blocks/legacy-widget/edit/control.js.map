{"version":3,"names":["_apiFetch","_interopRequireDefault","require","_compose","_i18n","Control","constructor","id","idBase","instance","onChangeInstance","onChangeHasPreview","onError","_instance","_hasPreview","number","lastNumber","handleFormChange","debounce","bind","handleFormSubmit","initDOM","bindEvents","loadContent","destroy","unbindEvents","element","remove","_this$id","_this$idBase","el","class","form","method","type","name","value","toString","content","__","window","jQuery","$","on","addEventListener","off","removeEventListener","saveWidget","innerHTML","preview","encodeWidget","hasPreview","isEmptyHTML","hash","formData","serializeForm","document","trigger","error","saveForm","event","preventDefault","exports","default","tagName","attributes","createElement","attribute","Object","entries","setAttribute","Array","isArray","child","appendChild","innerText","widget","apiFetch","path","data","form_data","rendered_form","response","html","isEmptyNode","node","nodeType","TEXT_NODE","nodeValue","trim","ELEMENT_NODE","includes","hasChildNodes","from","childNodes","every","URLSearchParams","FormData"],"sources":["@wordpress/widgets/src/blocks/legacy-widget/edit/control.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\nimport { debounce } from '@wordpress/compose';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * An API for creating and loading a widget control (a <div class=\"widget\">\n * element) that is compatible with most third party widget scripts. By not\n * using React for this, we ensure that we have complete control over the DOM\n * and do not accidentally remove any elements that a third party widget script\n * has attached an event listener to.\n *\n * @property {Element} element The control's DOM element.\n */\nexport default class Control {\n\t/**\n\t * Creates and loads a new control.\n\t *\n\t * @access public\n\t * @param {Object}   params\n\t * @param {string}   params.id\n\t * @param {string}   params.idBase\n\t * @param {Object}   params.instance\n\t * @param {Function} params.onChangeInstance\n\t * @param {Function} params.onChangeHasPreview\n\t * @param {Function} params.onError\n\t */\n\tconstructor( {\n\t\tid,\n\t\tidBase,\n\t\tinstance,\n\t\tonChangeInstance,\n\t\tonChangeHasPreview,\n\t\tonError,\n\t} ) {\n\t\tthis.id = id;\n\t\tthis.idBase = idBase;\n\t\tthis._instance = instance;\n\t\tthis._hasPreview = null;\n\t\tthis.onChangeInstance = onChangeInstance;\n\t\tthis.onChangeHasPreview = onChangeHasPreview;\n\t\tthis.onError = onError;\n\n\t\t// We can't use the real widget number as this is calculated by the\n\t\t// server and we may not ever *actually* save this widget. Instead, use\n\t\t// a fake but unique number.\n\t\tthis.number = ++lastNumber;\n\n\t\tthis.handleFormChange = debounce(\n\t\t\tthis.handleFormChange.bind( this ),\n\t\t\t200\n\t\t);\n\t\tthis.handleFormSubmit = this.handleFormSubmit.bind( this );\n\n\t\tthis.initDOM();\n\t\tthis.bindEvents();\n\t\tthis.loadContent();\n\t}\n\n\t/**\n\t * Clean up the control so that it can be garbage collected.\n\t *\n\t * @access public\n\t */\n\tdestroy() {\n\t\tthis.unbindEvents();\n\t\tthis.element.remove();\n\t\t// TODO: How do we make third party widget scripts remove their event\n\t\t// listeners?\n\t}\n\n\t/**\n\t * Creates the control's DOM structure.\n\t *\n\t * @access private\n\t */\n\tinitDOM() {\n\t\tthis.element = el( 'div', { class: 'widget open' }, [\n\t\t\tel( 'div', { class: 'widget-inside' }, [\n\t\t\t\t( this.form = el( 'form', { class: 'form', method: 'post' }, [\n\t\t\t\t\t// These hidden form inputs are what most widgets' scripts\n\t\t\t\t\t// use to access data about the widget.\n\t\t\t\t\tel( 'input', {\n\t\t\t\t\t\tclass: 'widget-id',\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'widget-id',\n\t\t\t\t\t\tvalue: this.id ?? `${ this.idBase }-${ this.number }`,\n\t\t\t\t\t} ),\n\t\t\t\t\tel( 'input', {\n\t\t\t\t\t\tclass: 'id_base',\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'id_base',\n\t\t\t\t\t\tvalue: this.idBase ?? this.id,\n\t\t\t\t\t} ),\n\t\t\t\t\tel( 'input', {\n\t\t\t\t\t\tclass: 'widget-width',\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'widget-width',\n\t\t\t\t\t\tvalue: '250',\n\t\t\t\t\t} ),\n\t\t\t\t\tel( 'input', {\n\t\t\t\t\t\tclass: 'widget-height',\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'widget-height',\n\t\t\t\t\t\tvalue: '200',\n\t\t\t\t\t} ),\n\t\t\t\t\tel( 'input', {\n\t\t\t\t\t\tclass: 'widget_number',\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'widget_number',\n\t\t\t\t\t\tvalue: this.idBase ? this.number.toString() : '',\n\t\t\t\t\t} ),\n\t\t\t\t\t( this.content = el( 'div', { class: 'widget-content' } ) ),\n\t\t\t\t\t// Non-multi widgets can be saved via a Save button.\n\t\t\t\t\tthis.id &&\n\t\t\t\t\t\tel(\n\t\t\t\t\t\t\t'button',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tclass: 'button is-primary',\n\t\t\t\t\t\t\t\ttype: 'submit',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t__( 'Save' )\n\t\t\t\t\t\t),\n\t\t\t\t] ) ),\n\t\t\t] ),\n\t\t] );\n\t}\n\n\t/**\n\t * Adds the control's event listeners.\n\t *\n\t * @access private\n\t */\n\tbindEvents() {\n\t\t// Prefer jQuery 'change' event instead of the native 'change' event\n\t\t// because many widgets use jQuery's event bus to trigger an update.\n\t\tif ( window.jQuery ) {\n\t\t\tconst { jQuery: $ } = window;\n\t\t\t$( this.form ).on( 'change', null, this.handleFormChange );\n\t\t\t$( this.form ).on( 'input', null, this.handleFormChange );\n\t\t\t$( this.form ).on( 'submit', this.handleFormSubmit );\n\t\t} else {\n\t\t\tthis.form.addEventListener( 'change', this.handleFormChange );\n\t\t\tthis.form.addEventListener( 'input', this.handleFormChange );\n\t\t\tthis.form.addEventListener( 'submit', this.handleFormSubmit );\n\t\t}\n\t}\n\n\t/**\n\t * Removes the control's event listeners.\n\t *\n\t * @access private\n\t */\n\tunbindEvents() {\n\t\tif ( window.jQuery ) {\n\t\t\tconst { jQuery: $ } = window;\n\t\t\t$( this.form ).off( 'change', null, this.handleFormChange );\n\t\t\t$( this.form ).off( 'input', null, this.handleFormChange );\n\t\t\t$( this.form ).off( 'submit', this.handleFormSubmit );\n\t\t} else {\n\t\t\tthis.form.removeEventListener( 'change', this.handleFormChange );\n\t\t\tthis.form.removeEventListener( 'input', this.handleFormChange );\n\t\t\tthis.form.removeEventListener( 'submit', this.handleFormSubmit );\n\t\t}\n\t}\n\n\t/**\n\t * Fetches the widget's form HTML from the REST API and loads it into the\n\t * control's form.\n\t *\n\t * @access private\n\t */\n\tasync loadContent() {\n\t\ttry {\n\t\t\tif ( this.id ) {\n\t\t\t\tconst { form } = await saveWidget( this.id );\n\t\t\t\tthis.content.innerHTML = form;\n\t\t\t} else if ( this.idBase ) {\n\t\t\t\tconst { form, preview } = await encodeWidget( {\n\t\t\t\t\tidBase: this.idBase,\n\t\t\t\t\tinstance: this.instance,\n\t\t\t\t\tnumber: this.number,\n\t\t\t\t} );\n\t\t\t\tthis.content.innerHTML = form;\n\t\t\t\tthis.hasPreview = ! isEmptyHTML( preview );\n\n\t\t\t\t// If we don't have an instance, perform a save right away. This\n\t\t\t\t// happens when creating a new Legacy Widget block.\n\t\t\t\tif ( ! this.instance.hash ) {\n\t\t\t\t\tconst { instance } = await encodeWidget( {\n\t\t\t\t\t\tidBase: this.idBase,\n\t\t\t\t\t\tinstance: this.instance,\n\t\t\t\t\t\tnumber: this.number,\n\t\t\t\t\t\tformData: serializeForm( this.form ),\n\t\t\t\t\t} );\n\t\t\t\t\tthis.instance = instance;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Trigger 'widget-added' when widget is ready. This event is what\n\t\t\t// widgets' scripts use to initialize, attach events, etc. The event\n\t\t\t// must be fired using jQuery's event bus as this is what widget\n\t\t\t// scripts expect. If jQuery is not loaded, do nothing - some\n\t\t\t// widgets will still work regardless.\n\t\t\tif ( window.jQuery ) {\n\t\t\t\tconst { jQuery: $ } = window;\n\t\t\t\t$( document ).trigger( 'widget-added', [ $( this.element ) ] );\n\t\t\t}\n\t\t} catch ( error ) {\n\t\t\tthis.onError( error );\n\t\t}\n\t}\n\n\t/**\n\t * Perform a save when a multi widget's form is changed. Non-multi widgets\n\t * are saved manually.\n\t *\n\t * @access private\n\t */\n\thandleFormChange() {\n\t\tif ( this.idBase ) {\n\t\t\tthis.saveForm();\n\t\t}\n\t}\n\n\t/**\n\t * Perform a save when the control's form is manually submitted.\n\t *\n\t * @access private\n\t * @param {Event} event\n\t */\n\thandleFormSubmit( event ) {\n\t\tevent.preventDefault();\n\t\tthis.saveForm();\n\t}\n\n\t/**\n\t * Serialize the control's form, send it to the REST API, and update the\n\t * instance with the encoded instance that the REST API returns.\n\t *\n\t * @access private\n\t */\n\tasync saveForm() {\n\t\tconst formData = serializeForm( this.form );\n\n\t\ttry {\n\t\t\tif ( this.id ) {\n\t\t\t\tconst { form } = await saveWidget( this.id, formData );\n\t\t\t\tthis.content.innerHTML = form;\n\n\t\t\t\tif ( window.jQuery ) {\n\t\t\t\t\tconst { jQuery: $ } = window;\n\t\t\t\t\t$( document ).trigger( 'widget-updated', [\n\t\t\t\t\t\t$( this.element ),\n\t\t\t\t\t] );\n\t\t\t\t}\n\t\t\t} else if ( this.idBase ) {\n\t\t\t\tconst { instance, preview } = await encodeWidget( {\n\t\t\t\t\tidBase: this.idBase,\n\t\t\t\t\tinstance: this.instance,\n\t\t\t\t\tnumber: this.number,\n\t\t\t\t\tformData,\n\t\t\t\t} );\n\t\t\t\tthis.instance = instance;\n\t\t\t\tthis.hasPreview = ! isEmptyHTML( preview );\n\t\t\t}\n\t\t} catch ( error ) {\n\t\t\tthis.onError( error );\n\t\t}\n\t}\n\n\t/**\n\t * The widget's instance object.\n\t *\n\t * @access private\n\t */\n\tget instance() {\n\t\treturn this._instance;\n\t}\n\n\t/**\n\t * The widget's instance object.\n\t *\n\t * @access private\n\t */\n\tset instance( instance ) {\n\t\tif ( this._instance !== instance ) {\n\t\t\tthis._instance = instance;\n\t\t\tthis.onChangeInstance( instance );\n\t\t}\n\t}\n\n\t/**\n\t * Whether or not the widget can be previewed.\n\t *\n\t * @access public\n\t */\n\tget hasPreview() {\n\t\treturn this._hasPreview;\n\t}\n\n\t/**\n\t * Whether or not the widget can be previewed.\n\t *\n\t * @access private\n\t */\n\tset hasPreview( hasPreview ) {\n\t\tif ( this._hasPreview !== hasPreview ) {\n\t\t\tthis._hasPreview = hasPreview;\n\t\t\tthis.onChangeHasPreview( hasPreview );\n\t\t}\n\t}\n}\n\nlet lastNumber = 0;\n\nfunction el( tagName, attributes = {}, content = null ) {\n\tconst element = document.createElement( tagName );\n\tfor ( const [ attribute, value ] of Object.entries( attributes ) ) {\n\t\telement.setAttribute( attribute, value );\n\t}\n\tif ( Array.isArray( content ) ) {\n\t\tfor ( const child of content ) {\n\t\t\tif ( child ) {\n\t\t\t\telement.appendChild( child );\n\t\t\t}\n\t\t}\n\t} else if ( typeof content === 'string' ) {\n\t\telement.innerText = content;\n\t}\n\treturn element;\n}\n\nasync function saveWidget( id, formData = null ) {\n\tlet widget;\n\tif ( formData ) {\n\t\twidget = await apiFetch( {\n\t\t\tpath: `/wp/v2/widgets/${ id }?context=edit`,\n\t\t\tmethod: 'PUT',\n\t\t\tdata: {\n\t\t\t\tform_data: formData,\n\t\t\t},\n\t\t} );\n\t} else {\n\t\twidget = await apiFetch( {\n\t\t\tpath: `/wp/v2/widgets/${ id }?context=edit`,\n\t\t\tmethod: 'GET',\n\t\t} );\n\t}\n\treturn { form: widget.rendered_form };\n}\n\nasync function encodeWidget( { idBase, instance, number, formData = null } ) {\n\tconst response = await apiFetch( {\n\t\tpath: `/wp/v2/widget-types/${ idBase }/encode`,\n\t\tmethod: 'POST',\n\t\tdata: {\n\t\t\tinstance,\n\t\t\tnumber,\n\t\t\tform_data: formData,\n\t\t},\n\t} );\n\treturn {\n\t\tinstance: response.instance,\n\t\tform: response.form,\n\t\tpreview: response.preview,\n\t};\n}\n\nfunction isEmptyHTML( html ) {\n\tconst element = document.createElement( 'div' );\n\telement.innerHTML = html;\n\treturn isEmptyNode( element );\n}\n\nfunction isEmptyNode( node ) {\n\tswitch ( node.nodeType ) {\n\t\tcase node.TEXT_NODE:\n\t\t\t// Text nodes are empty if it's entirely whitespace.\n\t\t\treturn node.nodeValue.trim() === '';\n\t\tcase node.ELEMENT_NODE:\n\t\t\t// Elements that are \"embedded content\" are not empty.\n\t\t\t// https://dev.w3.org/html5/spec-LC/content-models.html#embedded-content-0\n\t\t\tif (\n\t\t\t\t[\n\t\t\t\t\t'AUDIO',\n\t\t\t\t\t'CANVAS',\n\t\t\t\t\t'EMBED',\n\t\t\t\t\t'IFRAME',\n\t\t\t\t\t'IMG',\n\t\t\t\t\t'MATH',\n\t\t\t\t\t'OBJECT',\n\t\t\t\t\t'SVG',\n\t\t\t\t\t'VIDEO',\n\t\t\t\t].includes( node.tagName )\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// Elements with no children are empty.\n\t\t\tif ( ! node.hasChildNodes() ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// Elements with children are empty if all their children are empty.\n\t\t\treturn Array.from( node.childNodes ).every( isEmptyNode );\n\t\tdefault:\n\t\t\treturn true;\n\t}\n}\n\nfunction serializeForm( form ) {\n\treturn new window.URLSearchParams(\n\t\tArray.from( new window.FormData( form ) )\n\t).toString();\n}\n"],"mappings":"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","ignoreList":[]}