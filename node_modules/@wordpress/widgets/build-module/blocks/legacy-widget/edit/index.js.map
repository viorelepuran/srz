{"version":3,"names":["clsx","useBlockProps","BlockControls","InspectorControls","BlockIcon","Flex","FlexBlock","Spinner","Placeholder","brush","brushIcon","__","useState","useCallback","useEntityRecord","WidgetTypeSelector","InspectorCard","Form","Preview","NoPreview","ConvertToBlocksButton","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Edit","props","id","idBase","attributes","isWide","blockProps","className","children","Empty","NotEmpty","setAttributes","icon","label","selectedId","onSelect","isMulti","instance","clientId","isSelected","hasPreview","setHasPreview","widgetTypeId","record","widgetType","hasResolved","hasResolvedWidgetType","setInstance","nextInstance","mode","group","rawInstance","raw","name","description","title","isVisible","onChangeInstance","onChangeHasPreview"],"sources":["@wordpress/widgets/src/blocks/legacy-widget/edit/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport clsx from 'clsx';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tuseBlockProps,\n\tBlockControls,\n\tInspectorControls,\n\tBlockIcon,\n} from '@wordpress/block-editor';\nimport { Flex, FlexBlock, Spinner, Placeholder } from '@wordpress/components';\nimport { brush as brushIcon } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\nimport { useState, useCallback } from '@wordpress/element';\nimport { useEntityRecord } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport WidgetTypeSelector from './widget-type-selector';\nimport InspectorCard from './inspector-card';\nimport Form from './form';\nimport Preview from './preview';\nimport NoPreview from './no-preview';\nimport ConvertToBlocksButton from './convert-to-blocks-button';\n\nexport default function Edit( props ) {\n\tconst { id, idBase } = props.attributes;\n\tconst { isWide = false } = props;\n\n\tconst blockProps = useBlockProps( {\n\t\tclassName: clsx( {\n\t\t\t'is-wide-widget': isWide,\n\t\t} ),\n\t} );\n\n\treturn (\n\t\t<div { ...blockProps }>\n\t\t\t{ ! id && ! idBase ? (\n\t\t\t\t<Empty { ...props } />\n\t\t\t) : (\n\t\t\t\t<NotEmpty { ...props } />\n\t\t\t) }\n\t\t</div>\n\t);\n}\n\nfunction Empty( { attributes: { id, idBase }, setAttributes } ) {\n\treturn (\n\t\t<Placeholder\n\t\t\ticon={ <BlockIcon icon={ brushIcon } /> }\n\t\t\tlabel={ __( 'Legacy Widget' ) }\n\t\t>\n\t\t\t<Flex>\n\t\t\t\t<FlexBlock>\n\t\t\t\t\t<WidgetTypeSelector\n\t\t\t\t\t\tselectedId={ id ?? idBase }\n\t\t\t\t\t\tonSelect={ ( { selectedId, isMulti } ) => {\n\t\t\t\t\t\t\tif ( ! selectedId ) {\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t} else if ( isMulti ) {\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tid: null,\n\t\t\t\t\t\t\t\t\tidBase: selectedId,\n\t\t\t\t\t\t\t\t\tinstance: {},\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tid: selectedId,\n\t\t\t\t\t\t\t\t\tidBase: null,\n\t\t\t\t\t\t\t\t\tinstance: null,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t</FlexBlock>\n\t\t\t</Flex>\n\t\t</Placeholder>\n\t);\n}\n\nfunction NotEmpty( {\n\tattributes: { id, idBase, instance },\n\tsetAttributes,\n\tclientId,\n\tisSelected,\n\tisWide = false,\n} ) {\n\tconst [ hasPreview, setHasPreview ] = useState( null );\n\n\tconst widgetTypeId = id ?? idBase;\n\tconst { record: widgetType, hasResolved: hasResolvedWidgetType } =\n\t\tuseEntityRecord( 'root', 'widgetType', widgetTypeId );\n\n\tconst setInstance = useCallback( ( nextInstance ) => {\n\t\tsetAttributes( { instance: nextInstance } );\n\t}, [] );\n\n\tif ( ! widgetType && hasResolvedWidgetType ) {\n\t\treturn (\n\t\t\t<Placeholder\n\t\t\t\ticon={ <BlockIcon icon={ brushIcon } /> }\n\t\t\t\tlabel={ __( 'Legacy Widget' ) }\n\t\t\t>\n\t\t\t\t{ __( 'Widget is missing.' ) }\n\t\t\t</Placeholder>\n\t\t);\n\t}\n\n\tif ( ! hasResolvedWidgetType ) {\n\t\treturn (\n\t\t\t<Placeholder>\n\t\t\t\t<Spinner />\n\t\t\t</Placeholder>\n\t\t);\n\t}\n\n\tconst mode = idBase && ! isSelected ? 'preview' : 'edit';\n\n\treturn (\n\t\t<>\n\t\t\t{ idBase === 'text' && (\n\t\t\t\t<BlockControls group=\"other\">\n\t\t\t\t\t<ConvertToBlocksButton\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\trawInstance={ instance.raw }\n\t\t\t\t\t/>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\n\t\t\t<InspectorControls>\n\t\t\t\t<InspectorCard\n\t\t\t\t\tname={ widgetType.name }\n\t\t\t\t\tdescription={ widgetType.description }\n\t\t\t\t/>\n\t\t\t</InspectorControls>\n\n\t\t\t<Form\n\t\t\t\ttitle={ widgetType.name }\n\t\t\t\tisVisible={ mode === 'edit' }\n\t\t\t\tid={ id }\n\t\t\t\tidBase={ idBase }\n\t\t\t\tinstance={ instance }\n\t\t\t\tisWide={ isWide }\n\t\t\t\tonChangeInstance={ setInstance }\n\t\t\t\tonChangeHasPreview={ setHasPreview }\n\t\t\t/>\n\n\t\t\t{ idBase && (\n\t\t\t\t<>\n\t\t\t\t\t{ hasPreview === null && mode === 'preview' && (\n\t\t\t\t\t\t<Placeholder>\n\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t</Placeholder>\n\t\t\t\t\t) }\n\t\t\t\t\t{ hasPreview === true && (\n\t\t\t\t\t\t<Preview\n\t\t\t\t\t\t\tidBase={ idBase }\n\t\t\t\t\t\t\tinstance={ instance }\n\t\t\t\t\t\t\tisVisible={ mode === 'preview' }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ hasPreview === false && mode === 'preview' && (\n\t\t\t\t\t\t<NoPreview name={ widgetType.name } />\n\t\t\t\t\t) }\n\t\t\t\t</>\n\t\t\t) }\n\t\t</>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}