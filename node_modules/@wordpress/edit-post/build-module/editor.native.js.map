{"version":3,"names":["memize","I18nManager","GestureHandlerRootView","Component","EditorProvider","ErrorBoundary","store","editorStore","parse","serialize","withDispatch","withSelect","compose","subscribeSetFocusOnTitle","subscribeFeaturedImageIdNativeUpdated","SlotFillProvider","coreStore","Layout","jsx","_jsx","Editor","constructor","props","arguments","initialHtmlModeEnabled","mode","switchEditorMode","getEditorSettings","maxSize","setTitleRef","bind","settings","isRTL","componentDidMount","editEntityRecord","postType","postId","subscriptionParentSetFocusOnTitle","postTitleRef","focus","focusTitleWhenAvailable","subscriptionParentFeaturedImageIdNativeUpdated","payload","featured_media","featuredImageId","undoIgnore","componentWillUnmount","remove","titleRef","render","initialEdits","post","initialHtml","editorSettings","normalizedPost","id","title","raw","initialTitle","content","type","status","meta","style","flex","children","useSubRegistry","select","getEditorMode","dispatch"],"sources":["@wordpress/edit-post/src/editor.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport memize from 'memize';\nimport { I18nManager } from 'react-native';\nimport { GestureHandlerRootView } from 'react-native-gesture-handler';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport {\n\tEditorProvider,\n\tErrorBoundary,\n\tstore as editorStore,\n} from '@wordpress/editor';\nimport { parse, serialize } from '@wordpress/blocks';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport {\n\tsubscribeSetFocusOnTitle,\n\tsubscribeFeaturedImageIdNativeUpdated,\n} from '@wordpress/react-native-bridge';\nimport { SlotFillProvider } from '@wordpress/components';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport Layout from './components/layout';\n\nclass Editor extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\tif ( props.initialHtmlModeEnabled && props.mode === 'visual' ) {\n\t\t\t// Enable html mode if the initial mode the parent wants it but we're not already in it.\n\t\t\tthis.props.switchEditorMode( 'text' );\n\t\t}\n\n\t\tthis.getEditorSettings = memize( this.getEditorSettings, {\n\t\t\tmaxSize: 1,\n\t\t} );\n\n\t\tthis.setTitleRef = this.setTitleRef.bind( this );\n\t}\n\n\tgetEditorSettings( settings ) {\n\t\tsettings = {\n\t\t\t...settings,\n\t\t\tisRTL: I18nManager.isRTL,\n\t\t};\n\n\t\treturn settings;\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { editEntityRecord, postType, postId } = this.props;\n\n\t\tthis.subscriptionParentSetFocusOnTitle = subscribeSetFocusOnTitle(\n\t\t\t() => {\n\t\t\t\tif ( this.postTitleRef ) {\n\t\t\t\t\tthis.postTitleRef.focus();\n\t\t\t\t} else {\n\t\t\t\t\t// If the post title ref is not available, we postpone setting focus to when it's available.\n\t\t\t\t\tthis.focusTitleWhenAvailable = true;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentFeaturedImageIdNativeUpdated =\n\t\t\tsubscribeFeaturedImageIdNativeUpdated( ( payload ) => {\n\t\t\t\teditEntityRecord(\n\t\t\t\t\t'postType',\n\t\t\t\t\tpostType,\n\t\t\t\t\tpostId,\n\t\t\t\t\t{ featured_media: payload.featuredImageId },\n\t\t\t\t\t{\n\t\t\t\t\t\tundoIgnore: true,\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this.subscriptionParentSetFocusOnTitle ) {\n\t\t\tthis.subscriptionParentSetFocusOnTitle.remove();\n\t\t}\n\n\t\tif ( this.subscribeFeaturedImageIdNativeUpdated ) {\n\t\t\tthis.subscribeFeaturedImageIdNativeUpdated.remove();\n\t\t}\n\t}\n\n\tsetTitleRef( titleRef ) {\n\t\tif ( this.focusTitleWhenAvailable && ! this.postTitleRef ) {\n\t\t\tthis.focusTitleWhenAvailable = false;\n\t\t\ttitleRef.focus();\n\t\t}\n\n\t\tthis.postTitleRef = titleRef;\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tsettings,\n\t\t\tinitialEdits,\n\t\t\tpost,\n\t\t\tpostId,\n\t\t\tpostType,\n\t\t\tfeaturedImageId,\n\t\t\tinitialHtml,\n\t\t\t...props\n\t\t} = this.props;\n\n\t\tconst editorSettings = this.getEditorSettings( settings );\n\n\t\tconst normalizedPost = post || {\n\t\t\tid: postId,\n\t\t\ttitle: {\n\t\t\t\traw: props.initialTitle || '',\n\t\t\t},\n\t\t\tfeatured_media: featuredImageId,\n\t\t\tcontent: {\n\t\t\t\t// Make sure the post content is in sync with gutenberg store\n\t\t\t\t// to avoid marking the post as modified when simply loaded\n\t\t\t\t// For now, let's assume: serialize( parse( html ) ) !== html.\n\t\t\t\traw: serialize( parse( initialHtml || '' ) ),\n\t\t\t},\n\t\t\ttype: postType,\n\t\t\tstatus: 'draft',\n\t\t\tmeta: [],\n\t\t};\n\n\t\treturn (\n\t\t\t<GestureHandlerRootView style={ { flex: 1 } }>\n\t\t\t\t<SlotFillProvider>\n\t\t\t\t\t<EditorProvider\n\t\t\t\t\t\tsettings={ editorSettings }\n\t\t\t\t\t\tpost={ normalizedPost }\n\t\t\t\t\t\tinitialEdits={ initialEdits }\n\t\t\t\t\t\tuseSubRegistry={ false }\n\t\t\t\t\t\t{ ...props }\n\t\t\t\t\t>\n\t\t\t\t\t\t<ErrorBoundary>\n\t\t\t\t\t\t\t<Layout setTitleRef={ this.setTitleRef } />\n\t\t\t\t\t\t</ErrorBoundary>\n\t\t\t\t\t</EditorProvider>\n\t\t\t\t</SlotFillProvider>\n\t\t\t</GestureHandlerRootView>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst { getEditorMode } = select( editorStore );\n\n\t\treturn {\n\t\t\tmode: getEditorMode(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { switchEditorMode } = dispatch( editorStore );\n\t\tconst { editEntityRecord } = dispatch( coreStore );\n\t\treturn {\n\t\t\tswitchEditorMode,\n\t\t\teditEntityRecord,\n\t\t};\n\t} ),\n] )( Editor );\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAOA,MAAM,MAAM,QAAQ;AAC3B,SAASC,WAAW,QAAQ,cAAc;AAC1C,SAASC,sBAAsB,QAAQ,8BAA8B;;AAErE;AACA;AACA;AACA,SAASC,SAAS,QAAQ,oBAAoB;AAC9C,SACCC,cAAc,EACdC,aAAa,EACbC,KAAK,IAAIC,WAAW,QACd,mBAAmB;AAC1B,SAASC,KAAK,EAAEC,SAAS,QAAQ,mBAAmB;AACpD,SAASC,YAAY,EAAEC,UAAU,QAAQ,iBAAiB;AAC1D,SAASC,OAAO,QAAQ,oBAAoB;AAC5C,SACCC,wBAAwB,EACxBC,qCAAqC,QAC/B,gCAAgC;AACvC,SAASC,gBAAgB,QAAQ,uBAAuB;AACxD,SAAST,KAAK,IAAIU,SAAS,QAAQ,sBAAsB;;AAEzD;AACA;AACA;AACA,OAAOC,MAAM,MAAM,qBAAqB;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAEzC,MAAMC,MAAM,SAASjB,SAAS,CAAC;EAC9BkB,WAAWA,CAAEC,KAAK,EAAG;IACpB,KAAK,CAAE,GAAGC,SAAU,CAAC;IAErB,IAAKD,KAAK,CAACE,sBAAsB,IAAIF,KAAK,CAACG,IAAI,KAAK,QAAQ,EAAG;MAC9D;MACA,IAAI,CAACH,KAAK,CAACI,gBAAgB,CAAE,MAAO,CAAC;IACtC;IAEA,IAAI,CAACC,iBAAiB,GAAG3B,MAAM,CAAE,IAAI,CAAC2B,iBAAiB,EAAE;MACxDC,OAAO,EAAE;IACV,CAAE,CAAC;IAEH,IAAI,CAACC,WAAW,GAAG,IAAI,CAACA,WAAW,CAACC,IAAI,CAAE,IAAK,CAAC;EACjD;EAEAH,iBAAiBA,CAAEI,QAAQ,EAAG;IAC7BA,QAAQ,GAAG;MACV,GAAGA,QAAQ;MACXC,KAAK,EAAE/B,WAAW,CAAC+B;IACpB,CAAC;IAED,OAAOD,QAAQ;EAChB;EAEAE,iBAAiBA,CAAA,EAAG;IACnB,MAAM;MAAEC,gBAAgB;MAAEC,QAAQ;MAAEC;IAAO,CAAC,GAAG,IAAI,CAACd,KAAK;IAEzD,IAAI,CAACe,iCAAiC,GAAGxB,wBAAwB,CAChE,MAAM;MACL,IAAK,IAAI,CAACyB,YAAY,EAAG;QACxB,IAAI,CAACA,YAAY,CAACC,KAAK,CAAC,CAAC;MAC1B,CAAC,MAAM;QACN;QACA,IAAI,CAACC,uBAAuB,GAAG,IAAI;MACpC;IACD,CACD,CAAC;IAED,IAAI,CAACC,8CAA8C,GAClD3B,qCAAqC,CAAI4B,OAAO,IAAM;MACrDR,gBAAgB,CACf,UAAU,EACVC,QAAQ,EACRC,MAAM,EACN;QAAEO,cAAc,EAAED,OAAO,CAACE;MAAgB,CAAC,EAC3C;QACCC,UAAU,EAAE;MACb,CACD,CAAC;IACF,CAAE,CAAC;EACL;EAEAC,oBAAoBA,CAAA,EAAG;IACtB,IAAK,IAAI,CAACT,iCAAiC,EAAG;MAC7C,IAAI,CAACA,iCAAiC,CAACU,MAAM,CAAC,CAAC;IAChD;IAEA,IAAK,IAAI,CAACjC,qCAAqC,EAAG;MACjD,IAAI,CAACA,qCAAqC,CAACiC,MAAM,CAAC,CAAC;IACpD;EACD;EAEAlB,WAAWA,CAAEmB,QAAQ,EAAG;IACvB,IAAK,IAAI,CAACR,uBAAuB,IAAI,CAAE,IAAI,CAACF,YAAY,EAAG;MAC1D,IAAI,CAACE,uBAAuB,GAAG,KAAK;MACpCQ,QAAQ,CAACT,KAAK,CAAC,CAAC;IACjB;IAEA,IAAI,CAACD,YAAY,GAAGU,QAAQ;EAC7B;EAEAC,MAAMA,CAAA,EAAG;IACR,MAAM;MACLlB,QAAQ;MACRmB,YAAY;MACZC,IAAI;MACJf,MAAM;MACND,QAAQ;MACRS,eAAe;MACfQ,WAAW;MACX,GAAG9B;IACJ,CAAC,GAAG,IAAI,CAACA,KAAK;IAEd,MAAM+B,cAAc,GAAG,IAAI,CAAC1B,iBAAiB,CAAEI,QAAS,CAAC;IAEzD,MAAMuB,cAAc,GAAGH,IAAI,IAAI;MAC9BI,EAAE,EAAEnB,MAAM;MACVoB,KAAK,EAAE;QACNC,GAAG,EAAEnC,KAAK,CAACoC,YAAY,IAAI;MAC5B,CAAC;MACDf,cAAc,EAAEC,eAAe;MAC/Be,OAAO,EAAE;QACR;QACA;QACA;QACAF,GAAG,EAAEhD,SAAS,CAAED,KAAK,CAAE4C,WAAW,IAAI,EAAG,CAAE;MAC5C,CAAC;MACDQ,IAAI,EAAEzB,QAAQ;MACd0B,MAAM,EAAE,OAAO;MACfC,IAAI,EAAE;IACP,CAAC;IAED,oBACC3C,IAAA,CAACjB,sBAAsB;MAAC6D,KAAK,EAAG;QAAEC,IAAI,EAAE;MAAE,CAAG;MAAAC,QAAA,eAC5C9C,IAAA,CAACJ,gBAAgB;QAAAkD,QAAA,eAChB9C,IAAA,CAACf,cAAc;UACd2B,QAAQ,EAAGsB,cAAgB;UAC3BF,IAAI,EAAGG,cAAgB;UACvBJ,YAAY,EAAGA,YAAc;UAC7BgB,cAAc,EAAG,KAAO;UAAA,GACnB5C,KAAK;UAAA2C,QAAA,eAEV9C,IAAA,CAACd,aAAa;YAAA4D,QAAA,eACb9C,IAAA,CAACF,MAAM;cAACY,WAAW,EAAG,IAAI,CAACA;YAAa,CAAE;UAAC,CAC7B;QAAC,CACD;MAAC,CACA;IAAC,CACI,CAAC;EAE3B;AACD;AAEA,eAAejB,OAAO,CAAE,CACvBD,UAAU,CAAIwD,MAAM,IAAM;EACzB,MAAM;IAAEC;EAAc,CAAC,GAAGD,MAAM,CAAE5D,WAAY,CAAC;EAE/C,OAAO;IACNkB,IAAI,EAAE2C,aAAa,CAAC;EACrB,CAAC;AACF,CAAE,CAAC,EACH1D,YAAY,CAAI2D,QAAQ,IAAM;EAC7B,MAAM;IAAE3C;EAAiB,CAAC,GAAG2C,QAAQ,CAAE9D,WAAY,CAAC;EACpD,MAAM;IAAE2B;EAAiB,CAAC,GAAGmC,QAAQ,CAAErD,SAAU,CAAC;EAClD,OAAO;IACNU,gBAAgB;IAChBQ;EACD,CAAC;AACF,CAAE,CAAC,CACF,CAAC,CAAEd,MAAO,CAAC","ignoreList":[]}