{"version":3,"names":["encoding","decoding","promise","error","string","deriveKey","secret","roomName","secretBuffer","encodeUtf8","buffer","salt","crypto","subtle","importKey","then","keyMaterial","name","iterations","hash","length","encrypt","data","key","resolve","iv","getRandomValues","Uint8Array","cipher","encryptedDataEncoder","createEncoder","writeVarString","writeVarUint8Array","toUint8Array","encryptJson","dataEncoder","writeAny","decrypt","dataDecoder","createDecoder","algorithm","readVarString","reject","create","readVarUint8Array","decryptJson","decryptedValue","readAny"],"sources":["@wordpress/sync/src/y-webrtc/crypto.js"],"sourcesContent":["// File copied as is from the y-webrtc package.\n/* eslint-disable eslint-comments/disable-enable-pair */\n/* eslint-disable eslint-comments/no-unlimited-disable */\n/* eslint-disable */\n// @ts-nocheck\n/* eslint-env browser */\n\nimport * as encoding from 'lib0/encoding';\nimport * as decoding from 'lib0/decoding';\nimport * as promise from 'lib0/promise';\nimport * as error from 'lib0/error';\nimport * as string from 'lib0/string';\n\n/**\n * @param {string} secret\n * @param {string} roomName\n * @return {PromiseLike<CryptoKey>}\n */\nexport const deriveKey = ( secret, roomName ) => {\n\tconst secretBuffer = string.encodeUtf8( secret ).buffer;\n\tconst salt = string.encodeUtf8( roomName ).buffer;\n\treturn crypto.subtle\n\t\t.importKey( 'raw', secretBuffer, 'PBKDF2', false, [ 'deriveKey' ] )\n\t\t.then( ( keyMaterial ) =>\n\t\t\tcrypto.subtle.deriveKey(\n\t\t\t\t{\n\t\t\t\t\tname: 'PBKDF2',\n\t\t\t\t\tsalt,\n\t\t\t\t\titerations: 100000,\n\t\t\t\t\thash: 'SHA-256',\n\t\t\t\t},\n\t\t\t\tkeyMaterial,\n\t\t\t\t{\n\t\t\t\t\tname: 'AES-GCM',\n\t\t\t\t\tlength: 256,\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t[ 'encrypt', 'decrypt' ]\n\t\t\t)\n\t\t);\n};\n\n/**\n * @param {Uint8Array} data data to be encrypted\n * @param {CryptoKey?} key\n * @return {PromiseLike<Uint8Array>} encrypted, base64 encoded message\n */\nexport const encrypt = ( data, key ) => {\n\tif ( ! key ) {\n\t\treturn /** @type {PromiseLike<Uint8Array>} */ (\n\t\t\tpromise.resolve( data )\n\t\t);\n\t}\n\tconst iv = crypto.getRandomValues( new Uint8Array( 12 ) );\n\treturn crypto.subtle\n\t\t.encrypt(\n\t\t\t{\n\t\t\t\tname: 'AES-GCM',\n\t\t\t\tiv,\n\t\t\t},\n\t\t\tkey,\n\t\t\tdata\n\t\t)\n\t\t.then( ( cipher ) => {\n\t\t\tconst encryptedDataEncoder = encoding.createEncoder();\n\t\t\tencoding.writeVarString( encryptedDataEncoder, 'AES-GCM' );\n\t\t\tencoding.writeVarUint8Array( encryptedDataEncoder, iv );\n\t\t\tencoding.writeVarUint8Array(\n\t\t\t\tencryptedDataEncoder,\n\t\t\t\tnew Uint8Array( cipher )\n\t\t\t);\n\t\t\treturn encoding.toUint8Array( encryptedDataEncoder );\n\t\t} );\n};\n\n/**\n * @param {Object} data data to be encrypted\n * @param {CryptoKey?} key\n * @return {PromiseLike<Uint8Array>} encrypted data, if key is provided\n */\nexport const encryptJson = ( data, key ) => {\n\tconst dataEncoder = encoding.createEncoder();\n\tencoding.writeAny( dataEncoder, data );\n\treturn encrypt( encoding.toUint8Array( dataEncoder ), key );\n};\n\n/**\n * @param {Uint8Array} data\n * @param {CryptoKey?} key\n * @return {PromiseLike<Uint8Array>} decrypted buffer\n */\nexport const decrypt = ( data, key ) => {\n\tif ( ! key ) {\n\t\treturn /** @type {PromiseLike<Uint8Array>} */ (\n\t\t\tpromise.resolve( data )\n\t\t);\n\t}\n\tconst dataDecoder = decoding.createDecoder( data );\n\tconst algorithm = decoding.readVarString( dataDecoder );\n\tif ( algorithm !== 'AES-GCM' ) {\n\t\tpromise.reject( error.create( 'Unknown encryption algorithm' ) );\n\t}\n\tconst iv = decoding.readVarUint8Array( dataDecoder );\n\tconst cipher = decoding.readVarUint8Array( dataDecoder );\n\treturn crypto.subtle\n\t\t.decrypt(\n\t\t\t{\n\t\t\t\tname: 'AES-GCM',\n\t\t\t\tiv,\n\t\t\t},\n\t\t\tkey,\n\t\t\tcipher\n\t\t)\n\t\t.then( ( data ) => new Uint8Array( data ) );\n};\n\n/**\n * @param {Uint8Array} data\n * @param {CryptoKey?} key\n * @return {PromiseLike<Object>} decrypted object\n */\nexport const decryptJson = ( data, key ) =>\n\tdecrypt( data, key ).then( ( decryptedValue ) =>\n\t\tdecoding.readAny(\n\t\t\tdecoding.createDecoder( new Uint8Array( decryptedValue ) )\n\t\t)\n\t);\n"],"mappings":"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","ignoreList":[]}