{"version":3,"names":["encoding","_interopRequireWildcard","require","decoding","promise","error","string","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","deriveKey","secret","roomName","secretBuffer","encodeUtf8","buffer","salt","crypto","subtle","importKey","then","keyMaterial","name","iterations","hash","length","exports","encrypt","data","key","resolve","iv","getRandomValues","Uint8Array","cipher","encryptedDataEncoder","createEncoder","writeVarString","writeVarUint8Array","toUint8Array","encryptJson","dataEncoder","writeAny","decrypt","dataDecoder","createDecoder","algorithm","readVarString","reject","create","readVarUint8Array","decryptJson","decryptedValue","readAny"],"sources":["@wordpress/sync/src/y-webrtc/crypto.js"],"sourcesContent":["// File copied as is from the y-webrtc package.\n/* eslint-disable eslint-comments/disable-enable-pair */\n/* eslint-disable eslint-comments/no-unlimited-disable */\n/* eslint-disable */\n// @ts-nocheck\n/* eslint-env browser */\n\nimport * as encoding from 'lib0/encoding';\nimport * as decoding from 'lib0/decoding';\nimport * as promise from 'lib0/promise';\nimport * as error from 'lib0/error';\nimport * as string from 'lib0/string';\n\n/**\n * @param {string} secret\n * @param {string} roomName\n * @return {PromiseLike<CryptoKey>}\n */\nexport const deriveKey = ( secret, roomName ) => {\n\tconst secretBuffer = string.encodeUtf8( secret ).buffer;\n\tconst salt = string.encodeUtf8( roomName ).buffer;\n\treturn crypto.subtle\n\t\t.importKey( 'raw', secretBuffer, 'PBKDF2', false, [ 'deriveKey' ] )\n\t\t.then( ( keyMaterial ) =>\n\t\t\tcrypto.subtle.deriveKey(\n\t\t\t\t{\n\t\t\t\t\tname: 'PBKDF2',\n\t\t\t\t\tsalt,\n\t\t\t\t\titerations: 100000,\n\t\t\t\t\thash: 'SHA-256',\n\t\t\t\t},\n\t\t\t\tkeyMaterial,\n\t\t\t\t{\n\t\t\t\t\tname: 'AES-GCM',\n\t\t\t\t\tlength: 256,\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t[ 'encrypt', 'decrypt' ]\n\t\t\t)\n\t\t);\n};\n\n/**\n * @param {Uint8Array} data data to be encrypted\n * @param {CryptoKey?} key\n * @return {PromiseLike<Uint8Array>} encrypted, base64 encoded message\n */\nexport const encrypt = ( data, key ) => {\n\tif ( ! key ) {\n\t\treturn /** @type {PromiseLike<Uint8Array>} */ (\n\t\t\tpromise.resolve( data )\n\t\t);\n\t}\n\tconst iv = crypto.getRandomValues( new Uint8Array( 12 ) );\n\treturn crypto.subtle\n\t\t.encrypt(\n\t\t\t{\n\t\t\t\tname: 'AES-GCM',\n\t\t\t\tiv,\n\t\t\t},\n\t\t\tkey,\n\t\t\tdata\n\t\t)\n\t\t.then( ( cipher ) => {\n\t\t\tconst encryptedDataEncoder = encoding.createEncoder();\n\t\t\tencoding.writeVarString( encryptedDataEncoder, 'AES-GCM' );\n\t\t\tencoding.writeVarUint8Array( encryptedDataEncoder, iv );\n\t\t\tencoding.writeVarUint8Array(\n\t\t\t\tencryptedDataEncoder,\n\t\t\t\tnew Uint8Array( cipher )\n\t\t\t);\n\t\t\treturn encoding.toUint8Array( encryptedDataEncoder );\n\t\t} );\n};\n\n/**\n * @param {Object} data data to be encrypted\n * @param {CryptoKey?} key\n * @return {PromiseLike<Uint8Array>} encrypted data, if key is provided\n */\nexport const encryptJson = ( data, key ) => {\n\tconst dataEncoder = encoding.createEncoder();\n\tencoding.writeAny( dataEncoder, data );\n\treturn encrypt( encoding.toUint8Array( dataEncoder ), key );\n};\n\n/**\n * @param {Uint8Array} data\n * @param {CryptoKey?} key\n * @return {PromiseLike<Uint8Array>} decrypted buffer\n */\nexport const decrypt = ( data, key ) => {\n\tif ( ! key ) {\n\t\treturn /** @type {PromiseLike<Uint8Array>} */ (\n\t\t\tpromise.resolve( data )\n\t\t);\n\t}\n\tconst dataDecoder = decoding.createDecoder( data );\n\tconst algorithm = decoding.readVarString( dataDecoder );\n\tif ( algorithm !== 'AES-GCM' ) {\n\t\tpromise.reject( error.create( 'Unknown encryption algorithm' ) );\n\t}\n\tconst iv = decoding.readVarUint8Array( dataDecoder );\n\tconst cipher = decoding.readVarUint8Array( dataDecoder );\n\treturn crypto.subtle\n\t\t.decrypt(\n\t\t\t{\n\t\t\t\tname: 'AES-GCM',\n\t\t\t\tiv,\n\t\t\t},\n\t\t\tkey,\n\t\t\tcipher\n\t\t)\n\t\t.then( ( data ) => new Uint8Array( data ) );\n};\n\n/**\n * @param {Uint8Array} data\n * @param {CryptoKey?} key\n * @return {PromiseLike<Object>} decrypted object\n */\nexport const decryptJson = ( data, key ) =>\n\tdecrypt( data, key ).then( ( decryptedValue ) =>\n\t\tdecoding.readAny(\n\t\t\tdecoding.createDecoder( new Uint8Array( decryptedValue ) )\n\t\t)\n\t);\n"],"mappings":"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","ignoreList":[]}