{"version":3,"names":["_routeRecognizer","_interopRequireDefault","require","_history","_element","_url","_compose","_jsxRuntime","history","createBrowserHistory","RoutesContext","createContext","ConfigContext","exports","pathArg","locationMemo","WeakMap","getLocationWithQuery","location","locationWithQuery","get","query","Object","fromEntries","URLSearchParams","search","set","useLocation","context","useContext","Error","useHistory","beforeNavigate","navigate","useEvent","rawPath","options","_getPath","getQueryArgs","path","getPath","performPush","result","push","buildQueryString","state","isMediumOrBigger","window","matchMedia","matches","document","startViewTransition","transition","Promise","resolve","_options$transition","classname","documentElement","classList","add","finished","finally","remove","useMemo","back","useMatch","matcher","matchResolverArgs","rawQuery","recognize","name","addQueryArgs","areas","widths","params","matchedRoute","handler","resolveFunctions","record","entries","map","key","value","RouterProvider","routes","children","useSyncExternalStore","listen","ret","RouteRecognizer","forEach","route","as","match","config","jsx","Provider"],"sources":["@wordpress/router/src/router.tsx"],"sourcesContent":["/**\n * External dependencies\n */\nimport RouteRecognizer from 'route-recognizer';\nimport { createBrowserHistory } from 'history';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tcreateContext,\n\tuseContext,\n\tuseSyncExternalStore,\n\tuseMemo,\n} from '@wordpress/element';\nimport {\n\taddQueryArgs,\n\tgetQueryArgs,\n\tgetPath,\n\tbuildQueryString,\n} from '@wordpress/url';\nimport { useEvent } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport type { ReactNode } from 'react';\n\nconst history = createBrowserHistory();\ninterface Route {\n\tname: string;\n\tpath: string;\n\tareas: Record< string, ReactNode >;\n\twidths: Record< string, number >;\n}\n\ntype LocationWithQuery = Location & {\n\tquery?: Record< string, any >;\n};\n\ninterface Match {\n\tname: string;\n\tpath: string;\n\tareas: Record< string, ReactNode >;\n\twidths: Record< string, number >;\n\tquery?: Record< string, any >;\n\tparams?: Record< string, any >;\n}\n\nexport type BeforeNavigate = ( arg: {\n\tpath: string;\n\tquery: Record< string, any >;\n} ) => {\n\tpath: string;\n\tquery: Record< string, any >;\n};\n\ninterface Config {\n\tpathArg: string;\n\tbeforeNavigate?: BeforeNavigate;\n}\n\nexport interface NavigationOptions {\n\ttransition?: string;\n\tstate?: Record< string, any >;\n}\n\nconst RoutesContext = createContext< Match | null >( null );\nexport const ConfigContext = createContext< Config >( { pathArg: 'p' } );\n\nconst locationMemo = new WeakMap();\nfunction getLocationWithQuery() {\n\tconst location = history.location;\n\tlet locationWithQuery = locationMemo.get( location );\n\tif ( ! locationWithQuery ) {\n\t\tlocationWithQuery = {\n\t\t\t...location,\n\t\t\tquery: Object.fromEntries( new URLSearchParams( location.search ) ),\n\t\t};\n\t\tlocationMemo.set( location, locationWithQuery );\n\t}\n\treturn locationWithQuery;\n}\n\nexport function useLocation() {\n\tconst context = useContext( RoutesContext );\n\tif ( ! context ) {\n\t\tthrow new Error( 'useLocation must be used within a RouterProvider' );\n\t}\n\treturn context;\n}\n\nexport function useHistory() {\n\tconst { pathArg, beforeNavigate } = useContext( ConfigContext );\n\n\tconst navigate = useEvent(\n\t\tasync ( rawPath: string, options: NavigationOptions = {} ) => {\n\t\t\tconst query = getQueryArgs( rawPath );\n\t\t\tconst path = getPath( 'http://domain.com/' + rawPath ) ?? '';\n\t\t\tconst performPush = () => {\n\t\t\t\tconst result = beforeNavigate\n\t\t\t\t\t? beforeNavigate( { path, query } )\n\t\t\t\t\t: { path, query };\n\t\t\t\treturn history.push(\n\t\t\t\t\t{\n\t\t\t\t\t\tsearch: buildQueryString( {\n\t\t\t\t\t\t\t[ pathArg ]: result.path,\n\t\t\t\t\t\t\t...result.query,\n\t\t\t\t\t\t} ),\n\t\t\t\t\t},\n\t\t\t\t\toptions.state\n\t\t\t\t);\n\t\t\t};\n\n\t\t\t/*\n\t\t\t * Skip transition in mobile, otherwise it crashes the browser.\n\t\t\t * See: https://github.com/WordPress/gutenberg/pull/63002.\n\t\t\t */\n\t\t\tconst isMediumOrBigger =\n\t\t\t\twindow.matchMedia( '(min-width: 782px)' ).matches;\n\t\t\tif (\n\t\t\t\t! isMediumOrBigger ||\n\t\t\t\t! document.startViewTransition ||\n\t\t\t\t! options.transition\n\t\t\t) {\n\t\t\t\tperformPush();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait new Promise< void >( ( resolve ) => {\n\t\t\t\tconst classname = options.transition ?? '';\n\t\t\t\tdocument.documentElement.classList.add( classname );\n\t\t\t\tconst transition = document.startViewTransition( () =>\n\t\t\t\t\tperformPush()\n\t\t\t\t);\n\t\t\t\ttransition.finished.finally( () => {\n\t\t\t\t\tdocument.documentElement.classList.remove( classname );\n\t\t\t\t\tresolve();\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t);\n\n\treturn useMemo(\n\t\t() => ( {\n\t\t\tnavigate,\n\t\t\tback: history.back,\n\t\t} ),\n\t\t[ navigate ]\n\t);\n}\n\nexport default function useMatch(\n\tlocation: LocationWithQuery,\n\tmatcher: RouteRecognizer,\n\tpathArg: string,\n\tmatchResolverArgs: Record< string, any >\n): Match {\n\tconst { query: rawQuery = {} } = location;\n\n\treturn useMemo( () => {\n\t\tconst { [ pathArg ]: path = '/', ...query } = rawQuery;\n\t\tconst result = matcher.recognize( path )?.[ 0 ];\n\t\tif ( ! result ) {\n\t\t\treturn {\n\t\t\t\tname: '404',\n\t\t\t\tpath: addQueryArgs( path, query ),\n\t\t\t\tareas: {},\n\t\t\t\twidths: {},\n\t\t\t\tquery,\n\t\t\t\tparams: {},\n\t\t\t};\n\t\t}\n\n\t\tconst matchedRoute = result.handler as Route;\n\t\tconst resolveFunctions = ( record: Record< string, any > = {} ) => {\n\t\t\treturn Object.fromEntries(\n\t\t\t\tObject.entries( record ).map( ( [ key, value ] ) => {\n\t\t\t\t\tif ( typeof value === 'function' ) {\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tvalue( {\n\t\t\t\t\t\t\t\tquery,\n\t\t\t\t\t\t\t\tparams: result.params,\n\t\t\t\t\t\t\t\t...matchResolverArgs,\n\t\t\t\t\t\t\t} ),\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\t\t\t\t\treturn [ key, value ];\n\t\t\t\t} )\n\t\t\t);\n\t\t};\n\t\treturn {\n\t\t\tname: matchedRoute.name,\n\t\t\tareas: resolveFunctions( matchedRoute.areas ),\n\t\t\twidths: resolveFunctions( matchedRoute.widths ),\n\t\t\tparams: result.params,\n\t\t\tquery,\n\t\t\tpath: addQueryArgs( path, query ),\n\t\t};\n\t}, [ matcher, rawQuery, pathArg, matchResolverArgs ] );\n}\n\nexport function RouterProvider( {\n\troutes,\n\tpathArg,\n\tbeforeNavigate,\n\tchildren,\n\tmatchResolverArgs,\n}: {\n\troutes: Route[];\n\tpathArg: string;\n\tbeforeNavigate?: BeforeNavigate;\n\tchildren: React.ReactNode;\n\tmatchResolverArgs: Record< string, any >;\n} ) {\n\tconst location = useSyncExternalStore(\n\t\thistory.listen,\n\t\tgetLocationWithQuery,\n\t\tgetLocationWithQuery\n\t);\n\tconst matcher = useMemo( () => {\n\t\tconst ret = new RouteRecognizer();\n\t\troutes.forEach( ( route ) => {\n\t\t\tret.add( [ { path: route.path, handler: route } ], {\n\t\t\t\tas: route.name,\n\t\t\t} );\n\t\t} );\n\t\treturn ret;\n\t}, [ routes ] );\n\tconst match = useMatch( location, matcher, pathArg, matchResolverArgs );\n\tconst config = useMemo(\n\t\t() => ( { beforeNavigate, pathArg } ),\n\t\t[ beforeNavigate, pathArg ]\n\t);\n\n\treturn (\n\t\t<ConfigContext.Provider value={ config }>\n\t\t\t<RoutesContext.Provider value={ match }>\n\t\t\t\t{ children }\n\t\t\t</RoutesContext.Provider>\n\t\t</ConfigContext.Provider>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}