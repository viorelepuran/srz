{"version":3,"names":["RouteRecognizer","createBrowserHistory","createContext","useContext","useSyncExternalStore","useMemo","addQueryArgs","getQueryArgs","getPath","buildQueryString","useEvent","jsx","_jsx","history","RoutesContext","ConfigContext","pathArg","locationMemo","WeakMap","getLocationWithQuery","location","locationWithQuery","get","query","Object","fromEntries","URLSearchParams","search","set","useLocation","context","Error","useHistory","beforeNavigate","navigate","rawPath","options","_getPath","path","performPush","result","push","state","isMediumOrBigger","window","matchMedia","matches","document","startViewTransition","transition","Promise","resolve","_options$transition","classname","documentElement","classList","add","finished","finally","remove","back","useMatch","matcher","matchResolverArgs","rawQuery","recognize","name","areas","widths","params","matchedRoute","handler","resolveFunctions","record","entries","map","key","value","RouterProvider","routes","children","listen","ret","forEach","route","as","match","config","Provider"],"sources":["@wordpress/router/src/router.tsx"],"sourcesContent":["/**\n * External dependencies\n */\nimport RouteRecognizer from 'route-recognizer';\nimport { createBrowserHistory } from 'history';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tcreateContext,\n\tuseContext,\n\tuseSyncExternalStore,\n\tuseMemo,\n} from '@wordpress/element';\nimport {\n\taddQueryArgs,\n\tgetQueryArgs,\n\tgetPath,\n\tbuildQueryString,\n} from '@wordpress/url';\nimport { useEvent } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport type { ReactNode } from 'react';\n\nconst history = createBrowserHistory();\ninterface Route {\n\tname: string;\n\tpath: string;\n\tareas: Record< string, ReactNode >;\n\twidths: Record< string, number >;\n}\n\ntype LocationWithQuery = Location & {\n\tquery?: Record< string, any >;\n};\n\ninterface Match {\n\tname: string;\n\tpath: string;\n\tareas: Record< string, ReactNode >;\n\twidths: Record< string, number >;\n\tquery?: Record< string, any >;\n\tparams?: Record< string, any >;\n}\n\nexport type BeforeNavigate = ( arg: {\n\tpath: string;\n\tquery: Record< string, any >;\n} ) => {\n\tpath: string;\n\tquery: Record< string, any >;\n};\n\ninterface Config {\n\tpathArg: string;\n\tbeforeNavigate?: BeforeNavigate;\n}\n\nexport interface NavigationOptions {\n\ttransition?: string;\n\tstate?: Record< string, any >;\n}\n\nconst RoutesContext = createContext< Match | null >( null );\nexport const ConfigContext = createContext< Config >( { pathArg: 'p' } );\n\nconst locationMemo = new WeakMap();\nfunction getLocationWithQuery() {\n\tconst location = history.location;\n\tlet locationWithQuery = locationMemo.get( location );\n\tif ( ! locationWithQuery ) {\n\t\tlocationWithQuery = {\n\t\t\t...location,\n\t\t\tquery: Object.fromEntries( new URLSearchParams( location.search ) ),\n\t\t};\n\t\tlocationMemo.set( location, locationWithQuery );\n\t}\n\treturn locationWithQuery;\n}\n\nexport function useLocation() {\n\tconst context = useContext( RoutesContext );\n\tif ( ! context ) {\n\t\tthrow new Error( 'useLocation must be used within a RouterProvider' );\n\t}\n\treturn context;\n}\n\nexport function useHistory() {\n\tconst { pathArg, beforeNavigate } = useContext( ConfigContext );\n\n\tconst navigate = useEvent(\n\t\tasync ( rawPath: string, options: NavigationOptions = {} ) => {\n\t\t\tconst query = getQueryArgs( rawPath );\n\t\t\tconst path = getPath( 'http://domain.com/' + rawPath ) ?? '';\n\t\t\tconst performPush = () => {\n\t\t\t\tconst result = beforeNavigate\n\t\t\t\t\t? beforeNavigate( { path, query } )\n\t\t\t\t\t: { path, query };\n\t\t\t\treturn history.push(\n\t\t\t\t\t{\n\t\t\t\t\t\tsearch: buildQueryString( {\n\t\t\t\t\t\t\t[ pathArg ]: result.path,\n\t\t\t\t\t\t\t...result.query,\n\t\t\t\t\t\t} ),\n\t\t\t\t\t},\n\t\t\t\t\toptions.state\n\t\t\t\t);\n\t\t\t};\n\n\t\t\t/*\n\t\t\t * Skip transition in mobile, otherwise it crashes the browser.\n\t\t\t * See: https://github.com/WordPress/gutenberg/pull/63002.\n\t\t\t */\n\t\t\tconst isMediumOrBigger =\n\t\t\t\twindow.matchMedia( '(min-width: 782px)' ).matches;\n\t\t\tif (\n\t\t\t\t! isMediumOrBigger ||\n\t\t\t\t! document.startViewTransition ||\n\t\t\t\t! options.transition\n\t\t\t) {\n\t\t\t\tperformPush();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait new Promise< void >( ( resolve ) => {\n\t\t\t\tconst classname = options.transition ?? '';\n\t\t\t\tdocument.documentElement.classList.add( classname );\n\t\t\t\tconst transition = document.startViewTransition( () =>\n\t\t\t\t\tperformPush()\n\t\t\t\t);\n\t\t\t\ttransition.finished.finally( () => {\n\t\t\t\t\tdocument.documentElement.classList.remove( classname );\n\t\t\t\t\tresolve();\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t);\n\n\treturn useMemo(\n\t\t() => ( {\n\t\t\tnavigate,\n\t\t\tback: history.back,\n\t\t} ),\n\t\t[ navigate ]\n\t);\n}\n\nexport default function useMatch(\n\tlocation: LocationWithQuery,\n\tmatcher: RouteRecognizer,\n\tpathArg: string,\n\tmatchResolverArgs: Record< string, any >\n): Match {\n\tconst { query: rawQuery = {} } = location;\n\n\treturn useMemo( () => {\n\t\tconst { [ pathArg ]: path = '/', ...query } = rawQuery;\n\t\tconst result = matcher.recognize( path )?.[ 0 ];\n\t\tif ( ! result ) {\n\t\t\treturn {\n\t\t\t\tname: '404',\n\t\t\t\tpath: addQueryArgs( path, query ),\n\t\t\t\tareas: {},\n\t\t\t\twidths: {},\n\t\t\t\tquery,\n\t\t\t\tparams: {},\n\t\t\t};\n\t\t}\n\n\t\tconst matchedRoute = result.handler as Route;\n\t\tconst resolveFunctions = ( record: Record< string, any > = {} ) => {\n\t\t\treturn Object.fromEntries(\n\t\t\t\tObject.entries( record ).map( ( [ key, value ] ) => {\n\t\t\t\t\tif ( typeof value === 'function' ) {\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tvalue( {\n\t\t\t\t\t\t\t\tquery,\n\t\t\t\t\t\t\t\tparams: result.params,\n\t\t\t\t\t\t\t\t...matchResolverArgs,\n\t\t\t\t\t\t\t} ),\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\t\t\t\t\treturn [ key, value ];\n\t\t\t\t} )\n\t\t\t);\n\t\t};\n\t\treturn {\n\t\t\tname: matchedRoute.name,\n\t\t\tareas: resolveFunctions( matchedRoute.areas ),\n\t\t\twidths: resolveFunctions( matchedRoute.widths ),\n\t\t\tparams: result.params,\n\t\t\tquery,\n\t\t\tpath: addQueryArgs( path, query ),\n\t\t};\n\t}, [ matcher, rawQuery, pathArg, matchResolverArgs ] );\n}\n\nexport function RouterProvider( {\n\troutes,\n\tpathArg,\n\tbeforeNavigate,\n\tchildren,\n\tmatchResolverArgs,\n}: {\n\troutes: Route[];\n\tpathArg: string;\n\tbeforeNavigate?: BeforeNavigate;\n\tchildren: React.ReactNode;\n\tmatchResolverArgs: Record< string, any >;\n} ) {\n\tconst location = useSyncExternalStore(\n\t\thistory.listen,\n\t\tgetLocationWithQuery,\n\t\tgetLocationWithQuery\n\t);\n\tconst matcher = useMemo( () => {\n\t\tconst ret = new RouteRecognizer();\n\t\troutes.forEach( ( route ) => {\n\t\t\tret.add( [ { path: route.path, handler: route } ], {\n\t\t\t\tas: route.name,\n\t\t\t} );\n\t\t} );\n\t\treturn ret;\n\t}, [ routes ] );\n\tconst match = useMatch( location, matcher, pathArg, matchResolverArgs );\n\tconst config = useMemo(\n\t\t() => ( { beforeNavigate, pathArg } ),\n\t\t[ beforeNavigate, pathArg ]\n\t);\n\n\treturn (\n\t\t<ConfigContext.Provider value={ config }>\n\t\t\t<RoutesContext.Provider value={ match }>\n\t\t\t\t{ children }\n\t\t\t</RoutesContext.Provider>\n\t\t</ConfigContext.Provider>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}