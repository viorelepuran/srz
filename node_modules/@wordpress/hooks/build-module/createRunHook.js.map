{"version":3,"names":["createRunHook","hooks","storeKey","returnFirstArg","async","runHook","hookName","args","hooksStore","handlers","runs","process","env","NODE_ENV","all","push","length","undefined","hookInfo","name","currentIndex","asyncRunner","__current","add","result","handler","callback","apply","delete","syncRunner"],"sources":["@wordpress/hooks/src/createRunHook.js"],"sourcesContent":["/**\n * Returns a function which, when invoked, will execute all callbacks\n * registered to a hook of the specified type, optionally returning the final\n * value of the call chain.\n *\n * @param {import('.').Hooks}    hooks          Hooks instance.\n * @param {import('.').StoreKey} storeKey\n * @param {boolean}              returnFirstArg Whether each hook callback is expected to return its first argument.\n * @param {boolean}              async          Whether the hook callback should be run asynchronously\n *\n * @return {(hookName:string, ...args: unknown[]) => undefined|unknown} Function that runs hook callbacks.\n */\nfunction createRunHook( hooks, storeKey, returnFirstArg, async ) {\n\treturn function runHook( hookName, ...args ) {\n\t\tconst hooksStore = hooks[ storeKey ];\n\n\t\tif ( ! hooksStore[ hookName ] ) {\n\t\t\thooksStore[ hookName ] = {\n\t\t\t\thandlers: [],\n\t\t\t\truns: 0,\n\t\t\t};\n\t\t}\n\n\t\thooksStore[ hookName ].runs++;\n\n\t\tconst handlers = hooksStore[ hookName ].handlers;\n\n\t\t// The following code is stripped from production builds.\n\t\tif ( 'production' !== process.env.NODE_ENV ) {\n\t\t\t// Handle any 'all' hooks registered.\n\t\t\tif ( 'hookAdded' !== hookName && hooksStore.all ) {\n\t\t\t\thandlers.push( ...hooksStore.all.handlers );\n\t\t\t}\n\t\t}\n\n\t\tif ( ! handlers || ! handlers.length ) {\n\t\t\treturn returnFirstArg ? args[ 0 ] : undefined;\n\t\t}\n\n\t\tconst hookInfo = {\n\t\t\tname: hookName,\n\t\t\tcurrentIndex: 0,\n\t\t};\n\n\t\tasync function asyncRunner() {\n\t\t\ttry {\n\t\t\t\thooksStore.__current.add( hookInfo );\n\t\t\t\tlet result = returnFirstArg ? args[ 0 ] : undefined;\n\t\t\t\twhile ( hookInfo.currentIndex < handlers.length ) {\n\t\t\t\t\tconst handler = handlers[ hookInfo.currentIndex ];\n\t\t\t\t\tresult = await handler.callback.apply( null, args );\n\t\t\t\t\tif ( returnFirstArg ) {\n\t\t\t\t\t\targs[ 0 ] = result;\n\t\t\t\t\t}\n\t\t\t\t\thookInfo.currentIndex++;\n\t\t\t\t}\n\t\t\t\treturn returnFirstArg ? result : undefined;\n\t\t\t} finally {\n\t\t\t\thooksStore.__current.delete( hookInfo );\n\t\t\t}\n\t\t}\n\n\t\tfunction syncRunner() {\n\t\t\ttry {\n\t\t\t\thooksStore.__current.add( hookInfo );\n\t\t\t\tlet result = returnFirstArg ? args[ 0 ] : undefined;\n\t\t\t\twhile ( hookInfo.currentIndex < handlers.length ) {\n\t\t\t\t\tconst handler = handlers[ hookInfo.currentIndex ];\n\t\t\t\t\tresult = handler.callback.apply( null, args );\n\t\t\t\t\tif ( returnFirstArg ) {\n\t\t\t\t\t\targs[ 0 ] = result;\n\t\t\t\t\t}\n\t\t\t\t\thookInfo.currentIndex++;\n\t\t\t\t}\n\t\t\t\treturn returnFirstArg ? result : undefined;\n\t\t\t} finally {\n\t\t\t\thooksStore.__current.delete( hookInfo );\n\t\t\t}\n\t\t}\n\n\t\treturn ( async ? asyncRunner : syncRunner )();\n\t};\n}\n\nexport default createRunHook;\n"],"mappings":"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","ignoreList":[]}