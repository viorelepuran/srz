{"version":3,"names":["__","useSelect","useDispatch","resolveSelect","subscribe","useState","useMemo","comment","commentIcon","addFilter","store","noticesStore","coreStore","useEntityBlockEditor","blockEditorStore","interfaceStore","PluginSidebar","collabHistorySidebarName","collabSidebarName","Comments","AddComment","editorStore","AddCommentButton","AddCommentToolbarButton","useGlobalStylesContext","getCommentIdsFromBlocks","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","modifyBlockCommentAttributes","settings","attributes","blockCommentId","type","CollabSidebarContent","showCommentBoard","setShowCommentBoard","styles","comments","createNotice","saveEntityRecord","deleteEntityRecord","getEntityRecord","postId","select","getCurrentPostId","_postId","getSelectedBlockClientId","updateBlockAttributes","addNewComment","parentCommentId","args","post","content","comment_type","comment_approved","updatedArgs","parent","savedRecord","id","isDismissible","onError","onCommentResolve","commentId","status","onEditComment","onCommentDelete","childComment","undefined","className","style","children","onSubmit","threads","onAddReply","CollabSidebar","enableComplementaryArea","getActiveComplementaryArea","postType","postStatus","getCurrentPostType","data","getEntityRecords","per_page","getEditedPostAttribute","getBlockAttributes","_clientId","openCollabBoard","blocks","resultComments","sortedThreads","compare","result","filteredComments","filter","forEach","item","reply","push","length","updatedResult","map","reverse","blockCommentIds","threadIdMap","Map","thread","sortedComments","get","merged","GlobalStyles","backgroundColor","color","background","unsubscribe","activeSidebar","AddCommentComponent","onClick","identifier","title","icon","isPinnable","header","headerClassName"],"sources":["@wordpress/editor/src/components/collab-sidebar/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport {\n\tuseSelect,\n\tuseDispatch,\n\tresolveSelect,\n\tsubscribe,\n} from '@wordpress/data';\nimport { useState, useMemo } from '@wordpress/element';\nimport { comment as commentIcon } from '@wordpress/icons';\nimport { addFilter } from '@wordpress/hooks';\nimport { store as noticesStore } from '@wordpress/notices';\nimport { store as coreStore, useEntityBlockEditor } from '@wordpress/core-data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { store as interfaceStore } from '@wordpress/interface';\n\n/**\n * Internal dependencies\n */\nimport PluginSidebar from '../plugin-sidebar';\nimport { collabHistorySidebarName, collabSidebarName } from './constants';\nimport { Comments } from './comments';\nimport { AddComment } from './add-comment';\nimport { store as editorStore } from '../../store';\nimport AddCommentButton from './comment-button';\nimport AddCommentToolbarButton from './comment-button-toolbar';\nimport { useGlobalStylesContext } from '../global-styles-provider';\nimport { getCommentIdsFromBlocks } from './utils';\n\nconst modifyBlockCommentAttributes = ( settings ) => {\n\tif ( ! settings.attributes.blockCommentId ) {\n\t\tsettings.attributes = {\n\t\t\t...settings.attributes,\n\t\t\tblockCommentId: {\n\t\t\t\ttype: 'number',\n\t\t\t},\n\t\t};\n\t}\n\n\treturn settings;\n};\n\n// Apply the filter to all core blocks\naddFilter(\n\t'blocks.registerBlockType',\n\t'block-comment/modify-core-block-attributes',\n\tmodifyBlockCommentAttributes\n);\n\nfunction CollabSidebarContent( {\n\tshowCommentBoard,\n\tsetShowCommentBoard,\n\tstyles,\n\tcomments,\n} ) {\n\tconst { createNotice } = useDispatch( noticesStore );\n\tconst { saveEntityRecord, deleteEntityRecord } = useDispatch( coreStore );\n\tconst { getEntityRecord } = resolveSelect( coreStore );\n\n\tconst { postId } = useSelect( ( select ) => {\n\t\tconst { getCurrentPostId } = select( editorStore );\n\t\tconst _postId = getCurrentPostId();\n\n\t\treturn {\n\t\t\tpostId: _postId,\n\t\t};\n\t}, [] );\n\n\tconst { getSelectedBlockClientId } = useSelect( blockEditorStore );\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\n\t// Function to save the comment.\n\tconst addNewComment = async ( comment, parentCommentId ) => {\n\t\tconst args = {\n\t\t\tpost: postId,\n\t\t\tcontent: comment,\n\t\t\tcomment_type: 'block_comment',\n\t\t\tcomment_approved: 0,\n\t\t};\n\n\t\t// Create a new object, conditionally including the parent property\n\t\tconst updatedArgs = {\n\t\t\t...args,\n\t\t\t...( parentCommentId ? { parent: parentCommentId } : {} ),\n\t\t};\n\n\t\tconst savedRecord = await saveEntityRecord(\n\t\t\t'root',\n\t\t\t'comment',\n\t\t\tupdatedArgs\n\t\t);\n\n\t\tif ( savedRecord ) {\n\t\t\t// If it's a main comment, update the block attributes with the comment id.\n\t\t\tif ( ! parentCommentId ) {\n\t\t\t\tupdateBlockAttributes( getSelectedBlockClientId(), {\n\t\t\t\t\tblockCommentId: savedRecord?.id,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tcreateNotice(\n\t\t\t\t'snackbar',\n\t\t\t\tparentCommentId\n\t\t\t\t\t? // translators: Reply added successfully\n\t\t\t\t\t  __( 'Reply added successfully.' )\n\t\t\t\t\t: // translators: Comment added successfully\n\t\t\t\t\t  __( 'Comment added successfully.' ),\n\t\t\t\t{\n\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t\tisDismissible: true,\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tonError();\n\t\t}\n\t};\n\n\tconst onCommentResolve = async ( commentId ) => {\n\t\tconst savedRecord = await saveEntityRecord( 'root', 'comment', {\n\t\t\tid: commentId,\n\t\t\tstatus: 'approved',\n\t\t} );\n\n\t\tif ( savedRecord ) {\n\t\t\t// translators: Comment resolved successfully\n\t\t\tcreateNotice( 'snackbar', __( 'Comment marked as resolved.' ), {\n\t\t\t\ttype: 'snackbar',\n\t\t\t\tisDismissible: true,\n\t\t\t} );\n\t\t} else {\n\t\t\tonError();\n\t\t}\n\t};\n\n\tconst onEditComment = async ( commentId, comment ) => {\n\t\tconst savedRecord = await saveEntityRecord( 'root', 'comment', {\n\t\t\tid: commentId,\n\t\t\tcontent: comment,\n\t\t} );\n\n\t\tif ( savedRecord ) {\n\t\t\tcreateNotice(\n\t\t\t\t'snackbar',\n\t\t\t\t// translators: Comment edited successfully\n\t\t\t\t__( 'Comment edited successfully.' ),\n\t\t\t\t{\n\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t\tisDismissible: true,\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tonError();\n\t\t}\n\t};\n\n\tconst onError = () => {\n\t\tcreateNotice(\n\t\t\t'error',\n\t\t\t// translators: Error message when comment submission fails\n\t\t\t__(\n\t\t\t\t'Something went wrong. Please try publishing the post, or you may have already submitted your comment earlier.'\n\t\t\t),\n\t\t\t{\n\t\t\t\tisDismissible: true,\n\t\t\t}\n\t\t);\n\t};\n\n\tconst onCommentDelete = async ( commentId ) => {\n\t\tconst childComment = await getEntityRecord(\n\t\t\t'root',\n\t\t\t'comment',\n\t\t\tcommentId\n\t\t);\n\t\tawait deleteEntityRecord( 'root', 'comment', commentId );\n\n\t\tif ( childComment && ! childComment.parent ) {\n\t\t\tupdateBlockAttributes( getSelectedBlockClientId(), {\n\t\t\t\tblockCommentId: undefined,\n\t\t\t} );\n\t\t}\n\n\t\tcreateNotice(\n\t\t\t'snackbar',\n\t\t\t// translators: Comment deleted successfully\n\t\t\t__( 'Comment deleted successfully.' ),\n\t\t\t{\n\t\t\t\ttype: 'snackbar',\n\t\t\t\tisDismissible: true,\n\t\t\t}\n\t\t);\n\t};\n\n\treturn (\n\t\t<div className=\"editor-collab-sidebar-panel\" style={ styles }>\n\t\t\t<AddComment\n\t\t\t\tonSubmit={ addNewComment }\n\t\t\t\tshowCommentBoard={ showCommentBoard }\n\t\t\t\tsetShowCommentBoard={ setShowCommentBoard }\n\t\t\t/>\n\t\t\t<Comments\n\t\t\t\tkey={ getSelectedBlockClientId() }\n\t\t\t\tthreads={ comments }\n\t\t\t\tonEditComment={ onEditComment }\n\t\t\t\tonAddReply={ addNewComment }\n\t\t\t\tonCommentDelete={ onCommentDelete }\n\t\t\t\tonCommentResolve={ onCommentResolve }\n\t\t\t\tshowCommentBoard={ showCommentBoard }\n\t\t\t\tsetShowCommentBoard={ setShowCommentBoard }\n\t\t\t/>\n\t\t</div>\n\t);\n}\n\n/**\n * Renders the Collab sidebar.\n */\nexport default function CollabSidebar() {\n\tconst [ showCommentBoard, setShowCommentBoard ] = useState( false );\n\tconst { enableComplementaryArea } = useDispatch( interfaceStore );\n\tconst { getActiveComplementaryArea } = useSelect( interfaceStore );\n\n\tconst { postId, postType, postStatus, threads } = useSelect( ( select ) => {\n\t\tconst { getCurrentPostId, getCurrentPostType } = select( editorStore );\n\t\tconst _postId = getCurrentPostId();\n\t\tconst data =\n\t\t\t!! _postId && typeof _postId === 'number'\n\t\t\t\t? select( coreStore ).getEntityRecords( 'root', 'comment', {\n\t\t\t\t\t\tpost: _postId,\n\t\t\t\t\t\ttype: 'block_comment',\n\t\t\t\t\t\tstatus: 'any',\n\t\t\t\t\t\tper_page: 100,\n\t\t\t\t  } )\n\t\t\t\t: null;\n\t\treturn {\n\t\t\tpostId: _postId,\n\t\t\tpostType: getCurrentPostType(),\n\t\t\tpostStatus:\n\t\t\t\tselect( editorStore ).getEditedPostAttribute( 'status' ),\n\t\t\tthreads: data,\n\t\t};\n\t}, [] );\n\n\tconst { blockCommentId } = useSelect( ( select ) => {\n\t\tconst { getBlockAttributes, getSelectedBlockClientId } =\n\t\t\tselect( blockEditorStore );\n\t\tconst _clientId = getSelectedBlockClientId();\n\n\t\treturn {\n\t\t\tblockCommentId: _clientId\n\t\t\t\t? getBlockAttributes( _clientId )?.blockCommentId\n\t\t\t\t: null,\n\t\t};\n\t}, [] );\n\n\tconst openCollabBoard = () => {\n\t\tsetShowCommentBoard( true );\n\t\tenableComplementaryArea( 'core', 'edit-post/collab-sidebar' );\n\t};\n\n\tconst [ blocks ] = useEntityBlockEditor( 'postType', postType, {\n\t\tid: postId,\n\t} );\n\n\t// Process comments to build the tree structure\n\tconst { resultComments, sortedThreads } = useMemo( () => {\n\t\t// Create a compare to store the references to all objects by id\n\t\tconst compare = {};\n\t\tconst result = [];\n\n\t\tconst filteredComments = ( threads ?? [] ).filter(\n\t\t\t( comment ) => comment.status !== 'trash'\n\t\t);\n\n\t\t// Initialize each object with an empty `reply` array\n\t\tfilteredComments.forEach( ( item ) => {\n\t\t\tcompare[ item.id ] = { ...item, reply: [] };\n\t\t} );\n\n\t\t// Iterate over the data to build the tree structure\n\t\tfilteredComments.forEach( ( item ) => {\n\t\t\tif ( item.parent === 0 ) {\n\t\t\t\t// If parent is 0, it's a root item, push it to the result array\n\t\t\t\tresult.push( compare[ item.id ] );\n\t\t\t} else if ( compare[ item.parent ] ) {\n\t\t\t\t// Otherwise, find its parent and push it to the parent's `reply` array\n\t\t\t\tcompare[ item.parent ].reply.push( compare[ item.id ] );\n\t\t\t}\n\t\t} );\n\n\t\tif ( 0 === result?.length ) {\n\t\t\treturn { resultComments: [], sortedThreads: [] };\n\t\t}\n\n\t\tconst updatedResult = result.map( ( item ) => ( {\n\t\t\t...item,\n\t\t\treply: [ ...item.reply ].reverse(),\n\t\t} ) );\n\n\t\tconst blockCommentIds = getCommentIdsFromBlocks( blocks );\n\n\t\tconst threadIdMap = new Map(\n\t\t\tupdatedResult.map( ( thread ) => [ thread.id, thread ] )\n\t\t);\n\n\t\tconst sortedComments = blockCommentIds\n\t\t\t.map( ( id ) => threadIdMap.get( id ) )\n\t\t\t.filter( ( thread ) => thread !== undefined );\n\n\t\treturn { resultComments: updatedResult, sortedThreads: sortedComments };\n\t}, [ threads, blocks ] );\n\n\t// Get the global styles to set the background color of the sidebar.\n\tconst { merged: GlobalStyles } = useGlobalStylesContext();\n\tconst backgroundColor = GlobalStyles?.styles?.color?.background;\n\n\tif ( 0 < resultComments.length ) {\n\t\tconst unsubscribe = subscribe( () => {\n\t\t\tconst activeSidebar = getActiveComplementaryArea( 'core' );\n\n\t\t\tif ( ! activeSidebar ) {\n\t\t\t\tenableComplementaryArea( 'core', collabSidebarName );\n\t\t\t\tunsubscribe();\n\t\t\t}\n\t\t} );\n\t}\n\n\tif ( postStatus === 'publish' ) {\n\t\treturn null; // or maybe return some message indicating no threads are available.\n\t}\n\n\tconst AddCommentComponent = blockCommentId\n\t\t? AddCommentToolbarButton\n\t\t: AddCommentButton;\n\n\treturn (\n\t\t<>\n\t\t\t<AddCommentComponent onClick={ openCollabBoard } />\n\t\t\t<PluginSidebar\n\t\t\t\tidentifier={ collabHistorySidebarName }\n\t\t\t\t// translators: Comments sidebar title\n\t\t\t\ttitle={ __( 'Comments' ) }\n\t\t\t\ticon={ commentIcon }\n\t\t\t>\n\t\t\t\t<CollabSidebarContent\n\t\t\t\t\tcomments={ resultComments }\n\t\t\t\t\tshowCommentBoard={ showCommentBoard }\n\t\t\t\t\tsetShowCommentBoard={ setShowCommentBoard }\n\t\t\t\t/>\n\t\t\t</PluginSidebar>\n\t\t\t<PluginSidebar\n\t\t\t\tisPinnable={ false }\n\t\t\t\theader={ false }\n\t\t\t\tidentifier={ collabSidebarName }\n\t\t\t\tclassName=\"editor-collab-sidebar\"\n\t\t\t\theaderClassName=\"editor-collab-sidebar__header\"\n\t\t\t>\n\t\t\t\t<CollabSidebarContent\n\t\t\t\t\tcomments={ sortedThreads }\n\t\t\t\t\tshowCommentBoard={ showCommentBoard }\n\t\t\t\t\tsetShowCommentBoard={ setShowCommentBoard }\n\t\t\t\t\tstyles={ {\n\t\t\t\t\t\tbackgroundColor,\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t</PluginSidebar>\n\t\t</>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}