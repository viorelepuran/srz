{"version":3,"names":["useSelect","useDispatch","store","preferencesStore","hasBlockSupport","blocksStore","useMemo","privateApis","blockEditorPrivateApis","editorStore","unlock","jsx","_jsx","BlockManager","EMPTY_ARRAY","BlockVisibility","showBlockTypes","hideBlockTypes","blockTypes","allowedBlockTypes","_allowedBlockTypes","hiddenBlockTypes","_hiddenBlockTypes","select","_select$get","getBlockTypes","getEditorSettings","get","filter","name","includes","filteredBlockTypes","blockType","parent","hiddenBlock","some","registeredBlock","selectedBlockTypes","onChangeSelectedBlockTypes","newSelectedBlockTypes","length","blockTypesToHide","find","map","blockTypesToShow","onChange"],"sources":["@wordpress/editor/src/components/preferences-modal/block-visibility.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { store as preferencesStore } from '@wordpress/preferences';\nimport { hasBlockSupport, store as blocksStore } from '@wordpress/blocks';\nimport { useMemo } from '@wordpress/element';\nimport { privateApis as blockEditorPrivateApis } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { store as editorStore } from '../../store';\nimport { unlock } from '../../lock-unlock';\n\nconst { BlockManager } = unlock( blockEditorPrivateApis );\nconst EMPTY_ARRAY = [];\n\nexport default function BlockVisibility() {\n\tconst { showBlockTypes, hideBlockTypes } = unlock(\n\t\tuseDispatch( editorStore )\n\t);\n\n\tconst {\n\t\tblockTypes,\n\t\tallowedBlockTypes: _allowedBlockTypes,\n\t\thiddenBlockTypes: _hiddenBlockTypes,\n\t} = useSelect( ( select ) => {\n\t\treturn {\n\t\t\tblockTypes: select( blocksStore ).getBlockTypes(),\n\t\t\tallowedBlockTypes:\n\t\t\t\tselect( editorStore ).getEditorSettings().allowedBlockTypes,\n\t\t\thiddenBlockTypes:\n\t\t\t\tselect( preferencesStore ).get( 'core', 'hiddenBlockTypes' ) ??\n\t\t\t\tEMPTY_ARRAY,\n\t\t};\n\t}, [] );\n\n\tconst allowedBlockTypes = useMemo( () => {\n\t\tif ( _allowedBlockTypes === true ) {\n\t\t\treturn blockTypes;\n\t\t}\n\t\treturn blockTypes.filter( ( { name } ) => {\n\t\t\treturn _allowedBlockTypes?.includes( name );\n\t\t} );\n\t}, [ _allowedBlockTypes, blockTypes ] );\n\n\tconst filteredBlockTypes = allowedBlockTypes.filter(\n\t\t( blockType ) =>\n\t\t\thasBlockSupport( blockType, 'inserter', true ) &&\n\t\t\t( ! blockType.parent ||\n\t\t\t\tblockType.parent.includes( 'core/post-content' ) )\n\t);\n\n\t// Some hidden blocks become unregistered\n\t// by removing for instance the plugin that registered them, yet\n\t// they're still remain as hidden by the user's action.\n\t// We consider \"hidden\", blocks which were hidden and\n\t// are still registered.\n\tconst hiddenBlockTypes = _hiddenBlockTypes.filter( ( hiddenBlock ) => {\n\t\treturn filteredBlockTypes.some(\n\t\t\t( registeredBlock ) => registeredBlock.name === hiddenBlock\n\t\t);\n\t} );\n\n\tconst selectedBlockTypes = filteredBlockTypes.filter(\n\t\t( blockType ) => ! hiddenBlockTypes.includes( blockType.name )\n\t);\n\n\tconst onChangeSelectedBlockTypes = ( newSelectedBlockTypes ) => {\n\t\tif ( selectedBlockTypes.length > newSelectedBlockTypes.length ) {\n\t\t\tconst blockTypesToHide = selectedBlockTypes.filter(\n\t\t\t\t( blockType ) =>\n\t\t\t\t\t! newSelectedBlockTypes.find(\n\t\t\t\t\t\t( { name } ) => name === blockType.name\n\t\t\t\t\t)\n\t\t\t);\n\t\t\thideBlockTypes( blockTypesToHide.map( ( { name } ) => name ) );\n\t\t} else if ( selectedBlockTypes.length < newSelectedBlockTypes.length ) {\n\t\t\tconst blockTypesToShow = newSelectedBlockTypes.filter(\n\t\t\t\t( blockType ) =>\n\t\t\t\t\t! selectedBlockTypes.find(\n\t\t\t\t\t\t( { name } ) => name === blockType.name\n\t\t\t\t\t)\n\t\t\t);\n\t\t\tshowBlockTypes( blockTypesToShow.map( ( { name } ) => name ) );\n\t\t}\n\t};\n\n\treturn (\n\t\t<BlockManager\n\t\t\tblockTypes={ filteredBlockTypes }\n\t\t\tselectedBlockTypes={ selectedBlockTypes }\n\t\t\tonChange={ onChangeSelectedBlockTypes }\n\t\t/>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}