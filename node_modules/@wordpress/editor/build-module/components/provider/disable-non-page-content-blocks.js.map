{"version":3,"names":["useSelect","useRegistry","store","blockEditorStore","useEffect","usePostContentBlocks","DisableNonPageContentBlocks","contentOnlyIds","templateParts","isNavigationMode","select","getBlocksByName","_isNavigationMode","disabledIds","getBlockOrder","flatMap","clientId","registry","setBlockEditingMode","unsetBlockEditingMode","dispatch","batch"],"sources":["@wordpress/editor/src/components/provider/disable-non-page-content-blocks.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect, useRegistry } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useEffect } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport usePostContentBlocks from './use-post-content-blocks';\n\n/**\n * Component that when rendered, makes it so that the site editor allows only\n * page content to be edited.\n */\nexport default function DisableNonPageContentBlocks() {\n\tconst contentOnlyIds = usePostContentBlocks();\n\tconst { templateParts, isNavigationMode } = useSelect( ( select ) => {\n\t\tconst { getBlocksByName, isNavigationMode: _isNavigationMode } =\n\t\t\tselect( blockEditorStore );\n\t\treturn {\n\t\t\ttemplateParts: getBlocksByName( 'core/template-part' ),\n\t\t\tisNavigationMode: _isNavigationMode(),\n\t\t};\n\t}, [] );\n\tconst disabledIds = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getBlockOrder } = select( blockEditorStore );\n\t\t\treturn templateParts.flatMap( ( clientId ) =>\n\t\t\t\tgetBlockOrder( clientId )\n\t\t\t);\n\t\t},\n\t\t[ templateParts ]\n\t);\n\n\tconst registry = useRegistry();\n\n\t// The code here is split into multiple `useEffects` calls.\n\t// This is done to avoid setting/unsetting block editing modes multiple times unnecessarily.\n\t//\n\t// For example, the block editing mode of the root block (clientId: '') only\n\t// needs to be set once, not when `contentOnlyIds` or `disabledIds` change.\n\t//\n\t// It's also unlikely that these different types of blocks are being inserted\n\t// or removed at the same time, so using different effects reflects that.\n\tuseEffect( () => {\n\t\tconst { setBlockEditingMode, unsetBlockEditingMode } =\n\t\t\tregistry.dispatch( blockEditorStore );\n\n\t\tsetBlockEditingMode( '', 'disabled' );\n\n\t\treturn () => {\n\t\t\tunsetBlockEditingMode( '' );\n\t\t};\n\t}, [ registry ] );\n\n\tuseEffect( () => {\n\t\tconst { setBlockEditingMode, unsetBlockEditingMode } =\n\t\t\tregistry.dispatch( blockEditorStore );\n\n\t\tregistry.batch( () => {\n\t\t\tfor ( const clientId of contentOnlyIds ) {\n\t\t\t\tsetBlockEditingMode( clientId, 'contentOnly' );\n\t\t\t}\n\t\t} );\n\n\t\treturn () => {\n\t\t\tregistry.batch( () => {\n\t\t\t\tfor ( const clientId of contentOnlyIds ) {\n\t\t\t\t\tunsetBlockEditingMode( clientId );\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\t}, [ contentOnlyIds, registry ] );\n\n\tuseEffect( () => {\n\t\tconst { setBlockEditingMode, unsetBlockEditingMode } =\n\t\t\tregistry.dispatch( blockEditorStore );\n\n\t\tregistry.batch( () => {\n\t\t\tif ( ! isNavigationMode ) {\n\t\t\t\tfor ( const clientId of templateParts ) {\n\t\t\t\t\tsetBlockEditingMode( clientId, 'contentOnly' );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\n\t\treturn () => {\n\t\t\tregistry.batch( () => {\n\t\t\t\tif ( ! isNavigationMode ) {\n\t\t\t\t\tfor ( const clientId of templateParts ) {\n\t\t\t\t\t\tunsetBlockEditingMode( clientId );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\t}, [ templateParts, isNavigationMode, registry ] );\n\n\tuseEffect( () => {\n\t\tconst { setBlockEditingMode, unsetBlockEditingMode } =\n\t\t\tregistry.dispatch( blockEditorStore );\n\n\t\tregistry.batch( () => {\n\t\t\tfor ( const clientId of disabledIds ) {\n\t\t\t\tsetBlockEditingMode( clientId, 'disabled' );\n\t\t\t}\n\t\t} );\n\n\t\treturn () => {\n\t\t\tregistry.batch( () => {\n\t\t\t\tfor ( const clientId of disabledIds ) {\n\t\t\t\t\tunsetBlockEditingMode( clientId );\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\t}, [ disabledIds, registry ] );\n\n\treturn null;\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,EAAEC,WAAW,QAAQ,iBAAiB;AACxD,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,yBAAyB;AACnE,SAASC,SAAS,QAAQ,oBAAoB;;AAE9C;AACA;AACA;AACA,OAAOC,oBAAoB,MAAM,2BAA2B;;AAE5D;AACA;AACA;AACA;AACA,eAAe,SAASC,2BAA2BA,CAAA,EAAG;EACrD,MAAMC,cAAc,GAAGF,oBAAoB,CAAC,CAAC;EAC7C,MAAM;IAAEG,aAAa;IAAEC;EAAiB,CAAC,GAAGT,SAAS,CAAIU,MAAM,IAAM;IACpE,MAAM;MAAEC,eAAe;MAAEF,gBAAgB,EAAEG;IAAkB,CAAC,GAC7DF,MAAM,CAAEP,gBAAiB,CAAC;IAC3B,OAAO;MACNK,aAAa,EAAEG,eAAe,CAAE,oBAAqB,CAAC;MACtDF,gBAAgB,EAAEG,iBAAiB,CAAC;IACrC,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EACP,MAAMC,WAAW,GAAGb,SAAS,CAC1BU,MAAM,IAAM;IACb,MAAM;MAAEI;IAAc,CAAC,GAAGJ,MAAM,CAAEP,gBAAiB,CAAC;IACpD,OAAOK,aAAa,CAACO,OAAO,CAAIC,QAAQ,IACvCF,aAAa,CAAEE,QAAS,CACzB,CAAC;EACF,CAAC,EACD,CAAER,aAAa,CAChB,CAAC;EAED,MAAMS,QAAQ,GAAGhB,WAAW,CAAC,CAAC;;EAE9B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACAG,SAAS,CAAE,MAAM;IAChB,MAAM;MAAEc,mBAAmB;MAAEC;IAAsB,CAAC,GACnDF,QAAQ,CAACG,QAAQ,CAAEjB,gBAAiB,CAAC;IAEtCe,mBAAmB,CAAE,EAAE,EAAE,UAAW,CAAC;IAErC,OAAO,MAAM;MACZC,qBAAqB,CAAE,EAAG,CAAC;IAC5B,CAAC;EACF,CAAC,EAAE,CAAEF,QAAQ,CAAG,CAAC;EAEjBb,SAAS,CAAE,MAAM;IAChB,MAAM;MAAEc,mBAAmB;MAAEC;IAAsB,CAAC,GACnDF,QAAQ,CAACG,QAAQ,CAAEjB,gBAAiB,CAAC;IAEtCc,QAAQ,CAACI,KAAK,CAAE,MAAM;MACrB,KAAM,MAAML,QAAQ,IAAIT,cAAc,EAAG;QACxCW,mBAAmB,CAAEF,QAAQ,EAAE,aAAc,CAAC;MAC/C;IACD,CAAE,CAAC;IAEH,OAAO,MAAM;MACZC,QAAQ,CAACI,KAAK,CAAE,MAAM;QACrB,KAAM,MAAML,QAAQ,IAAIT,cAAc,EAAG;UACxCY,qBAAqB,CAAEH,QAAS,CAAC;QAClC;MACD,CAAE,CAAC;IACJ,CAAC;EACF,CAAC,EAAE,CAAET,cAAc,EAAEU,QAAQ,CAAG,CAAC;EAEjCb,SAAS,CAAE,MAAM;IAChB,MAAM;MAAEc,mBAAmB;MAAEC;IAAsB,CAAC,GACnDF,QAAQ,CAACG,QAAQ,CAAEjB,gBAAiB,CAAC;IAEtCc,QAAQ,CAACI,KAAK,CAAE,MAAM;MACrB,IAAK,CAAEZ,gBAAgB,EAAG;QACzB,KAAM,MAAMO,QAAQ,IAAIR,aAAa,EAAG;UACvCU,mBAAmB,CAAEF,QAAQ,EAAE,aAAc,CAAC;QAC/C;MACD;IACD,CAAE,CAAC;IAEH,OAAO,MAAM;MACZC,QAAQ,CAACI,KAAK,CAAE,MAAM;QACrB,IAAK,CAAEZ,gBAAgB,EAAG;UACzB,KAAM,MAAMO,QAAQ,IAAIR,aAAa,EAAG;YACvCW,qBAAqB,CAAEH,QAAS,CAAC;UAClC;QACD;MACD,CAAE,CAAC;IACJ,CAAC;EACF,CAAC,EAAE,CAAER,aAAa,EAAEC,gBAAgB,EAAEQ,QAAQ,CAAG,CAAC;EAElDb,SAAS,CAAE,MAAM;IAChB,MAAM;MAAEc,mBAAmB;MAAEC;IAAsB,CAAC,GACnDF,QAAQ,CAACG,QAAQ,CAAEjB,gBAAiB,CAAC;IAEtCc,QAAQ,CAACI,KAAK,CAAE,MAAM;MACrB,KAAM,MAAML,QAAQ,IAAIH,WAAW,EAAG;QACrCK,mBAAmB,CAAEF,QAAQ,EAAE,UAAW,CAAC;MAC5C;IACD,CAAE,CAAC;IAEH,OAAO,MAAM;MACZC,QAAQ,CAACI,KAAK,CAAE,MAAM;QACrB,KAAM,MAAML,QAAQ,IAAIH,WAAW,EAAG;UACrCM,qBAAqB,CAAEH,QAAS,CAAC;QAClC;MACD,CAAE,CAAC;IACJ,CAAC;EACF,CAAC,EAAE,CAAEH,WAAW,EAAEI,QAAQ,CAAG,CAAC;EAE9B,OAAO,IAAI;AACZ","ignoreList":[]}