{"version":3,"names":["_data","require","_preferences","_blocks","_element","_blockEditor","_store","_lockUnlock","_jsxRuntime","BlockManager","unlock","blockEditorPrivateApis","EMPTY_ARRAY","BlockVisibility","showBlockTypes","hideBlockTypes","useDispatch","editorStore","blockTypes","allowedBlockTypes","_allowedBlockTypes","hiddenBlockTypes","_hiddenBlockTypes","useSelect","select","_select$get","blocksStore","getBlockTypes","getEditorSettings","preferencesStore","get","useMemo","filter","name","includes","filteredBlockTypes","blockType","hasBlockSupport","parent","hiddenBlock","some","registeredBlock","selectedBlockTypes","onChangeSelectedBlockTypes","newSelectedBlockTypes","length","blockTypesToHide","find","map","blockTypesToShow","jsx","onChange"],"sources":["@wordpress/editor/src/components/preferences-modal/block-visibility.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { store as preferencesStore } from '@wordpress/preferences';\nimport { hasBlockSupport, store as blocksStore } from '@wordpress/blocks';\nimport { useMemo } from '@wordpress/element';\nimport { privateApis as blockEditorPrivateApis } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { store as editorStore } from '../../store';\nimport { unlock } from '../../lock-unlock';\n\nconst { BlockManager } = unlock( blockEditorPrivateApis );\nconst EMPTY_ARRAY = [];\n\nexport default function BlockVisibility() {\n\tconst { showBlockTypes, hideBlockTypes } = unlock(\n\t\tuseDispatch( editorStore )\n\t);\n\n\tconst {\n\t\tblockTypes,\n\t\tallowedBlockTypes: _allowedBlockTypes,\n\t\thiddenBlockTypes: _hiddenBlockTypes,\n\t} = useSelect( ( select ) => {\n\t\treturn {\n\t\t\tblockTypes: select( blocksStore ).getBlockTypes(),\n\t\t\tallowedBlockTypes:\n\t\t\t\tselect( editorStore ).getEditorSettings().allowedBlockTypes,\n\t\t\thiddenBlockTypes:\n\t\t\t\tselect( preferencesStore ).get( 'core', 'hiddenBlockTypes' ) ??\n\t\t\t\tEMPTY_ARRAY,\n\t\t};\n\t}, [] );\n\n\tconst allowedBlockTypes = useMemo( () => {\n\t\tif ( _allowedBlockTypes === true ) {\n\t\t\treturn blockTypes;\n\t\t}\n\t\treturn blockTypes.filter( ( { name } ) => {\n\t\t\treturn _allowedBlockTypes?.includes( name );\n\t\t} );\n\t}, [ _allowedBlockTypes, blockTypes ] );\n\n\tconst filteredBlockTypes = allowedBlockTypes.filter(\n\t\t( blockType ) =>\n\t\t\thasBlockSupport( blockType, 'inserter', true ) &&\n\t\t\t( ! blockType.parent ||\n\t\t\t\tblockType.parent.includes( 'core/post-content' ) )\n\t);\n\n\t// Some hidden blocks become unregistered\n\t// by removing for instance the plugin that registered them, yet\n\t// they're still remain as hidden by the user's action.\n\t// We consider \"hidden\", blocks which were hidden and\n\t// are still registered.\n\tconst hiddenBlockTypes = _hiddenBlockTypes.filter( ( hiddenBlock ) => {\n\t\treturn filteredBlockTypes.some(\n\t\t\t( registeredBlock ) => registeredBlock.name === hiddenBlock\n\t\t);\n\t} );\n\n\tconst selectedBlockTypes = filteredBlockTypes.filter(\n\t\t( blockType ) => ! hiddenBlockTypes.includes( blockType.name )\n\t);\n\n\tconst onChangeSelectedBlockTypes = ( newSelectedBlockTypes ) => {\n\t\tif ( selectedBlockTypes.length > newSelectedBlockTypes.length ) {\n\t\t\tconst blockTypesToHide = selectedBlockTypes.filter(\n\t\t\t\t( blockType ) =>\n\t\t\t\t\t! newSelectedBlockTypes.find(\n\t\t\t\t\t\t( { name } ) => name === blockType.name\n\t\t\t\t\t)\n\t\t\t);\n\t\t\thideBlockTypes( blockTypesToHide.map( ( { name } ) => name ) );\n\t\t} else if ( selectedBlockTypes.length < newSelectedBlockTypes.length ) {\n\t\t\tconst blockTypesToShow = newSelectedBlockTypes.filter(\n\t\t\t\t( blockType ) =>\n\t\t\t\t\t! selectedBlockTypes.find(\n\t\t\t\t\t\t( { name } ) => name === blockType.name\n\t\t\t\t\t)\n\t\t\t);\n\t\t\tshowBlockTypes( blockTypesToShow.map( ( { name } ) => name ) );\n\t\t}\n\t};\n\n\treturn (\n\t\t<BlockManager\n\t\t\tblockTypes={ filteredBlockTypes }\n\t\t\tselectedBlockTypes={ selectedBlockTypes }\n\t\t\tonChange={ onChangeSelectedBlockTypes }\n\t\t/>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}