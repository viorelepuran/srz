{"version":3,"names":["_types","require","noop","DEFAULT_STATE","queue","queueStatus","blobUrls","settings","mediaUpload","reducer","state","action","type","Type","Unknown","PauseQueue","ResumeQueue","Add","item","Cancel","map","id","error","Remove","filter","OperationStart","currentOperation","operation","AddOperations","operations","OperationFinish","slice","attachment","undefined","additionalData","CacheBlobUrl","blobUrl","RevokeBlobUrls","newBlobUrls","UpdateSettings","_default","exports","default"],"sources":["@wordpress/upload-media/src/store/reducer.ts"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport {\n\ttype AddAction,\n\ttype AddOperationsAction,\n\ttype CacheBlobUrlAction,\n\ttype CancelAction,\n\ttype OperationFinishAction,\n\ttype OperationStartAction,\n\ttype PauseQueueAction,\n\ttype QueueItem,\n\ttype RemoveAction,\n\ttype ResumeQueueAction,\n\ttype RevokeBlobUrlsAction,\n\ttype State,\n\tType,\n\ttype UnknownAction,\n\ttype UpdateSettingsAction,\n} from './types';\n\nconst noop = () => {};\n\nconst DEFAULT_STATE: State = {\n\tqueue: [],\n\tqueueStatus: 'active',\n\tblobUrls: {},\n\tsettings: {\n\t\tmediaUpload: noop,\n\t},\n};\n\ntype Action =\n\t| AddAction\n\t| RemoveAction\n\t| CancelAction\n\t| PauseQueueAction\n\t| ResumeQueueAction\n\t| AddOperationsAction\n\t| OperationFinishAction\n\t| OperationStartAction\n\t| CacheBlobUrlAction\n\t| RevokeBlobUrlsAction\n\t| UpdateSettingsAction\n\t| UnknownAction;\n\nfunction reducer(\n\tstate = DEFAULT_STATE,\n\taction: Action = { type: Type.Unknown }\n) {\n\tswitch ( action.type ) {\n\t\tcase Type.PauseQueue: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tqueueStatus: 'paused',\n\t\t\t};\n\t\t}\n\n\t\tcase Type.ResumeQueue: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tqueueStatus: 'active',\n\t\t\t};\n\t\t}\n\n\t\tcase Type.Add:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tqueue: [ ...state.queue, action.item ],\n\t\t\t};\n\n\t\tcase Type.Cancel:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tqueue: state.queue.map(\n\t\t\t\t\t( item ): QueueItem =>\n\t\t\t\t\t\titem.id === action.id\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\t\t\terror: action.error,\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: item\n\t\t\t\t),\n\t\t\t};\n\n\t\tcase Type.Remove:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tqueue: state.queue.filter( ( item ) => item.id !== action.id ),\n\t\t\t};\n\n\t\tcase Type.OperationStart: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tqueue: state.queue.map(\n\t\t\t\t\t( item ): QueueItem =>\n\t\t\t\t\t\titem.id === action.id\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\t\t\tcurrentOperation: action.operation,\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: item\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\tcase Type.AddOperations:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tqueue: state.queue.map( ( item ): QueueItem => {\n\t\t\t\t\tif ( item.id !== action.id ) {\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\toperations: [\n\t\t\t\t\t\t\t...( item.operations || [] ),\n\t\t\t\t\t\t\t...action.operations,\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t} ),\n\t\t\t};\n\n\t\tcase Type.OperationFinish:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tqueue: state.queue.map( ( item ): QueueItem => {\n\t\t\t\t\tif ( item.id !== action.id ) {\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst operations = item.operations\n\t\t\t\t\t\t? item.operations.slice( 1 )\n\t\t\t\t\t\t: [];\n\n\t\t\t\t\t// Prevent an empty object if there's no attachment data.\n\t\t\t\t\tconst attachment =\n\t\t\t\t\t\titem.attachment || action.item.attachment\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t...item.attachment,\n\t\t\t\t\t\t\t\t\t...action.item.attachment,\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: undefined;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\tcurrentOperation: undefined,\n\t\t\t\t\t\toperations,\n\t\t\t\t\t\t...action.item,\n\t\t\t\t\t\tattachment,\n\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t...item.additionalData,\n\t\t\t\t\t\t\t...action.item.additionalData,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t} ),\n\t\t\t};\n\n\t\tcase Type.CacheBlobUrl: {\n\t\t\tconst blobUrls = state.blobUrls[ action.id ] || [];\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tblobUrls: {\n\t\t\t\t\t...state.blobUrls,\n\t\t\t\t\t[ action.id ]: [ ...blobUrls, action.blobUrl ],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tcase Type.RevokeBlobUrls: {\n\t\t\tconst newBlobUrls = { ...state.blobUrls };\n\t\t\tdelete newBlobUrls[ action.id ];\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tblobUrls: newBlobUrls,\n\t\t\t};\n\t\t}\n\n\t\tcase Type.UpdateSettings: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tsettings: {\n\t\t\t\t\t...state.settings,\n\t\t\t\t\t...action.settings,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t}\n\n\treturn state;\n}\n\nexport default reducer;\n"],"mappings":"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","ignoreList":[]}