{"version":3,"names":["useReducedMotion","useCallback","useRef","useState","CONFIG","warning","FRAME_ANIMATION_DURATION","transitionDuration","FRAME_ANIMATION_DURATION_NUMBER","Number","parseInt","EXIT_ANIMATION_NAME","useModalExitAnimation","frameRef","isAnimatingOut","setIsAnimatingOut","isReducedMotion","closeModal","Promise","closeModalResolve","frameEl","current","globalThis","SCRIPT_DEBUG","handleAnimationEnd","startAnimation","animationResolve","e","animationName","addEventListener","animationTimeout","timeoutResolve","setTimeout","race","then","removeEventListener","overlayClassname","undefined","frameStyle"],"sources":["@wordpress/components/src/modal/use-modal-exit-animation.ts"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useReducedMotion } from '@wordpress/compose';\nimport { useCallback, useRef, useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { CONFIG } from '../utils';\nimport warning from '@wordpress/warning';\n\n// Animation duration (ms) extracted to JS in order to be used on a setTimeout.\nconst FRAME_ANIMATION_DURATION = CONFIG.transitionDuration;\nconst FRAME_ANIMATION_DURATION_NUMBER = Number.parseInt(\n\tCONFIG.transitionDuration\n);\n\nconst EXIT_ANIMATION_NAME = 'components-modal__disappear-animation';\n\nexport function useModalExitAnimation() {\n\tconst frameRef = useRef< HTMLDivElement >();\n\tconst [ isAnimatingOut, setIsAnimatingOut ] = useState( false );\n\tconst isReducedMotion = useReducedMotion();\n\n\tconst closeModal = useCallback(\n\t\t() =>\n\t\t\tnew Promise< void >( ( closeModalResolve ) => {\n\t\t\t\t// Grab a \"stable\" reference of the frame element, since\n\t\t\t\t// the value held by the react ref might change at runtime.\n\t\t\t\tconst frameEl = frameRef.current;\n\n\t\t\t\tif ( isReducedMotion ) {\n\t\t\t\t\tcloseModalResolve();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( ! frameEl ) {\n\t\t\t\t\twarning(\n\t\t\t\t\t\t\"wp.components.Modal: the Modal component can't be closed with an exit animation because of a missing reference to the modal frame element.\"\n\t\t\t\t\t);\n\t\t\t\t\tcloseModalResolve();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet handleAnimationEnd:\n\t\t\t\t\t| undefined\n\t\t\t\t\t| ( ( e: AnimationEvent ) => void );\n\n\t\t\t\tconst startAnimation = () =>\n\t\t\t\t\tnew Promise< void >( ( animationResolve ) => {\n\t\t\t\t\t\thandleAnimationEnd = ( e: AnimationEvent ) => {\n\t\t\t\t\t\t\tif ( e.animationName === EXIT_ANIMATION_NAME ) {\n\t\t\t\t\t\t\t\tanimationResolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tframeEl.addEventListener(\n\t\t\t\t\t\t\t'animationend',\n\t\t\t\t\t\t\thandleAnimationEnd\n\t\t\t\t\t\t);\n\t\t\t\t\t\tsetIsAnimatingOut( true );\n\t\t\t\t\t} );\n\t\t\t\tconst animationTimeout = () =>\n\t\t\t\t\tnew Promise< void >( ( timeoutResolve ) => {\n\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\t() => timeoutResolve(),\n\t\t\t\t\t\t\t// Allow an extra 20% of the animation duration for the\n\t\t\t\t\t\t\t// animationend event to fire, in case the animation frame is\n\t\t\t\t\t\t\t// slightly delayes by some other events in the event loop.\n\t\t\t\t\t\t\tFRAME_ANIMATION_DURATION_NUMBER * 1.2\n\t\t\t\t\t\t);\n\t\t\t\t\t} );\n\n\t\t\t\tPromise.race( [ startAnimation(), animationTimeout() ] ).then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tif ( handleAnimationEnd ) {\n\t\t\t\t\t\t\tframeEl.removeEventListener(\n\t\t\t\t\t\t\t\t'animationend',\n\t\t\t\t\t\t\t\thandleAnimationEnd\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetIsAnimatingOut( false );\n\t\t\t\t\t\tcloseModalResolve();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} ),\n\t\t[ isReducedMotion ]\n\t);\n\n\treturn {\n\t\toverlayClassname: isAnimatingOut ? 'is-animating-out' : undefined,\n\t\tframeRef,\n\t\tframeStyle: {\n\t\t\t'--modal-frame-animation-duration': `${ FRAME_ANIMATION_DURATION }`,\n\t\t},\n\t\tcloseModal,\n\t};\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,gBAAgB,QAAQ,oBAAoB;AACrD,SAASC,WAAW,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,oBAAoB;;AAElE;AACA;AACA;AACA,SAASC,MAAM,QAAQ,UAAU;AACjC,OAAOC,OAAO,MAAM,oBAAoB;;AAExC;AACA,MAAMC,wBAAwB,GAAGF,MAAM,CAACG,kBAAkB;AAC1D,MAAMC,+BAA+B,GAAGC,MAAM,CAACC,QAAQ,CACtDN,MAAM,CAACG,kBACR,CAAC;AAED,MAAMI,mBAAmB,GAAG,uCAAuC;AAEnE,OAAO,SAASC,qBAAqBA,CAAA,EAAG;EACvC,MAAMC,QAAQ,GAAGX,MAAM,CAAmB,CAAC;EAC3C,MAAM,CAAEY,cAAc,EAAEC,iBAAiB,CAAE,GAAGZ,QAAQ,CAAE,KAAM,CAAC;EAC/D,MAAMa,eAAe,GAAGhB,gBAAgB,CAAC,CAAC;EAE1C,MAAMiB,UAAU,GAAGhB,WAAW,CAC7B,MACC,IAAIiB,OAAO,CAAYC,iBAAiB,IAAM;IAC7C;IACA;IACA,MAAMC,OAAO,GAAGP,QAAQ,CAACQ,OAAO;IAEhC,IAAKL,eAAe,EAAG;MACtBG,iBAAiB,CAAC,CAAC;MACnB;IACD;IAEA,IAAK,CAAEC,OAAO,EAAG;MAChBE,UAAA,CAAAC,YAAA,YAAAlB,OAAO,CACN,4IACD,CAAC;MACDc,iBAAiB,CAAC,CAAC;MACnB;IACD;IAEA,IAAIK,kBAEgC;IAEpC,MAAMC,cAAc,GAAGA,CAAA,KACtB,IAAIP,OAAO,CAAYQ,gBAAgB,IAAM;MAC5CF,kBAAkB,GAAKG,CAAiB,IAAM;QAC7C,IAAKA,CAAC,CAACC,aAAa,KAAKjB,mBAAmB,EAAG;UAC9Ce,gBAAgB,CAAC,CAAC;QACnB;MACD,CAAC;MAEDN,OAAO,CAACS,gBAAgB,CACvB,cAAc,EACdL,kBACD,CAAC;MACDT,iBAAiB,CAAE,IAAK,CAAC;IAC1B,CAAE,CAAC;IACJ,MAAMe,gBAAgB,GAAGA,CAAA,KACxB,IAAIZ,OAAO,CAAYa,cAAc,IAAM;MAC1CC,UAAU,CACT,MAAMD,cAAc,CAAC,CAAC;MACtB;MACA;MACA;MACAvB,+BAA+B,GAAG,GACnC,CAAC;IACF,CAAE,CAAC;IAEJU,OAAO,CAACe,IAAI,CAAE,CAAER,cAAc,CAAC,CAAC,EAAEK,gBAAgB,CAAC,CAAC,CAAG,CAAC,CAACI,IAAI,CAC5D,MAAM;MACL,IAAKV,kBAAkB,EAAG;QACzBJ,OAAO,CAACe,mBAAmB,CAC1B,cAAc,EACdX,kBACD,CAAC;MACF;MACAT,iBAAiB,CAAE,KAAM,CAAC;MAC1BI,iBAAiB,CAAC,CAAC;IACpB,CACD,CAAC;EACF,CAAE,CAAC,EACJ,CAAEH,eAAe,CAClB,CAAC;EAED,OAAO;IACNoB,gBAAgB,EAAEtB,cAAc,GAAG,kBAAkB,GAAGuB,SAAS;IACjExB,QAAQ;IACRyB,UAAU,EAAE;MACX,kCAAkC,EAAE,GAAIhC,wBAAwB;IACjE,CAAC;IACDW;EACD,CAAC;AACF","ignoreList":[]}