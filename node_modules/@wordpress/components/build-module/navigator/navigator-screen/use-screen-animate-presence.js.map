{"version":3,"names":["useState","useEffect","useLayoutEffect","useCallback","useReducedMotion","isRTL","isRTLFn","styles","ANIMATION_TIMEOUT_MARGIN","isEnterAnimation","animationDirection","animationStatus","animationName","ANIMATION_END_NAMES","in","isExitAnimation","out","useScreenAnimatePresence","isMatch","skipAnimation","isBack","onAnimationEnd","prefersReducedMotion","setAnimationStatus","becameSelected","becameUnselected","isAnimatingIn","isAnimatingOut","animationType","onScreenAnimationEnd","e","animationTimeout","window","setTimeout","undefined","TOTAL_ANIMATION_DURATION","OUT","IN","clearTimeout","animationStyles","navigatorScreenAnimation","shouldRenderScreen","screenProps"],"sources":["@wordpress/components/src/navigator/navigator-screen/use-screen-animate-presence.ts"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tuseState,\n\tuseEffect,\n\tuseLayoutEffect,\n\tuseCallback,\n} from '@wordpress/element';\nimport { useReducedMotion } from '@wordpress/compose';\nimport { isRTL as isRTLFn } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport * as styles from '../styles';\n\n// Possible values:\n// - 'INITIAL': the initial state\n// - 'ANIMATING_IN': start enter animation\n// - 'IN': enter animation has ended\n// - 'ANIMATING_OUT': start exit animation\n// - 'OUT': the exit animation has ended\ntype AnimationStatus =\n\t| 'INITIAL'\n\t| 'ANIMATING_IN'\n\t| 'IN'\n\t| 'ANIMATING_OUT'\n\t| 'OUT';\n\n// Allow an extra 20% of the total animation duration to account for potential\n// event loop delays.\nconst ANIMATION_TIMEOUT_MARGIN = 1.2;\n\nconst isEnterAnimation = (\n\tanimationDirection: 'end' | 'start',\n\tanimationStatus: AnimationStatus,\n\tanimationName: string\n) =>\n\tanimationStatus === 'ANIMATING_IN' &&\n\tanimationName === styles.ANIMATION_END_NAMES[ animationDirection ].in;\n\nconst isExitAnimation = (\n\tanimationDirection: 'end' | 'start',\n\tanimationStatus: AnimationStatus,\n\tanimationName: string\n) =>\n\tanimationStatus === 'ANIMATING_OUT' &&\n\tanimationName === styles.ANIMATION_END_NAMES[ animationDirection ].out;\n\nexport function useScreenAnimatePresence( {\n\tisMatch,\n\tskipAnimation,\n\tisBack,\n\tonAnimationEnd,\n}: {\n\tisMatch: boolean;\n\tskipAnimation: boolean;\n\tisBack?: boolean;\n\tonAnimationEnd?: React.AnimationEventHandler< Element >;\n} ) {\n\tconst isRTL = isRTLFn();\n\tconst prefersReducedMotion = useReducedMotion();\n\n\tconst [ animationStatus, setAnimationStatus ] =\n\t\tuseState< AnimationStatus >( 'INITIAL' );\n\n\t// Start enter and exit animations when the screen is selected or deselected.\n\t// The animation status is set to `IN` or `OUT` immediately if the animation\n\t// should be skipped.\n\tconst becameSelected =\n\t\tanimationStatus !== 'ANIMATING_IN' &&\n\t\tanimationStatus !== 'IN' &&\n\t\tisMatch;\n\tconst becameUnselected =\n\t\tanimationStatus !== 'ANIMATING_OUT' &&\n\t\tanimationStatus !== 'OUT' &&\n\t\t! isMatch;\n\tuseLayoutEffect( () => {\n\t\tif ( becameSelected ) {\n\t\t\tsetAnimationStatus(\n\t\t\t\tskipAnimation || prefersReducedMotion ? 'IN' : 'ANIMATING_IN'\n\t\t\t);\n\t\t} else if ( becameUnselected ) {\n\t\t\tsetAnimationStatus(\n\t\t\t\tskipAnimation || prefersReducedMotion ? 'OUT' : 'ANIMATING_OUT'\n\t\t\t);\n\t\t}\n\t}, [\n\t\tbecameSelected,\n\t\tbecameUnselected,\n\t\tskipAnimation,\n\t\tprefersReducedMotion,\n\t] );\n\n\t// Animation attributes (derived state).\n\tconst animationDirection =\n\t\t( isRTL && isBack ) || ( ! isRTL && ! isBack ) ? 'end' : 'start';\n\tconst isAnimatingIn = animationStatus === 'ANIMATING_IN';\n\tconst isAnimatingOut = animationStatus === 'ANIMATING_OUT';\n\tlet animationType: 'in' | 'out' | undefined;\n\tif ( isAnimatingIn ) {\n\t\tanimationType = 'in';\n\t} else if ( isAnimatingOut ) {\n\t\tanimationType = 'out';\n\t}\n\n\tconst onScreenAnimationEnd = useCallback(\n\t\t( e: React.AnimationEvent< HTMLElement > ) => {\n\t\t\tonAnimationEnd?.( e );\n\n\t\t\tif (\n\t\t\t\tisExitAnimation(\n\t\t\t\t\tanimationDirection,\n\t\t\t\t\tanimationStatus,\n\t\t\t\t\te.animationName\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// When the exit animation ends on an unselected screen, set the\n\t\t\t\t// status to 'OUT' to remove the screen contents from the DOM.\n\t\t\t\tsetAnimationStatus( 'OUT' );\n\t\t\t} else if (\n\t\t\t\tisEnterAnimation(\n\t\t\t\t\tanimationDirection,\n\t\t\t\t\tanimationStatus,\n\t\t\t\t\te.animationName\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// When the enter animation ends on a selected screen, set the\n\t\t\t\t// status to 'IN' to ensure the screen is rendered in the DOM.\n\t\t\t\tsetAnimationStatus( 'IN' );\n\t\t\t}\n\t\t},\n\t\t[ onAnimationEnd, animationStatus, animationDirection ]\n\t);\n\n\t// Fallback timeout to ensure that the logic is applied even if the\n\t// `animationend` event is not triggered.\n\tuseEffect( () => {\n\t\tlet animationTimeout: number | undefined;\n\n\t\tif ( isAnimatingOut ) {\n\t\t\tanimationTimeout = window.setTimeout( () => {\n\t\t\t\tsetAnimationStatus( 'OUT' );\n\t\t\t\tanimationTimeout = undefined;\n\t\t\t}, styles.TOTAL_ANIMATION_DURATION.OUT * ANIMATION_TIMEOUT_MARGIN );\n\t\t} else if ( isAnimatingIn ) {\n\t\t\tanimationTimeout = window.setTimeout( () => {\n\t\t\t\tsetAnimationStatus( 'IN' );\n\t\t\t\tanimationTimeout = undefined;\n\t\t\t}, styles.TOTAL_ANIMATION_DURATION.IN * ANIMATION_TIMEOUT_MARGIN );\n\t\t}\n\n\t\treturn () => {\n\t\t\tif ( animationTimeout ) {\n\t\t\t\twindow.clearTimeout( animationTimeout );\n\t\t\t\tanimationTimeout = undefined;\n\t\t\t}\n\t\t};\n\t}, [ isAnimatingOut, isAnimatingIn ] );\n\n\treturn {\n\t\tanimationStyles: styles.navigatorScreenAnimation,\n\t\t// Render the screen's contents in the DOM not only when the screen is\n\t\t// selected, but also while it is animating out.\n\t\tshouldRenderScreen:\n\t\t\tisMatch ||\n\t\t\tanimationStatus === 'IN' ||\n\t\t\tanimationStatus === 'ANIMATING_OUT',\n\t\tscreenProps: {\n\t\t\tonAnimationEnd: onScreenAnimationEnd,\n\t\t\t'data-animation-direction': animationDirection,\n\t\t\t'data-animation-type': animationType,\n\t\t\t'data-skip-animation': skipAnimation || undefined,\n\t\t},\n\t} as const;\n}\n"],"mappings":"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","ignoreList":[]}