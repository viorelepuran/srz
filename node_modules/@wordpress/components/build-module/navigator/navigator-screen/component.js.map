{"version":3,"names":["focus","useContext","useEffect","useMemo","useRef","useId","useMergeRefs","escapeAttribute","warning","contextConnect","useContextSystem","useCx","View","NavigatorContext","styles","useScreenAnimatePresence","jsx","_jsx","UnconnectedNavigatorScreen","props","forwardedRef","test","path","globalThis","SCRIPT_DEBUG","screenId","children","className","onAnimationEnd","onAnimationEndProp","otherProps","location","match","addScreen","removeScreen","isInitial","isBack","focusTargetSelector","skipFocus","isMatch","wrapperRef","skipAnimationAndFocusRestoration","screen","id","animationStyles","shouldRenderScreen","screenProps","skipAnimation","cx","classes","navigatorScreen","locationRef","current","wrapperEl","hasRestoredFocus","activeElement","ownerDocument","contains","elementToFocus","querySelector","firstTabbable","tabbable","find","mergedWrapperRef","ref","NavigatorScreen"],"sources":["@wordpress/components/src/navigator/navigator-screen/component.tsx"],"sourcesContent":["/**\n * External dependencies\n */\nimport type { ForwardedRef } from 'react';\n\n/**\n * WordPress dependencies\n */\nimport { focus } from '@wordpress/dom';\nimport {\n\tuseContext,\n\tuseEffect,\n\tuseMemo,\n\tuseRef,\n\tuseId,\n} from '@wordpress/element';\nimport { useMergeRefs } from '@wordpress/compose';\nimport { escapeAttribute } from '@wordpress/escape-html';\nimport warning from '@wordpress/warning';\n\n/**\n * Internal dependencies\n */\nimport type { WordPressComponentProps } from '../../context';\nimport { contextConnect, useContextSystem } from '../../context';\nimport { useCx } from '../../utils/hooks/use-cx';\nimport { View } from '../../view';\nimport { NavigatorContext } from '../context';\nimport * as styles from '../styles';\nimport type { NavigatorScreenProps } from '../types';\nimport { useScreenAnimatePresence } from './use-screen-animate-presence';\n\nfunction UnconnectedNavigatorScreen(\n\tprops: WordPressComponentProps< NavigatorScreenProps, 'div', false >,\n\tforwardedRef: ForwardedRef< any >\n) {\n\tif ( ! /^\\//.test( props.path ) ) {\n\t\twarning(\n\t\t\t'wp.components.Navigator.Screen: the `path` should follow a URL-like scheme; it should start with and be separated by the `/` character.'\n\t\t);\n\t}\n\n\tconst screenId = useId();\n\n\tconst {\n\t\tchildren,\n\t\tclassName,\n\t\tpath,\n\t\tonAnimationEnd: onAnimationEndProp,\n\t\t...otherProps\n\t} = useContextSystem( props, 'Navigator.Screen' );\n\n\tconst { location, match, addScreen, removeScreen } =\n\t\tuseContext( NavigatorContext );\n\tconst { isInitial, isBack, focusTargetSelector, skipFocus } = location;\n\n\tconst isMatch = match === screenId;\n\tconst wrapperRef = useRef< HTMLDivElement >( null );\n\tconst skipAnimationAndFocusRestoration = !! isInitial && ! isBack;\n\n\t// Register / unregister screen with the navigator context.\n\tuseEffect( () => {\n\t\tconst screen = {\n\t\t\tid: screenId,\n\t\t\tpath: escapeAttribute( path ),\n\t\t};\n\t\taddScreen( screen );\n\t\treturn () => removeScreen( screen );\n\t}, [ screenId, path, addScreen, removeScreen ] );\n\n\t// Animation.\n\tconst { animationStyles, shouldRenderScreen, screenProps } =\n\t\tuseScreenAnimatePresence( {\n\t\t\tisMatch,\n\t\t\tisBack,\n\t\t\tonAnimationEnd: onAnimationEndProp,\n\t\t\tskipAnimation: skipAnimationAndFocusRestoration,\n\t\t} );\n\n\tconst cx = useCx();\n\tconst classes = useMemo(\n\t\t() => cx( styles.navigatorScreen, animationStyles, className ),\n\t\t[ className, cx, animationStyles ]\n\t);\n\n\t// Focus restoration\n\tconst locationRef = useRef( location );\n\tuseEffect( () => {\n\t\tlocationRef.current = location;\n\t}, [ location ] );\n\tuseEffect( () => {\n\t\tconst wrapperEl = wrapperRef.current;\n\t\t// Only attempt to restore focus:\n\t\t// - if the current location is not the initial one (to avoid moving focus on page load)\n\t\t// - when the screen becomes visible\n\t\t// - if the wrapper ref has been assigned\n\t\t// - if focus hasn't already been restored for the current location\n\t\t// - if the `skipFocus` option is not set to `true`. This is useful when we trigger the navigation outside of NavigatorScreen.\n\t\tif (\n\t\t\tskipAnimationAndFocusRestoration ||\n\t\t\t! isMatch ||\n\t\t\t! wrapperEl ||\n\t\t\tlocationRef.current.hasRestoredFocus ||\n\t\t\tskipFocus\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst activeElement = wrapperEl.ownerDocument.activeElement;\n\n\t\t// If an element is already focused within the wrapper do not focus the\n\t\t// element. This prevents inputs or buttons from losing focus unnecessarily.\n\t\tif ( wrapperEl.contains( activeElement ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet elementToFocus: HTMLElement | null = null;\n\n\t\t// When navigating back, if a selector is provided, use it to look for the\n\t\t// target element (assumed to be a node inside the current NavigatorScreen)\n\t\tif ( isBack && focusTargetSelector ) {\n\t\t\telementToFocus = wrapperEl.querySelector( focusTargetSelector );\n\t\t}\n\n\t\t// If the previous query didn't run or find any element to focus, fallback\n\t\t// to the first tabbable element in the screen (or the screen itself).\n\t\tif ( ! elementToFocus ) {\n\t\t\tconst [ firstTabbable ] = focus.tabbable.find( wrapperEl );\n\t\t\telementToFocus = firstTabbable ?? wrapperEl;\n\t\t}\n\n\t\tlocationRef.current.hasRestoredFocus = true;\n\t\telementToFocus.focus();\n\t}, [\n\t\tskipAnimationAndFocusRestoration,\n\t\tisMatch,\n\t\tisBack,\n\t\tfocusTargetSelector,\n\t\tskipFocus,\n\t] );\n\n\tconst mergedWrapperRef = useMergeRefs( [ forwardedRef, wrapperRef ] );\n\n\treturn shouldRenderScreen ? (\n\t\t<View\n\t\t\tref={ mergedWrapperRef }\n\t\t\tclassName={ classes }\n\t\t\t{ ...screenProps }\n\t\t\t{ ...otherProps }\n\t\t>\n\t\t\t{ children }\n\t\t</View>\n\t) : null;\n}\n\nexport const NavigatorScreen = contextConnect(\n\tUnconnectedNavigatorScreen,\n\t'Navigator.Screen'\n);\n"],"mappings":"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","ignoreList":[]}