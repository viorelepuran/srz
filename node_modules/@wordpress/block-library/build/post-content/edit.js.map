{"version":3,"names":["_i18n","require","_blockEditor","_blocks","_coreData","_data","_element","_hooks","_jsxRuntime","ReadOnlyContent","parentLayout","layoutClassNames","userCanEdit","postType","postId","content","useEntityProp","blockProps","useBlockProps","className","blocks","useMemo","raw","parse","blockPreviewProps","useBlockPreview","props","layout","jsx","protected","children","Warning","__","dangerouslySetInnerHTML","__html","rendered","EditableContent","context","onInput","onChange","useEntityBlockEditor","id","entityRecord","useSelect","select","coreStore","getEntityRecord","hasInnerBlocks","length","initialInnerBlocks","useInnerBlocksProps","value","template","undefined","Content","queryId","useCanEditEntity","isDescendentOfQueryLoop","Number","isFinite","isEditable","Placeholder","jsxs","RecursionError","PostContentEdit","__unstableLayoutClassNames","__unstableParentLayout","contextPostId","contextPostType","hasAlreadyRendered","useHasRecursion","RecursionProvider","uniqueId"],"sources":["@wordpress/block-library/src/post-content/edit.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport {\n\tuseBlockProps,\n\tuseInnerBlocksProps,\n\tRecursionProvider,\n\tuseHasRecursion,\n\tWarning,\n\t__experimentalUseBlockPreview as useBlockPreview,\n} from '@wordpress/block-editor';\nimport { parse } from '@wordpress/blocks';\nimport {\n\tuseEntityProp,\n\tuseEntityBlockEditor,\n\tstore as coreStore,\n} from '@wordpress/core-data';\nimport { useSelect } from '@wordpress/data';\nimport { useMemo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { useCanEditEntity } from '../utils/hooks';\n\nfunction ReadOnlyContent( {\n\tparentLayout,\n\tlayoutClassNames,\n\tuserCanEdit,\n\tpostType,\n\tpostId,\n} ) {\n\tconst [ , , content ] = useEntityProp(\n\t\t'postType',\n\t\tpostType,\n\t\t'content',\n\t\tpostId\n\t);\n\tconst blockProps = useBlockProps( { className: layoutClassNames } );\n\tconst blocks = useMemo( () => {\n\t\treturn content?.raw ? parse( content.raw ) : [];\n\t}, [ content?.raw ] );\n\tconst blockPreviewProps = useBlockPreview( {\n\t\tblocks,\n\t\tprops: blockProps,\n\t\tlayout: parentLayout,\n\t} );\n\n\tif ( userCanEdit ) {\n\t\t/*\n\t\t * Rendering the block preview using the raw content blocks allows for\n\t\t * block support styles to be generated and applied by the editor.\n\t\t *\n\t\t * The preview using the raw blocks can only be presented to users with\n\t\t * edit permissions for the post to prevent potential exposure of private\n\t\t * block content.\n\t\t */\n\t\treturn <div { ...blockPreviewProps }></div>;\n\t}\n\n\treturn content?.protected ? (\n\t\t<div { ...blockProps }>\n\t\t\t<Warning>{ __( 'This content is password protected.' ) }</Warning>\n\t\t</div>\n\t) : (\n\t\t<div\n\t\t\t{ ...blockProps }\n\t\t\tdangerouslySetInnerHTML={ { __html: content?.rendered } }\n\t\t></div>\n\t);\n}\n\nfunction EditableContent( { context = {} } ) {\n\tconst { postType, postId } = context;\n\n\tconst [ blocks, onInput, onChange ] = useEntityBlockEditor(\n\t\t'postType',\n\t\tpostType,\n\t\t{ id: postId }\n\t);\n\n\tconst entityRecord = useSelect(\n\t\t( select ) => {\n\t\t\treturn select( coreStore ).getEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\tpostType,\n\t\t\t\tpostId\n\t\t\t);\n\t\t},\n\t\t[ postType, postId ]\n\t);\n\n\tconst hasInnerBlocks = !! entityRecord?.content?.raw || blocks?.length;\n\n\tconst initialInnerBlocks = [ [ 'core/paragraph' ] ];\n\n\tconst props = useInnerBlocksProps(\n\t\tuseBlockProps( { className: 'entry-content' } ),\n\t\t{\n\t\t\tvalue: blocks,\n\t\t\tonInput,\n\t\t\tonChange,\n\t\t\ttemplate: ! hasInnerBlocks ? initialInnerBlocks : undefined,\n\t\t}\n\t);\n\treturn <div { ...props } />;\n}\n\nfunction Content( props ) {\n\tconst { context: { queryId, postType, postId } = {}, layoutClassNames } =\n\t\tprops;\n\tconst userCanEdit = useCanEditEntity( 'postType', postType, postId );\n\tif ( userCanEdit === undefined ) {\n\t\treturn null;\n\t}\n\n\tconst isDescendentOfQueryLoop = Number.isFinite( queryId );\n\tconst isEditable = userCanEdit && ! isDescendentOfQueryLoop;\n\n\treturn isEditable ? (\n\t\t<EditableContent { ...props } />\n\t) : (\n\t\t<ReadOnlyContent\n\t\t\tparentLayout={ props.parentLayout }\n\t\t\tlayoutClassNames={ layoutClassNames }\n\t\t\tuserCanEdit={ userCanEdit }\n\t\t\tpostType={ postType }\n\t\t\tpostId={ postId }\n\t\t/>\n\t);\n}\n\nfunction Placeholder( { layoutClassNames } ) {\n\tconst blockProps = useBlockProps( { className: layoutClassNames } );\n\treturn (\n\t\t<div { ...blockProps }>\n\t\t\t<p>\n\t\t\t\t{ __(\n\t\t\t\t\t'This is the Content block, it will display all the blocks in any single post or page.'\n\t\t\t\t) }\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t{ __(\n\t\t\t\t\t'That might be a simple arrangement like consecutive paragraphs in a blog post, or a more elaborate composition that includes image galleries, videos, tables, columns, and any other block types.'\n\t\t\t\t) }\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t{ __(\n\t\t\t\t\t'If there are any Custom Post Types registered at your site, the Content block can display the contents of those entries as well.'\n\t\t\t\t) }\n\t\t\t</p>\n\t\t</div>\n\t);\n}\n\nfunction RecursionError() {\n\tconst blockProps = useBlockProps();\n\treturn (\n\t\t<div { ...blockProps }>\n\t\t\t<Warning>\n\t\t\t\t{ __( 'Block cannot be rendered inside itself.' ) }\n\t\t\t</Warning>\n\t\t</div>\n\t);\n}\n\nexport default function PostContentEdit( {\n\tcontext,\n\t__unstableLayoutClassNames: layoutClassNames,\n\t__unstableParentLayout: parentLayout,\n} ) {\n\tconst { postId: contextPostId, postType: contextPostType } = context;\n\tconst hasAlreadyRendered = useHasRecursion( contextPostId );\n\n\tif ( contextPostId && contextPostType && hasAlreadyRendered ) {\n\t\treturn <RecursionError />;\n\t}\n\n\treturn (\n\t\t<RecursionProvider uniqueId={ contextPostId }>\n\t\t\t{ contextPostId && contextPostType ? (\n\t\t\t\t<Content\n\t\t\t\t\tcontext={ context }\n\t\t\t\t\tparentLayout={ parentLayout }\n\t\t\t\t\tlayoutClassNames={ layoutClassNames }\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<Placeholder layoutClassNames={ layoutClassNames } />\n\t\t\t) }\n\t\t</RecursionProvider>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}