{"version":3,"names":["_blob","require","_components","_compose","_data","_blockEditor","_element","_i18n","_url","_blocks","_icons","_notices","_coreData","_lockUnlock","_util","_edit","_caption","_hooks","_constants","_utils","_jsxRuntime","DimensionsTool","ResolutionTool","unlock","blockEditorPrivateApis","scaleOptions","value","label","_x","help","__","WRITEMODE_POPOVER_PROPS","placement","ImageWrapper","href","children","jsx","onClick","event","preventDefault","style","pointerEvents","cursor","display","ContentOnlyControls","attributes","setAttributes","lockAltControls","lockAltControlsMessage","lockTitleControls","lockTitleControlsMessage","popoverAnchor","setPopoverAnchor","useState","isAltDialogOpen","setIsAltDialogOpen","isTitleDialogOpen","setIsTitleDialogOpen","jsxs","Fragment","ToolbarItem","ref","toggleProps","DropdownMenu","icon","chevronDown","description","popoverProps","onClose","MenuItem","Popover","anchor","offset","variant","className","TextareaControl","alt","onChange","disabled","ExternalLink","__nextHasNoMarginBottom","TextControl","__next40pxDefaultSize","title","Image","temporaryURL","isSingleSelected","insertBlocksAfter","onReplace","onSelectImage","onSelectURL","onUploadError","context","clientId","blockEditingMode","parentLayoutType","maxContentWidth","url","align","id","rel","linkClass","linkDestination","width","height","aspectRatio","scale","linkTarget","sizeSlug","lightbox","metadata","imageElement","setImageElement","resizeDelta","setResizeDelta","pixelSize","setPixelSize","offsetTop","setOffsetTop","setResizeObserved","useResizeObserver","entry","box","borderBoxSize","inlineSize","blockSize","target","effectResizeableBoxPlacement","useCallback","_imageElement$offsetT","setRefs","useMergeRefs","allowResize","image","useSelect","select","coreStore","getMedia","canInsertCover","imageEditing","imageSizes","maxWidth","getBlockRootClientId","canInsertBlockType","getSettings","blockEditorStore","rootClientId","settings","getBlock","replaceBlocks","toggleSelection","useDispatch","createErrorNotice","createSuccessNotice","noticesStore","editEntityRecord","isLargeViewport","useViewportMatch","isWideAligned","includes","loadedNaturalWidth","loadedNaturalHeight","setLoadedNaturalSize","isEditingImage","setIsEditingImage","externalBlob","setExternalBlob","hasImageErrored","setHasImageErrored","hasNonContentControls","isContentOnlyMode","isResizable","imageSizeOptions","filter","slug","media_details","sizes","source_url","map","name","useEffect","isExternalImage","mediaUpload","window","fetch","then","response","blob","catch","naturalWidth","naturalHeight","useMemo","undefined","complete","onImageError","embedBlock","createUpgradedEmbedBlock","onImageLoad","onSetHref","props","onSetLightbox","enable","lightboxSetting","enabled","resetLightbox","allowEditing","onSetTitle","updateAlt","newAlt","updateImage","newSizeSlug","newUrl","uploadExternal","filesList","onFileChange","img","isBlobURL","type","allowedTypes","ALLOWED_MEDIA_TYPES","onError","message","canEditImage","allowCrop","switchToCover","switchToBlockType","dimensionsUnitsOptions","useCustomUnits","availableUnits","useSettings","showLightboxSetting","lightboxChecked","dropdownMenuProps","useToolsPanelDropdownMenuProps","dimensionsControl","SIZED_LAYOUTS","newAspectRatio","defaultAspectRatio","tools","newWidth","newHeight","newScale","defaultScale","unitsOptions","resetAll","sizeControls","InspectorControls","__experimentalToolsPanel","arePatternOverridesEnabled","bindings","__default","source","lockUrlControls","lockHrefControls","lockCaption","urlBinding","altBinding","titleBinding","hasParentPattern","urlBindingSource","getBlockBindingsSource","altBindingSource","titleBindingSource","canUserEditValue","args","sprintf","showUrlInput","showCoverControls","showBlockControls","mediaReplaceFlow","BlockControls","group","MediaReplaceFlow","mediaId","mediaURL","accept","onSelect","onReset","controls","__experimentalImageURLInputUI","onChangeUrl","mediaUrl","mediaLink","link","lightboxEnabled","ToolbarButton","crop","overlayText","ToolbarGroup","upload","__experimentalToolsPanelItem","isShownByDefault","hasValue","onDeselect","readOnly","length","options","filename","getFilename","defaultedAlt","borderProps","useBorderProps","shadowProps","getShadowClassesAndStyles","isRounded","postType","postId","queryId","isDescendentOfQueryLoop","Number","isFinite","Placeholder","withIllustration","Spinner","src","onLoad","objectFit","__experimentalImageEditor","onSaveImage","imageAttributes","onFinishEditing","resizableBox","numericRatio","evalAspectRatio","customRatio","naturalRatio","ratio","minWidth","MIN_SIZE","minHeight","maxWidthBuffer","maxResizeWidth","showRightHandle","showLeftHandle","isRTL","ResizableBox","position","inset","size","maxHeight","lockAspectRatio","top","right","bottom","left","onResizeStart","onResize","direction","elt","delta","onResizeStop","current","Math","abs","offsetWidth","String","resizeRatio","setPostFeatureImage","featured_media","featuredImageControl","BlockSettingsMenuControls","selectedClientIds","Caption","isSelected","showToolbarButton"],"sources":["@wordpress/block-library/src/image/image.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { isBlobURL } from '@wordpress/blob';\nimport {\n\tExternalLink,\n\tResizableBox,\n\tSpinner,\n\tTextareaControl,\n\tTextControl,\n\tToolbarButton,\n\tToolbarGroup,\n\t__experimentalToolsPanel as ToolsPanel,\n\t__experimentalToolsPanelItem as ToolsPanelItem,\n\t__experimentalUseCustomUnits as useCustomUnits,\n\tPlaceholder,\n\tMenuItem,\n\tToolbarItem,\n\tDropdownMenu,\n\tPopover,\n} from '@wordpress/components';\nimport {\n\tuseMergeRefs,\n\tuseResizeObserver,\n\tuseViewportMatch,\n} from '@wordpress/compose';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport {\n\tBlockControls,\n\tInspectorControls,\n\t__experimentalImageURLInputUI as ImageURLInputUI,\n\tMediaReplaceFlow,\n\tstore as blockEditorStore,\n\tuseSettings,\n\t__experimentalImageEditor as ImageEditor,\n\t__experimentalUseBorderProps as useBorderProps,\n\t__experimentalGetShadowClassesAndStyles as getShadowClassesAndStyles,\n\tprivateApis as blockEditorPrivateApis,\n\tBlockSettingsMenuControls,\n} from '@wordpress/block-editor';\nimport { useCallback, useEffect, useMemo, useState } from '@wordpress/element';\nimport { __, _x, sprintf, isRTL } from '@wordpress/i18n';\nimport { getFilename } from '@wordpress/url';\nimport { getBlockBindingsSource, switchToBlockType } from '@wordpress/blocks';\nimport { crop, overlayText, upload, chevronDown } from '@wordpress/icons';\nimport { store as noticesStore } from '@wordpress/notices';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport { unlock } from '../lock-unlock';\nimport { createUpgradedEmbedBlock } from '../embed/util';\nimport { isExternalImage } from './edit';\nimport { Caption } from '../utils/caption';\n\n/**\n * Module constants\n */\nimport { useToolsPanelDropdownMenuProps } from '../utils/hooks';\nimport { MIN_SIZE, ALLOWED_MEDIA_TYPES, SIZED_LAYOUTS } from './constants';\nimport { evalAspectRatio } from './utils';\n\nconst { DimensionsTool, ResolutionTool } = unlock( blockEditorPrivateApis );\n\nconst scaleOptions = [\n\t{\n\t\tvalue: 'cover',\n\t\tlabel: _x( 'Cover', 'Scale option for dimensions control' ),\n\t\thelp: __( 'Image covers the space evenly.' ),\n\t},\n\t{\n\t\tvalue: 'contain',\n\t\tlabel: _x( 'Contain', 'Scale option for dimensions control' ),\n\t\thelp: __( 'Image is contained without distortion.' ),\n\t},\n];\n\nconst WRITEMODE_POPOVER_PROPS = {\n\tplacement: 'bottom-start',\n};\n\n// If the image has a href, wrap in an <a /> tag to trigger any inherited link element styles.\nconst ImageWrapper = ( { href, children } ) => {\n\tif ( ! href ) {\n\t\treturn children;\n\t}\n\treturn (\n\t\t<a\n\t\t\thref={ href }\n\t\t\tonClick={ ( event ) => event.preventDefault() }\n\t\t\taria-disabled\n\t\t\tstyle={ {\n\t\t\t\t// When the Image block is linked,\n\t\t\t\t// it's wrapped with a disabled <a /> tag.\n\t\t\t\t// Restore cursor style so it doesn't appear 'clickable'\n\t\t\t\t// and remove pointer events. Safari needs the display property.\n\t\t\t\tpointerEvents: 'none',\n\t\t\t\tcursor: 'default',\n\t\t\t\tdisplay: 'inline',\n\t\t\t} }\n\t\t>\n\t\t\t{ children }\n\t\t</a>\n\t);\n};\n\nfunction ContentOnlyControls( {\n\tattributes,\n\tsetAttributes,\n\tlockAltControls,\n\tlockAltControlsMessage,\n\tlockTitleControls,\n\tlockTitleControlsMessage,\n} ) {\n\t// Use internal state instead of a ref to make sure that the component\n\t// re-renders when the popover's anchor updates.\n\tconst [ popoverAnchor, setPopoverAnchor ] = useState( null );\n\tconst [ isAltDialogOpen, setIsAltDialogOpen ] = useState( false );\n\tconst [ isTitleDialogOpen, setIsTitleDialogOpen ] = useState( false );\n\treturn (\n\t\t<>\n\t\t\t<ToolbarItem ref={ setPopoverAnchor }>\n\t\t\t\t{ ( toggleProps ) => (\n\t\t\t\t\t<DropdownMenu\n\t\t\t\t\t\ticon={ chevronDown }\n\t\t\t\t\t\t/* translators: button label text should, if possible, be under 16 characters. */\n\t\t\t\t\t\tlabel={ __( 'More' ) }\n\t\t\t\t\t\ttoggleProps={ {\n\t\t\t\t\t\t\t...toggleProps,\n\t\t\t\t\t\t\tdescription: __( 'Displays more controls.' ),\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tpopoverProps={ WRITEMODE_POPOVER_PROPS }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ ( { onClose } ) => (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t\tsetIsAltDialogOpen( true );\n\t\t\t\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\taria-haspopup=\"dialog\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ _x(\n\t\t\t\t\t\t\t\t\t\t'Alternative text',\n\t\t\t\t\t\t\t\t\t\t'Alternative text for an image. Block toolbar label, a low character count is preferred.'\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t\tsetIsTitleDialogOpen( true );\n\t\t\t\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\taria-haspopup=\"dialog\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ __( 'Title text' ) }\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</DropdownMenu>\n\t\t\t\t) }\n\t\t\t</ToolbarItem>\n\t\t\t{ isAltDialogOpen && (\n\t\t\t\t<Popover\n\t\t\t\t\tplacement=\"bottom-start\"\n\t\t\t\t\tanchor={ popoverAnchor }\n\t\t\t\t\tonClose={ () => setIsAltDialogOpen( false ) }\n\t\t\t\t\toffset={ 13 }\n\t\t\t\t\tvariant=\"toolbar\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"wp-block-image__toolbar_content_textarea__container\">\n\t\t\t\t\t\t<TextareaControl\n\t\t\t\t\t\t\tclassName=\"wp-block-image__toolbar_content_textarea\"\n\t\t\t\t\t\t\tlabel={ __( 'Alternative text' ) }\n\t\t\t\t\t\t\tvalue={ attributes.alt || '' }\n\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\tsetAttributes( { alt: value } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdisabled={ lockAltControls }\n\t\t\t\t\t\t\thelp={\n\t\t\t\t\t\t\t\tlockAltControls ? (\n\t\t\t\t\t\t\t\t\t<>{ lockAltControlsMessage }</>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t\t\t\t\t// translators: Localized tutorial, if one exists. W3C Web Accessibility Initiative link has list of existing translations.\n\t\t\t\t\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\n\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Describe the purpose of the image.'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t{ __( 'Leave empty if decorative.' ) }\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t\t{ isTitleDialogOpen && (\n\t\t\t\t<Popover\n\t\t\t\t\tplacement=\"bottom-start\"\n\t\t\t\t\tanchor={ popoverAnchor }\n\t\t\t\t\tonClose={ () => setIsTitleDialogOpen( false ) }\n\t\t\t\t\toffset={ 13 }\n\t\t\t\t\tvariant=\"toolbar\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"wp-block-image__toolbar_content_textarea__container\">\n\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t__next40pxDefaultSize\n\t\t\t\t\t\t\tclassName=\"wp-block-image__toolbar_content_textarea\"\n\t\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\t\tlabel={ __( 'Title attribute' ) }\n\t\t\t\t\t\t\tvalue={ attributes.title || '' }\n\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\ttitle: value,\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdisabled={ lockTitleControls }\n\t\t\t\t\t\t\thelp={\n\t\t\t\t\t\t\t\tlockTitleControls ? (\n\t\t\t\t\t\t\t\t\t<>{ lockTitleControlsMessage }</>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\t\t'Describe the role of this image on the page.'\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t<ExternalLink href=\"https://www.w3.org/TR/html52/dom.html#the-title-attribute\">\n\t\t\t\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'(Note: many devices and browsers do not display this text.)'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t</>\n\t);\n}\n\nexport default function Image( {\n\ttemporaryURL,\n\tattributes,\n\tsetAttributes,\n\tisSingleSelected,\n\tinsertBlocksAfter,\n\tonReplace,\n\tonSelectImage,\n\tonSelectURL,\n\tonUploadError,\n\tcontext,\n\tclientId,\n\tblockEditingMode,\n\tparentLayoutType,\n\tmaxContentWidth,\n} ) {\n\tconst {\n\t\turl = '',\n\t\talt,\n\t\talign,\n\t\tid,\n\t\thref,\n\t\trel,\n\t\tlinkClass,\n\t\tlinkDestination,\n\t\ttitle,\n\t\twidth,\n\t\theight,\n\t\taspectRatio,\n\t\tscale,\n\t\tlinkTarget,\n\t\tsizeSlug,\n\t\tlightbox,\n\t\tmetadata,\n\t} = attributes;\n\tconst [ imageElement, setImageElement ] = useState();\n\tconst [ resizeDelta, setResizeDelta ] = useState( null );\n\tconst [ pixelSize, setPixelSize ] = useState( {} );\n\tconst [ offsetTop, setOffsetTop ] = useState( 0 );\n\tconst setResizeObserved = useResizeObserver( ( [ entry ] ) => {\n\t\tif ( ! resizeDelta ) {\n\t\t\tconst [ box ] = entry.borderBoxSize;\n\t\t\tsetPixelSize( { width: box.inlineSize, height: box.blockSize } );\n\t\t}\n\t\t// This is usually 0 unless the image height is less than the line-height.\n\t\tsetOffsetTop( entry.target.offsetTop );\n\t} );\n\tconst effectResizeableBoxPlacement = useCallback( () => {\n\t\tsetOffsetTop( imageElement?.offsetTop ?? 0 );\n\t}, [ imageElement ] );\n\tconst setRefs = useMergeRefs( [ setImageElement, setResizeObserved ] );\n\tconst { allowResize = true } = context;\n\n\tconst image = useSelect(\n\t\t( select ) =>\n\t\t\tid && isSingleSelected\n\t\t\t\t? select( coreStore ).getMedia( id, { context: 'view' } )\n\t\t\t\t: null,\n\t\t[ id, isSingleSelected ]\n\t);\n\n\tconst { canInsertCover, imageEditing, imageSizes, maxWidth } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getBlockRootClientId, canInsertBlockType, getSettings } =\n\t\t\t\tselect( blockEditorStore );\n\n\t\t\tconst rootClientId = getBlockRootClientId( clientId );\n\t\t\tconst settings = getSettings();\n\n\t\t\treturn {\n\t\t\t\timageEditing: settings.imageEditing,\n\t\t\t\timageSizes: settings.imageSizes,\n\t\t\t\tmaxWidth: settings.maxWidth,\n\t\t\t\tcanInsertCover: canInsertBlockType(\n\t\t\t\t\t'core/cover',\n\t\t\t\t\trootClientId\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\tconst { getBlock, getSettings } = useSelect( blockEditorStore );\n\n\tconst { replaceBlocks, toggleSelection } = useDispatch( blockEditorStore );\n\tconst { createErrorNotice, createSuccessNotice } =\n\t\tuseDispatch( noticesStore );\n\tconst { editEntityRecord } = useDispatch( coreStore );\n\n\tconst isLargeViewport = useViewportMatch( 'medium' );\n\tconst isWideAligned = [ 'wide', 'full' ].includes( align );\n\tconst [\n\t\t{ loadedNaturalWidth, loadedNaturalHeight },\n\t\tsetLoadedNaturalSize,\n\t] = useState( {} );\n\tconst [ isEditingImage, setIsEditingImage ] = useState( false );\n\tconst [ externalBlob, setExternalBlob ] = useState();\n\tconst [ hasImageErrored, setHasImageErrored ] = useState( false );\n\tconst hasNonContentControls = blockEditingMode === 'default';\n\tconst isContentOnlyMode = blockEditingMode === 'contentOnly';\n\tconst isResizable =\n\t\tallowResize &&\n\t\thasNonContentControls &&\n\t\t! isWideAligned &&\n\t\tisLargeViewport;\n\tconst imageSizeOptions = imageSizes\n\t\t.filter(\n\t\t\t( { slug } ) => image?.media_details?.sizes?.[ slug ]?.source_url\n\t\t)\n\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\n\t// If an image is externally hosted, try to fetch the image data. This may\n\t// fail if the image host doesn't allow CORS with the domain. If it works,\n\t// we can enable a button in the toolbar to upload the image.\n\tuseEffect( () => {\n\t\tif (\n\t\t\t! isExternalImage( id, url ) ||\n\t\t\t! isSingleSelected ||\n\t\t\t! getSettings().mediaUpload\n\t\t) {\n\t\t\tsetExternalBlob();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( externalBlob ) {\n\t\t\treturn;\n\t\t}\n\n\t\twindow\n\t\t\t// Avoid cache, which seems to help avoid CORS problems.\n\t\t\t.fetch( url.includes( '?' ) ? url : url + '?' )\n\t\t\t.then( ( response ) => response.blob() )\n\t\t\t.then( ( blob ) => setExternalBlob( blob ) )\n\t\t\t// Do nothing, cannot upload.\n\t\t\t.catch( () => {} );\n\t}, [ id, url, isSingleSelected, externalBlob, getSettings ] );\n\n\t// Get naturalWidth and naturalHeight from image, and fall back to loaded natural\n\t// width and height. This resolves an issue in Safari where the loaded natural\n\t// width and height is otherwise lost when switching between alignments.\n\t// See: https://github.com/WordPress/gutenberg/pull/37210.\n\tconst { naturalWidth, naturalHeight } = useMemo( () => {\n\t\treturn {\n\t\t\tnaturalWidth:\n\t\t\t\timageElement?.naturalWidth || loadedNaturalWidth || undefined,\n\t\t\tnaturalHeight:\n\t\t\t\timageElement?.naturalHeight || loadedNaturalHeight || undefined,\n\t\t};\n\t}, [ loadedNaturalWidth, loadedNaturalHeight, imageElement?.complete ] );\n\n\tfunction onImageError() {\n\t\tsetHasImageErrored( true );\n\n\t\t// Check if there's an embed block that handles this URL, e.g., instagram URL.\n\t\t// See: https://github.com/WordPress/gutenberg/pull/11472\n\t\tconst embedBlock = createUpgradedEmbedBlock( { attributes: { url } } );\n\t\tif ( undefined !== embedBlock ) {\n\t\t\tonReplace( embedBlock );\n\t\t}\n\t}\n\n\tfunction onImageLoad( event ) {\n\t\tsetHasImageErrored( false );\n\t\tsetLoadedNaturalSize( {\n\t\t\tloadedNaturalWidth: event.target?.naturalWidth,\n\t\t\tloadedNaturalHeight: event.target?.naturalHeight,\n\t\t} );\n\t}\n\n\tfunction onSetHref( props ) {\n\t\tsetAttributes( props );\n\t}\n\n\tfunction onSetLightbox( enable ) {\n\t\tif ( enable && ! lightboxSetting?.enabled ) {\n\t\t\tsetAttributes( {\n\t\t\t\tlightbox: { enabled: true },\n\t\t\t} );\n\t\t} else if ( ! enable && lightboxSetting?.enabled ) {\n\t\t\tsetAttributes( {\n\t\t\t\tlightbox: { enabled: false },\n\t\t\t} );\n\t\t} else {\n\t\t\tsetAttributes( {\n\t\t\t\tlightbox: undefined,\n\t\t\t} );\n\t\t}\n\t}\n\n\tfunction resetLightbox() {\n\t\t// When deleting a link from an image while lightbox settings\n\t\t// are enabled by default, we should disable the lightbox,\n\t\t// otherwise the resulting UX looks like a mistake.\n\t\t// See https://github.com/WordPress/gutenberg/pull/59890/files#r1532286123.\n\t\tif ( lightboxSetting?.enabled && lightboxSetting?.allowEditing ) {\n\t\t\tsetAttributes( {\n\t\t\t\tlightbox: { enabled: false },\n\t\t\t} );\n\t\t} else {\n\t\t\tsetAttributes( {\n\t\t\t\tlightbox: undefined,\n\t\t\t} );\n\t\t}\n\t}\n\n\tfunction onSetTitle( value ) {\n\t\t// This is the HTML title attribute, separate from the media object\n\t\t// title.\n\t\tsetAttributes( { title: value } );\n\t}\n\n\tfunction updateAlt( newAlt ) {\n\t\tsetAttributes( { alt: newAlt } );\n\t}\n\n\tfunction updateImage( newSizeSlug ) {\n\t\tconst newUrl = image?.media_details?.sizes?.[ newSizeSlug ]?.source_url;\n\t\tif ( ! newUrl ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tsetAttributes( {\n\t\t\turl: newUrl,\n\t\t\tsizeSlug: newSizeSlug,\n\t\t} );\n\t}\n\n\tfunction uploadExternal() {\n\t\tconst { mediaUpload } = getSettings();\n\t\tif ( ! mediaUpload ) {\n\t\t\treturn;\n\t\t}\n\t\tmediaUpload( {\n\t\t\tfilesList: [ externalBlob ],\n\t\t\tonFileChange( [ img ] ) {\n\t\t\t\tonSelectImage( img );\n\n\t\t\t\tif ( isBlobURL( img.url ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsetExternalBlob();\n\t\t\t\tcreateSuccessNotice( __( 'Image uploaded.' ), {\n\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t} );\n\t\t\t},\n\t\t\tallowedTypes: ALLOWED_MEDIA_TYPES,\n\t\t\tonError( message ) {\n\t\t\t\tcreateErrorNotice( message, { type: 'snackbar' } );\n\t\t\t},\n\t\t} );\n\t}\n\n\tuseEffect( () => {\n\t\tif ( ! isSingleSelected ) {\n\t\t\tsetIsEditingImage( false );\n\t\t}\n\t}, [ isSingleSelected ] );\n\n\tconst canEditImage = id && naturalWidth && naturalHeight && imageEditing;\n\tconst allowCrop =\n\t\tisSingleSelected &&\n\t\tcanEditImage &&\n\t\t! isEditingImage &&\n\t\t! isContentOnlyMode;\n\n\tfunction switchToCover() {\n\t\treplaceBlocks(\n\t\t\tclientId,\n\t\t\tswitchToBlockType( getBlock( clientId ), 'core/cover' )\n\t\t);\n\t}\n\n\t// TODO: Can allow more units after figuring out how they should interact\n\t// with the ResizableBox and ImageEditor components. Calculations later on\n\t// for those components are currently assuming px units.\n\tconst dimensionsUnitsOptions = useCustomUnits( {\n\t\tavailableUnits: [ 'px' ],\n\t} );\n\n\tconst [ lightboxSetting ] = useSettings( 'lightbox' );\n\n\tconst showLightboxSetting =\n\t\t// If a block-level override is set, we should give users the option to\n\t\t// remove that override, even if the lightbox UI is disabled in the settings.\n\t\t( !! lightbox && lightbox?.enabled !== lightboxSetting?.enabled ) ||\n\t\tlightboxSetting?.allowEditing;\n\n\tconst lightboxChecked =\n\t\t!! lightbox?.enabled || ( ! lightbox && !! lightboxSetting?.enabled );\n\n\tconst dropdownMenuProps = useToolsPanelDropdownMenuProps();\n\n\tconst dimensionsControl =\n\t\tisResizable &&\n\t\t( SIZED_LAYOUTS.includes( parentLayoutType ) ? (\n\t\t\t<DimensionsTool\n\t\t\t\tvalue={ { aspectRatio } }\n\t\t\t\tonChange={ ( { aspectRatio: newAspectRatio } ) => {\n\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\taspectRatio: newAspectRatio,\n\t\t\t\t\t\tscale: 'cover',\n\t\t\t\t\t} );\n\t\t\t\t} }\n\t\t\t\tdefaultAspectRatio=\"auto\"\n\t\t\t\ttools={ [ 'aspectRatio' ] }\n\t\t\t/>\n\t\t) : (\n\t\t\t<DimensionsTool\n\t\t\t\tvalue={ { width, height, scale, aspectRatio } }\n\t\t\t\tonChange={ ( {\n\t\t\t\t\twidth: newWidth,\n\t\t\t\t\theight: newHeight,\n\t\t\t\t\tscale: newScale,\n\t\t\t\t\taspectRatio: newAspectRatio,\n\t\t\t\t} ) => {\n\t\t\t\t\t// Rebuilding the object forces setting `undefined`\n\t\t\t\t\t// for values that are removed since setAttributes\n\t\t\t\t\t// doesn't do anything with keys that aren't set.\n\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t// CSS includes `height: auto`, but we need\n\t\t\t\t\t\t// `width: auto` to fix the aspect ratio when\n\t\t\t\t\t\t// only height is set due to the width and\n\t\t\t\t\t\t// height attributes set via the server.\n\t\t\t\t\t\twidth: ! newWidth && newHeight ? 'auto' : newWidth,\n\t\t\t\t\t\theight: newHeight,\n\t\t\t\t\t\tscale: newScale,\n\t\t\t\t\t\taspectRatio: newAspectRatio,\n\t\t\t\t\t} );\n\t\t\t\t} }\n\t\t\t\tdefaultScale=\"cover\"\n\t\t\t\tdefaultAspectRatio=\"auto\"\n\t\t\t\tscaleOptions={ scaleOptions }\n\t\t\t\tunitsOptions={ dimensionsUnitsOptions }\n\t\t\t/>\n\t\t) );\n\n\tconst resetAll = () => {\n\t\tsetAttributes( {\n\t\t\talt: undefined,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tscale: undefined,\n\t\t\taspectRatio: undefined,\n\t\t\tlightbox: undefined,\n\t\t} );\n\t};\n\n\tconst sizeControls = (\n\t\t<InspectorControls>\n\t\t\t<ToolsPanel\n\t\t\t\tlabel={ __( 'Settings' ) }\n\t\t\t\tresetAll={ resetAll }\n\t\t\t\tdropdownMenuProps={ dropdownMenuProps }\n\t\t\t>\n\t\t\t\t{ dimensionsControl }\n\t\t\t</ToolsPanel>\n\t\t</InspectorControls>\n\t);\n\n\tconst arePatternOverridesEnabled =\n\t\tmetadata?.bindings?.__default?.source === 'core/pattern-overrides';\n\n\tconst {\n\t\tlockUrlControls = false,\n\t\tlockHrefControls = false,\n\t\tlockAltControls = false,\n\t\tlockAltControlsMessage,\n\t\tlockTitleControls = false,\n\t\tlockTitleControlsMessage,\n\t\tlockCaption = false,\n\t} = useSelect(\n\t\t( select ) => {\n\t\t\tif ( ! isSingleSelected ) {\n\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst {\n\t\t\t\turl: urlBinding,\n\t\t\t\talt: altBinding,\n\t\t\t\ttitle: titleBinding,\n\t\t\t} = metadata?.bindings || {};\n\t\t\tconst hasParentPattern = !! context[ 'pattern/overrides' ];\n\t\t\tconst urlBindingSource = getBlockBindingsSource(\n\t\t\t\turlBinding?.source\n\t\t\t);\n\t\t\tconst altBindingSource = getBlockBindingsSource(\n\t\t\t\taltBinding?.source\n\t\t\t);\n\t\t\tconst titleBindingSource = getBlockBindingsSource(\n\t\t\t\ttitleBinding?.source\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tlockUrlControls:\n\t\t\t\t\t!! urlBinding &&\n\t\t\t\t\t! urlBindingSource?.canUserEditValue?.( {\n\t\t\t\t\t\tselect,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\targs: urlBinding?.args,\n\t\t\t\t\t} ),\n\t\t\t\tlockHrefControls:\n\t\t\t\t\t// Disable editing the link of the URL if the image is inside a pattern instance.\n\t\t\t\t\t// This is a temporary solution until we support overriding the link on the frontend.\n\t\t\t\t\thasParentPattern || arePatternOverridesEnabled,\n\t\t\t\tlockCaption:\n\t\t\t\t\t// Disable editing the caption if the image is inside a pattern instance.\n\t\t\t\t\t// This is a temporary solution until we support overriding the caption on the frontend.\n\t\t\t\t\thasParentPattern,\n\t\t\t\tlockAltControls:\n\t\t\t\t\t!! altBinding &&\n\t\t\t\t\t! altBindingSource?.canUserEditValue?.( {\n\t\t\t\t\t\tselect,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\targs: altBinding?.args,\n\t\t\t\t\t} ),\n\t\t\t\tlockAltControlsMessage: altBindingSource?.label\n\t\t\t\t\t? sprintf(\n\t\t\t\t\t\t\t/* translators: %s: Label of the bindings source. */\n\t\t\t\t\t\t\t__( 'Connected to %s' ),\n\t\t\t\t\t\t\taltBindingSource.label\n\t\t\t\t\t  )\n\t\t\t\t\t: __( 'Connected to dynamic data' ),\n\t\t\t\tlockTitleControls:\n\t\t\t\t\t!! titleBinding &&\n\t\t\t\t\t! titleBindingSource?.canUserEditValue?.( {\n\t\t\t\t\t\tselect,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\targs: titleBinding?.args,\n\t\t\t\t\t} ),\n\t\t\t\tlockTitleControlsMessage: titleBindingSource?.label\n\t\t\t\t\t? sprintf(\n\t\t\t\t\t\t\t/* translators: %s: Label of the bindings source. */\n\t\t\t\t\t\t\t__( 'Connected to %s' ),\n\t\t\t\t\t\t\ttitleBindingSource.label\n\t\t\t\t\t  )\n\t\t\t\t\t: __( 'Connected to dynamic data' ),\n\t\t\t};\n\t\t},\n\t\t[\n\t\t\tarePatternOverridesEnabled,\n\t\t\tcontext,\n\t\t\tisSingleSelected,\n\t\t\tmetadata?.bindings,\n\t\t]\n\t);\n\n\tconst showUrlInput =\n\t\tisSingleSelected &&\n\t\t! isEditingImage &&\n\t\t! lockHrefControls &&\n\t\t! lockUrlControls;\n\n\tconst showCoverControls = isSingleSelected && canInsertCover;\n\n\tconst showBlockControls = showUrlInput || allowCrop || showCoverControls;\n\n\tconst mediaReplaceFlow = isSingleSelected &&\n\t\t! isEditingImage &&\n\t\t! lockUrlControls && (\n\t\t\t// For contentOnly mode, put this button in its own area so it has borders around it.\n\t\t\t<BlockControls group={ isContentOnlyMode ? 'inline' : 'other' }>\n\t\t\t\t<MediaReplaceFlow\n\t\t\t\t\tmediaId={ id }\n\t\t\t\t\tmediaURL={ url }\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\tonSelect={ onSelectImage }\n\t\t\t\t\tonSelectURL={ onSelectURL }\n\t\t\t\t\tonError={ onUploadError }\n\t\t\t\t\tname={ ! url ? __( 'Add image' ) : __( 'Replace' ) }\n\t\t\t\t\tonReset={ () => onSelectImage( undefined ) }\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t);\n\n\tconst controls = (\n\t\t<>\n\t\t\t{ showBlockControls && (\n\t\t\t\t<BlockControls group=\"block\">\n\t\t\t\t\t{ showUrlInput && (\n\t\t\t\t\t\t<ImageURLInputUI\n\t\t\t\t\t\t\turl={ href || '' }\n\t\t\t\t\t\t\tonChangeUrl={ onSetHref }\n\t\t\t\t\t\t\tlinkDestination={ linkDestination }\n\t\t\t\t\t\t\tmediaUrl={ ( image && image.source_url ) || url }\n\t\t\t\t\t\t\tmediaLink={ image && image.link }\n\t\t\t\t\t\t\tlinkTarget={ linkTarget }\n\t\t\t\t\t\t\tlinkClass={ linkClass }\n\t\t\t\t\t\t\trel={ rel }\n\t\t\t\t\t\t\tshowLightboxSetting={ showLightboxSetting }\n\t\t\t\t\t\t\tlightboxEnabled={ lightboxChecked }\n\t\t\t\t\t\t\tonSetLightbox={ onSetLightbox }\n\t\t\t\t\t\t\tresetLightbox={ resetLightbox }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ allowCrop && (\n\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\tonClick={ () => setIsEditingImage( true ) }\n\t\t\t\t\t\t\ticon={ crop }\n\t\t\t\t\t\t\tlabel={ __( 'Crop' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ showCoverControls && (\n\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\ticon={ overlayText }\n\t\t\t\t\t\t\tlabel={ __( 'Add text over image' ) }\n\t\t\t\t\t\t\tonClick={ switchToCover }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t{ isSingleSelected && externalBlob && (\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\tonClick={ uploadExternal }\n\t\t\t\t\t\t\ticon={ upload }\n\t\t\t\t\t\t\tlabel={ __( 'Upload to Media Library' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</ToolbarGroup>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t{ isContentOnlyMode && (\n\t\t\t\t// Add some extra controls for content attributes when content only mode is active.\n\t\t\t\t// With content only mode active, the inspector is hidden, so users need another way\n\t\t\t\t// to edit these attributes.\n\t\t\t\t<BlockControls group=\"block\">\n\t\t\t\t\t<ContentOnlyControls\n\t\t\t\t\t\tattributes={ attributes }\n\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t\tlockAltControls={ lockAltControls }\n\t\t\t\t\t\tlockAltControlsMessage={ lockAltControlsMessage }\n\t\t\t\t\t\tlockTitleControls={ lockTitleControls }\n\t\t\t\t\t\tlockTitleControlsMessage={ lockTitleControlsMessage }\n\t\t\t\t\t/>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t<InspectorControls>\n\t\t\t\t<ToolsPanel\n\t\t\t\t\tlabel={ __( 'Settings' ) }\n\t\t\t\t\tresetAll={ resetAll }\n\t\t\t\t\tdropdownMenuProps={ dropdownMenuProps }\n\t\t\t\t>\n\t\t\t\t\t{ isSingleSelected && (\n\t\t\t\t\t\t<ToolsPanelItem\n\t\t\t\t\t\t\tlabel={ __( 'Alternative text' ) }\n\t\t\t\t\t\t\tisShownByDefault\n\t\t\t\t\t\t\thasValue={ () => !! alt }\n\t\t\t\t\t\t\tonDeselect={ () =>\n\t\t\t\t\t\t\t\tsetAttributes( { alt: undefined } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TextareaControl\n\t\t\t\t\t\t\t\tlabel={ __( 'Alternative text' ) }\n\t\t\t\t\t\t\t\tvalue={ alt || '' }\n\t\t\t\t\t\t\t\tonChange={ updateAlt }\n\t\t\t\t\t\t\t\treadOnly={ lockAltControls }\n\t\t\t\t\t\t\t\thelp={\n\t\t\t\t\t\t\t\t\tlockAltControls ? (\n\t\t\t\t\t\t\t\t\t\t<>{ lockAltControlsMessage }</>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t\t\t\t\t\t// translators: Localized tutorial, if one exists. W3C Web Accessibility Initiative link has list of existing translations.\n\t\t\t\t\t\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\n\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Describe the purpose of the image.'\n\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Leave empty if decorative.'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</ToolsPanelItem>\n\t\t\t\t\t) }\n\t\t\t\t\t{ dimensionsControl }\n\t\t\t\t\t{ !! imageSizeOptions.length && (\n\t\t\t\t\t\t<ResolutionTool\n\t\t\t\t\t\t\tvalue={ sizeSlug }\n\t\t\t\t\t\t\tonChange={ updateImage }\n\t\t\t\t\t\t\toptions={ imageSizeOptions }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</ToolsPanel>\n\t\t\t</InspectorControls>\n\t\t\t<InspectorControls group=\"advanced\">\n\t\t\t\t<TextControl\n\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t__next40pxDefaultSize\n\t\t\t\t\tlabel={ __( 'Title attribute' ) }\n\t\t\t\t\tvalue={ title || '' }\n\t\t\t\t\tonChange={ onSetTitle }\n\t\t\t\t\treadOnly={ lockTitleControls }\n\t\t\t\t\thelp={\n\t\t\t\t\t\tlockTitleControls ? (\n\t\t\t\t\t\t\t<>{ lockTitleControlsMessage }</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t'Describe the role of this image on the page.'\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t<ExternalLink href=\"https://www.w3.org/TR/html52/dom.html#the-title-attribute\">\n\t\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\t'(Note: many devices and browsers do not display this text.)'\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</InspectorControls>\n\t\t</>\n\t);\n\n\tconst filename = getFilename( url );\n\tlet defaultedAlt;\n\n\tif ( alt ) {\n\t\tdefaultedAlt = alt;\n\t} else if ( filename ) {\n\t\tdefaultedAlt = sprintf(\n\t\t\t/* translators: %s: file name */\n\t\t\t__( 'This image has an empty alt attribute; its file name is %s' ),\n\t\t\tfilename\n\t\t);\n\t} else {\n\t\tdefaultedAlt = __( 'This image has an empty alt attribute' );\n\t}\n\n\tconst borderProps = useBorderProps( attributes );\n\tconst shadowProps = getShadowClassesAndStyles( attributes );\n\tconst isRounded = attributes.className?.includes( 'is-style-rounded' );\n\n\tconst { postType, postId, queryId } = context;\n\tconst isDescendentOfQueryLoop = Number.isFinite( queryId );\n\n\tlet img =\n\t\ttemporaryURL && hasImageErrored ? (\n\t\t\t// Show a placeholder during upload when the blob URL can't be loaded. This can\n\t\t\t// happen when the user uploads a HEIC image in a browser that doesn't support them.\n\t\t\t<Placeholder\n\t\t\t\tclassName=\"wp-block-image__placeholder\"\n\t\t\t\twithIllustration\n\t\t\t>\n\t\t\t\t<Spinner />\n\t\t\t</Placeholder>\n\t\t) : (\n\t\t\t// Disable reason: Image itself is not meant to be interactive, but\n\t\t\t// should direct focus to block.\n\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions, jsx-a11y/click-events-have-key-events */\n\t\t\t<>\n\t\t\t\t<img\n\t\t\t\t\tsrc={ temporaryURL || url }\n\t\t\t\t\talt={ defaultedAlt }\n\t\t\t\t\tonError={ onImageError }\n\t\t\t\t\tonLoad={ onImageLoad }\n\t\t\t\t\tref={ setRefs }\n\t\t\t\t\tclassName={ borderProps.className }\n\t\t\t\t\twidth={ naturalWidth }\n\t\t\t\t\theight={ naturalHeight }\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\taspectRatio,\n\t\t\t\t\t\t...( resizeDelta\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\twidth: pixelSize.width + resizeDelta.width,\n\t\t\t\t\t\t\t\t\theight:\n\t\t\t\t\t\t\t\t\t\tpixelSize.height + resizeDelta.height,\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: { width, height } ),\n\t\t\t\t\t\tobjectFit: scale,\n\t\t\t\t\t\t...borderProps.style,\n\t\t\t\t\t\t...shadowProps.style,\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t\t{ temporaryURL && <Spinner /> }\n\t\t\t</>\n\t\t\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions, jsx-a11y/click-events-have-key-events */\n\t\t);\n\n\tif ( canEditImage && isEditingImage ) {\n\t\timg = (\n\t\t\t<ImageWrapper href={ href }>\n\t\t\t\t<ImageEditor\n\t\t\t\t\tid={ id }\n\t\t\t\t\turl={ url }\n\t\t\t\t\t{ ...pixelSize }\n\t\t\t\t\tnaturalHeight={ naturalHeight }\n\t\t\t\t\tnaturalWidth={ naturalWidth }\n\t\t\t\t\tonSaveImage={ ( imageAttributes ) =>\n\t\t\t\t\t\tsetAttributes( imageAttributes )\n\t\t\t\t\t}\n\t\t\t\t\tonFinishEditing={ () => {\n\t\t\t\t\t\tsetIsEditingImage( false );\n\t\t\t\t\t} }\n\t\t\t\t\tborderProps={ isRounded ? undefined : borderProps }\n\t\t\t\t/>\n\t\t\t</ImageWrapper>\n\t\t);\n\t} else {\n\t\timg = <ImageWrapper href={ href }>{ img }</ImageWrapper>;\n\t}\n\n\tlet resizableBox;\n\tif (\n\t\tisResizable &&\n\t\tisSingleSelected &&\n\t\t! isEditingImage &&\n\t\t! SIZED_LAYOUTS.includes( parentLayoutType )\n\t) {\n\t\tconst numericRatio = aspectRatio && evalAspectRatio( aspectRatio );\n\t\tconst customRatio = pixelSize.width / pixelSize.height;\n\t\tconst naturalRatio = naturalWidth / naturalHeight;\n\t\tconst ratio = numericRatio || customRatio || naturalRatio || 1;\n\t\tconst minWidth =\n\t\t\tnaturalWidth < naturalHeight ? MIN_SIZE : MIN_SIZE * ratio;\n\t\tconst minHeight =\n\t\t\tnaturalHeight < naturalWidth ? MIN_SIZE : MIN_SIZE / ratio;\n\n\t\t// With the current implementation of ResizableBox, an image needs an\n\t\t// explicit pixel value for the max-width. In absence of being able to\n\t\t// set the content-width, this max-width is currently dictated by the\n\t\t// vanilla editor style. The following variable adds a buffer to this\n\t\t// vanilla style, so 3rd party themes have some wiggleroom. This does,\n\t\t// in most cases, allow you to scale the image beyond the width of the\n\t\t// main column, though not infinitely.\n\t\t// @todo It would be good to revisit this once a content-width variable\n\t\t// becomes available.\n\t\tconst maxWidthBuffer = maxWidth * 2.5;\n\t\tconst maxResizeWidth = maxContentWidth || maxWidthBuffer;\n\n\t\tlet showRightHandle = false;\n\t\tlet showLeftHandle = false;\n\n\t\t/* eslint-disable no-lonely-if */\n\t\t// See https://github.com/WordPress/gutenberg/issues/7584.\n\t\tif ( align === 'center' ) {\n\t\t\t// When the image is centered, show both handles.\n\t\t\tshowRightHandle = true;\n\t\t\tshowLeftHandle = true;\n\t\t} else if ( isRTL() ) {\n\t\t\t// In RTL mode the image is on the right by default.\n\t\t\t// Show the right handle and hide the left handle only when it is\n\t\t\t// aligned left. Otherwise always show the left handle.\n\t\t\tif ( align === 'left' ) {\n\t\t\t\tshowRightHandle = true;\n\t\t\t} else {\n\t\t\t\tshowLeftHandle = true;\n\t\t\t}\n\t\t} else {\n\t\t\t// Show the left handle and hide the right handle only when the\n\t\t\t// image is aligned right. Otherwise always show the right handle.\n\t\t\tif ( align === 'right' ) {\n\t\t\t\tshowLeftHandle = true;\n\t\t\t} else {\n\t\t\t\tshowRightHandle = true;\n\t\t\t}\n\t\t}\n\t\t/* eslint-enable no-lonely-if */\n\t\tresizableBox = (\n\t\t\t<ResizableBox\n\t\t\t\tref={ effectResizeableBoxPlacement }\n\t\t\t\tstyle={ {\n\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t// To match the vertical-align: bottom of the img (from style.scss)\n\t\t\t\t\t// syncs the top with the img. This matters when the img height is\n\t\t\t\t\t// less than the line-height.\n\t\t\t\t\tinset: `${ offsetTop }px 0 0 0`,\n\t\t\t\t} }\n\t\t\t\tsize={ pixelSize }\n\t\t\t\tminWidth={ minWidth }\n\t\t\t\tmaxWidth={ maxResizeWidth }\n\t\t\t\tminHeight={ minHeight }\n\t\t\t\tmaxHeight={ maxResizeWidth / ratio }\n\t\t\t\tlockAspectRatio={ ratio }\n\t\t\t\tenable={ {\n\t\t\t\t\ttop: false,\n\t\t\t\t\tright: showRightHandle,\n\t\t\t\t\tbottom: true,\n\t\t\t\t\tleft: showLeftHandle,\n\t\t\t\t} }\n\t\t\t\tonResizeStart={ () => {\n\t\t\t\t\ttoggleSelection( false );\n\t\t\t\t} }\n\t\t\t\tonResize={ ( event, direction, elt, delta ) => {\n\t\t\t\t\tsetResizeDelta( delta );\n\t\t\t\t} }\n\t\t\t\tonResizeStop={ ( event, direction, elt, delta ) => {\n\t\t\t\t\ttoggleSelection( true );\n\t\t\t\t\tsetResizeDelta( null );\n\t\t\t\t\tsetPixelSize( ( current ) => ( {\n\t\t\t\t\t\twidth: current.width + delta.width,\n\t\t\t\t\t\theight: current.height + delta.height,\n\t\t\t\t\t} ) );\n\n\t\t\t\t\t// Clear hardcoded width if the resized width is close to the max-content width.\n\t\t\t\t\tif (\n\t\t\t\t\t\tmaxContentWidth &&\n\t\t\t\t\t\t// Only do this if the image is bigger than the container to prevent it from being squished.\n\t\t\t\t\t\t// TODO: Remove this check if the image support setting 100% width.\n\t\t\t\t\t\tnaturalWidth >= maxContentWidth &&\n\t\t\t\t\t\tMath.abs( elt.offsetWidth - maxContentWidth ) < 10\n\t\t\t\t\t) {\n\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\twidth: undefined,\n\t\t\t\t\t\t\theight: undefined,\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Since the aspect ratio is locked when resizing, we can\n\t\t\t\t\t// use the width of the resized element to calculate the\n\t\t\t\t\t// height in CSS to prevent stretching when the max-width\n\t\t\t\t\t// is reached.\n\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\twidth: `${ elt.offsetWidth }px`,\n\t\t\t\t\t\theight: 'auto',\n\t\t\t\t\t\taspectRatio:\n\t\t\t\t\t\t\tratio === naturalRatio\n\t\t\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t\t\t: String( ratio ),\n\t\t\t\t\t} );\n\t\t\t\t} }\n\t\t\t\tresizeRatio={ align === 'center' ? 2 : 1 }\n\t\t\t/>\n\t\t);\n\t}\n\n\tif ( ! url && ! temporaryURL ) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ mediaReplaceFlow }\n\t\t\t\t{ /* Add all controls if the image attributes are connected. */ }\n\t\t\t\t{ metadata?.bindings ? controls : sizeControls }\n\t\t\t</>\n\t\t);\n\t}\n\n\t/**\n\t * Set the post's featured image with the current image.\n\t */\n\tconst setPostFeatureImage = () => {\n\t\teditEntityRecord( 'postType', postType, postId, {\n\t\t\tfeatured_media: id,\n\t\t} );\n\t\tcreateSuccessNotice( __( 'Post featured image updated.' ), {\n\t\t\ttype: 'snackbar',\n\t\t} );\n\t};\n\n\tconst featuredImageControl = (\n\t\t<BlockSettingsMenuControls>\n\t\t\t{ ( { selectedClientIds } ) =>\n\t\t\t\tselectedClientIds.length === 1 &&\n\t\t\t\t! isDescendentOfQueryLoop &&\n\t\t\t\tpostId &&\n\t\t\t\tid &&\n\t\t\t\tclientId === selectedClientIds[ 0 ] && (\n\t\t\t\t\t<MenuItem onClick={ setPostFeatureImage }>\n\t\t\t\t\t\t{ __( 'Set as featured image' ) }\n\t\t\t\t\t</MenuItem>\n\t\t\t\t)\n\t\t\t}\n\t\t</BlockSettingsMenuControls>\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t{ mediaReplaceFlow }\n\t\t\t{ controls }\n\t\t\t{ featuredImageControl }\n\t\t\t{ img }\n\t\t\t{ resizableBox }\n\n\t\t\t<Caption\n\t\t\t\tattributes={ attributes }\n\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\tisSelected={ isSingleSelected }\n\t\t\t\tinsertBlocksAfter={ insertBlocksAfter }\n\t\t\t\tlabel={ __( 'Image caption text' ) }\n\t\t\t\tshowToolbarButton={\n\t\t\t\t\tisSingleSelected &&\n\t\t\t\t\thasNonContentControls &&\n\t\t\t\t\t! arePatternOverridesEnabled\n\t\t\t\t}\n\t\t\t\treadOnly={ lockCaption }\n\t\t\t/>\n\t\t</>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}