{"version":3,"names":["_clsx","_interopRequireDefault","require","_blockEditor","_i18n","_coreData","_components","_element","_data","_apiFetch","_url","_jsxRuntime","Edit","attributes","textAlign","showPostTitle","showCommentsCount","level","levelOptions","setAttributes","context","postType","postId","TagName","commentsCount","setCommentsCount","useState","rawTitle","useEntityProp","isSiteEditor","blockProps","useBlockProps","className","clsx","threadCommentsDepth","threadComments","commentsPerPage","pageComments","useSelect","select","getSettings","blockEditorStore","__experimentalDiscussionSettings","useEffect","nestedCommentsNumber","Math","min","topLevelCommentsNumber","commentsNumber","parseInt","currentPostId","apiFetch","path","addQueryArgs","post","_fields","method","parse","then","res","headers","get","catch","blockControls","jsxs","BlockControls","group","children","jsx","AlignmentControl","value","onChange","newAlign","HeadingLevelDropdown","options","newLevel","inspectorControls","InspectorControls","PanelBody","title","__","ToggleControl","__nextHasNoMarginBottom","label","checked","postTitle","placeholder","undefined","sprintf","_n","Fragment"],"sources":["@wordpress/block-library/src/comments-title/edit.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport clsx from 'clsx';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tAlignmentControl,\n\tBlockControls,\n\tuseBlockProps,\n\tInspectorControls,\n\tstore as blockEditorStore,\n\tHeadingLevelDropdown,\n} from '@wordpress/block-editor';\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { useEntityProp } from '@wordpress/core-data';\nimport { PanelBody, ToggleControl } from '@wordpress/components';\nimport { useState, useEffect } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\nexport default function Edit( {\n\tattributes: {\n\t\ttextAlign,\n\t\tshowPostTitle,\n\t\tshowCommentsCount,\n\t\tlevel,\n\t\tlevelOptions,\n\t},\n\tsetAttributes,\n\tcontext: { postType, postId },\n} ) {\n\tconst TagName = 'h' + level;\n\tconst [ commentsCount, setCommentsCount ] = useState();\n\tconst [ rawTitle ] = useEntityProp( 'postType', postType, 'title', postId );\n\tconst isSiteEditor = typeof postId === 'undefined';\n\tconst blockProps = useBlockProps( {\n\t\tclassName: clsx( {\n\t\t\t[ `has-text-align-${ textAlign }` ]: textAlign,\n\t\t} ),\n\t} );\n\n\tconst {\n\t\tthreadCommentsDepth,\n\t\tthreadComments,\n\t\tcommentsPerPage,\n\t\tpageComments,\n\t} = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn getSettings().__experimentalDiscussionSettings;\n\t} );\n\n\tuseEffect( () => {\n\t\tif ( isSiteEditor ) {\n\t\t\t// Match the number of comments that will be shown in the comment-template/edit.js placeholder\n\n\t\t\tconst nestedCommentsNumber = threadComments\n\t\t\t\t? Math.min( threadCommentsDepth, 3 ) - 1\n\t\t\t\t: 0;\n\t\t\tconst topLevelCommentsNumber = pageComments ? commentsPerPage : 3;\n\n\t\t\tconst commentsNumber =\n\t\t\t\tparseInt( nestedCommentsNumber ) +\n\t\t\t\tparseInt( topLevelCommentsNumber );\n\n\t\t\tsetCommentsCount( Math.min( commentsNumber, 3 ) );\n\t\t\treturn;\n\t\t}\n\t\tconst currentPostId = postId;\n\t\tapiFetch( {\n\t\t\tpath: addQueryArgs( '/wp/v2/comments', {\n\t\t\t\tpost: postId,\n\t\t\t\t_fields: 'id',\n\t\t\t} ),\n\t\t\tmethod: 'HEAD',\n\t\t\tparse: false,\n\t\t} )\n\t\t\t.then( ( res ) => {\n\t\t\t\t// Stale requests will have the `currentPostId` of an older closure.\n\t\t\t\tif ( currentPostId === postId ) {\n\t\t\t\t\tsetCommentsCount(\n\t\t\t\t\t\tparseInt( res.headers.get( 'X-WP-Total' ) )\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.catch( () => {\n\t\t\t\tsetCommentsCount( 0 );\n\t\t\t} );\n\t}, [ postId ] );\n\n\tconst blockControls = (\n\t\t<BlockControls group=\"block\">\n\t\t\t<AlignmentControl\n\t\t\t\tvalue={ textAlign }\n\t\t\t\tonChange={ ( newAlign ) =>\n\t\t\t\t\tsetAttributes( { textAlign: newAlign } )\n\t\t\t\t}\n\t\t\t/>\n\t\t\t<HeadingLevelDropdown\n\t\t\t\tvalue={ level }\n\t\t\t\toptions={ levelOptions }\n\t\t\t\tonChange={ ( newLevel ) =>\n\t\t\t\t\tsetAttributes( { level: newLevel } )\n\t\t\t\t}\n\t\t\t/>\n\t\t</BlockControls>\n\t);\n\n\tconst inspectorControls = (\n\t\t<InspectorControls>\n\t\t\t<PanelBody title={ __( 'Settings' ) }>\n\t\t\t\t<ToggleControl\n\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\tlabel={ __( 'Show post title' ) }\n\t\t\t\t\tchecked={ showPostTitle }\n\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\tsetAttributes( { showPostTitle: value } )\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<ToggleControl\n\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\tlabel={ __( 'Show comments count' ) }\n\t\t\t\t\tchecked={ showCommentsCount }\n\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\tsetAttributes( { showCommentsCount: value } )\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</PanelBody>\n\t\t</InspectorControls>\n\t);\n\n\tconst postTitle = isSiteEditor ? __( '“Post Title”' ) : `\"${ rawTitle }\"`;\n\n\tlet placeholder;\n\tif ( showCommentsCount && commentsCount !== undefined ) {\n\t\tif ( showPostTitle ) {\n\t\t\tif ( commentsCount === 1 ) {\n\t\t\t\t/* translators: %s: Post title. */\n\t\t\t\tplaceholder = sprintf( __( 'One response to %s' ), postTitle );\n\t\t\t} else {\n\t\t\t\tplaceholder = sprintf(\n\t\t\t\t\t/* translators: 1: Number of comments, 2: Post title. */\n\t\t\t\t\t_n(\n\t\t\t\t\t\t'%1$s response to %2$s',\n\t\t\t\t\t\t'%1$s responses to %2$s',\n\t\t\t\t\t\tcommentsCount\n\t\t\t\t\t),\n\t\t\t\t\tcommentsCount,\n\t\t\t\t\tpostTitle\n\t\t\t\t);\n\t\t\t}\n\t\t} else if ( commentsCount === 1 ) {\n\t\t\tplaceholder = __( 'One response' );\n\t\t} else {\n\t\t\tplaceholder = sprintf(\n\t\t\t\t/* translators: %s: Number of comments. */\n\t\t\t\t_n( '%s response', '%s responses', commentsCount ),\n\t\t\t\tcommentsCount\n\t\t\t);\n\t\t}\n\t} else if ( showPostTitle ) {\n\t\tif ( commentsCount === 1 ) {\n\t\t\t/* translators: %s: Post title. */\n\t\t\tplaceholder = sprintf( __( 'Response to %s' ), postTitle );\n\t\t} else {\n\t\t\t/* translators: %s: Post title. */\n\t\t\tplaceholder = sprintf( __( 'Responses to %s' ), postTitle );\n\t\t}\n\t} else if ( commentsCount === 1 ) {\n\t\tplaceholder = __( 'Response' );\n\t} else {\n\t\tplaceholder = __( 'Responses' );\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{ blockControls }\n\t\t\t{ inspectorControls }\n\t\t\t<TagName { ...blockProps }>{ placeholder }</TagName>\n\t\t</>\n\t);\n}\n"],"mappings":"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","ignoreList":[]}