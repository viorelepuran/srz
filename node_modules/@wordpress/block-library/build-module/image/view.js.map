{"version":3,"names":["store","getContext","getElement","withSyncEvent","isTouching","lastTouchTime","state","actions","callbacks","currentImageId","currentImage","metadata","overlayOpened","roleAttribute","ariaModal","enlargedSrc","uploadedSrc","figureStyles","replace","imgStyles","imageButtonRight","imageId","imageButtonTop","isContentHidden","ctx","overlayEnabled","isContentVisible","showLightbox","imageRef","complete","scrollTopReset","document","documentElement","scrollTop","scrollLeftReset","scrollLeft","setOverlayStyles","hideLightbox","showClosingAnimation","setTimeout","buttonRef","focus","preventScroll","handleKeydown","event","key","preventDefault","ref","querySelector","handleTouchMove","handleTouchStart","handleTouchEnd","Date","now","handleScroll","window","scrollTo","naturalWidth","naturalHeight","offsetWidth","originalWidth","offsetHeight","originalHeight","x","screenPosX","y","screenPosY","getBoundingClientRect","naturalRatio","originalRatio","scaleAttr","heightWithoutSpace","widthWithoutSpace","imgMaxWidth","parseFloat","targetWidth","imgMaxHeight","targetHeight","imgRatio","containerMaxWidth","containerMaxHeight","containerWidth","containerHeight","toFixed","reducedHeight","reducedWidth","horizontalPadding","innerWidth","verticalPadding","targetMaxWidth","Math","min","targetMaxHeight","innerHeight","targetContainerRatio","containerScale","lightboxImgWidth","lightboxImgHeight","overlayStyles","clientWidth","setButtonStyles","currentSrc","figure","parentElement","figureWidth","figureHeight","clientHeight","caption","captionComputedStyle","getComputedStyle","includes","position","marginTop","marginBottom","buttonOffsetTop","buttonOffsetRight","offsetRatio","referenceHeight","referenceWidth","setOverlayFocus","initTriggerButton","lock"],"sources":["@wordpress/block-library/src/image/view.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tstore,\n\tgetContext,\n\tgetElement,\n\twithSyncEvent,\n} from '@wordpress/interactivity';\n\n/**\n * Tracks whether user is touching screen; used to differentiate behavior for\n * touch and mouse input.\n *\n * @type {boolean}\n */\nlet isTouching = false;\n\n/**\n * Tracks the last time the screen was touched; used to differentiate behavior\n * for touch and mouse input.\n *\n * @type {number}\n */\nlet lastTouchTime = 0;\n\nconst { state, actions, callbacks } = store(\n\t'core/image',\n\t{\n\t\tstate: {\n\t\t\tcurrentImageId: null,\n\t\t\tget currentImage() {\n\t\t\t\treturn state.metadata[ state.currentImageId ];\n\t\t\t},\n\t\t\tget overlayOpened() {\n\t\t\t\treturn state.currentImageId !== null;\n\t\t\t},\n\t\t\tget roleAttribute() {\n\t\t\t\treturn state.overlayOpened ? 'dialog' : null;\n\t\t\t},\n\t\t\tget ariaModal() {\n\t\t\t\treturn state.overlayOpened ? 'true' : null;\n\t\t\t},\n\t\t\tget enlargedSrc() {\n\t\t\t\treturn (\n\t\t\t\t\tstate.currentImage.uploadedSrc ||\n\t\t\t\t\t'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='\n\t\t\t\t);\n\t\t\t},\n\t\t\tget figureStyles() {\n\t\t\t\treturn (\n\t\t\t\t\tstate.overlayOpened &&\n\t\t\t\t\t`${ state.currentImage.figureStyles?.replace(\n\t\t\t\t\t\t/margin[^;]*;?/g,\n\t\t\t\t\t\t''\n\t\t\t\t\t) };`\n\t\t\t\t);\n\t\t\t},\n\t\t\tget imgStyles() {\n\t\t\t\treturn (\n\t\t\t\t\tstate.overlayOpened &&\n\t\t\t\t\t`${ state.currentImage.imgStyles?.replace(\n\t\t\t\t\t\t/;$/,\n\t\t\t\t\t\t''\n\t\t\t\t\t) }; object-fit:cover;`\n\t\t\t\t);\n\t\t\t},\n\t\t\tget imageButtonRight() {\n\t\t\t\tconst { imageId } = getContext();\n\t\t\t\treturn state.metadata[ imageId ].imageButtonRight;\n\t\t\t},\n\t\t\tget imageButtonTop() {\n\t\t\t\tconst { imageId } = getContext();\n\t\t\t\treturn state.metadata[ imageId ].imageButtonTop;\n\t\t\t},\n\t\t\tget isContentHidden() {\n\t\t\t\tconst ctx = getContext();\n\t\t\t\treturn (\n\t\t\t\t\tstate.overlayEnabled && state.currentImageId === ctx.imageId\n\t\t\t\t);\n\t\t\t},\n\t\t\tget isContentVisible() {\n\t\t\t\tconst ctx = getContext();\n\t\t\t\treturn (\n\t\t\t\t\t! state.overlayEnabled &&\n\t\t\t\t\tstate.currentImageId === ctx.imageId\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t\tactions: {\n\t\t\tshowLightbox() {\n\t\t\t\tconst { imageId } = getContext();\n\n\t\t\t\t// Bails out if the image has not loaded yet.\n\t\t\t\tif ( ! state.metadata[ imageId ].imageRef?.complete ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Stores the positions of the scroll to fix it until the overlay is\n\t\t\t\t// closed.\n\t\t\t\tstate.scrollTopReset = document.documentElement.scrollTop;\n\t\t\t\tstate.scrollLeftReset = document.documentElement.scrollLeft;\n\n\t\t\t\t// Sets the current expanded image in the state and enables the overlay.\n\t\t\t\tstate.overlayEnabled = true;\n\t\t\t\tstate.currentImageId = imageId;\n\n\t\t\t\t// Computes the styles of the overlay for the animation.\n\t\t\t\tcallbacks.setOverlayStyles();\n\t\t\t},\n\t\t\thideLightbox() {\n\t\t\t\tif ( state.overlayEnabled ) {\n\t\t\t\t\t// Starts the overlay closing animation. The showClosingAnimation\n\t\t\t\t\t// class is used to avoid showing it on page load.\n\t\t\t\t\tstate.showClosingAnimation = true;\n\t\t\t\t\tstate.overlayEnabled = false;\n\n\t\t\t\t\t// Waits until the close animation has completed before allowing a\n\t\t\t\t\t// user to scroll again. The duration of this animation is defined in\n\t\t\t\t\t// the `styles.scss` file, but in any case we should wait a few\n\t\t\t\t\t// milliseconds longer than the duration, otherwise a user may scroll\n\t\t\t\t\t// too soon and cause the animation to look sloppy.\n\t\t\t\t\tsetTimeout( function () {\n\t\t\t\t\t\t// Delays before changing the focus. Otherwise the focus ring will\n\t\t\t\t\t\t// appear on Firefox before the image has finished animating, which\n\t\t\t\t\t\t// looks broken.\n\t\t\t\t\t\tstate.currentImage.buttonRef.focus( {\n\t\t\t\t\t\t\tpreventScroll: true,\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t// Resets the current image id to mark the overlay as closed.\n\t\t\t\t\t\tstate.currentImageId = null;\n\t\t\t\t\t}, 450 );\n\t\t\t\t}\n\t\t\t},\n\t\t\thandleKeydown: withSyncEvent( ( event ) => {\n\t\t\t\tif ( state.overlayEnabled ) {\n\t\t\t\t\t// Focuses the close button when the user presses the tab key.\n\t\t\t\t\tif ( event.key === 'Tab' ) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tconst { ref } = getElement();\n\t\t\t\t\t\tref.querySelector( 'button' ).focus();\n\t\t\t\t\t}\n\t\t\t\t\t// Closes the lightbox when the user presses the escape key.\n\t\t\t\t\tif ( event.key === 'Escape' ) {\n\t\t\t\t\t\tactions.hideLightbox();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} ),\n\t\t\thandleTouchMove: withSyncEvent( ( event ) => {\n\t\t\t\t// On mobile devices, prevents triggering the scroll event because\n\t\t\t\t// otherwise the page jumps around when it resets the scroll position.\n\t\t\t\t// This also means that closing the lightbox requires that a user\n\t\t\t\t// perform a simple tap. This may be changed in the future if there is a\n\t\t\t\t// better alternative to override or reset the scroll position during\n\t\t\t\t// swipe actions.\n\t\t\t\tif ( state.overlayEnabled ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t} ),\n\t\t\thandleTouchStart() {\n\t\t\t\tisTouching = true;\n\t\t\t},\n\t\t\thandleTouchEnd() {\n\t\t\t\t// Waits a few milliseconds before resetting to ensure that pinch to\n\t\t\t\t// zoom works consistently on mobile devices when the lightbox is open.\n\t\t\t\tlastTouchTime = Date.now();\n\t\t\t\tisTouching = false;\n\t\t\t},\n\t\t\thandleScroll() {\n\t\t\t\t// Prevents scrolling behaviors that trigger content shift while the\n\t\t\t\t// lightbox is open. It would be better to accomplish through CSS alone,\n\t\t\t\t// but using overflow: hidden is currently the only way to do so and\n\t\t\t\t// that causes a layout to shift and prevents the zoom animation from\n\t\t\t\t// working in some cases because it's not possible to account for the\n\t\t\t\t// layout shift when doing the animation calculations. Instead, it uses\n\t\t\t\t// JavaScript to prevent and reset the scrolling behavior.\n\t\t\t\tif ( state.overlayOpened ) {\n\t\t\t\t\t// Avoids overriding the scroll behavior on mobile devices because\n\t\t\t\t\t// doing so breaks the pinch to zoom functionality, and users should\n\t\t\t\t\t// be able to zoom in further on the high-res image.\n\t\t\t\t\tif ( ! isTouching && Date.now() - lastTouchTime > 450 ) {\n\t\t\t\t\t\t// It doesn't rely on `event.preventDefault()` to prevent scrolling\n\t\t\t\t\t\t// because the scroll event can't be canceled, so it resets the\n\t\t\t\t\t\t// position instead.\n\t\t\t\t\t\twindow.scrollTo(\n\t\t\t\t\t\t\tstate.scrollLeftReset,\n\t\t\t\t\t\t\tstate.scrollTopReset\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\tcallbacks: {\n\t\t\tsetOverlayStyles() {\n\t\t\t\tif ( ! state.overlayEnabled ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet {\n\t\t\t\t\tnaturalWidth,\n\t\t\t\t\tnaturalHeight,\n\t\t\t\t\toffsetWidth: originalWidth,\n\t\t\t\t\toffsetHeight: originalHeight,\n\t\t\t\t} = state.currentImage.imageRef;\n\t\t\t\tlet { x: screenPosX, y: screenPosY } =\n\t\t\t\t\tstate.currentImage.imageRef.getBoundingClientRect();\n\n\t\t\t\t// Natural ratio of the image clicked to open the lightbox.\n\t\t\t\tconst naturalRatio = naturalWidth / naturalHeight;\n\t\t\t\t// Original ratio of the image clicked to open the lightbox.\n\t\t\t\tlet originalRatio = originalWidth / originalHeight;\n\n\t\t\t\t// If it has object-fit: contain, recalculates the original sizes\n\t\t\t\t// and the screen position without the blank spaces.\n\t\t\t\tif ( state.currentImage.scaleAttr === 'contain' ) {\n\t\t\t\t\tif ( naturalRatio > originalRatio ) {\n\t\t\t\t\t\tconst heightWithoutSpace = originalWidth / naturalRatio;\n\t\t\t\t\t\t// Recalculates screen position without the top space.\n\t\t\t\t\t\tscreenPosY +=\n\t\t\t\t\t\t\t( originalHeight - heightWithoutSpace ) / 2;\n\t\t\t\t\t\toriginalHeight = heightWithoutSpace;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst widthWithoutSpace = originalHeight * naturalRatio;\n\t\t\t\t\t\t// Recalculates screen position without the left space.\n\t\t\t\t\t\tscreenPosX += ( originalWidth - widthWithoutSpace ) / 2;\n\t\t\t\t\t\toriginalWidth = widthWithoutSpace;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toriginalRatio = originalWidth / originalHeight;\n\n\t\t\t\t// Typically, it uses the image's full-sized dimensions. If those\n\t\t\t\t// dimensions have not been set (i.e. an external image with only one\n\t\t\t\t// size), the image's dimensions in the lightbox are the same\n\t\t\t\t// as those of the image in the content.\n\t\t\t\tlet imgMaxWidth = parseFloat(\n\t\t\t\t\tstate.currentImage.targetWidth !== 'none'\n\t\t\t\t\t\t? state.currentImage.targetWidth\n\t\t\t\t\t\t: naturalWidth\n\t\t\t\t);\n\t\t\t\tlet imgMaxHeight = parseFloat(\n\t\t\t\t\tstate.currentImage.targetHeight !== 'none'\n\t\t\t\t\t\t? state.currentImage.targetHeight\n\t\t\t\t\t\t: naturalHeight\n\t\t\t\t);\n\n\t\t\t\t// Ratio of the biggest image stored in the database.\n\t\t\t\tlet imgRatio = imgMaxWidth / imgMaxHeight;\n\t\t\t\tlet containerMaxWidth = imgMaxWidth;\n\t\t\t\tlet containerMaxHeight = imgMaxHeight;\n\t\t\t\tlet containerWidth = imgMaxWidth;\n\t\t\t\tlet containerHeight = imgMaxHeight;\n\n\t\t\t\t// Checks if the target image has a different ratio than the original\n\t\t\t\t// one (thumbnail). Recalculates the width and height.\n\t\t\t\tif ( naturalRatio.toFixed( 2 ) !== imgRatio.toFixed( 2 ) ) {\n\t\t\t\t\tif ( naturalRatio > imgRatio ) {\n\t\t\t\t\t\t// If the width is reached before the height, it keeps the maxWidth\n\t\t\t\t\t\t// and recalculates the height unless the difference between the\n\t\t\t\t\t\t// maxHeight and the reducedHeight is higher than the maxWidth,\n\t\t\t\t\t\t// where it keeps the reducedHeight and recalculate the width.\n\t\t\t\t\t\tconst reducedHeight = imgMaxWidth / naturalRatio;\n\t\t\t\t\t\tif ( imgMaxHeight - reducedHeight > imgMaxWidth ) {\n\t\t\t\t\t\t\timgMaxHeight = reducedHeight;\n\t\t\t\t\t\t\timgMaxWidth = reducedHeight * naturalRatio;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\timgMaxHeight = imgMaxWidth / naturalRatio;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If the height is reached before the width, it keeps the maxHeight\n\t\t\t\t\t\t// and recalculate the width unlesss the difference between the\n\t\t\t\t\t\t// maxWidth and the reducedWidth is higher than the maxHeight, where\n\t\t\t\t\t\t// it keeps the reducedWidth and recalculate the height.\n\t\t\t\t\t\tconst reducedWidth = imgMaxHeight * naturalRatio;\n\t\t\t\t\t\tif ( imgMaxWidth - reducedWidth > imgMaxHeight ) {\n\t\t\t\t\t\t\timgMaxWidth = reducedWidth;\n\t\t\t\t\t\t\timgMaxHeight = reducedWidth / naturalRatio;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\timgMaxWidth = imgMaxHeight * naturalRatio;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcontainerWidth = imgMaxWidth;\n\t\t\t\t\tcontainerHeight = imgMaxHeight;\n\t\t\t\t\timgRatio = imgMaxWidth / imgMaxHeight;\n\n\t\t\t\t\t// Calculates the max size of the container.\n\t\t\t\t\tif ( originalRatio > imgRatio ) {\n\t\t\t\t\t\tcontainerMaxWidth = imgMaxWidth;\n\t\t\t\t\t\tcontainerMaxHeight = containerMaxWidth / originalRatio;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontainerMaxHeight = imgMaxHeight;\n\t\t\t\t\t\tcontainerMaxWidth = containerMaxHeight * originalRatio;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If the image has been pixelated on purpose, it keeps that size.\n\t\t\t\tif (\n\t\t\t\t\toriginalWidth > containerWidth ||\n\t\t\t\t\toriginalHeight > containerHeight\n\t\t\t\t) {\n\t\t\t\t\tcontainerWidth = originalWidth;\n\t\t\t\t\tcontainerHeight = originalHeight;\n\t\t\t\t}\n\n\t\t\t\t// Calculates the final lightbox image size and the scale factor.\n\t\t\t\t// MaxWidth is either the window container (accounting for padding) or\n\t\t\t\t// the image resolution.\n\t\t\t\tlet horizontalPadding = 0;\n\t\t\t\tif ( window.innerWidth > 480 ) {\n\t\t\t\t\thorizontalPadding = 80;\n\t\t\t\t} else if ( window.innerWidth > 1920 ) {\n\t\t\t\t\thorizontalPadding = 160;\n\t\t\t\t}\n\t\t\t\tconst verticalPadding = 80;\n\n\t\t\t\tconst targetMaxWidth = Math.min(\n\t\t\t\t\twindow.innerWidth - horizontalPadding,\n\t\t\t\t\tcontainerWidth\n\t\t\t\t);\n\t\t\t\tconst targetMaxHeight = Math.min(\n\t\t\t\t\twindow.innerHeight - verticalPadding,\n\t\t\t\t\tcontainerHeight\n\t\t\t\t);\n\t\t\t\tconst targetContainerRatio = targetMaxWidth / targetMaxHeight;\n\n\t\t\t\tif ( originalRatio > targetContainerRatio ) {\n\t\t\t\t\t// If targetMaxWidth is reached before targetMaxHeight.\n\t\t\t\t\tcontainerWidth = targetMaxWidth;\n\t\t\t\t\tcontainerHeight = containerWidth / originalRatio;\n\t\t\t\t} else {\n\t\t\t\t\t// If targetMaxHeight is reached before targetMaxWidth.\n\t\t\t\t\tcontainerHeight = targetMaxHeight;\n\t\t\t\t\tcontainerWidth = containerHeight * originalRatio;\n\t\t\t\t}\n\n\t\t\t\tconst containerScale = originalWidth / containerWidth;\n\t\t\t\tconst lightboxImgWidth =\n\t\t\t\t\timgMaxWidth * ( containerWidth / containerMaxWidth );\n\t\t\t\tconst lightboxImgHeight =\n\t\t\t\t\timgMaxHeight * ( containerHeight / containerMaxHeight );\n\n\t\t\t\t// As of this writing, using the calculations above will render the\n\t\t\t\t// lightbox with a small, erroneous whitespace on the left side of the\n\t\t\t\t// image in iOS Safari, perhaps due to an inconsistency in how browsers\n\t\t\t\t// handle absolute positioning and CSS transformation. In any case,\n\t\t\t\t// adding 1 pixel to the container width and height solves the problem,\n\t\t\t\t// though this can be removed if the issue is fixed in the future.\n\t\t\t\tstate.overlayStyles = `\n\t\t\t\t\t--wp--lightbox-initial-top-position: ${ screenPosY }px;\n\t\t\t\t\t--wp--lightbox-initial-left-position: ${ screenPosX }px;\n\t\t\t\t\t--wp--lightbox-container-width: ${ containerWidth + 1 }px;\n\t\t\t\t\t--wp--lightbox-container-height: ${ containerHeight + 1 }px;\n\t\t\t\t\t--wp--lightbox-image-width: ${ lightboxImgWidth }px;\n\t\t\t\t\t--wp--lightbox-image-height: ${ lightboxImgHeight }px;\n\t\t\t\t\t--wp--lightbox-scale: ${ containerScale };\n\t\t\t\t\t--wp--lightbox-scrollbar-width: ${\n\t\t\t\t\t\twindow.innerWidth - document.documentElement.clientWidth\n\t\t\t\t\t}px;\n\t\t\t\t`;\n\t\t\t},\n\t\t\tsetButtonStyles() {\n\t\t\t\tconst { imageId } = getContext();\n\t\t\t\tconst { ref } = getElement();\n\n\t\t\t\tstate.metadata[ imageId ].imageRef = ref;\n\t\t\t\tstate.metadata[ imageId ].currentSrc = ref.currentSrc;\n\n\t\t\t\tconst {\n\t\t\t\t\tnaturalWidth,\n\t\t\t\t\tnaturalHeight,\n\t\t\t\t\toffsetWidth,\n\t\t\t\t\toffsetHeight,\n\t\t\t\t} = ref;\n\n\t\t\t\t// If the image isn't loaded yet, it can't calculate where the button\n\t\t\t\t// should be.\n\t\t\t\tif ( naturalWidth === 0 || naturalHeight === 0 ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst figure = ref.parentElement;\n\t\t\t\tconst figureWidth = ref.parentElement.clientWidth;\n\n\t\t\t\t// It needs special handling for the height because a caption will cause\n\t\t\t\t// the figure to be taller than the image, which means it needs to\n\t\t\t\t// account for that when calculating the placement of the button in the\n\t\t\t\t// top right corner of the image.\n\t\t\t\tlet figureHeight = ref.parentElement.clientHeight;\n\t\t\t\tconst caption = figure.querySelector( 'figcaption' );\n\t\t\t\tif ( caption ) {\n\t\t\t\t\tconst captionComputedStyle =\n\t\t\t\t\t\twindow.getComputedStyle( caption );\n\t\t\t\t\tif (\n\t\t\t\t\t\t! [ 'absolute', 'fixed' ].includes(\n\t\t\t\t\t\t\tcaptionComputedStyle.position\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tfigureHeight =\n\t\t\t\t\t\t\tfigureHeight -\n\t\t\t\t\t\t\tcaption.offsetHeight -\n\t\t\t\t\t\t\tparseFloat( captionComputedStyle.marginTop ) -\n\t\t\t\t\t\t\tparseFloat( captionComputedStyle.marginBottom );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst buttonOffsetTop = figureHeight - offsetHeight;\n\t\t\t\tconst buttonOffsetRight = figureWidth - offsetWidth;\n\n\t\t\t\tlet imageButtonTop = buttonOffsetTop + 16;\n\t\t\t\tlet imageButtonRight = buttonOffsetRight + 16;\n\n\t\t\t\t// In the case of an image with object-fit: contain, the size of the\n\t\t\t\t// <img> element can be larger than the image itself, so it needs to\n\t\t\t\t// calculate where to place the button.\n\t\t\t\tif ( state.metadata[ imageId ].scaleAttr === 'contain' ) {\n\t\t\t\t\t// Natural ratio of the image.\n\t\t\t\t\tconst naturalRatio = naturalWidth / naturalHeight;\n\t\t\t\t\t// Offset ratio of the image.\n\t\t\t\t\tconst offsetRatio = offsetWidth / offsetHeight;\n\n\t\t\t\t\tif ( naturalRatio >= offsetRatio ) {\n\t\t\t\t\t\t// If it reaches the width first, it keeps the width and compute the\n\t\t\t\t\t\t// height.\n\t\t\t\t\t\tconst referenceHeight = offsetWidth / naturalRatio;\n\t\t\t\t\t\timageButtonTop =\n\t\t\t\t\t\t\t( offsetHeight - referenceHeight ) / 2 +\n\t\t\t\t\t\t\tbuttonOffsetTop +\n\t\t\t\t\t\t\t16;\n\t\t\t\t\t\timageButtonRight = buttonOffsetRight + 16;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If it reaches the height first, it keeps the height and compute\n\t\t\t\t\t\t// the width.\n\t\t\t\t\t\tconst referenceWidth = offsetHeight * naturalRatio;\n\t\t\t\t\t\timageButtonTop = buttonOffsetTop + 16;\n\t\t\t\t\t\timageButtonRight =\n\t\t\t\t\t\t\t( offsetWidth - referenceWidth ) / 2 +\n\t\t\t\t\t\t\tbuttonOffsetRight +\n\t\t\t\t\t\t\t16;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tstate.metadata[ imageId ].imageButtonTop = imageButtonTop;\n\t\t\t\tstate.metadata[ imageId ].imageButtonRight = imageButtonRight;\n\t\t\t},\n\t\t\tsetOverlayFocus() {\n\t\t\t\tif ( state.overlayEnabled ) {\n\t\t\t\t\t// Moves the focus to the dialog when it opens.\n\t\t\t\t\tconst { ref } = getElement();\n\t\t\t\t\tref.focus();\n\t\t\t\t}\n\t\t\t},\n\t\t\tinitTriggerButton() {\n\t\t\t\tconst { imageId } = getContext();\n\t\t\t\tconst { ref } = getElement();\n\t\t\t\tstate.metadata[ imageId ].buttonRef = ref;\n\t\t\t},\n\t\t},\n\t},\n\t{ lock: true }\n);\n"],"mappings":"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","ignoreList":[]}