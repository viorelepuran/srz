{"version":3,"names":["ActivityIndicator","Image","RNImage","TouchableWithoutFeedback","View","useRoute","Component","useEffect","requestMediaImport","mediaUploadSync","requestImageFailedRetryDialog","requestImageUploadCancelDialog","requestImageFullscreenPreview","setFeaturedImage","Icon","PanelBody","ToolbarButton","ToolbarGroup","WIDE_ALIGNMENTS","LinkSettingsNavigation","BottomSheet","BottomSheetTextControl","BottomSheetSelectControl","FooterMessageControl","FooterMessageLink","Badge","BlockCaption","MediaPlaceholder","MediaUpload","MediaUploadProgress","MEDIA_TYPE_IMAGE","BlockControls","InspectorControls","BlockStyles","store","blockEditorStore","blockSettingsScreens","RichText","__","_x","sprintf","getProtocol","hasQueryArg","isURL","doAction","hasAction","compose","withPreferredColorScheme","withSelect","withDispatch","image","placeholderIcon","replace","fullscreen","textColor","coreStore","noticesStore","editPostStore","styles","getUpdatedLinkTargetSettings","LINK_DESTINATION_NONE","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_MEDIA","MEDIA_ID_NO_FEATURED_IMAGE_SET","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","getUrlForSlug","sizeSlug","undefined","media_details","sizes","source_url","LinkSettings","attributes","isLinkSheetVisible","setMappedAttributes","route","href","url","label","linkDestination","linkTarget","rel","inputValue","newUrl","params","newLinkDestination","link","valueMask","linkSettingsOptions","autoFocus","autoFill","openInNewTab","linkRel","placeholder","title","children","isVisible","setAttributes","withBottomSheet","hasPicker","options","showIcon","onLinkCellPressed","navigation","navigate","imageLinkDestinations","imageUrl","attachmentPageUrl","UPLOAD_STATE_IDLE","UPLOAD_STATE_UPLOADING","UPLOAD_STATE_SUCCEEDED","UPLOAD_STATE_FAILED","ImageEdit","constructor","props","state","isCaptionSelected","uploadStatus","replacedFeaturedImage","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateImageURL","onSetNewTab","onSetSizeSlug","onImagePressed","onSetFeatured","onFocusCaption","onSelectURL","accessibilityLabelCreator","onSizeChangeValue","componentDidMount","id","console","warn","componentWillUnmount","componentDidUpdate","previousProps","featuredImageId","updatedUrl","previousId","canImageBeFeatured","align","__unstableMarkNextChangeAsNotPersistent","includes","width","height","aspectRatio","scale","getDerivedStateFromProps","isSelected","caption","isEmpty","setState","payload","mediaUrl","mediaServerId","mediaId","value","updatedLinkTarget","media","imageDefaultSize","destination","mediaAttributes","alt","additionalAttributes","newURL","createErrorNotice","isFetchingImage","getSize","onFocus","getPlaceholderIcon","icon","getStylesFromColorScheme","iconPlaceholder","iconPlaceholderDark","showLoadingIndicator","style","image__loading","animating","getWidth","Object","values","alignments","restAttributes","getAltTextSettings","updateAlt","newAlt","initialValue","onChange","footerNote","newValue","closeSettingsBottomSheet","getFeaturedButtonPanel","isFeaturedImage","setFeaturedButtonStyle","setFeaturedButton","setFeaturedButtonDark","removeFeaturedButton","Cell","labelStyle","cellContainerStyle","setFeaturedButtonCellContainer","separatorType","onPress","isGif","toLowerCase","render","clientId","context","wasBlockJustInserted","shouldUseFastImage","className","hasImageContext","keys","length","imageSizes","Array","isArray","sizeOptions","filter","slug","map","name","selectedSizeOption","sizeOptionsValid","find","option","getToolbarEditButton","open","onClick","getInspectorControls","panelBody","titleStyle","featuredImagePanelTitle","content","allowedTypes","onSelect","autoOpenMediaUpload","alignToFlex","left","center","right","full","wide","additionalImageProps","resizeMode","imageCrop","imageContainerStyles","fixedHeight","badgeLabelShown","badgeLabelText","getImageComponent","openMediaOptions","getMediaOptions","show","accessible","disabled","enablePausedUploads","coverUrl","onUpdateMediaProgress","onFinishMediaUploadWithSuccess","onFinishMediaUploadWithFailure","onMediaUploadStateReset","renderContent","isUploadPaused","isUploadInProgress","isUploadFailed","retryMessage","shapeStyle","onBlur","insertBlocksAfter","isReplacingMedia","select","getMedia","getSettings","getEditedPostAttribute","capabilities","isNotFileUrl","shouldGetMedia","dispatch","closeGeneralSidebar"],"sources":["@wordpress/block-library/src/image/edit.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tActivityIndicator,\n\tImage as RNImage,\n\tTouchableWithoutFeedback,\n\tView,\n} from 'react-native';\nimport { useRoute } from '@react-navigation/native';\n\n/**\n * WordPress dependencies\n */\nimport { Component, useEffect } from '@wordpress/element';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n\tsetFeaturedImage,\n} from '@wordpress/react-native-bridge';\nimport {\n\tIcon,\n\tPanelBody,\n\tToolbarButton,\n\tToolbarGroup,\n\tImage,\n\tWIDE_ALIGNMENTS,\n\tLinkSettingsNavigation,\n\tBottomSheet,\n\tBottomSheetTextControl,\n\tBottomSheetSelectControl,\n\tFooterMessageControl,\n\tFooterMessageLink,\n\tBadge,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n\tBlockStyles,\n\tstore as blockEditorStore,\n\tblockSettingsScreens,\n\tRichText,\n} from '@wordpress/block-editor';\nimport { __, _x, sprintf } from '@wordpress/i18n';\nimport { getProtocol, hasQueryArg, isURL } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\timage as placeholderIcon,\n\treplace,\n\tfullscreen,\n\ttextColor,\n} from '@wordpress/icons';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as noticesStore } from '@wordpress/notices';\n// eslint-disable-next-line no-restricted-imports\nimport { store as editPostStore } from '@wordpress/edit-post';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { getUpdatedLinkTargetSettings } from './utils';\n\nimport {\n\tLINK_DESTINATION_NONE,\n\tLINK_DESTINATION_CUSTOM,\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tMEDIA_ID_NO_FEATURED_IMAGE_SET,\n} from './constants';\n\nconst getUrlForSlug = ( image, sizeSlug ) => {\n\tif ( ! sizeSlug ) {\n\t\treturn undefined;\n\t}\n\treturn image?.media_details?.sizes?.[ sizeSlug ]?.source_url;\n};\n\nfunction LinkSettings( {\n\tattributes,\n\timage,\n\tisLinkSheetVisible,\n\tsetMappedAttributes,\n} ) {\n\tconst route = useRoute();\n\tconst { href: url, label, linkDestination, linkTarget, rel } = attributes;\n\n\t// Persist attributes passed from child screen.\n\tuseEffect( () => {\n\t\tconst { inputValue: newUrl } = route.params || {};\n\n\t\tlet newLinkDestination;\n\t\tswitch ( newUrl ) {\n\t\t\tcase attributes.url:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_MEDIA;\n\t\t\t\tbreak;\n\t\t\tcase image?.link:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_ATTACHMENT;\n\t\t\t\tbreak;\n\t\t\tcase '':\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_NONE;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tsetMappedAttributes( {\n\t\t\turl: newUrl,\n\t\t\tlinkDestination: newLinkDestination,\n\t\t} );\n\t}, [ route.params?.inputValue ] );\n\n\tlet valueMask;\n\tswitch ( linkDestination ) {\n\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\tvalueMask = __( 'Media File' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\tvalueMask = __( 'Attachment Page' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_CUSTOM:\n\t\t\tvalueMask = __( 'Custom URL' );\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tvalueMask = __( 'None' );\n\t\t\tbreak;\n\t}\n\n\tconst linkSettingsOptions = {\n\t\turl: {\n\t\t\tvalueMask,\n\t\t\tautoFocus: false,\n\t\t\tautoFill: false,\n\t\t},\n\t\topenInNewTab: {\n\t\t\tlabel: __( 'Open in new tab' ),\n\t\t},\n\t\tlinkRel: {\n\t\t\tlabel: __( 'Link Rel' ),\n\t\t\tplaceholder: _x( 'None', 'Link rel attribute value placeholder' ),\n\t\t},\n\t};\n\n\treturn (\n\t\t<PanelBody title={ __( 'Link Settings' ) }>\n\t\t\t<LinkSettingsNavigation\n\t\t\t\tisVisible={ isLinkSheetVisible }\n\t\t\t\turl={ url }\n\t\t\t\trel={ rel }\n\t\t\t\tlabel={ label }\n\t\t\t\tlinkTarget={ linkTarget }\n\t\t\t\tsetAttributes={ setMappedAttributes }\n\t\t\t\twithBottomSheet={ false }\n\t\t\t\thasPicker\n\t\t\t\toptions={ linkSettingsOptions }\n\t\t\t\tshowIcon={ false }\n\t\t\t\tonLinkCellPressed={ ( { navigation } ) => {\n\t\t\t\t\tnavigation.navigate(\n\t\t\t\t\t\tblockSettingsScreens.imageLinkDestinations,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinputValue: attributes.href,\n\t\t\t\t\t\t\tlinkDestination: attributes.linkDestination,\n\t\t\t\t\t\t\timageUrl: attributes.url,\n\t\t\t\t\t\t\tattachmentPageUrl: image?.link,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t/>\n\t\t</PanelBody>\n\t);\n}\n\nconst UPLOAD_STATE_IDLE = 0;\nconst UPLOAD_STATE_UPLOADING = 1;\nconst UPLOAD_STATE_SUCCEEDED = 2;\nconst UPLOAD_STATE_FAILED = 3;\n\nexport class ImageEdit extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tisCaptionSelected: false,\n\t\t\tuploadStatus: UPLOAD_STATE_IDLE,\n\t\t};\n\n\t\tthis.replacedFeaturedImage = false;\n\n\t\tthis.finishMediaUploadWithSuccess =\n\t\t\tthis.finishMediaUploadWithSuccess.bind( this );\n\t\tthis.finishMediaUploadWithFailure =\n\t\t\tthis.finishMediaUploadWithFailure.bind( this );\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption =\n\t\t\tthis.onSelectMediaUploadOption.bind( this );\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.onSetSizeSlug = this.onSetSizeSlug.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onSetFeatured = this.onSetFeatured.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.onSelectURL = this.onSelectURL.bind( this );\n\t\tthis.accessibilityLabelCreator =\n\t\t\tthis.accessibilityLabelCreator.bind( this );\n\t\tthis.setMappedAttributes = this.setMappedAttributes.bind( this );\n\t\tthis.onSizeChangeValue = this.onSizeChangeValue.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\t// Detect any pasted image and start an upload.\n\t\tif (\n\t\t\t! attributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestMediaImport( attributes.url, ( id, url ) => {\n\t\t\t\tif ( url ) {\n\t\t\t\t\tsetAttributes( { id, url } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure we mark any temporary images as failed if they failed while\n\t\t// the editor wasn't open.\n\t\tif (\n\t\t\tattributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// This action will only exist if the user pressed the trash button on the block holder.\n\t\tif (\n\t\t\thasAction( 'blocks.onRemoveBlockCheckUpload' ) &&\n\t\t\tthis.state.uploadStatus === UPLOAD_STATE_UPLOADING\n\t\t) {\n\t\t\tdoAction(\n\t\t\t\t'blocks.onRemoveBlockCheckUpload',\n\t\t\t\tthis.props.attributes.id\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( previousProps ) {\n\t\tconst { image, attributes, setAttributes, featuredImageId } =\n\t\t\tthis.props;\n\t\tconst { url } = attributes;\n\t\tif ( ! previousProps.image && image ) {\n\t\t\tif ( ! hasQueryArg( url, 'w' ) && attributes?.sizeSlug ) {\n\t\t\t\tconst updatedUrl =\n\t\t\t\t\tgetUrlForSlug( image, attributes.sizeSlug ) ||\n\t\t\t\t\timage.source_url;\n\n\t\t\t\tsetAttributes( { url: updatedUrl } );\n\t\t\t}\n\t\t}\n\n\t\tconst { id } = attributes;\n\t\tconst { id: previousId } = previousProps.attributes;\n\n\t\t// The media changed and the previous media was set as the Featured Image,\n\t\t// we must keep track of the previous media's featured status to act on it\n\t\t// once the new media has a finalized ID.\n\t\tif (\n\t\t\t!! id &&\n\t\t\tid !== previousId &&\n\t\t\t!! featuredImageId &&\n\t\t\tfeaturedImageId === previousId\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = true;\n\t\t}\n\n\t\t// The media changed and now has a finalized ID (e.g. upload completed), we\n\t\t// should attempt to replace the featured image if applicable.\n\t\tif (\n\t\t\tthis.replacedFeaturedImage &&\n\t\t\t!! image &&\n\t\t\tthis.canImageBeFeatured()\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = false;\n\t\t\tsetFeaturedImage( id );\n\t\t}\n\n\t\tconst { align } = attributes;\n\t\tconst { __unstableMarkNextChangeAsNotPersistent } = this.props;\n\n\t\t// Update the attributes if the align is wide or full\n\t\tif ( [ 'wide', 'full' ].includes( align ) ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tsetAttributes( {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\taspectRatio: undefined,\n\t\t\t\tscale: undefined,\n\t\t\t} );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false.\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\taccessibilityLabelCreator( caption ) {\n\t\t// Checks if caption is empty.\n\t\treturn RichText.isEmpty( caption )\n\t\t\t? /* translators: accessibility text. Empty image caption. */\n\t\t\t  'Image caption. Empty'\n\t\t\t: sprintf(\n\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\tcaption\n\t\t\t  );\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes, image } = this.props;\n\n\t\tif ( this.state.uploadStatus === UPLOAD_STATE_UPLOADING ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if (\n\t\t\tattributes.id &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t} else if ( ! this.state.isCaptionSelected ) {\n\t\t\trequestImageFullscreenPreview(\n\t\t\t\tattributes.url,\n\t\t\t\timage && image.source_url\n\t\t\t);\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( this.state.uploadStatus !== UPLOAD_STATE_UPLOADING ) {\n\t\t\tthis.setState( { uploadStatus: UPLOAD_STATE_UPLOADING } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_SUCCEEDED } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_FAILED } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_IDLE } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings(\n\t\t\tvalue,\n\t\t\tthis.props.attributes\n\t\t);\n\t\tthis.props.setAttributes( updatedLinkTarget );\n\t}\n\n\tonSetSizeSlug( sizeSlug ) {\n\t\tconst { image, setAttributes } = this.props;\n\n\t\tconst url = getUrlForSlug( image, sizeSlug );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\t\tsetAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( media ) {\n\t\tconst { imageDefaultSize } = this.props;\n\t\tconst { id, url, destination } = this.props.attributes;\n\t\tconst mediaAttributes = {\n\t\t\tid: media.id,\n\t\t\turl: media.url,\n\t\t\tcaption: media.caption,\n\t\t\talt: media.alt,\n\t\t};\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tlet href;\n\t\tswitch ( destination ) {\n\t\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\t\thref = media.url;\n\t\t\t\tbreak;\n\t\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\t\thref = media.link;\n\t\t\t\tbreak;\n\t\t}\n\t\tmediaAttributes.href = href;\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonSelectURL( newURL ) {\n\t\tconst { createErrorNotice, imageDefaultSize, setAttributes } =\n\t\t\tthis.props;\n\n\t\tif ( isURL( newURL ) ) {\n\t\t\tthis.setState( {\n\t\t\t\tisFetchingImage: true,\n\t\t\t} );\n\n\t\t\t// Use RN's Image.getSize to determine if URL is a valid image\n\t\t\tRNImage.getSize(\n\t\t\t\tnewURL,\n\t\t\t\t() => {\n\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\turl: newURL,\n\t\t\t\t\t\tid: undefined,\n\t\t\t\t\t\twidth: undefined,\n\t\t\t\t\t\theight: undefined,\n\t\t\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t\t\t} );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tcreateErrorNotice( __( 'Image file not found.' ) );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tcreateErrorNotice( __( 'Invalid URL.' ) );\n\t\t}\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetPlaceholderIcon() {\n\t\treturn (\n\t\t\t<Icon\n\t\t\t\ticon={ placeholderIcon }\n\t\t\t\t{ ...this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconPlaceholder,\n\t\t\t\t\tstyles.iconPlaceholderDark\n\t\t\t\t) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tshowLoadingIndicator() {\n\t\treturn (\n\t\t\t<View style={ styles.image__loading }>\n\t\t\t\t<ActivityIndicator animating />\n\t\t\t</View>\n\t\t);\n\t}\n\n\tgetWidth() {\n\t\tconst { attributes } = this.props;\n\t\tconst { align, width } = attributes;\n\n\t\treturn Object.values( WIDE_ALIGNMENTS.alignments ).includes( align )\n\t\t\t? '100%'\n\t\t\t: width;\n\t}\n\n\tsetMappedAttributes( { url: href, linkDestination, ...restAttributes } ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( ! href && ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_NONE;\n\t\t} else if ( ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t}\n\n\t\treturn href === undefined || href === this.props.attributes.href\n\t\t\t? setAttributes( restAttributes )\n\t\t\t: setAttributes( {\n\t\t\t\t\t...restAttributes,\n\t\t\t\t\tlinkDestination,\n\t\t\t\t\thref,\n\t\t\t  } );\n\t}\n\n\tgetAltTextSettings() {\n\t\tconst {\n\t\t\tattributes: { alt },\n\t\t} = this.props;\n\n\t\tconst updateAlt = ( newAlt ) => {\n\t\t\tthis.props.setAttributes( { alt: newAlt } );\n\t\t};\n\n\t\treturn (\n\t\t\t<BottomSheetTextControl\n\t\t\t\tinitialValue={ alt }\n\t\t\t\tonChange={ updateAlt }\n\t\t\t\tplaceholder={ __( 'Add alt text' ) }\n\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\ticon={ textColor }\n\t\t\t\tfooterNote={\n\t\t\t\t\t<>\n\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t'Describe the purpose of the image. Leave empty if decorative.'\n\t\t\t\t\t\t) }{ ' ' }\n\t\t\t\t\t\t<FooterMessageLink\n\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t// translators: Localized tutorial, if one exists. W3C Web Accessibility Initiative link has list of existing translations.\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue={ __( 'What is alt text?' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\t}\n\n\tonSizeChangeValue( newValue ) {\n\t\tthis.onSetSizeSlug( newValue );\n\t}\n\n\tonSetFeatured( mediaId ) {\n\t\tconst { closeSettingsBottomSheet } = this.props;\n\t\tsetFeaturedImage( mediaId );\n\t\tcloseSettingsBottomSheet();\n\t}\n\n\tgetFeaturedButtonPanel( isFeaturedImage ) {\n\t\tconst { attributes, getStylesFromColorScheme } = this.props;\n\n\t\tconst setFeaturedButtonStyle = getStylesFromColorScheme(\n\t\t\tstyles.setFeaturedButton,\n\t\t\tstyles.setFeaturedButtonDark\n\t\t);\n\n\t\tconst removeFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Remove as Featured Image' ) }\n\t\t\t\tlabelStyle={ [\n\t\t\t\t\tsetFeaturedButtonStyle,\n\t\t\t\t\tstyles.removeFeaturedButton,\n\t\t\t\t] }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType=\"none\"\n\t\t\t\tonPress={ () =>\n\t\t\t\t\tthis.onSetFeatured( MEDIA_ID_NO_FEATURED_IMAGE_SET )\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\n\t\tconst setFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Set as Featured Image' ) }\n\t\t\t\tlabelStyle={ setFeaturedButtonStyle }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType=\"none\"\n\t\t\t\tonPress={ () => this.onSetFeatured( attributes.id ) }\n\t\t\t/>\n\t\t);\n\n\t\treturn isFeaturedImage ? removeFeaturedButton() : setFeaturedButton();\n\t}\n\n\t/**\n\t * Featured images must be set to a successfully uploaded self-hosted image,\n\t * which has an ID.\n\t *\n\t * @return {boolean} Boolean indicating whether or not the current may be set as featured.\n\t */\n\tcanImageBeFeatured() {\n\t\tconst {\n\t\t\tattributes: { id },\n\t\t} = this.props;\n\t\treturn (\n\t\t\ttypeof id !== 'undefined' &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_UPLOADING &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_FAILED\n\t\t);\n\t}\n\n\tisGif( url ) {\n\t\treturn url.toLowerCase().includes( '.gif' );\n\t}\n\n\trender() {\n\t\tconst { isCaptionSelected, isFetchingImage } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tisSelected,\n\t\t\timage,\n\t\t\tclientId,\n\t\t\timageDefaultSize,\n\t\t\tcontext,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted,\n\t\t\tshouldUseFastImage,\n\t\t} = this.props;\n\t\tconst { align, url, alt, id, sizeSlug, className } = attributes;\n\t\tconst hasImageContext = context\n\t\t\t? Object.keys( context ).length > 0\n\t\t\t: false;\n\n\t\tconst imageSizes = Array.isArray( this.props.imageSizes )\n\t\t\t? this.props.imageSizes\n\t\t\t: [];\n\t\t// Only map available image sizes for the user to choose.\n\t\tconst sizeOptions = imageSizes\n\t\t\t.filter( ( { slug } ) => getUrlForSlug( image, slug ) )\n\t\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\n\t\tlet selectedSizeOption = sizeSlug || imageDefaultSize;\n\t\tlet sizeOptionsValid = sizeOptions.find(\n\t\t\t( option ) => option.value === selectedSizeOption\n\t\t);\n\n\t\tif ( ! sizeOptionsValid ) {\n\t\t\t// Default to 'full' size if the default large size is not available.\n\t\t\tsizeOptionsValid = sizeOptions.find(\n\t\t\t\t( option ) => option.value === 'full'\n\t\t\t);\n\t\t\tselectedSizeOption = 'full';\n\t\t}\n\n\t\tconst canImageBeFeatured = this.canImageBeFeatured();\n\t\tconst isFeaturedImage =\n\t\t\tcanImageBeFeatured && featuredImageId === attributes.id;\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon={ replace }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Settings' ) } />\n\t\t\t\t<PanelBody style={ styles.panelBody }>\n\t\t\t\t\t<BlockStyles clientId={ clientId } url={ url } />\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody>\n\t\t\t\t\t{ image && sizeOptionsValid && (\n\t\t\t\t\t\t<BottomSheetSelectControl\n\t\t\t\t\t\t\ticon={ fullscreen }\n\t\t\t\t\t\t\tlabel={ __( 'Size' ) }\n\t\t\t\t\t\t\toptions={ sizeOptions }\n\t\t\t\t\t\t\tonChange={ this.onSizeChangeValue }\n\t\t\t\t\t\t\tvalue={ selectedSizeOption }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ this.getAltTextSettings() }\n\t\t\t\t</PanelBody>\n\t\t\t\t<LinkSettings\n\t\t\t\t\tattributes={ this.props.attributes }\n\t\t\t\t\timage={ this.props.image }\n\t\t\t\t\tisLinkSheetVisible={ this.state.isLinkSheetVisible }\n\t\t\t\t\tsetMappedAttributes={ this.setMappedAttributes }\n\t\t\t\t/>\n\t\t\t\t<PanelBody\n\t\t\t\t\ttitle={ __( 'Featured Image' ) }\n\t\t\t\t\ttitleStyle={ styles.featuredImagePanelTitle }\n\t\t\t\t>\n\t\t\t\t\t{ canImageBeFeatured &&\n\t\t\t\t\t\tthis.getFeaturedButtonPanel( isFeaturedImage ) }\n\t\t\t\t\t<FooterMessageControl\n\t\t\t\t\t\tlabel={ __(\n\t\t\t\t\t\t\t'Changes to featured image will not be affected by the undo/redo buttons.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tcellContainerStyle={\n\t\t\t\t\t\t\tstyles.setFeaturedButtonCellContainer\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t{ isFetchingImage && this.showLoadingIndicator() }\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\t\t\ticon={ this.getPlaceholderIcon() }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t\tautoOpenMediaUpload={\n\t\t\t\t\t\t\tisSelected && wasBlockJustInserted\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst alignToFlex = {\n\t\t\tleft: 'flex-start',\n\t\t\tcenter: 'center',\n\t\t\tright: 'flex-end',\n\t\t\tfull: 'center',\n\t\t\twide: 'center',\n\t\t};\n\n\t\tconst additionalImageProps = {\n\t\t\theight: '100%',\n\t\t\tresizeMode: context?.imageCrop ? 'cover' : 'contain',\n\t\t};\n\n\t\tconst imageContainerStyles = [\n\t\t\tcontext?.fixedHeight && styles.fixedHeight,\n\t\t];\n\n\t\tconst isGif = this.isGif( url );\n\t\tconst badgeLabelShown = isFeaturedImage || isGif;\n\t\tlet badgeLabelText = '';\n\t\tif ( isFeaturedImage ) {\n\t\t\tbadgeLabelText = __( 'Featured' );\n\t\t} else if ( isGif ) {\n\t\t\tbadgeLabelText = __( 'GIF' );\n\t\t}\n\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<Badge label={ badgeLabelText } show={ badgeLabelShown }>\n\t\t\t\t<TouchableWithoutFeedback\n\t\t\t\t\taccessible={ ! isSelected }\n\t\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t>\n\t\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t\t{ isSelected && getInspectorControls() }\n\t\t\t\t\t\t{ isSelected && getMediaOptions() }\n\t\t\t\t\t\t{ ! this.state.isCaptionSelected &&\n\t\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions ) }\n\t\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\t\tenablePausedUploads\n\t\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonMediaUploadStateReset={\n\t\t\t\t\t\t\t\tthis.mediaUploadStateReset\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trenderContent={ ( {\n\t\t\t\t\t\t\t\tisUploadPaused,\n\t\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t\t} ) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<View style={ imageContainerStyles }>\n\t\t\t\t\t\t\t\t\t\t{ isFetchingImage &&\n\t\t\t\t\t\t\t\t\t\t\tthis.showLoadingIndicator() }\n\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\talign={\n\t\t\t\t\t\t\t\t\t\t\t\talign && alignToFlex[ align ]\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\talt={ alt }\n\t\t\t\t\t\t\t\t\t\t\tisSelected={\n\t\t\t\t\t\t\t\t\t\t\t\tisSelected &&\n\t\t\t\t\t\t\t\t\t\t\t\t! isCaptionSelected\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\t\t\t\t\t\t\tisUploadPaused={ isUploadPaused }\n\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress={\n\t\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage={\n\t\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tonSelectMediaUploadOption={\n\t\t\t\t\t\t\t\t\t\t\t\tthis.onSelectMediaUploadOption\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\topenMediaOptions={\n\t\t\t\t\t\t\t\t\t\t\t\topenMediaOptions\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tretryMessage={ retryMessage }\n\t\t\t\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\t\t\t\tshapeStyle={\n\t\t\t\t\t\t\t\t\t\t\t\tstyles[ className ] || className\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\twidth={ this.getWidth() }\n\t\t\t\t\t\t\t\t\t\t\t{ ...( hasImageContext\n\t\t\t\t\t\t\t\t\t\t\t\t? additionalImageProps\n\t\t\t\t\t\t\t\t\t\t\t\t: {} ) }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</TouchableWithoutFeedback>\n\t\t\t\t<BlockCaption\n\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\taccessible={ ! this.state.isCaptionSelected }\n\t\t\t\t\taccessibilityLabelCreator={ this.accessibilityLabelCreator }\n\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\tonBlur={ this.props.onBlur } // Always assign onBlur as props.\n\t\t\t\t\tinsertBlocksAfter={ this.props.insertBlocksAfter }\n\t\t\t\t/>\n\t\t\t</Badge>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\tisReplacingMedia\n\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( coreStore );\n\t\tconst { getSettings, wasBlockJustInserted } =\n\t\t\tselect( blockEditorStore );\n\t\tconst { getEditedPostAttribute } = select( 'core/editor' );\n\t\tconst {\n\t\t\tattributes: { id, url },\n\t\t\tisSelected,\n\t\t\tclientId,\n\t\t} = props;\n\t\tconst { imageSizes, imageDefaultSize, capabilities } = getSettings();\n\t\tconst isNotFileUrl = id && getProtocol( url ) !== 'file:';\n\t\tconst featuredImageId = getEditedPostAttribute( 'featured_media' );\n\n\t\tconst shouldGetMedia =\n\t\t\t( isSelected && isNotFileUrl ) ||\n\t\t\t// Edge case to update the image after uploading if the block gets unselected\n\t\t\t// Check if it's the original image and not the resized one with queryparams.\n\t\t\t( ! isSelected &&\n\t\t\t\tisNotFileUrl &&\n\t\t\t\turl &&\n\t\t\t\t! hasQueryArg( url, 'w' ) );\n\t\tconst image = shouldGetMedia ? getMedia( id ) : null;\n\n\t\treturn {\n\t\t\timage,\n\t\t\timageSizes,\n\t\t\timageDefaultSize,\n\t\t\tshouldUseFastImage: capabilities?.shouldUseFastImage === true,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted: wasBlockJustInserted(\n\t\t\t\tclientId,\n\t\t\t\t'inserter_menu'\n\t\t\t),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { createErrorNotice } = dispatch( noticesStore );\n\t\tconst { __unstableMarkNextChangeAsNotPersistent } =\n\t\t\tdispatch( blockEditorStore );\n\n\t\treturn {\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t\tcreateErrorNotice,\n\t\t\tcloseSettingsBottomSheet() {\n\t\t\t\tdispatch( editPostStore ).closeGeneralSidebar();\n\t\t\t},\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( ImageEdit );\n"],"mappings":"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","ignoreList":[]}