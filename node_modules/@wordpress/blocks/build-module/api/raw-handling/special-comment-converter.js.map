{"version":3,"names":["remove","replace","specialCommentConverter","node","doc","nodeType","COMMENT_NODE","nodeValue","indexOf","block","createBlock","parentNode","nodeName","childNodes","Array","from","nodeIndex","wrapperNode","body","paragraphBuilder","acc","child","createElement","appendChild","slice","reduce","forEach","element","insertBefore","commentNode","createNextpage","customText","trim","sibling","noTeaser","nextSibling","createMore","dataset"],"sources":["@wordpress/blocks/src/api/raw-handling/special-comment-converter.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { remove, replace } from '@wordpress/dom';\n\n/**\n * Looks for `<!--nextpage-->` and `<!--more-->` comments and\n * replaces them with a custom element representing a future block.\n *\n * The custom element is a way to bypass the rest of the `raw-handling`\n * transforms, which would eliminate other kinds of node with which to carry\n * `<!--more-->`'s data: nodes with `data` attributes, empty paragraphs, etc.\n *\n * The custom element is then expected to be recognized by any registered\n * block's `raw` transform.\n *\n * @param {Node}     node The node to be processed.\n * @param {Document} doc  The document of the node.\n * @return {void}\n */\nexport default function specialCommentConverter( node, doc ) {\n\tif ( node.nodeType !== node.COMMENT_NODE ) {\n\t\treturn;\n\t}\n\n\tif (\n\t\tnode.nodeValue !== 'nextpage' &&\n\t\tnode.nodeValue.indexOf( 'more' ) !== 0\n\t) {\n\t\treturn;\n\t}\n\n\tconst block = createBlock( node, doc );\n\n\t// If our `<!--more-->` comment is in the middle of a paragraph, we should\n\t// split the paragraph in two and insert the more block in between. If it's\n\t// inside an empty paragraph, we should still move it out of the paragraph\n\t// and remove the paragraph. If there's no paragraph, fall back to simply\n\t// replacing the comment.\n\tif ( ! node.parentNode || node.parentNode.nodeName !== 'P' ) {\n\t\treplace( node, block );\n\t} else {\n\t\tconst childNodes = Array.from( node.parentNode.childNodes );\n\t\tconst nodeIndex = childNodes.indexOf( node );\n\t\tconst wrapperNode = node.parentNode.parentNode || doc.body;\n\n\t\tconst paragraphBuilder = ( acc, child ) => {\n\t\t\tif ( ! acc ) {\n\t\t\t\tacc = doc.createElement( 'p' );\n\t\t\t}\n\n\t\t\tacc.appendChild( child );\n\n\t\t\treturn acc;\n\t\t};\n\n\t\t// Split the original parent node and insert our more block\n\t\t[\n\t\t\tchildNodes.slice( 0, nodeIndex ).reduce( paragraphBuilder, null ),\n\t\t\tblock,\n\t\t\tchildNodes.slice( nodeIndex + 1 ).reduce( paragraphBuilder, null ),\n\t\t].forEach(\n\t\t\t( element ) =>\n\t\t\t\telement && wrapperNode.insertBefore( element, node.parentNode )\n\t\t);\n\n\t\t// Remove the old parent paragraph\n\t\tremove( node.parentNode );\n\t}\n}\n\nfunction createBlock( commentNode, doc ) {\n\tif ( commentNode.nodeValue === 'nextpage' ) {\n\t\treturn createNextpage( doc );\n\t}\n\n\t// Grab any custom text in the comment.\n\tconst customText = commentNode.nodeValue.slice( 4 ).trim();\n\n\t/*\n\t * When a `<!--more-->` comment is found, we need to look for any\n\t * `<!--noteaser-->` sibling, but it may not be a direct sibling\n\t * (whitespace typically lies in between)\n\t */\n\tlet sibling = commentNode;\n\tlet noTeaser = false;\n\twhile ( ( sibling = sibling.nextSibling ) ) {\n\t\tif (\n\t\t\tsibling.nodeType === sibling.COMMENT_NODE &&\n\t\t\tsibling.nodeValue === 'noteaser'\n\t\t) {\n\t\t\tnoTeaser = true;\n\t\t\tremove( sibling );\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn createMore( customText, noTeaser, doc );\n}\n\nfunction createMore( customText, noTeaser, doc ) {\n\tconst node = doc.createElement( 'wp-block' );\n\tnode.dataset.block = 'core/more';\n\tif ( customText ) {\n\t\tnode.dataset.customText = customText;\n\t}\n\tif ( noTeaser ) {\n\t\t// \"Boolean\" data attribute.\n\t\tnode.dataset.noTeaser = '';\n\t}\n\treturn node;\n}\n\nfunction createNextpage( doc ) {\n\tconst node = doc.createElement( 'wp-block' );\n\tnode.dataset.block = 'core/nextpage';\n\n\treturn node;\n}\n"],"mappings":"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","ignoreList":[]}