{"version":3,"names":["_dom","require","_keycodes","_data","_compose","_element","_blocks","_store","_lockUnlock","_draggableChip","_interopRequireDefault","_jsxRuntime","useEventHandlers","clientId","isSelected","getBlockType","useSelect","blocksStore","getBlockRootClientId","isZoomOut","hasMultiSelection","getBlockName","unlock","blockEditorStore","insertAfterBlock","removeBlock","resetZoomLevel","startDraggingBlocks","stopDraggingBlocks","useDispatch","useRefEffect","node","onKeyDown","event","keyCode","target","ENTER","BACKSPACE","DELETE","isTextField","preventDefault","onDragStart","isContentEditable","ownerDocument","activeElement","data","JSON","stringify","type","srcClientIds","srcRootClientId","dataTransfer","effectAllowed","clearData","setData","defaultView","selection","getSelection","removeAllRanges","domNode","document","createElement","root","createRoot","render","jsx","default","icon","body","appendChild","style","position","top","left","zIndex","pointerEvents","dragElement","width","height","visibility","setDragImage","offset","x","y","frame","frameElement","rect","getBoundingClientRect","over","e","transform","clientX","clientY","end","removeEventListener","remove","classList","documentElement","addEventListener","add"],"sources":["@wordpress/block-editor/src/components/block-list/use-block-props/use-selected-block-event-handlers.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { isTextField } from '@wordpress/dom';\nimport { ENTER, BACKSPACE, DELETE } from '@wordpress/keycodes';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useRefEffect } from '@wordpress/compose';\nimport { createRoot } from '@wordpress/element';\nimport { store as blocksStore } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../../store';\nimport { unlock } from '../../../lock-unlock';\nimport BlockDraggableChip from '../../../components/block-draggable/draggable-chip';\n\n/**\n * Adds block behaviour:\n *   - Removes the block on BACKSPACE.\n *   - Inserts a default block on ENTER.\n *   - Disables dragging of block contents.\n *\n * @param {string} clientId Block client ID.\n */\nexport function useEventHandlers( { clientId, isSelected } ) {\n\tconst { getBlockType } = useSelect( blocksStore );\n\tconst { getBlockRootClientId, isZoomOut, hasMultiSelection, getBlockName } =\n\t\tunlock( useSelect( blockEditorStore ) );\n\tconst {\n\t\tinsertAfterBlock,\n\t\tremoveBlock,\n\t\tresetZoomLevel,\n\t\tstartDraggingBlocks,\n\t\tstopDraggingBlocks,\n\t} = unlock( useDispatch( blockEditorStore ) );\n\n\treturn useRefEffect(\n\t\t( node ) => {\n\t\t\tif ( ! isSelected ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Interprets keydown event intent to remove or insert after block if\n\t\t\t * key event occurs on wrapper node. This can occur when the block has\n\t\t\t * no text fields of its own, particularly after initial insertion, to\n\t\t\t * allow for easy deletion and continuous writing flow to add additional\n\t\t\t * content.\n\t\t\t *\n\t\t\t * @param {KeyboardEvent} event Keydown event.\n\t\t\t */\n\t\t\tfunction onKeyDown( event ) {\n\t\t\t\tconst { keyCode, target } = event;\n\n\t\t\t\tif (\n\t\t\t\t\tkeyCode !== ENTER &&\n\t\t\t\t\tkeyCode !== BACKSPACE &&\n\t\t\t\t\tkeyCode !== DELETE\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( target !== node || isTextField( target ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tif ( keyCode === ENTER && isZoomOut() ) {\n\t\t\t\t\tresetZoomLevel();\n\t\t\t\t} else if ( keyCode === ENTER ) {\n\t\t\t\t\tinsertAfterBlock( clientId );\n\t\t\t\t} else {\n\t\t\t\t\tremoveBlock( clientId );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Prevents default dragging behavior within a block. To do: we must\n\t\t\t * handle this in the future and clean up the drag target.\n\t\t\t *\n\t\t\t * @param {DragEvent} event Drag event.\n\t\t\t */\n\t\t\tfunction onDragStart( event ) {\n\t\t\t\tif (\n\t\t\t\t\tnode !== event.target ||\n\t\t\t\t\tnode.isContentEditable ||\n\t\t\t\t\tnode.ownerDocument.activeElement !== node ||\n\t\t\t\t\thasMultiSelection()\n\t\t\t\t) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst data = JSON.stringify( {\n\t\t\t\t\ttype: 'block',\n\t\t\t\t\tsrcClientIds: [ clientId ],\n\t\t\t\t\tsrcRootClientId: getBlockRootClientId( clientId ),\n\t\t\t\t} );\n\t\t\t\tevent.dataTransfer.effectAllowed = 'move'; // remove \"+\" cursor\n\t\t\t\tevent.dataTransfer.clearData();\n\t\t\t\tevent.dataTransfer.setData( 'wp-blocks', data );\n\t\t\t\tconst { ownerDocument } = node;\n\t\t\t\tconst { defaultView } = ownerDocument;\n\t\t\t\tconst selection = defaultView.getSelection();\n\t\t\t\tselection.removeAllRanges();\n\n\t\t\t\tconst domNode = document.createElement( 'div' );\n\t\t\t\tconst root = createRoot( domNode );\n\t\t\t\troot.render(\n\t\t\t\t\t<BlockDraggableChip\n\t\t\t\t\t\ticon={ getBlockType( getBlockName( clientId ) ).icon }\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t\tdocument.body.appendChild( domNode );\n\t\t\t\tdomNode.style.position = 'absolute';\n\t\t\t\tdomNode.style.top = '0';\n\t\t\t\tdomNode.style.left = '0';\n\t\t\t\tdomNode.style.zIndex = '1000';\n\t\t\t\tdomNode.style.pointerEvents = 'none';\n\n\t\t\t\t// Setting the drag chip as the drag image actually works, but\n\t\t\t\t// the behaviour is slightly different in every browser. In\n\t\t\t\t// Safari, it animates, in Firefox it's slightly transparent...\n\t\t\t\t// So we set a fake drag image and have to reposition it\n\t\t\t\t// ourselves.\n\t\t\t\tconst dragElement = ownerDocument.createElement( 'div' );\n\t\t\t\t// Chrome will show a globe icon if the drag element does not\n\t\t\t\t// have dimensions.\n\t\t\t\tdragElement.style.width = '1px';\n\t\t\t\tdragElement.style.height = '1px';\n\t\t\t\tdragElement.style.position = 'fixed';\n\t\t\t\tdragElement.style.visibility = 'hidden';\n\t\t\t\townerDocument.body.appendChild( dragElement );\n\t\t\t\tevent.dataTransfer.setDragImage( dragElement, 0, 0 );\n\n\t\t\t\tlet offset = { x: 0, y: 0 };\n\n\t\t\t\tif ( document !== ownerDocument ) {\n\t\t\t\t\tconst frame = defaultView.frameElement;\n\t\t\t\t\tif ( frame ) {\n\t\t\t\t\t\tconst rect = frame.getBoundingClientRect();\n\t\t\t\t\t\toffset = { x: rect.left, y: rect.top };\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// chip handle offset\n\t\t\t\toffset.x -= 58;\n\n\t\t\t\tfunction over( e ) {\n\t\t\t\t\tdomNode.style.transform = `translate( ${\n\t\t\t\t\t\te.clientX + offset.x\n\t\t\t\t\t}px, ${ e.clientY + offset.y }px )`;\n\t\t\t\t}\n\n\t\t\t\tover( event );\n\n\t\t\t\tfunction end() {\n\t\t\t\t\townerDocument.removeEventListener( 'dragover', over );\n\t\t\t\t\townerDocument.removeEventListener( 'dragend', end );\n\t\t\t\t\tdomNode.remove();\n\t\t\t\t\tdragElement.remove();\n\t\t\t\t\tstopDraggingBlocks();\n\t\t\t\t\tdocument.body.classList.remove(\n\t\t\t\t\t\t'is-dragging-components-draggable'\n\t\t\t\t\t);\n\t\t\t\t\townerDocument.documentElement.classList.remove(\n\t\t\t\t\t\t'is-dragging'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\townerDocument.addEventListener( 'dragover', over );\n\t\t\t\townerDocument.addEventListener( 'dragend', end );\n\t\t\t\townerDocument.addEventListener( 'drop', end );\n\n\t\t\t\tstartDraggingBlocks( [ clientId ] );\n\t\t\t\t// Important because it hides the block toolbar.\n\t\t\t\tdocument.body.classList.add(\n\t\t\t\t\t'is-dragging-components-draggable'\n\t\t\t\t);\n\t\t\t\townerDocument.documentElement.classList.add( 'is-dragging' );\n\t\t\t}\n\n\t\t\tnode.addEventListener( 'keydown', onKeyDown );\n\t\t\tnode.addEventListener( 'dragstart', onDragStart );\n\n\t\t\treturn () => {\n\t\t\t\tnode.removeEventListener( 'keydown', onKeyDown );\n\t\t\t\tnode.removeEventListener( 'dragstart', onDragStart );\n\t\t\t};\n\t\t},\n\t\t[\n\t\t\tclientId,\n\t\t\tisSelected,\n\t\t\tgetBlockRootClientId,\n\t\t\tinsertAfterBlock,\n\t\t\tremoveBlock,\n\t\t\tisZoomOut,\n\t\t\tresetZoomLevel,\n\t\t\thasMultiSelection,\n\t\t\tstartDraggingBlocks,\n\t\t\tstopDraggingBlocks,\n\t\t]\n\t);\n}\n"],"mappings":"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","ignoreList":[]}