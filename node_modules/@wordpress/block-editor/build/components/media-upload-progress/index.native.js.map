{"version":3,"names":["_reactNative","require","_element","_components","_i18n","_reactNativeBridge","_styles","_interopRequireDefault","_constants","_jsxRuntime","MediaUploadProgress","Component","constructor","props","state","uploadState","MEDIA_UPLOAD_STATE_IDLE","progress","isUploadInProgress","isUploadFailed","mediaUpload","bind","getRetryMessage","componentDidMount","addMediaUploadListener","componentWillUnmount","mediaId","requestImageUploadCancel","removeMediaUploadListener","payload","mediaUrl","updateMediaThumbnail","MEDIA_UPLOAD_STATE_UPLOADING","updateMediaProgress","MEDIA_UPLOAD_STATE_SUCCEEDED","finishMediaUploadWithSuccess","MEDIA_UPLOAD_STATE_PAUSED","finishMediaUploadWithPause","MEDIA_UPLOAD_STATE_FAILED","finishMediaUploadWithFailure","MEDIA_UPLOAD_STATE_RESET","mediaUploadStateReset","setState","onUpdateMediaProgress","onFinishMediaUploadWithSuccess","enablePausedUploads","onFinishMediaUploadWithFailure","onMediaUploadStateReset","subscriptionParentMediaUpload","subscribeMediaUpload","remove","__","render","renderContent","showSpinner","retryMessage","progressBarStyle","styles","progressBar","progressBarHidden","jsxs","View","style","mediaUploadProgress","containerStyle","pointerEvents","children","jsx","Spinner","spinnerStyle","testID","isUploadPaused","exports","_default","default"],"sources":["@wordpress/block-editor/src/components/media-upload-progress/index.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { View } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { Spinner } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tsubscribeMediaUpload,\n\trequestImageUploadCancel,\n} from '@wordpress/react-native-bridge';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport {\n\tMEDIA_UPLOAD_STATE_IDLE,\n\tMEDIA_UPLOAD_STATE_UPLOADING,\n\tMEDIA_UPLOAD_STATE_SUCCEEDED,\n\tMEDIA_UPLOAD_STATE_FAILED,\n\tMEDIA_UPLOAD_STATE_RESET,\n\tMEDIA_UPLOAD_STATE_PAUSED,\n} from './constants';\n\nexport class MediaUploadProgress extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tuploadState: MEDIA_UPLOAD_STATE_IDLE,\n\t\t\tprogress: 0,\n\t\t\tisUploadInProgress: false,\n\t\t\tisUploadFailed: false,\n\t\t};\n\n\t\tthis.mediaUpload = this.mediaUpload.bind( this );\n\t\tthis.getRetryMessage = this.getRetryMessage.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.addMediaUploadListener();\n\t}\n\n\tcomponentWillUnmount() {\n\t\tconst { isUploadInProgress, isUploadFailed } = this.state;\n\t\tconst { mediaId } = this.props;\n\n\t\tif ( isUploadInProgress || isUploadFailed ) {\n\t\t\trequestImageUploadCancel( mediaId );\n\t\t}\n\t\tthis.removeMediaUploadListener();\n\t}\n\n\tmediaUpload( payload ) {\n\t\tconst { mediaId } = this.props;\n\t\tif (\n\t\t\tpayload.mediaId !== mediaId ||\n\t\t\t( payload.state === this.state.uploadState &&\n\t\t\t\tpayload.progress === this.state.progress )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( payload?.mediaUrl && ! payload.state ) {\n\t\t\tthis.updateMediaThumbnail( payload );\n\t\t\treturn;\n\t\t}\n\n\t\tswitch ( payload.state ) {\n\t\t\tcase MEDIA_UPLOAD_STATE_UPLOADING:\n\t\t\t\tthis.updateMediaProgress( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_SUCCEEDED:\n\t\t\t\tthis.finishMediaUploadWithSuccess( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_PAUSED:\n\t\t\t\tthis.finishMediaUploadWithPause( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_FAILED:\n\t\t\t\tthis.finishMediaUploadWithFailure( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_RESET:\n\t\t\t\tthis.mediaUploadStateReset( payload );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tthis.setState( {\n\t\t\tprogress: payload.progress,\n\t\t\tuploadState: payload.state,\n\t\t\tisUploadInProgress: true,\n\t\t\tisUploadFailed: false,\n\t\t} );\n\t\tif ( this.props.onUpdateMediaProgress ) {\n\t\t\tthis.props.onUpdateMediaProgress( payload );\n\t\t}\n\t}\n\n\tupdateMediaThumbnail( payload ) {\n\t\tconst { onUpdateMediaProgress } = this.props;\n\t\tif ( onUpdateMediaProgress ) {\n\t\t\tonUpdateMediaProgress( payload );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tthis.setState( {\n\t\t\tuploadState: payload.state,\n\t\t\tisUploadInProgress: false,\n\t\t} );\n\t\tif ( this.props.onFinishMediaUploadWithSuccess ) {\n\t\t\tthis.props.onFinishMediaUploadWithSuccess( payload );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithPause( payload ) {\n\t\tif ( ! this.props.enablePausedUploads ) {\n\t\t\tthis.finishMediaUploadWithFailure( payload );\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tuploadState: payload.state,\n\t\t\tisUploadInProgress: true,\n\t\t\tisUploadFailed: false,\n\t\t} );\n\t\tif ( this.props.onFinishMediaUploadWithFailure ) {\n\t\t\tthis.props.onFinishMediaUploadWithFailure( payload );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tthis.setState( {\n\t\t\tuploadState: payload.state,\n\t\t\tisUploadInProgress: false,\n\t\t\tisUploadFailed: true,\n\t\t} );\n\t\tif ( this.props.onFinishMediaUploadWithFailure ) {\n\t\t\tthis.props.onFinishMediaUploadWithFailure( payload );\n\t\t}\n\t}\n\n\tmediaUploadStateReset( payload ) {\n\t\tthis.setState( {\n\t\t\tuploadState: payload.state,\n\t\t\tisUploadInProgress: false,\n\t\t\tisUploadFailed: false,\n\t\t} );\n\t\tif ( this.props.onMediaUploadStateReset ) {\n\t\t\tthis.props.onMediaUploadStateReset( payload );\n\t\t}\n\t}\n\n\taddMediaUploadListener() {\n\t\t// If we already have a subscription not worth doing it again.\n\t\tif ( this.subscriptionParentMediaUpload ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.subscriptionParentMediaUpload = subscribeMediaUpload(\n\t\t\t( payload ) => {\n\t\t\t\tthis.mediaUpload( payload );\n\t\t\t}\n\t\t);\n\t}\n\n\tremoveMediaUploadListener() {\n\t\tif ( this.subscriptionParentMediaUpload ) {\n\t\t\tthis.subscriptionParentMediaUpload.remove();\n\t\t}\n\t}\n\n\tgetRetryMessage() {\n\t\tif (\n\t\t\tthis.state.uploadState === MEDIA_UPLOAD_STATE_PAUSED &&\n\t\t\tthis.props.enablePausedUploads\n\t\t) {\n\t\t\treturn __( 'Waiting for connection' );\n\t\t}\n\n\t\t// eslint-disable-next-line @wordpress/i18n-no-collapsible-whitespace\n\t\treturn __( 'Failed to insert media.\\nTap for more info.' );\n\t}\n\n\trender() {\n\t\tconst { renderContent = () => null } = this.props;\n\t\tconst { isUploadInProgress, isUploadFailed, uploadState } = this.state;\n\t\tconst showSpinner = this.state.isUploadInProgress;\n\t\tconst progress = this.state.progress * 100;\n\t\tconst retryMessage = this.getRetryMessage();\n\n\t\tconst progressBarStyle = [\n\t\t\tstyles.progressBar,\n\t\t\tshowSpinner || styles.progressBarHidden,\n\t\t\tthis.props.progressBarStyle,\n\t\t];\n\n\t\treturn (\n\t\t\t<View\n\t\t\t\tstyle={ [\n\t\t\t\t\tstyles.mediaUploadProgress,\n\t\t\t\t\tthis.props.containerStyle,\n\t\t\t\t] }\n\t\t\t\tpointerEvents=\"box-none\"\n\t\t\t>\n\t\t\t\t<View style={ progressBarStyle }>\n\t\t\t\t\t{ showSpinner && (\n\t\t\t\t\t\t<Spinner\n\t\t\t\t\t\t\tprogress={ progress }\n\t\t\t\t\t\t\tstyle={ this.props.spinnerStyle }\n\t\t\t\t\t\t\ttestID=\"spinner\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</View>\n\t\t\t\t{ renderContent( {\n\t\t\t\t\tisUploadPaused:\n\t\t\t\t\t\tuploadState === MEDIA_UPLOAD_STATE_PAUSED &&\n\t\t\t\t\t\tthis.props.enablePausedUploads,\n\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\tisUploadFailed,\n\t\t\t\t\tretryMessage,\n\t\t\t\t} ) }\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nexport default MediaUploadProgress;\n"],"mappings":"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","ignoreList":[]}