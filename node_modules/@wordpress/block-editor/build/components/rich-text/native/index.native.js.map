{"version":3,"names":["_reactNative","require","_memize","_interopRequireDefault","_colord","_reactNativeAztec","_reactNativeBridge","_blockEditor","_components","_element","_compose","_data","_blocks","_htmlEntities","_keycodes","_url","_icons","_i18n","_richText","_useFormatTypes","_formatEdit","_getFormatColors","_style","_toolbarButtonWithOptions","_jsxRuntime","flatColorPalettes","memize","colorsPalettes","theme","custom","default","getSelectionColor","currentSelectionColor","defaultSelectionColor","baseGlobalStyles","isBlockBasedTheme","selectionColor","colordTextColor","colord","colordBackgroundColor","color","background","isColordTextReadable","isReadable","text","gutenbergFormatNamesToAztec","EMPTY_PARAGRAPH_TAGS","DEFAULT_FONT_SIZE","MIN_LINE_HEIGHT","RichText","Component","constructor","value","selectionStart","selectionEnd","arguments","isIOS","Platform","OS","createRecord","bind","onChangeFromAztec","onKeyDown","handleEnter","handleDelete","onPaste","onFocus","onBlur","onTextUpdate","onContentSizeChange","onFormatChange","formatToValue","maxSize","debounceCreateUndoLevel","debounce","onCreateUndoLevel","onSelectionChange","onSelectionChangeFromAztec","valueToFormat","getHtmlToRender","handleSuggestionFunc","handleUserSuggestion","showUserSuggestions","handleXpostSuggestion","showXpostSuggestions","suggestionOptions","insertString","manipulateEventCounterToForceNativeToRefresh","shouldDropEventFromAztec","state","activeFormats","selectedFormat","height","currentFontSize","getFontSize","needsSelectionUpdate","savedContent","isTouched","lastAztecEventType","lastHistoryValue","getRecord","start","end","colorPalette","props","currentValue","formats","replacements","newFormats","getFormatColors","preserveWhiteSpace","create","html","range","Math","min","length","removeRootTagsProducedByAztec","toHTMLString","getActiveFormatNames","record","formatTypes","map","name","filter","getActiveFormat","undefined","Boolean","changeHandlers","Object","fromEntries","entries","key","startsWith","values","forEach","changeHandler","onChange","setState","string","toInsert","insert","__unstableOnCreateUndoLevel","toString","result","removeRootTag","tagName","tagsToEliminate","element","removeTag","tag","openingTagRegexp","RegExp","closingTagRegexp","replace","event","contentWithoutRootTag","nativeEvent","__unstableInputRule","currentValuePosition","lastEventCount","eventCount","comesFromAztec","firedAfterTextChanged","refresh","contentSize","defaultPrevented","customEditableOnKeyDown","preventDefault","RCTAztecView","KeyCodes","keyCode","handleTriggerKeyCodes","ENTER","onEnter","shiftKey","DELETE","BACKSPACE","isReverse","onDelete","hasActiveFormats","newValue","remove","isCollapsed","triggeredOption","find","option","triggeredKeyCode","triggerChar","charCodeAt","getTextContent","useTrigger","charAt","onClick","areMentionsSupported","areXPostsSupported","allOptions","supported","title","__","label","icon","atSymbol","plus","op","suggestionFunction","prefix","then","suggestion","catch","pastedText","pastedHtml","files","currentRecord","trimmedText","trim","isURL","linkedRecord","applyFormat","type","attributes","href","decodeEntities","window","console","log","plainText","unstableOnFocus","hasChanged","isManual","getActiveFormats","logText","shouldDrop","shouldFocusTextInputAfterMerge","prevProps","__unstableIsSelected","isSelected","blockIsSelected","__unstableMobileNoFocusOnMount","prevIsSelected","prevBlockIsSelected","noSelectionValues","textInputWasNotFocused","realStart","realEnd","max","isEmpty","Array","isArray","childrenBlock","toHTML","format","shouldComponentUpdate","nextProps","nextState","reversed","fontSize","style","lineHeight","componentDidMount","_editor","focus","componentDidUpdate","_this$value$toString$","lastCharacterPosition","blur","currentFontSizeStyle","getParsedFontSize","prevFontSizeStyle","isDifferentTag","componentWillUnmount","clearCurrentSelectionOnUnmount","isFocused","extraAttributes","getEditableProps","className","_getPxFromCssUnit","width","Dimensions","get","cssUnitOptions","selectedPxValue","getPxFromCssUnit","parseFloat","tagNameFontSize","elements","typography","newFontSize","getLineHeight","tagNameLineHeight","newLineHeight","getIsBlockBasedTheme","isNaN","getBlockUseDefaultFont","tagsToMatch","test","getLinkTextColor","defaultColor","customColor","linkColor","isValid","toHex","getPlaceholderTextColor","_ref","_ref2","getStylesFromColorScheme","placeholderTextColor","placeholderStyle","styles","richTextPlaceholder","richTextPlaceholderDark","defaultPlaceholderTextColor","placeholderOpacity","inheritPlaceholderColor","placeholderColor","globalStylesPlaceholderColor","render","children","minWidth","maxWidth","parentBlockStyles","accessibilityLabel","disableEditingMenu","disableSuggestions","containerWidth","editableProps","blockUseDefaultFont","textDecorationColor","defaultTextDecorationColor","fontFamily","defaultFontFamily","richText","richTextDark","linkTextColor","currentSelectionStart","currentSelectionEnd","selection","brBeforeParaMatches","match","warn","count","newSelectionStart","newSelectionEnd","containerStyles","padding","backgroundColor","EditableView","jsx","Fragment","jsxs","View","editableTagName","ref","nativeEditorRef","minHeight","placeholder","deleteEnter","triggerKeyCodes","blockType","maxImagesWidth","fontWeight","fontStyle","isMultiline","textAlign","id","disableAutocorrection","forwardedRef","BlockFormatControls","options","exports","defaultProps","withFormatTypes","WrappedComponent","clientId","identifier","withoutInteractiveFormatting","allowedFormats","useFormatTypes","_default","compose","withSelect","select","getBlockParents","getBlock","getSettings","parents","parentBlock","childrenStyles","settings","__experimentalGlobalStylesBaseStyles","colorPalettes","__experimentalFeatures","palette","colors","capabilities","mentions","xposts","withPreferredColorScheme"],"sources":["@wordpress/block-editor/src/components/rich-text/native/index.native.js"],"sourcesContent":["/* eslint no-console: [\"error\", { allow: [\"warn\"] }] */\n\n/**\n * External dependencies\n */\nimport { View, Platform, Dimensions } from 'react-native';\nimport memize from 'memize';\nimport { colord } from 'colord';\n\n/**\n * WordPress dependencies\n */\nimport RCTAztecView from '@wordpress/react-native-aztec';\nimport {\n\tshowUserSuggestions,\n\tshowXpostSuggestions,\n} from '@wordpress/react-native-bridge';\nimport { BlockFormatControls } from '@wordpress/block-editor';\nimport { getPxFromCssUnit } from '@wordpress/components';\nimport { Component } from '@wordpress/element';\nimport {\n\tcompose,\n\tdebounce,\n\twithPreferredColorScheme,\n} from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport { childrenBlock } from '@wordpress/blocks';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { BACKSPACE, DELETE, ENTER } from '@wordpress/keycodes';\nimport { isURL } from '@wordpress/url';\nimport { atSymbol, plus } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tapplyFormat,\n\tgetActiveFormat,\n\tgetActiveFormats,\n\tinsert,\n\tgetTextContent,\n\tisEmpty,\n\tcreate,\n\ttoHTMLString,\n\tisCollapsed,\n\tremove,\n} from '@wordpress/rich-text';\n\n/**\n * Internal dependencies\n */\nimport { useFormatTypes } from './use-format-types';\nimport FormatEdit from './format-edit';\nimport { getFormatColors } from './get-format-colors';\nimport styles from './style.scss';\nimport ToolbarButtonWithOptions from './toolbar-button-with-options';\n\n// The flattened color palettes array is memoized to ensure that the same array instance is\n// returned for the colors palettes. This value might be used as a prop, so having the same\n// instance will prevent unnecessary re-renders of the RichText component.\nconst flatColorPalettes = memize( ( colorsPalettes ) => [\n\t...( colorsPalettes?.theme || [] ),\n\t...( colorsPalettes?.custom || [] ),\n\t...( colorsPalettes?.default || [] ),\n] );\n\nconst getSelectionColor = memize(\n\t(\n\t\tcurrentSelectionColor,\n\t\tdefaultSelectionColor,\n\t\tbaseGlobalStyles,\n\t\tisBlockBasedTheme\n\t) => {\n\t\tlet selectionColor = defaultSelectionColor;\n\t\tif ( currentSelectionColor ) {\n\t\t\tselectionColor = currentSelectionColor;\n\t\t}\n\n\t\tif ( isBlockBasedTheme ) {\n\t\t\tconst colordTextColor = colord( selectionColor );\n\t\t\tconst colordBackgroundColor = colord(\n\t\t\t\tbaseGlobalStyles?.color?.background\n\t\t\t);\n\t\t\tconst isColordTextReadable = colordTextColor.isReadable(\n\t\t\t\tcolordBackgroundColor\n\t\t\t);\n\t\t\tif ( ! isColordTextReadable ) {\n\t\t\t\tselectionColor = baseGlobalStyles?.color?.text;\n\t\t\t}\n\t\t}\n\n\t\treturn selectionColor;\n\t}\n);\n\nconst gutenbergFormatNamesToAztec = {\n\t'core/bold': 'bold',\n\t'core/italic': 'italic',\n\t'core/strikethrough': 'strikethrough',\n\t'core/text-color': 'mark',\n};\n\nconst EMPTY_PARAGRAPH_TAGS = '<p></p>';\nconst DEFAULT_FONT_SIZE = 16;\nconst MIN_LINE_HEIGHT = 1;\n\nexport class RichText extends Component {\n\tconstructor( { value, selectionStart, selectionEnd } ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.isIOS = Platform.OS === 'ios';\n\t\tthis.createRecord = this.createRecord.bind( this );\n\t\tthis.onChangeFromAztec = this.onChangeFromAztec.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.handleEnter = this.handleEnter.bind( this );\n\t\tthis.handleDelete = this.handleDelete.bind( this );\n\t\tthis.onPaste = this.onPaste.bind( this );\n\t\tthis.onFocus = this.onFocus.bind( this );\n\t\tthis.onBlur = this.onBlur.bind( this );\n\t\tthis.onTextUpdate = this.onTextUpdate.bind( this );\n\t\tthis.onContentSizeChange = this.onContentSizeChange.bind( this );\n\t\tthis.onFormatChange = this.onFormatChange.bind( this );\n\t\tthis.formatToValue = memize( this.formatToValue.bind( this ), {\n\t\t\tmaxSize: 1,\n\t\t} );\n\t\tthis.debounceCreateUndoLevel = debounce( this.onCreateUndoLevel, 1000 );\n\t\t// This prevents a bug in Aztec which triggers onSelectionChange twice on format change.\n\t\tthis.onSelectionChange = this.onSelectionChange.bind( this );\n\t\tthis.onSelectionChangeFromAztec =\n\t\t\tthis.onSelectionChangeFromAztec.bind( this );\n\t\tthis.valueToFormat = this.valueToFormat.bind( this );\n\t\tthis.getHtmlToRender = this.getHtmlToRender.bind( this );\n\t\tthis.handleSuggestionFunc = this.handleSuggestionFunc.bind( this );\n\t\tthis.handleUserSuggestion = this.handleSuggestionFunc(\n\t\t\tshowUserSuggestions,\n\t\t\t'@'\n\t\t).bind( this );\n\t\tthis.handleXpostSuggestion = this.handleSuggestionFunc(\n\t\t\tshowXpostSuggestions,\n\t\t\t'+'\n\t\t).bind( this );\n\t\tthis.suggestionOptions = this.suggestionOptions.bind( this );\n\t\tthis.insertString = this.insertString.bind( this );\n\t\tthis.manipulateEventCounterToForceNativeToRefresh =\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh.bind( this );\n\t\tthis.shouldDropEventFromAztec =\n\t\t\tthis.shouldDropEventFromAztec.bind( this );\n\t\tthis.state = {\n\t\t\tactiveFormats: [],\n\t\t\tselectedFormat: null,\n\t\t\theight: 0,\n\t\t\tcurrentFontSize: this.getFontSize( arguments[ 0 ] ),\n\t\t};\n\t\tthis.needsSelectionUpdate = false;\n\t\tthis.savedContent = '';\n\t\tthis.isTouched = false;\n\t\tthis.lastAztecEventType = null;\n\n\t\tthis.lastHistoryValue = value;\n\n\t\t// Internal values that are update synchronously, unlike props.\n\t\tthis.value = value;\n\t\tthis.selectionStart = selectionStart;\n\t\tthis.selectionEnd = selectionEnd;\n\t}\n\n\t/**\n\t * Get the current record (value and selection) from props and state.\n\t *\n\t * @return {Object} The current record (value and selection).\n\t */\n\tgetRecord() {\n\t\tconst {\n\t\t\tselectionStart: start,\n\t\t\tselectionEnd: end,\n\t\t\tcolorPalette,\n\t\t} = this.props;\n\t\tconst { value } = this.props;\n\t\tconst currentValue = this.formatToValue( value );\n\n\t\tconst { formats, replacements, text } = currentValue;\n\t\tconst { activeFormats } = this.state;\n\t\tconst newFormats = getFormatColors( formats, colorPalette );\n\n\t\treturn {\n\t\t\tformats: newFormats,\n\t\t\treplacements,\n\t\t\ttext,\n\t\t\tstart,\n\t\t\tend,\n\t\t\tactiveFormats,\n\t\t};\n\t}\n\n\t/**\n\t * Creates a RichText value \"record\" from the current content and selection\n\t * information\n\t *\n\t *\n\t * @return {Object} A RichText value with formats and selection.\n\t */\n\tcreateRecord() {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\tconst value = {\n\t\t\tstart: this.selectionStart,\n\t\t\tend: this.selectionEnd,\n\t\t\t...create( {\n\t\t\t\thtml: this.value,\n\t\t\t\trange: null,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} ),\n\t\t};\n\t\tconst start = Math.min( this.selectionStart, value.text.length );\n\t\tconst end = Math.min( this.selectionEnd, value.text.length );\n\t\treturn { ...value, start, end };\n\t}\n\n\tvalueToFormat( value ) {\n\t\t// Remove the outer root tags.\n\t\treturn this.removeRootTagsProducedByAztec( toHTMLString( { value } ) );\n\t}\n\n\tgetActiveFormatNames( record ) {\n\t\tconst { formatTypes } = this.props;\n\n\t\treturn formatTypes\n\t\t\t.map( ( { name } ) => name )\n\t\t\t.filter( ( name ) => {\n\t\t\t\treturn getActiveFormat( record, name ) !== undefined;\n\t\t\t} )\n\t\t\t.map( ( name ) => gutenbergFormatNamesToAztec[ name ] )\n\t\t\t.filter( Boolean );\n\t}\n\n\tonFormatChange( record ) {\n\t\tconst { start = 0, end = 0, activeFormats = [] } = record;\n\t\tconst changeHandlers = Object.fromEntries(\n\t\t\tObject.entries( this.props ).filter( ( [ key ] ) =>\n\t\t\t\tkey.startsWith( 'format_on_change_functions_' )\n\t\t\t)\n\t\t);\n\n\t\tObject.values( changeHandlers ).forEach( ( changeHandler ) => {\n\t\t\tchangeHandler( record.formats, record.text );\n\t\t} );\n\n\t\tthis.value = this.valueToFormat( record );\n\t\tthis.props.onChange( this.value );\n\t\tthis.setState( { activeFormats } );\n\t\tthis.props.onSelectionChange( start, end );\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\tthis.onCreateUndoLevel();\n\n\t\tthis.lastAztecEventType = 'format change';\n\t}\n\n\tinsertString( record, string ) {\n\t\tif ( record && string ) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tconst toInsert = insert( record, string );\n\t\t\tthis.onFormatChange( toInsert );\n\t\t}\n\t}\n\n\tonCreateUndoLevel() {\n\t\tconst { __unstableOnCreateUndoLevel: onCreateUndoLevel } = this.props;\n\t\t// If the content is the same, no level needs to be created.\n\t\tif ( this.lastHistoryValue?.toString() === this.value?.toString() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonCreateUndoLevel();\n\t\tthis.lastHistoryValue = this.value;\n\t}\n\n\t/*\n\t * Cleans up any root tags produced by aztec.\n\t * TODO: This should be removed on a later version when aztec doesn't return the top tag of the text being edited\n\t */\n\tremoveRootTagsProducedByAztec( html ) {\n\t\tlet result = this.removeRootTag( this.props.tagName, html );\n\n\t\tif ( this.props.tagsToEliminate ) {\n\t\t\tthis.props.tagsToEliminate.forEach( ( element ) => {\n\t\t\t\tresult = this.removeTag( element, result );\n\t\t\t} );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tremoveRootTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '^<' + tag + '[^>]*>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>$', 'gim' );\n\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\n\tremoveTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '<' + tag + '>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>', 'gim' );\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed\n\t */\n\tonChangeFromAztec( event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'onChange' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tevent.nativeEvent.text\n\t\t);\n\n\t\tconst { __unstableInputRule } = this.props;\n\t\tconst currentValuePosition = {\n\t\t\tend: this.isIOS ? this.selectionEnd : this.selectionEnd + 1,\n\t\t\tstart: this.isIOS ? this.selectionStart : this.selectionStart + 1,\n\t\t};\n\n\t\tif (\n\t\t\t__unstableInputRule &&\n\t\t\t__unstableInputRule( {\n\t\t\t\t...currentValuePosition,\n\t\t\t\t...this.formatToValue( contentWithoutRootTag ),\n\t\t\t} )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\t// On iOS, onChange can be triggered after selection changes, even though there are no content changes.\n\t\tif ( contentWithoutRootTag === this.value?.toString() ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // The onChange event always fires after the fact.\n\t\tthis.onTextUpdate( event );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\tonTextUpdate( event ) {\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tevent.nativeEvent.text\n\t\t);\n\n\t\tthis.debounceCreateUndoLevel();\n\t\tconst refresh = this.value?.toString() !== contentWithoutRootTag;\n\t\tthis.value = contentWithoutRootTag;\n\n\t\t// We don't want to refresh if our goal is just to create a record.\n\t\tif ( refresh ) {\n\t\t\tthis.props.onChange( contentWithoutRootTag );\n\t\t}\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed in size\n\t */\n\tonContentSizeChange( contentSize ) {\n\t\tthis.setState( contentSize );\n\t\tthis.lastAztecEventType = 'content size change';\n\t}\n\n\tonKeyDown( event ) {\n\t\tif ( event.defaultPrevented ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Add stubs for conformance in downstream autocompleters logic.\n\t\tthis.customEditableOnKeyDown?.( {\n\t\t\tpreventDefault: () => undefined,\n\t\t\t...event,\n\t\t\tkey: RCTAztecView.KeyCodes[ event?.keyCode ],\n\t\t} );\n\n\t\tthis.handleDelete( event );\n\t\tthis.handleEnter( event );\n\t\tthis.handleTriggerKeyCodes( event );\n\t}\n\n\thandleEnter( event ) {\n\t\tif ( event.keyCode !== ENTER ) {\n\t\t\treturn;\n\t\t}\n\t\tconst { onEnter } = this.props;\n\n\t\tif ( ! onEnter ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonEnter( {\n\t\t\tvalue: this.createRecord(),\n\t\t\tonChange: this.onFormatChange,\n\t\t\tshiftKey: event.shiftKey,\n\t\t} );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleDelete( event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'handleDelete' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { keyCode } = event;\n\n\t\tif ( keyCode !== DELETE && keyCode !== BACKSPACE ) {\n\t\t\treturn;\n\t\t}\n\t\tconst isReverse = keyCode === BACKSPACE;\n\n\t\tconst { onDelete } = this.props;\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = event.nativeEvent.firedAfterTextChanged;\n\t\tconst value = this.createRecord();\n\t\tconst { start, end, text, activeFormats } = value;\n\t\tconst hasActiveFormats = activeFormats && !! activeFormats.length;\n\t\tlet newValue;\n\n\t\t// Always handle full content deletion ourselves.\n\t\tif ( start === 0 && end !== 0 && end >= text.length ) {\n\t\t\tnewValue = remove( value );\n\t\t\tthis.onFormatChange( newValue );\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\t// Only process delete if the key press occurs at an uncollapsed edge.\n\t\tif (\n\t\t\t! isCollapsed( value ) ||\n\t\t\thasActiveFormats ||\n\t\t\t( isReverse && start !== 0 ) ||\n\t\t\t( ! isReverse && end !== text.length )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( onDelete ) {\n\t\t\tonDelete( { isReverse, value } );\n\t\t}\n\n\t\tevent.preventDefault();\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleTriggerKeyCodes( event ) {\n\t\tconst { keyCode } = event;\n\t\tconst triggeredOption = this.suggestionOptions().find( ( option ) => {\n\t\t\tconst triggeredKeyCode = option.triggerChar.charCodeAt( 0 );\n\t\t\treturn triggeredKeyCode === keyCode;\n\t\t} );\n\n\t\tif ( triggeredOption ) {\n\t\t\tconst record = this.getRecord();\n\t\t\tconst text = getTextContent( record );\n\t\t\t// Only respond to the trigger if the selection is on the start of text or line\n\t\t\t// or if the character before is a space.\n\t\t\tconst useTrigger =\n\t\t\t\ttext.length === 0 ||\n\t\t\t\trecord.start === 0 ||\n\t\t\t\ttext.charAt( record.start - 1 ) === '\\n' ||\n\t\t\t\ttext.charAt( record.start - 1 ) === ' ';\n\n\t\t\tif ( useTrigger && triggeredOption.onClick ) {\n\t\t\t\ttriggeredOption.onClick();\n\t\t\t} else {\n\t\t\t\tthis.insertString( record, triggeredOption.triggerChar );\n\t\t\t}\n\t\t}\n\t}\n\n\tsuggestionOptions() {\n\t\tconst { areMentionsSupported, areXPostsSupported } = this.props;\n\t\tconst allOptions = [\n\t\t\t{\n\t\t\t\tsupported: areMentionsSupported,\n\t\t\t\ttitle: __( 'Insert mention' ),\n\t\t\t\tonClick: this.handleUserSuggestion,\n\t\t\t\ttriggerChar: '@',\n\t\t\t\tvalue: 'mention',\n\t\t\t\tlabel: __( 'Mention' ),\n\t\t\t\ticon: atSymbol,\n\t\t\t},\n\t\t\t{\n\t\t\t\tsupported: areXPostsSupported,\n\t\t\t\ttitle: __( 'Insert crosspost' ),\n\t\t\t\tonClick: this.handleXpostSuggestion,\n\t\t\t\ttriggerChar: '+',\n\t\t\t\tvalue: 'crosspost',\n\t\t\t\tlabel: __( 'Crosspost' ),\n\t\t\t\ticon: plus,\n\t\t\t},\n\t\t];\n\t\treturn allOptions.filter( ( op ) => op.supported );\n\t}\n\n\thandleSuggestionFunc( suggestionFunction, prefix ) {\n\t\treturn () => {\n\t\t\tconst record = this.getRecord();\n\t\t\tsuggestionFunction()\n\t\t\t\t.then( ( suggestion ) => {\n\t\t\t\t\tthis.insertString( record, `${ prefix }${ suggestion } ` );\n\t\t\t\t} )\n\t\t\t\t.catch( () => {} );\n\t\t};\n\t}\n\n\t/**\n\t * Handles a paste event from the native Aztec Wrapper.\n\t *\n\t * @param {Object} event The paste event which wraps `nativeEvent`.\n\t */\n\tonPaste( event ) {\n\t\tconst { onPaste, onChange } = this.props;\n\t\tconst { activeFormats = [] } = this.state;\n\n\t\tconst { pastedText, pastedHtml, files } = event.nativeEvent;\n\t\tconst currentRecord = this.createRecord();\n\n\t\tevent.preventDefault();\n\n\t\t// There is a selection, check if a URL is pasted.\n\t\tif ( ! isCollapsed( currentRecord ) ) {\n\t\t\tconst trimmedText = ( pastedHtml || pastedText )\n\t\t\t\t.replace( /<[^>]+>/g, '' )\n\t\t\t\t.trim();\n\n\t\t\t// A URL was pasted, turn the selection into a link.\n\t\t\tif ( isURL( trimmedText ) ) {\n\t\t\t\tconst linkedRecord = applyFormat( currentRecord, {\n\t\t\t\t\ttype: 'a',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\thref: decodeEntities( trimmedText ),\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t\tthis.value = this.valueToFormat( linkedRecord );\n\t\t\t\tonChange( this.value );\n\n\t\t\t\t// Allows us to ask for this information when we get a report.\n\t\t\t\twindow.console.log( 'Created link:\\n\\n', trimmedText );\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif ( onPaste ) {\n\t\t\tonPaste( {\n\t\t\t\tvalue: currentRecord,\n\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\thtml: pastedHtml,\n\t\t\t\tplainText: pastedText,\n\t\t\t\tfiles,\n\t\t\t\tactiveFormats,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonFocus() {\n\t\tthis.isTouched = true;\n\n\t\tconst { unstableOnFocus, onSelectionChange } = this.props;\n\n\t\tif ( unstableOnFocus ) {\n\t\t\tunstableOnFocus();\n\t\t}\n\n\t\t// We know for certain that on focus, the old selection is invalid. It\n\t\t// will be recalculated on `selectionchange`.\n\n\t\tonSelectionChange( this.selectionStart, this.selectionEnd );\n\n\t\tthis.lastAztecEventType = 'focus';\n\t}\n\n\tonBlur( event ) {\n\t\tthis.isTouched = false;\n\n\t\t// Check if value is up to date with latest state of native AztecView.\n\t\tif (\n\t\t\tevent.nativeEvent.text &&\n\t\t\tevent.nativeEvent.text !== this.props.value?.toString()\n\t\t) {\n\t\t\tthis.onTextUpdate( event );\n\t\t}\n\n\t\tif ( this.props.onBlur ) {\n\t\t\tthis.props.onBlur( event );\n\t\t}\n\n\t\tthis.lastAztecEventType = 'blur';\n\t}\n\n\tonSelectionChange( start, end ) {\n\t\tconst hasChanged =\n\t\t\tthis.selectionStart !== start || this.selectionEnd !== end;\n\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\t// This is a manual selection change event if onChange was not triggered just before\n\t\t// and we did not just trigger a text update\n\t\t// `onChange` could be the last event and could have been triggered a long time ago so\n\t\t// this approach is not perfectly reliable.\n\t\tconst isManual =\n\t\t\tthis.lastAztecEventType !== 'input' &&\n\t\t\tthis.props.value?.toString() === this.value?.toString();\n\t\tif ( hasChanged && isManual ) {\n\t\t\tconst value = this.createRecord();\n\t\t\tconst activeFormats = getActiveFormats( value );\n\t\t\tthis.setState( { activeFormats } );\n\t\t}\n\n\t\tthis.props.onSelectionChange( start, end );\n\t}\n\n\tshouldDropEventFromAztec( event, logText ) {\n\t\tconst shouldDrop =\n\t\t\t! this.isIOS && event.nativeEvent.eventCount <= this.lastEventCount;\n\t\tif ( shouldDrop ) {\n\t\t\twindow.console.log(\n\t\t\t\t`Dropping ${ logText } from Aztec as its event counter is older than latest sent to the native side. Got ${ event.nativeEvent.eventCount } but lastEventCount is ${ this.lastEventCount }.`\n\t\t\t);\n\t\t}\n\t\treturn shouldDrop;\n\t}\n\n\t/**\n\t * Determines whether the text input should receive focus after an update.\n\t * For cases where a RichText with a value is merged with an empty one.\n\t *\n\t * @param {Object} prevProps - The previous props of the component.\n\t * @return {boolean} True if the text input should receive focus, false otherwise.\n\t */\n\tshouldFocusTextInputAfterMerge( prevProps ) {\n\t\tconst {\n\t\t\t__unstableIsSelected: isSelected,\n\t\t\tblockIsSelected,\n\t\t\tselectionStart,\n\t\t\tselectionEnd,\n\t\t\t__unstableMobileNoFocusOnMount,\n\t\t} = this.props;\n\n\t\tconst {\n\t\t\t__unstableIsSelected: prevIsSelected,\n\t\t\tblockIsSelected: prevBlockIsSelected,\n\t\t} = prevProps;\n\n\t\tconst noSelectionValues =\n\t\t\tselectionStart === undefined && selectionEnd === undefined;\n\t\tconst textInputWasNotFocused = ! prevIsSelected && ! isSelected;\n\n\t\treturn (\n\t\t\t! __unstableMobileNoFocusOnMount &&\n\t\t\tnoSelectionValues &&\n\t\t\ttextInputWasNotFocused &&\n\t\t\t! prevBlockIsSelected &&\n\t\t\tblockIsSelected\n\t\t);\n\t}\n\n\tonSelectionChangeFromAztec( start, end, text, event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'onSelectionChange' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// `end` can be less than `start` on iOS\n\t\t// Let's fix that here so `rich-text/slice` can work properly.\n\t\tconst realStart = Math.min( start, end );\n\t\tconst realEnd = Math.max( start, end );\n\n\t\t// Check and dicsard stray event, where the text and selection is equal to the ones already cached.\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tevent.nativeEvent.text\n\t\t);\n\t\tif (\n\t\t\tcontentWithoutRootTag === this.value?.toString() &&\n\t\t\trealStart === this.selectionStart &&\n\t\t\trealEnd === this.selectionEnd\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // Selection change event always fires after the fact.\n\n\t\t// Update text before updating selection\n\t\t// Make sure there are changes made to the content before upgrading it upward.\n\t\tthis.onTextUpdate( event );\n\n\t\t// Aztec can send us selection change events after it has lost focus.\n\t\t// For instance the autocorrect feature will complete a partially written\n\t\t// word when resigning focus, causing a selection change event.\n\t\t// Forwarding this selection change could cause this RichText to regain\n\t\t// focus and start a focus loop.\n\t\t//\n\t\t// See https://github.com/wordpress-mobile/gutenberg-mobile/issues/1696\n\t\tif ( this.props.__unstableIsSelected ) {\n\t\t\tthis.onSelectionChange( realStart, realEnd );\n\t\t}\n\t\t// Update lastEventCount to prevent Aztec from re-rendering the content it just sent.\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\n\t\tthis.lastAztecEventType = 'selection change';\n\t}\n\n\tisEmpty() {\n\t\treturn isEmpty( this.formatToValue( this.props.value ) );\n\t}\n\n\tformatToValue( value ) {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\t// Handle deprecated `children` and `node` sources.\n\t\tif ( Array.isArray( value ) ) {\n\t\t\treturn create( {\n\t\t\t\thtml: childrenBlock.toHTML( value ),\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\tif ( this.props.format === 'string' ) {\n\t\t\treturn create( {\n\t\t\t\thtml: value,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\t// Guard for blocks passing `null` in onSplit callbacks. May be removed\n\t\t// if onSplit is revised to not pass a `null` value.\n\t\tif ( value === null ) {\n\t\t\treturn create();\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tmanipulateEventCounterToForceNativeToRefresh() {\n\t\tif ( this.isIOS ) {\n\t\t\tthis.lastEventCount = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( typeof this.lastEventCount !== 'undefined' ) {\n\t\t\tthis.lastEventCount += 100; // bump by a hundred, hopefully native hasn't bombarded the JS side in the meantime.\n\t\t} // no need to bump when 'undefined' as native side won't receive the key when the value is undefined, and that will cause force updating anyway,\n\t\t//   see https://github.com/WordPress/gutenberg/blob/82e578dcc75e67891c750a41a04c1e31994192fc/packages/react-native-aztec/android/src/main/java/org/wordpress/mobile/ReactNativeAztec/ReactAztecManager.java#L213-L215\n\t}\n\n\tshouldComponentUpdate( nextProps, nextState ) {\n\t\tif (\n\t\t\tnextProps.tagName !== this.props.tagName ||\n\t\t\tnextProps.reversed !== this.props.reversed ||\n\t\t\tnextProps.start !== this.props.start\n\t\t) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tthis.value = undefined;\n\t\t\treturn true;\n\t\t}\n\n\t\t// TODO: Please re-introduce the check to avoid updating the content right after an `onChange` call.\n\t\t// It was removed in https://github.com/WordPress/gutenberg/pull/12417 to fix undo/redo problem.\n\n\t\t// If the component is changed React side (undo/redo/merging/splitting/custom text actions)\n\t\t// we need to make sure the native is updated as well.\n\n\t\t// Also, don't trust the \"this.lastContent\" as on Android, incomplete text events arrive\n\t\t//  with only some of the text, while the virtual keyboard's suggestion system does its magic.\n\t\t// ** compare with this.lastContent for optimizing performance by not forcing Aztec with text it already has\n\t\t// , but compare with props.value to not lose \"half word\" text because of Android virtual keyb autosuggestion behavior\n\t\tif (\n\t\t\ttypeof nextProps.value !== 'undefined' &&\n\t\t\ttypeof this.props.value !== 'undefined' &&\n\t\t\t( ! this.comesFromAztec || ! this.firedAfterTextChanged ) &&\n\t\t\tnextProps.value?.toString() !== this.props.value?.toString()\n\t\t) {\n\t\t\t// Gutenberg seems to try to mirror the caret state even on events that only change the content so,\n\t\t\t//  let's force caret update if state has selection set.\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined'\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t}\n\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t}\n\n\t\tif ( ! this.comesFromAztec ) {\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined' &&\n\t\t\t\tnextProps.selectionStart !== this.props.selectionStart &&\n\t\t\t\tnextProps.selectionStart !== this.selectionStart &&\n\t\t\t\tnextProps.__unstableIsSelected\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\n\t\t\t// For font size changes from a prop value a force refresh\n\t\t\t// is needed without the selection update.\n\t\t\tif ( nextProps?.fontSize !== this.props?.fontSize ) {\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t( nextProps?.style?.fontSize !== this.props?.style?.fontSize &&\n\t\t\t\t\tnextState.currentFontSize !==\n\t\t\t\t\t\tthis.state.currentFontSize ) ||\n\t\t\t\tnextState.currentFontSize !== this.state.currentFontSize ||\n\t\t\t\tnextProps?.style?.lineHeight !== this.props?.style?.lineHeight\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tcomponentDidMount() {\n\t\t// Request focus if wrapping block is selected and parent hasn't inhibited the focus request. This method of focusing\n\t\t//  is trying to implement the web-side counterpart of BlockList's `focusTabbable` where the BlockList is focusing an\n\t\t//  inputbox by searching the DOM. We don't have the DOM in RN so, using the combination of blockIsSelected and __unstableMobileNoFocusOnMount\n\t\t//  to determine if we should focus the RichText.\n\t\tif (\n\t\t\tthis.props.blockIsSelected &&\n\t\t\t! this.props.__unstableMobileNoFocusOnMount\n\t\t) {\n\t\t\tthis._editor.focus();\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { style, tagName } = this.props;\n\t\tconst { currentFontSize } = this.state;\n\n\t\tif ( this.props.value?.toString() !== this.value?.toString() ) {\n\t\t\tthis.value = this.props.value;\n\t\t}\n\t\tconst { __unstableIsSelected: prevIsSelected } = prevProps;\n\t\tconst { __unstableIsSelected: isSelected } = this.props;\n\n\t\tif ( isSelected && ! prevIsSelected ) {\n\t\t\tthis._editor.focus();\n\t\t\t// Update selection props explicitly when component is selected as Aztec won't call onSelectionChange\n\t\t\t// if its internal value hasn't change. When created, default value is 0, 0.\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t} else if ( this.shouldFocusTextInputAfterMerge( prevProps ) ) {\n\t\t\t// Since this is happening when merging blocks, the selection should be at the last character position.\n\t\t\t// As a fallback the internal selectionEnd value is used.\n\t\t\tconst lastCharacterPosition =\n\t\t\t\tthis.value?.toString().length ?? this.selectionEnd;\n\t\t\tthis._editor.focus();\n\t\t\tthis.props.onSelectionChange(\n\t\t\t\tlastCharacterPosition,\n\t\t\t\tlastCharacterPosition\n\t\t\t);\n\t\t} else if ( ! isSelected && prevIsSelected ) {\n\t\t\tthis._editor.blur();\n\t\t}\n\n\t\t// For font size values changes from the font size picker\n\t\t// we compare previous values to refresh the selected font size,\n\t\t// this is also used when the tag name changes\n\t\t// e.g Heading block and a level change like h1->h2.\n\t\tconst currentFontSizeStyle = this.getParsedFontSize( style?.fontSize );\n\t\tconst prevFontSizeStyle = this.getParsedFontSize(\n\t\t\tprevProps?.style?.fontSize\n\t\t);\n\t\tconst isDifferentTag = prevProps.tagName !== tagName;\n\t\tif (\n\t\t\t( currentFontSize &&\n\t\t\t\t( currentFontSizeStyle || prevFontSizeStyle ) &&\n\t\t\t\tcurrentFontSizeStyle !== currentFontSize ) ||\n\t\t\tisDifferentTag\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tcurrentFontSize: this.getFontSize( this.props ),\n\t\t\t} );\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tconst { clearCurrentSelectionOnUnmount } = this.props;\n\n\t\t// There are cases when the component is unmounted e.g. scrolling in a\n\t\t// long post due to virtualization, so the block selection needs to be cleared\n\t\t// so it doesn't auto-focus when it's added back.\n\t\tif ( this._editor?.isFocused() ) {\n\t\t\tclearCurrentSelectionOnUnmount?.();\n\t\t}\n\t}\n\n\tgetHtmlToRender( record, tagName ) {\n\t\t// Save back to HTML from React tree.\n\t\tlet value = this.valueToFormat( record );\n\n\t\tif ( value === undefined ) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tvalue = '';\n\t\t}\n\t\t// On android if content is empty we need to send no content or else the placeholder will not show.\n\t\tif (\n\t\t\t! this.isIOS &&\n\t\t\t( value?.toString() === '' ||\n\t\t\t\tvalue?.toString() === EMPTY_PARAGRAPH_TAGS )\n\t\t) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif ( tagName ) {\n\t\t\tlet extraAttributes = ``;\n\t\t\tif ( tagName === `ol` ) {\n\t\t\t\tif ( this.props.reversed ) {\n\t\t\t\t\textraAttributes += ` reversed`;\n\t\t\t\t}\n\t\t\t\tif ( this.props.start ) {\n\t\t\t\t\textraAttributes += ` start=${ this.props.start }`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvalue = `<${ tagName }${ extraAttributes }>${ value }</${ tagName }>`;\n\t\t}\n\t\treturn value;\n\t}\n\n\tgetEditableProps() {\n\t\treturn {\n\t\t\t// Overridable props.\n\t\t\tstyle: {},\n\t\t\tclassName: 'rich-text',\n\t\t\tonKeyDown: () => null,\n\t\t};\n\t}\n\n\tgetParsedFontSize( fontSize ) {\n\t\tconst { height, width } = Dimensions.get( 'window' );\n\t\tconst cssUnitOptions = { height, width, fontSize: DEFAULT_FONT_SIZE };\n\n\t\tif ( ! fontSize ) {\n\t\t\treturn fontSize;\n\t\t}\n\n\t\tconst selectedPxValue =\n\t\t\tgetPxFromCssUnit( fontSize, cssUnitOptions ) ?? DEFAULT_FONT_SIZE;\n\n\t\treturn parseFloat( selectedPxValue );\n\t}\n\n\tgetFontSize( props ) {\n\t\tconst { baseGlobalStyles, tagName, fontSize, style } = props;\n\t\tconst tagNameFontSize =\n\t\t\tbaseGlobalStyles?.elements?.[ tagName ]?.typography?.fontSize;\n\n\t\tlet newFontSize = DEFAULT_FONT_SIZE;\n\n\t\t// Disables line-height rendering for pre elements until we fix some issues with AztecAndroid.\n\t\tif ( tagName === 'pre' && ! this.isIOS ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// For block-based themes, get the default editor font size.\n\t\tif ( baseGlobalStyles?.typography?.fontSize && tagName === 'p' ) {\n\t\t\tnewFontSize = baseGlobalStyles?.typography?.fontSize;\n\t\t}\n\n\t\t// For block-based themes, get the default element font size\n\t\t// e.g h1, h2.\n\t\tif ( tagNameFontSize ) {\n\t\t\tnewFontSize = tagNameFontSize;\n\t\t}\n\n\t\t// For font size values provided from the styles,\n\t\t// usually from values set from the font size picker.\n\t\tif ( style?.fontSize ) {\n\t\t\tnewFontSize = style.fontSize;\n\t\t}\n\n\t\t// Fall-back to a font size provided from its props (if there's any)\n\t\t// and there are no other default values to use.\n\t\tif ( fontSize && ! tagNameFontSize && ! style?.fontSize ) {\n\t\t\tnewFontSize = fontSize;\n\t\t}\n\n\t\t// We need to always convert to px units because the selected value\n\t\t// could be coming from the web where it could be stored as a different unit.\n\t\tconst selectedPxValue = this.getParsedFontSize( newFontSize );\n\n\t\treturn selectedPxValue;\n\t}\n\n\tgetLineHeight() {\n\t\tconst { baseGlobalStyles, tagName, lineHeight, style } = this.props;\n\t\tconst tagNameLineHeight =\n\t\t\tbaseGlobalStyles?.elements?.[ tagName ]?.typography?.lineHeight;\n\t\tlet newLineHeight;\n\n\t\t// Disables line-height rendering for pre elements until we fix some issues with AztecAndroid.\n\t\tif ( tagName === 'pre' && ! this.isIOS ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif ( ! this.getIsBlockBasedTheme() ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// For block-based themes, get the default editor line height.\n\t\tif ( baseGlobalStyles?.typography?.lineHeight && tagName === 'p' ) {\n\t\t\tnewLineHeight = parseFloat(\n\t\t\t\tbaseGlobalStyles?.typography?.lineHeight\n\t\t\t);\n\t\t}\n\n\t\t// For block-based themes, get the default element line height\n\t\t// e.g h1, h2.\n\t\tif ( tagNameLineHeight ) {\n\t\t\tnewLineHeight = parseFloat( tagNameLineHeight );\n\t\t}\n\n\t\t// For line height values provided from the styles,\n\t\t// usually from values set from the line height picker.\n\t\tif ( style?.lineHeight ) {\n\t\t\tnewLineHeight = parseFloat( style.lineHeight );\n\t\t}\n\n\t\t// Fall-back to a line height provided from its props (if there's any)\n\t\t// and there are no other default values to use.\n\t\tif ( lineHeight && ! tagNameLineHeight && ! style?.lineHeight ) {\n\t\t\tnewLineHeight = lineHeight;\n\t\t}\n\n\t\t// Check the final value is not over the minimum supported value.\n\t\tif ( newLineHeight && newLineHeight < MIN_LINE_HEIGHT ) {\n\t\t\tnewLineHeight = MIN_LINE_HEIGHT;\n\t\t}\n\n\t\t// Until we parse CSS values correctly, avoid passing NaN values to Aztec\n\t\tif ( isNaN( newLineHeight ) ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn newLineHeight;\n\t}\n\n\tgetIsBlockBasedTheme() {\n\t\tconst { baseGlobalStyles } = this.props;\n\n\t\treturn (\n\t\t\tbaseGlobalStyles && Object.entries( baseGlobalStyles ).length !== 0\n\t\t);\n\t}\n\n\tgetBlockUseDefaultFont() {\n\t\t// For block-based themes it enables using the defaultFont\n\t\t// in Aztec for iOS so it allows customizing the font size\n\t\t// for the Preformatted/Code and Heading blocks.\n\t\tif ( ! this.isIOS ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { tagName } = this.props;\n\t\tconst isBlockBasedTheme = this.getIsBlockBasedTheme();\n\t\tconst tagsToMatch = /pre|h([1-6])$/gm;\n\n\t\treturn isBlockBasedTheme && tagsToMatch.test( tagName );\n\t}\n\n\tgetLinkTextColor( defaultColor ) {\n\t\tconst { style } = this.props;\n\t\tconst customColor = style?.linkColor && colord( style.linkColor );\n\n\t\treturn customColor && customColor.isValid()\n\t\t\t? customColor.toHex()\n\t\t\t: defaultColor;\n\t}\n\n\tgetPlaceholderTextColor() {\n\t\tconst {\n\t\t\tbaseGlobalStyles,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tplaceholderTextColor,\n\t\t\tstyle,\n\t\t} = this.props;\n\n\t\t// Default placeholder text color.\n\t\tconst placeholderStyle = getStylesFromColorScheme(\n\t\t\tstyles.richTextPlaceholder,\n\t\t\tstyles.richTextPlaceholderDark\n\t\t);\n\t\tconst { color: defaultPlaceholderTextColor } = placeholderStyle;\n\t\t// Custom 63% opacity for theme and inherited colors.\n\t\tconst placeholderOpacity = 'A1';\n\n\t\t// Determine inherited placeholder color if available.\n\t\tconst inheritPlaceholderColor = style?.placeholderColor\n\t\t\t? `${ style.placeholderColor }${ placeholderOpacity }`\n\t\t\t: undefined;\n\n\t\t// If using block-based themes, derive the placeholder color from global styles.\n\t\tconst globalStylesPlaceholderColor = baseGlobalStyles?.color?.text\n\t\t\t? `${ baseGlobalStyles.color.text }${ placeholderOpacity }`\n\t\t\t: undefined;\n\n\t\treturn (\n\t\t\tinheritPlaceholderColor ??\n\t\t\tplaceholderTextColor ??\n\t\t\tglobalStylesPlaceholderColor ??\n\t\t\tdefaultPlaceholderTextColor\n\t\t);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\ttagName,\n\t\t\tstyle,\n\t\t\t__unstableIsSelected: isSelected,\n\t\t\tchildren,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tminWidth,\n\t\t\tmaxWidth,\n\t\t\tformatTypes,\n\t\t\tparentBlockStyles,\n\t\t\taccessibilityLabel,\n\t\t\tdisableEditingMenu = false,\n\t\t\tbaseGlobalStyles,\n\t\t\tselectionStart,\n\t\t\tselectionEnd,\n\t\t\tdisableSuggestions,\n\t\t\tcontainerWidth,\n\t\t} = this.props;\n\t\tconst { currentFontSize } = this.state;\n\n\t\tconst record = this.getRecord();\n\t\tconst html = this.getHtmlToRender( record, tagName );\n\t\tconst editableProps = this.getEditableProps();\n\t\tconst blockUseDefaultFont = this.getBlockUseDefaultFont();\n\n\t\tconst fontSize = currentFontSize;\n\t\tconst lineHeight = this.getLineHeight();\n\n\t\tconst {\n\t\t\tcolor: defaultColor,\n\t\t\ttextDecorationColor: defaultTextDecorationColor,\n\t\t\tfontFamily: defaultFontFamily,\n\t\t} = getStylesFromColorScheme( styles.richText, styles.richTextDark );\n\t\tconst linkTextColor = this.getLinkTextColor(\n\t\t\tdefaultTextDecorationColor\n\t\t);\n\n\t\tconst currentSelectionStart = selectionStart ?? 0;\n\t\tconst currentSelectionEnd = selectionEnd ?? 0;\n\t\tlet selection = null;\n\t\tif ( this.needsSelectionUpdate ) {\n\t\t\tthis.needsSelectionUpdate = false;\n\t\t\tselection = {\n\t\t\t\tstart: currentSelectionStart,\n\t\t\t\tend: currentSelectionEnd,\n\t\t\t};\n\n\t\t\t// On AztecAndroid, setting the caret to an out-of-bounds position will crash the editor so, let's check for some cases.\n\t\t\tif ( ! this.isIOS ) {\n\t\t\t\t// The following regular expression is used in Aztec here:\n\t\t\t\t// https://github.com/wordpress-mobile/AztecEditor-Android/blob/b1fad439d56fa6d4aa0b78526fef355c59d00dd3/aztec/src/main/kotlin/org/wordpress/aztec/AztecParser.kt#L656\n\t\t\t\tconst brBeforeParaMatches = html.match( /(<br>)+<\\/p>$/g );\n\t\t\t\tif ( brBeforeParaMatches ) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Oops, BR tag(s) at the end of content. Aztec will remove them, adapting the selection...'\n\t\t\t\t\t);\n\t\t\t\t\tconst count = (\n\t\t\t\t\t\tbrBeforeParaMatches[ 0 ].match( /br/g ) || []\n\t\t\t\t\t).length;\n\t\t\t\t\tif ( count > 0 ) {\n\t\t\t\t\t\tlet newSelectionStart = currentSelectionStart - count;\n\t\t\t\t\t\tif ( newSelectionStart < 0 ) {\n\t\t\t\t\t\t\tnewSelectionStart = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet newSelectionEnd = currentSelectionEnd - count;\n\t\t\t\t\t\tif ( newSelectionEnd < 0 ) {\n\t\t\t\t\t\t\tnewSelectionEnd = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselection = {\n\t\t\t\t\t\t\tstart: newSelectionStart,\n\t\t\t\t\t\t\tend: newSelectionEnd,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( this.comesFromAztec ) {\n\t\t\tthis.comesFromAztec = false;\n\t\t\tthis.firedAfterTextChanged = false;\n\t\t}\n\n\t\t// Logic below assures that `RichText` width will always have equal value when container is almost fully filled.\n\t\tconst width =\n\t\t\tmaxWidth && this.state.width && maxWidth - this.state.width < 10\n\t\t\t\t? maxWidth\n\t\t\t\t: this.state.width;\n\t\tconst containerStyles = [\n\t\t\tstyle?.padding &&\n\t\t\t\tstyle?.backgroundColor && {\n\t\t\t\t\tpadding: style.padding,\n\t\t\t\t\tbackgroundColor: style.backgroundColor,\n\t\t\t\t},\n\t\t\tcontainerWidth && {\n\t\t\t\twidth: containerWidth,\n\t\t\t},\n\t\t];\n\n\t\tconst defaultSelectionColor = getStylesFromColorScheme(\n\t\t\tstyles[ 'rich-text-selection' ],\n\t\t\tstyles[ 'rich-text-selection--dark' ]\n\t\t).color;\n\t\tconst selectionColor = getSelectionColor(\n\t\t\tthis.props.selectionColor,\n\t\t\tdefaultSelectionColor,\n\t\t\tbaseGlobalStyles,\n\t\t\tthis.getIsBlockBasedTheme()\n\t\t);\n\n\t\tconst EditableView = ( props ) => {\n\t\t\tthis.customEditableOnKeyDown = props?.onKeyDown;\n\n\t\t\treturn <></>;\n\t\t};\n\n\t\treturn (\n\t\t\t<View style={ containerStyles }>\n\t\t\t\t{ children &&\n\t\t\t\t\tchildren( {\n\t\t\t\t\t\tisSelected,\n\t\t\t\t\t\tvalue: record,\n\t\t\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\t\t\tonFocus: () => {},\n\t\t\t\t\t\teditableProps,\n\t\t\t\t\t\teditableTagName: EditableView,\n\t\t\t\t\t} ) }\n\t\t\t\t<RCTAztecView\n\t\t\t\t\taccessibilityLabel={ accessibilityLabel }\n\t\t\t\t\tref={ ( ref ) => {\n\t\t\t\t\t\tthis._editor = ref;\n\n\t\t\t\t\t\tif ( this.props.nativeEditorRef ) {\n\t\t\t\t\t\t\tthis.props.nativeEditorRef( ref );\n\t\t\t\t\t\t}\n\t\t\t\t\t} }\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tbackgroundColor: styles.richText.backgroundColor,\n\t\t\t\t\t\t...style,\n\t\t\t\t\t\t...( this.isIOS && minWidth && maxWidth\n\t\t\t\t\t\t\t? { width }\n\t\t\t\t\t\t\t: { maxWidth } ),\n\t\t\t\t\t\tminHeight: this.state.height,\n\t\t\t\t\t} }\n\t\t\t\t\tblockUseDefaultFont={ blockUseDefaultFont }\n\t\t\t\t\ttext={ {\n\t\t\t\t\t\ttext: html,\n\t\t\t\t\t\teventCount: this.lastEventCount,\n\t\t\t\t\t\tselection,\n\t\t\t\t\t\tlinkTextColor,\n\t\t\t\t\t\ttag: tagName,\n\t\t\t\t\t} }\n\t\t\t\t\tplaceholder={ this.props.placeholder }\n\t\t\t\t\tplaceholderTextColor={ this.getPlaceholderTextColor() }\n\t\t\t\t\tdeleteEnter={ this.props.deleteEnter }\n\t\t\t\t\tonChange={ this.onChangeFromAztec }\n\t\t\t\t\tonFocus={ this.onFocus }\n\t\t\t\t\tonBlur={ this.onBlur }\n\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\ttriggerKeyCodes={\n\t\t\t\t\t\tdisableEditingMenu\n\t\t\t\t\t\t\t? []\n\t\t\t\t\t\t\t: this.suggestionOptions().map(\n\t\t\t\t\t\t\t\t\t( op ) => op.triggerChar\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t}\n\t\t\t\t\tonPaste={ this.onPaste }\n\t\t\t\t\tactiveFormats={ this.getActiveFormatNames( record ) }\n\t\t\t\t\tonContentSizeChange={ this.onContentSizeChange }\n\t\t\t\t\tonSelectionChange={ this.onSelectionChangeFromAztec }\n\t\t\t\t\tblockType={ { tag: tagName } }\n\t\t\t\t\tcolor={\n\t\t\t\t\t\t( style && style.color ) ||\n\t\t\t\t\t\t( parentBlockStyles && parentBlockStyles.color ) ||\n\t\t\t\t\t\t( baseGlobalStyles && baseGlobalStyles?.color?.text ) ||\n\t\t\t\t\t\tdefaultColor\n\t\t\t\t\t}\n\t\t\t\t\tmaxImagesWidth={ 200 }\n\t\t\t\t\tfontFamily={ this.props.fontFamily || defaultFontFamily }\n\t\t\t\t\tfontSize={ fontSize }\n\t\t\t\t\tlineHeight={ lineHeight }\n\t\t\t\t\tfontWeight={ this.props.fontWeight }\n\t\t\t\t\tfontStyle={ this.props.fontStyle }\n\t\t\t\t\tdisableEditingMenu={ disableEditingMenu }\n\t\t\t\t\tisMultiline={ false }\n\t\t\t\t\ttextAlign={ this.props.textAlign }\n\t\t\t\t\t{ ...( this.isIOS ? { maxWidth } : {} ) }\n\t\t\t\t\tminWidth={ minWidth }\n\t\t\t\t\tid={ this.props.id }\n\t\t\t\t\tselectionColor={ selectionColor }\n\t\t\t\t\tdisableAutocorrection={ this.props.disableAutocorrection }\n\t\t\t\t/>\n\t\t\t\t{ isSelected && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<FormatEdit\n\t\t\t\t\t\t\tforwardedRef={ this._editor }\n\t\t\t\t\t\t\tformatTypes={ formatTypes }\n\t\t\t\t\t\t\tvalue={ record }\n\t\t\t\t\t\t\tonChange={ this.onFormatChange }\n\t\t\t\t\t\t\tonFocus={ () => {} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{ ! disableSuggestions && (\n\t\t\t\t\t\t\t<BlockFormatControls>\n\t\t\t\t\t\t\t\t<ToolbarButtonWithOptions\n\t\t\t\t\t\t\t\t\toptions={ this.suggestionOptions() }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</BlockFormatControls>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nRichText.defaultProps = {\n\tformat: 'string',\n\tvalue: '',\n\ttagName: 'div',\n};\n\nconst withFormatTypes = ( WrappedComponent ) => ( props ) => {\n\tconst {\n\t\tclientId,\n\t\tidentifier,\n\t\twithoutInteractiveFormatting,\n\t\tallowedFormats,\n\t} = props;\n\tconst { formatTypes } = useFormatTypes( {\n\t\tclientId,\n\t\tidentifier,\n\t\twithoutInteractiveFormatting,\n\t\tallowedFormats,\n\t} );\n\n\treturn <WrappedComponent { ...props } formatTypes={ formatTypes } />;\n};\n\nexport default compose( [\n\twithSelect( ( select, { clientId } ) => {\n\t\tconst { getBlockParents, getBlock, getSettings } =\n\t\t\tselect( 'core/block-editor' );\n\t\tconst parents = getBlockParents( clientId, true );\n\t\tconst parentBlock = parents ? getBlock( parents[ 0 ] ) : undefined;\n\t\tconst parentBlockStyles = parentBlock?.attributes?.childrenStyles;\n\n\t\tconst settings = getSettings();\n\t\tconst baseGlobalStyles = settings?.__experimentalGlobalStylesBaseStyles;\n\n\t\tconst colorPalettes = settings?.__experimentalFeatures?.color?.palette;\n\t\tconst colorPalette = colorPalettes\n\t\t\t? flatColorPalettes( colorPalettes )\n\t\t\t: settings?.colors;\n\n\t\treturn {\n\t\t\tareMentionsSupported: settings?.capabilities?.mentions === true,\n\t\t\tareXPostsSupported: settings?.capabilities?.xposts === true,\n\t\t\tparentBlockStyles,\n\t\t\tbaseGlobalStyles,\n\t\t\tcolorPalette,\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n\twithFormatTypes,\n] )( RichText );\n"],"mappings":"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","ignoreList":[]}