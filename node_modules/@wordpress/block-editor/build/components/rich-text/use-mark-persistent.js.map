{"version":3,"names":["_element","require","_data","_store","useMarkPersistent","html","value","previousTextRef","useRef","hasActiveFormats","activeFormats","length","__unstableMarkLastChangeAsPersistent","useDispatch","blockEditorStore","useLayoutEffect","current","text","timeout","window","setTimeout","clearTimeout"],"sources":["@wordpress/block-editor/src/components/rich-text/use-mark-persistent.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useLayoutEffect, useRef } from '@wordpress/element';\nimport { useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\n\nexport function useMarkPersistent( { html, value } ) {\n\tconst previousTextRef = useRef();\n\tconst hasActiveFormats = !! value.activeFormats?.length;\n\tconst { __unstableMarkLastChangeAsPersistent } =\n\t\tuseDispatch( blockEditorStore );\n\n\t// Must be set synchronously to make sure it applies to the last change.\n\tuseLayoutEffect( () => {\n\t\t// Ignore mount.\n\t\tif ( ! previousTextRef.current ) {\n\t\t\tpreviousTextRef.current = value.text;\n\t\t\treturn;\n\t\t}\n\n\t\t// Text input, so don't create an undo level for every character.\n\t\t// Create an undo level after 1 second of no input.\n\t\tif ( previousTextRef.current !== value.text ) {\n\t\t\tconst timeout = window.setTimeout( () => {\n\t\t\t\t__unstableMarkLastChangeAsPersistent();\n\t\t\t}, 1000 );\n\t\t\tpreviousTextRef.current = value.text;\n\t\t\treturn () => {\n\t\t\t\twindow.clearTimeout( timeout );\n\t\t\t};\n\t\t}\n\n\t\t__unstableMarkLastChangeAsPersistent();\n\t}, [ html, hasActiveFormats ] );\n}\n"],"mappings":";;;;;;AAGA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,KAAA,GAAAD,OAAA;AAKA,IAAAE,MAAA,GAAAF,OAAA;AATA;AACA;AACA;;AAIA;AACA;AACA;;AAGO,SAASG,iBAAiBA,CAAE;EAAEC,IAAI;EAAEC;AAAM,CAAC,EAAG;EACpD,MAAMC,eAAe,GAAG,IAAAC,eAAM,EAAC,CAAC;EAChC,MAAMC,gBAAgB,GAAG,CAAC,CAAEH,KAAK,CAACI,aAAa,EAAEC,MAAM;EACvD,MAAM;IAAEC;EAAqC,CAAC,GAC7C,IAAAC,iBAAW,EAAEC,YAAiB,CAAC;;EAEhC;EACA,IAAAC,wBAAe,EAAE,MAAM;IACtB;IACA,IAAK,CAAER,eAAe,CAACS,OAAO,EAAG;MAChCT,eAAe,CAACS,OAAO,GAAGV,KAAK,CAACW,IAAI;MACpC;IACD;;IAEA;IACA;IACA,IAAKV,eAAe,CAACS,OAAO,KAAKV,KAAK,CAACW,IAAI,EAAG;MAC7C,MAAMC,OAAO,GAAGC,MAAM,CAACC,UAAU,CAAE,MAAM;QACxCR,oCAAoC,CAAC,CAAC;MACvC,CAAC,EAAE,IAAK,CAAC;MACTL,eAAe,CAACS,OAAO,GAAGV,KAAK,CAACW,IAAI;MACpC,OAAO,MAAM;QACZE,MAAM,CAACE,YAAY,CAAEH,OAAQ,CAAC;MAC/B,CAAC;IACF;IAEAN,oCAAoC,CAAC,CAAC;EACvC,CAAC,EAAE,CAAEP,IAAI,EAAEI,gBAAgB,CAAG,CAAC;AAChC","ignoreList":[]}