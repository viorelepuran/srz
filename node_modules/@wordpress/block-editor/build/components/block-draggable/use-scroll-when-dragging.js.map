{"version":3,"names":["_dom","require","_element","SCROLL_INACTIVE_DISTANCE_PX","SCROLL_INTERVAL_MS","PIXELS_PER_SECOND_PER_PERCENTAGE","VELOCITY_MULTIPLIER","useScrollWhenDragging","dragStartYRef","useRef","velocityYRef","scrollParentYRef","scrollEditorIntervalRef","useEffect","current","clearInterval","startScrolling","useCallback","event","clientY","getScrollContainer","target","setInterval","newTop","scrollTop","scroll","top","scrollOnDragOver","scrollParentHeight","offsetHeight","offsetDragStartPosition","offsetTop","offsetDragPosition","moveableDistance","Math","max","dragDistance","distancePercentage","stopScrolling"],"sources":["@wordpress/block-editor/src/components/block-draggable/use-scroll-when-dragging.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { getScrollContainer } from '@wordpress/dom';\nimport { useCallback, useEffect, useRef } from '@wordpress/element';\n\nconst SCROLL_INACTIVE_DISTANCE_PX = 50;\nconst SCROLL_INTERVAL_MS = 25;\nconst PIXELS_PER_SECOND_PER_PERCENTAGE = 1000;\nconst VELOCITY_MULTIPLIER =\n\tPIXELS_PER_SECOND_PER_PERCENTAGE * ( SCROLL_INTERVAL_MS / 1000 );\n\n/**\n * React hook that scrolls the scroll container when a block is being dragged.\n *\n * @return {Function[]} `startScrolling`, `scrollOnDragOver`, `stopScrolling`\n *                      functions to be called in `onDragStart`, `onDragOver`\n *                      and `onDragEnd` events respectively.\n */\nexport default function useScrollWhenDragging() {\n\tconst dragStartYRef = useRef( null );\n\tconst velocityYRef = useRef( null );\n\tconst scrollParentYRef = useRef( null );\n\tconst scrollEditorIntervalRef = useRef( null );\n\n\t// Clear interval when unmounting.\n\tuseEffect(\n\t\t() => () => {\n\t\t\tif ( scrollEditorIntervalRef.current ) {\n\t\t\t\tclearInterval( scrollEditorIntervalRef.current );\n\t\t\t\tscrollEditorIntervalRef.current = null;\n\t\t\t}\n\t\t},\n\t\t[]\n\t);\n\n\tconst startScrolling = useCallback( ( event ) => {\n\t\tdragStartYRef.current = event.clientY;\n\n\t\t// Find nearest parent(s) to scroll.\n\t\tscrollParentYRef.current = getScrollContainer( event.target );\n\n\t\tscrollEditorIntervalRef.current = setInterval( () => {\n\t\t\tif ( scrollParentYRef.current && velocityYRef.current ) {\n\t\t\t\tconst newTop =\n\t\t\t\t\tscrollParentYRef.current.scrollTop + velocityYRef.current;\n\n\t\t\t\t// Setting `behavior: 'smooth'` as a scroll property seems to hurt performance.\n\t\t\t\t// Better to use a small scroll interval.\n\t\t\t\tscrollParentYRef.current.scroll( {\n\t\t\t\t\ttop: newTop,\n\t\t\t\t} );\n\t\t\t}\n\t\t}, SCROLL_INTERVAL_MS );\n\t}, [] );\n\n\tconst scrollOnDragOver = useCallback( ( event ) => {\n\t\tif ( ! scrollParentYRef.current ) {\n\t\t\treturn;\n\t\t}\n\t\tconst scrollParentHeight = scrollParentYRef.current.offsetHeight;\n\t\tconst offsetDragStartPosition =\n\t\t\tdragStartYRef.current - scrollParentYRef.current.offsetTop;\n\t\tconst offsetDragPosition =\n\t\t\tevent.clientY - scrollParentYRef.current.offsetTop;\n\n\t\tif ( event.clientY > offsetDragStartPosition ) {\n\t\t\t// User is dragging downwards.\n\t\t\tconst moveableDistance = Math.max(\n\t\t\t\tscrollParentHeight -\n\t\t\t\t\toffsetDragStartPosition -\n\t\t\t\t\tSCROLL_INACTIVE_DISTANCE_PX,\n\t\t\t\t0\n\t\t\t);\n\t\t\tconst dragDistance = Math.max(\n\t\t\t\toffsetDragPosition -\n\t\t\t\t\toffsetDragStartPosition -\n\t\t\t\t\tSCROLL_INACTIVE_DISTANCE_PX,\n\t\t\t\t0\n\t\t\t);\n\t\t\tconst distancePercentage =\n\t\t\t\tmoveableDistance === 0 || dragDistance === 0\n\t\t\t\t\t? 0\n\t\t\t\t\t: dragDistance / moveableDistance;\n\t\t\tvelocityYRef.current = VELOCITY_MULTIPLIER * distancePercentage;\n\t\t} else if ( event.clientY < offsetDragStartPosition ) {\n\t\t\t// User is dragging upwards.\n\t\t\tconst moveableDistance = Math.max(\n\t\t\t\toffsetDragStartPosition - SCROLL_INACTIVE_DISTANCE_PX,\n\t\t\t\t0\n\t\t\t);\n\t\t\tconst dragDistance = Math.max(\n\t\t\t\toffsetDragStartPosition -\n\t\t\t\t\toffsetDragPosition -\n\t\t\t\t\tSCROLL_INACTIVE_DISTANCE_PX,\n\t\t\t\t0\n\t\t\t);\n\t\t\tconst distancePercentage =\n\t\t\t\tmoveableDistance === 0 || dragDistance === 0\n\t\t\t\t\t? 0\n\t\t\t\t\t: dragDistance / moveableDistance;\n\t\t\tvelocityYRef.current = -VELOCITY_MULTIPLIER * distancePercentage;\n\t\t} else {\n\t\t\tvelocityYRef.current = 0;\n\t\t}\n\t}, [] );\n\n\tconst stopScrolling = () => {\n\t\tdragStartYRef.current = null;\n\t\tscrollParentYRef.current = null;\n\n\t\tif ( scrollEditorIntervalRef.current ) {\n\t\t\tclearInterval( scrollEditorIntervalRef.current );\n\t\t\tscrollEditorIntervalRef.current = null;\n\t\t}\n\t};\n\n\treturn [ startScrolling, scrollOnDragOver, stopScrolling ];\n}\n"],"mappings":"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","ignoreList":[]}