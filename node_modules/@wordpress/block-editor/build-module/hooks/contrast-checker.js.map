{"version":3,"names":["useLayoutEffect","useReducer","ContrastChecker","useBlockElement","jsx","_jsx","getComputedValue","node","property","ownerDocument","defaultView","getComputedStyle","getPropertyValue","getBlockElementColors","blockEl","firstLinkElement","querySelector","linkColor","innerText","undefined","textColor","backgroundColorNode","backgroundColor","parentNode","nodeType","ELEMENT_NODE","reducer","prevColors","newColors","hasChanged","Object","keys","some","key","BlockColorContrastChecker","clientId","colors","setColors","updateColors","window","requestAnimationFrame","enableAlphaChecker"],"sources":["@wordpress/block-editor/src/hooks/contrast-checker.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useLayoutEffect, useReducer } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport ContrastChecker from '../components/contrast-checker';\nimport { useBlockElement } from '../components/block-list/use-block-props/use-block-refs';\n\nfunction getComputedValue( node, property ) {\n\treturn node.ownerDocument.defaultView\n\t\t.getComputedStyle( node )\n\t\t.getPropertyValue( property );\n}\n\nfunction getBlockElementColors( blockEl ) {\n\tif ( ! blockEl ) {\n\t\treturn {};\n\t}\n\n\tconst firstLinkElement = blockEl.querySelector( 'a' );\n\tconst linkColor = !! firstLinkElement?.innerText\n\t\t? getComputedValue( firstLinkElement, 'color' )\n\t\t: undefined;\n\n\tconst textColor = getComputedValue( blockEl, 'color' );\n\n\tlet backgroundColorNode = blockEl;\n\tlet backgroundColor = getComputedValue(\n\t\tbackgroundColorNode,\n\t\t'background-color'\n\t);\n\twhile (\n\t\tbackgroundColor === 'rgba(0, 0, 0, 0)' &&\n\t\tbackgroundColorNode.parentNode &&\n\t\tbackgroundColorNode.parentNode.nodeType ===\n\t\t\tbackgroundColorNode.parentNode.ELEMENT_NODE\n\t) {\n\t\tbackgroundColorNode = backgroundColorNode.parentNode;\n\t\tbackgroundColor = getComputedValue(\n\t\t\tbackgroundColorNode,\n\t\t\t'background-color'\n\t\t);\n\t}\n\n\treturn {\n\t\ttextColor,\n\t\tbackgroundColor,\n\t\tlinkColor,\n\t};\n}\n\nfunction reducer( prevColors, newColors ) {\n\tconst hasChanged = Object.keys( newColors ).some(\n\t\t( key ) => prevColors[ key ] !== newColors[ key ]\n\t);\n\n\t// Do not re-render if the colors have not changed.\n\treturn hasChanged ? newColors : prevColors;\n}\n\nexport default function BlockColorContrastChecker( { clientId } ) {\n\tconst blockEl = useBlockElement( clientId );\n\tconst [ colors, setColors ] = useReducer( reducer, {} );\n\n\t// There are so many things that can change the color of a block\n\t// So we perform this check on every render.\n\tuseLayoutEffect( () => {\n\t\tif ( ! blockEl ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction updateColors() {\n\t\t\tsetColors( getBlockElementColors( blockEl ) );\n\t\t}\n\n\t\t// Combine `useLayoutEffect` and two rAF calls to ensure that values are read\n\t\t// after the current paint but before the next paint.\n\t\twindow.requestAnimationFrame( () =>\n\t\t\twindow.requestAnimationFrame( updateColors )\n\t\t);\n\t} );\n\n\treturn (\n\t\t<ContrastChecker\n\t\t\tbackgroundColor={ colors.backgroundColor }\n\t\t\ttextColor={ colors.textColor }\n\t\t\tlinkColor={ colors.linkColor }\n\t\t\tenableAlphaChecker\n\t\t/>\n\t);\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,eAAe,EAAEC,UAAU,QAAQ,oBAAoB;;AAEhE;AACA;AACA;AACA,OAAOC,eAAe,MAAM,gCAAgC;AAC5D,SAASC,eAAe,QAAQ,yDAAyD;AAAC,SAAAC,GAAA,IAAAC,IAAA;AAE1F,SAASC,gBAAgBA,CAAEC,IAAI,EAAEC,QAAQ,EAAG;EAC3C,OAAOD,IAAI,CAACE,aAAa,CAACC,WAAW,CACnCC,gBAAgB,CAAEJ,IAAK,CAAC,CACxBK,gBAAgB,CAAEJ,QAAS,CAAC;AAC/B;AAEA,SAASK,qBAAqBA,CAAEC,OAAO,EAAG;EACzC,IAAK,CAAEA,OAAO,EAAG;IAChB,OAAO,CAAC,CAAC;EACV;EAEA,MAAMC,gBAAgB,GAAGD,OAAO,CAACE,aAAa,CAAE,GAAI,CAAC;EACrD,MAAMC,SAAS,GAAG,CAAC,CAAEF,gBAAgB,EAAEG,SAAS,GAC7CZ,gBAAgB,CAAES,gBAAgB,EAAE,OAAQ,CAAC,GAC7CI,SAAS;EAEZ,MAAMC,SAAS,GAAGd,gBAAgB,CAAEQ,OAAO,EAAE,OAAQ,CAAC;EAEtD,IAAIO,mBAAmB,GAAGP,OAAO;EACjC,IAAIQ,eAAe,GAAGhB,gBAAgB,CACrCe,mBAAmB,EACnB,kBACD,CAAC;EACD,OACCC,eAAe,KAAK,kBAAkB,IACtCD,mBAAmB,CAACE,UAAU,IAC9BF,mBAAmB,CAACE,UAAU,CAACC,QAAQ,KACtCH,mBAAmB,CAACE,UAAU,CAACE,YAAY,EAC3C;IACDJ,mBAAmB,GAAGA,mBAAmB,CAACE,UAAU;IACpDD,eAAe,GAAGhB,gBAAgB,CACjCe,mBAAmB,EACnB,kBACD,CAAC;EACF;EAEA,OAAO;IACND,SAAS;IACTE,eAAe;IACfL;EACD,CAAC;AACF;AAEA,SAASS,OAAOA,CAAEC,UAAU,EAAEC,SAAS,EAAG;EACzC,MAAMC,UAAU,GAAGC,MAAM,CAACC,IAAI,CAAEH,SAAU,CAAC,CAACI,IAAI,CAC7CC,GAAG,IAAMN,UAAU,CAAEM,GAAG,CAAE,KAAKL,SAAS,CAAEK,GAAG,CAChD,CAAC;;EAED;EACA,OAAOJ,UAAU,GAAGD,SAAS,GAAGD,UAAU;AAC3C;AAEA,eAAe,SAASO,yBAAyBA,CAAE;EAAEC;AAAS,CAAC,EAAG;EACjE,MAAMrB,OAAO,GAAGX,eAAe,CAAEgC,QAAS,CAAC;EAC3C,MAAM,CAAEC,MAAM,EAAEC,SAAS,CAAE,GAAGpC,UAAU,CAAEyB,OAAO,EAAE,CAAC,CAAE,CAAC;;EAEvD;EACA;EACA1B,eAAe,CAAE,MAAM;IACtB,IAAK,CAAEc,OAAO,EAAG;MAChB;IACD;IAEA,SAASwB,YAAYA,CAAA,EAAG;MACvBD,SAAS,CAAExB,qBAAqB,CAAEC,OAAQ,CAAE,CAAC;IAC9C;;IAEA;IACA;IACAyB,MAAM,CAACC,qBAAqB,CAAE,MAC7BD,MAAM,CAACC,qBAAqB,CAAEF,YAAa,CAC5C,CAAC;EACF,CAAE,CAAC;EAEH,oBACCjC,IAAA,CAACH,eAAe;IACfoB,eAAe,EAAGc,MAAM,CAACd,eAAiB;IAC1CF,SAAS,EAAGgB,MAAM,CAAChB,SAAW;IAC9BH,SAAS,EAAGmB,MAAM,CAACnB,SAAW;IAC9BwB,kBAAkB;EAAA,CAClB,CAAC;AAEJ","ignoreList":[]}