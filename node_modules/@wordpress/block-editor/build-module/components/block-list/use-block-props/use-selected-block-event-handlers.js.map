{"version":3,"names":["isTextField","ENTER","BACKSPACE","DELETE","useSelect","useDispatch","useRefEffect","createRoot","store","blocksStore","blockEditorStore","unlock","BlockDraggableChip","jsx","_jsx","useEventHandlers","clientId","isSelected","getBlockType","getBlockRootClientId","isZoomOut","hasMultiSelection","getBlockName","insertAfterBlock","removeBlock","resetZoomLevel","startDraggingBlocks","stopDraggingBlocks","node","onKeyDown","event","keyCode","target","preventDefault","onDragStart","isContentEditable","ownerDocument","activeElement","data","JSON","stringify","type","srcClientIds","srcRootClientId","dataTransfer","effectAllowed","clearData","setData","defaultView","selection","getSelection","removeAllRanges","domNode","document","createElement","root","render","icon","body","appendChild","style","position","top","left","zIndex","pointerEvents","dragElement","width","height","visibility","setDragImage","offset","x","y","frame","frameElement","rect","getBoundingClientRect","over","e","transform","clientX","clientY","end","removeEventListener","remove","classList","documentElement","addEventListener","add"],"sources":["@wordpress/block-editor/src/components/block-list/use-block-props/use-selected-block-event-handlers.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { isTextField } from '@wordpress/dom';\nimport { ENTER, BACKSPACE, DELETE } from '@wordpress/keycodes';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useRefEffect } from '@wordpress/compose';\nimport { createRoot } from '@wordpress/element';\nimport { store as blocksStore } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../../store';\nimport { unlock } from '../../../lock-unlock';\nimport BlockDraggableChip from '../../../components/block-draggable/draggable-chip';\n\n/**\n * Adds block behaviour:\n *   - Removes the block on BACKSPACE.\n *   - Inserts a default block on ENTER.\n *   - Disables dragging of block contents.\n *\n * @param {string} clientId Block client ID.\n */\nexport function useEventHandlers( { clientId, isSelected } ) {\n\tconst { getBlockType } = useSelect( blocksStore );\n\tconst { getBlockRootClientId, isZoomOut, hasMultiSelection, getBlockName } =\n\t\tunlock( useSelect( blockEditorStore ) );\n\tconst {\n\t\tinsertAfterBlock,\n\t\tremoveBlock,\n\t\tresetZoomLevel,\n\t\tstartDraggingBlocks,\n\t\tstopDraggingBlocks,\n\t} = unlock( useDispatch( blockEditorStore ) );\n\n\treturn useRefEffect(\n\t\t( node ) => {\n\t\t\tif ( ! isSelected ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Interprets keydown event intent to remove or insert after block if\n\t\t\t * key event occurs on wrapper node. This can occur when the block has\n\t\t\t * no text fields of its own, particularly after initial insertion, to\n\t\t\t * allow for easy deletion and continuous writing flow to add additional\n\t\t\t * content.\n\t\t\t *\n\t\t\t * @param {KeyboardEvent} event Keydown event.\n\t\t\t */\n\t\t\tfunction onKeyDown( event ) {\n\t\t\t\tconst { keyCode, target } = event;\n\n\t\t\t\tif (\n\t\t\t\t\tkeyCode !== ENTER &&\n\t\t\t\t\tkeyCode !== BACKSPACE &&\n\t\t\t\t\tkeyCode !== DELETE\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( target !== node || isTextField( target ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tif ( keyCode === ENTER && isZoomOut() ) {\n\t\t\t\t\tresetZoomLevel();\n\t\t\t\t} else if ( keyCode === ENTER ) {\n\t\t\t\t\tinsertAfterBlock( clientId );\n\t\t\t\t} else {\n\t\t\t\t\tremoveBlock( clientId );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Prevents default dragging behavior within a block. To do: we must\n\t\t\t * handle this in the future and clean up the drag target.\n\t\t\t *\n\t\t\t * @param {DragEvent} event Drag event.\n\t\t\t */\n\t\t\tfunction onDragStart( event ) {\n\t\t\t\tif (\n\t\t\t\t\tnode !== event.target ||\n\t\t\t\t\tnode.isContentEditable ||\n\t\t\t\t\tnode.ownerDocument.activeElement !== node ||\n\t\t\t\t\thasMultiSelection()\n\t\t\t\t) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst data = JSON.stringify( {\n\t\t\t\t\ttype: 'block',\n\t\t\t\t\tsrcClientIds: [ clientId ],\n\t\t\t\t\tsrcRootClientId: getBlockRootClientId( clientId ),\n\t\t\t\t} );\n\t\t\t\tevent.dataTransfer.effectAllowed = 'move'; // remove \"+\" cursor\n\t\t\t\tevent.dataTransfer.clearData();\n\t\t\t\tevent.dataTransfer.setData( 'wp-blocks', data );\n\t\t\t\tconst { ownerDocument } = node;\n\t\t\t\tconst { defaultView } = ownerDocument;\n\t\t\t\tconst selection = defaultView.getSelection();\n\t\t\t\tselection.removeAllRanges();\n\n\t\t\t\tconst domNode = document.createElement( 'div' );\n\t\t\t\tconst root = createRoot( domNode );\n\t\t\t\troot.render(\n\t\t\t\t\t<BlockDraggableChip\n\t\t\t\t\t\ticon={ getBlockType( getBlockName( clientId ) ).icon }\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t\tdocument.body.appendChild( domNode );\n\t\t\t\tdomNode.style.position = 'absolute';\n\t\t\t\tdomNode.style.top = '0';\n\t\t\t\tdomNode.style.left = '0';\n\t\t\t\tdomNode.style.zIndex = '1000';\n\t\t\t\tdomNode.style.pointerEvents = 'none';\n\n\t\t\t\t// Setting the drag chip as the drag image actually works, but\n\t\t\t\t// the behaviour is slightly different in every browser. In\n\t\t\t\t// Safari, it animates, in Firefox it's slightly transparent...\n\t\t\t\t// So we set a fake drag image and have to reposition it\n\t\t\t\t// ourselves.\n\t\t\t\tconst dragElement = ownerDocument.createElement( 'div' );\n\t\t\t\t// Chrome will show a globe icon if the drag element does not\n\t\t\t\t// have dimensions.\n\t\t\t\tdragElement.style.width = '1px';\n\t\t\t\tdragElement.style.height = '1px';\n\t\t\t\tdragElement.style.position = 'fixed';\n\t\t\t\tdragElement.style.visibility = 'hidden';\n\t\t\t\townerDocument.body.appendChild( dragElement );\n\t\t\t\tevent.dataTransfer.setDragImage( dragElement, 0, 0 );\n\n\t\t\t\tlet offset = { x: 0, y: 0 };\n\n\t\t\t\tif ( document !== ownerDocument ) {\n\t\t\t\t\tconst frame = defaultView.frameElement;\n\t\t\t\t\tif ( frame ) {\n\t\t\t\t\t\tconst rect = frame.getBoundingClientRect();\n\t\t\t\t\t\toffset = { x: rect.left, y: rect.top };\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// chip handle offset\n\t\t\t\toffset.x -= 58;\n\n\t\t\t\tfunction over( e ) {\n\t\t\t\t\tdomNode.style.transform = `translate( ${\n\t\t\t\t\t\te.clientX + offset.x\n\t\t\t\t\t}px, ${ e.clientY + offset.y }px )`;\n\t\t\t\t}\n\n\t\t\t\tover( event );\n\n\t\t\t\tfunction end() {\n\t\t\t\t\townerDocument.removeEventListener( 'dragover', over );\n\t\t\t\t\townerDocument.removeEventListener( 'dragend', end );\n\t\t\t\t\tdomNode.remove();\n\t\t\t\t\tdragElement.remove();\n\t\t\t\t\tstopDraggingBlocks();\n\t\t\t\t\tdocument.body.classList.remove(\n\t\t\t\t\t\t'is-dragging-components-draggable'\n\t\t\t\t\t);\n\t\t\t\t\townerDocument.documentElement.classList.remove(\n\t\t\t\t\t\t'is-dragging'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\townerDocument.addEventListener( 'dragover', over );\n\t\t\t\townerDocument.addEventListener( 'dragend', end );\n\t\t\t\townerDocument.addEventListener( 'drop', end );\n\n\t\t\t\tstartDraggingBlocks( [ clientId ] );\n\t\t\t\t// Important because it hides the block toolbar.\n\t\t\t\tdocument.body.classList.add(\n\t\t\t\t\t'is-dragging-components-draggable'\n\t\t\t\t);\n\t\t\t\townerDocument.documentElement.classList.add( 'is-dragging' );\n\t\t\t}\n\n\t\t\tnode.addEventListener( 'keydown', onKeyDown );\n\t\t\tnode.addEventListener( 'dragstart', onDragStart );\n\n\t\t\treturn () => {\n\t\t\t\tnode.removeEventListener( 'keydown', onKeyDown );\n\t\t\t\tnode.removeEventListener( 'dragstart', onDragStart );\n\t\t\t};\n\t\t},\n\t\t[\n\t\t\tclientId,\n\t\t\tisSelected,\n\t\t\tgetBlockRootClientId,\n\t\t\tinsertAfterBlock,\n\t\t\tremoveBlock,\n\t\t\tisZoomOut,\n\t\t\tresetZoomLevel,\n\t\t\thasMultiSelection,\n\t\t\tstartDraggingBlocks,\n\t\t\tstopDraggingBlocks,\n\t\t]\n\t);\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,WAAW,QAAQ,gBAAgB;AAC5C,SAASC,KAAK,EAAEC,SAAS,EAAEC,MAAM,QAAQ,qBAAqB;AAC9D,SAASC,SAAS,EAAEC,WAAW,QAAQ,iBAAiB;AACxD,SAASC,YAAY,QAAQ,oBAAoB;AACjD,SAASC,UAAU,QAAQ,oBAAoB;AAC/C,SAASC,KAAK,IAAIC,WAAW,QAAQ,mBAAmB;;AAExD;AACA;AACA;AACA,SAASD,KAAK,IAAIE,gBAAgB,QAAQ,gBAAgB;AAC1D,SAASC,MAAM,QAAQ,sBAAsB;AAC7C,OAAOC,kBAAkB,MAAM,oDAAoD;;AAEnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA,SAAAC,GAAA,IAAAC,IAAA;AAQA,OAAO,SAASC,gBAAgBA,CAAE;EAAEC,QAAQ;EAAEC;AAAW,CAAC,EAAG;EAC5D,MAAM;IAAEC;EAAa,CAAC,GAAGd,SAAS,CAAEK,WAAY,CAAC;EACjD,MAAM;IAAEU,oBAAoB;IAAEC,SAAS;IAAEC,iBAAiB;IAAEC;EAAa,CAAC,GACzEX,MAAM,CAAEP,SAAS,CAAEM,gBAAiB,CAAE,CAAC;EACxC,MAAM;IACLa,gBAAgB;IAChBC,WAAW;IACXC,cAAc;IACdC,mBAAmB;IACnBC;EACD,CAAC,GAAGhB,MAAM,CAAEN,WAAW,CAAEK,gBAAiB,CAAE,CAAC;EAE7C,OAAOJ,YAAY,CAChBsB,IAAI,IAAM;IACX,IAAK,CAAEX,UAAU,EAAG;MACnB;IACD;;IAEA;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACG,SAASY,SAASA,CAAEC,KAAK,EAAG;MAC3B,MAAM;QAAEC,OAAO;QAAEC;MAAO,CAAC,GAAGF,KAAK;MAEjC,IACCC,OAAO,KAAK9B,KAAK,IACjB8B,OAAO,KAAK7B,SAAS,IACrB6B,OAAO,KAAK5B,MAAM,EACjB;QACD;MACD;MAEA,IAAK6B,MAAM,KAAKJ,IAAI,IAAI5B,WAAW,CAAEgC,MAAO,CAAC,EAAG;QAC/C;MACD;MAEAF,KAAK,CAACG,cAAc,CAAC,CAAC;MAEtB,IAAKF,OAAO,KAAK9B,KAAK,IAAImB,SAAS,CAAC,CAAC,EAAG;QACvCK,cAAc,CAAC,CAAC;MACjB,CAAC,MAAM,IAAKM,OAAO,KAAK9B,KAAK,EAAG;QAC/BsB,gBAAgB,CAAEP,QAAS,CAAC;MAC7B,CAAC,MAAM;QACNQ,WAAW,CAAER,QAAS,CAAC;MACxB;IACD;;IAEA;AACH;AACA;AACA;AACA;AACA;IACG,SAASkB,WAAWA,CAAEJ,KAAK,EAAG;MAC7B,IACCF,IAAI,KAAKE,KAAK,CAACE,MAAM,IACrBJ,IAAI,CAACO,iBAAiB,IACtBP,IAAI,CAACQ,aAAa,CAACC,aAAa,KAAKT,IAAI,IACzCP,iBAAiB,CAAC,CAAC,EAClB;QACDS,KAAK,CAACG,cAAc,CAAC,CAAC;QACtB;MACD;MACA,MAAMK,IAAI,GAAGC,IAAI,CAACC,SAAS,CAAE;QAC5BC,IAAI,EAAE,OAAO;QACbC,YAAY,EAAE,CAAE1B,QAAQ,CAAE;QAC1B2B,eAAe,EAAExB,oBAAoB,CAAEH,QAAS;MACjD,CAAE,CAAC;MACHc,KAAK,CAACc,YAAY,CAACC,aAAa,GAAG,MAAM,CAAC,CAAC;MAC3Cf,KAAK,CAACc,YAAY,CAACE,SAAS,CAAC,CAAC;MAC9BhB,KAAK,CAACc,YAAY,CAACG,OAAO,CAAE,WAAW,EAAET,IAAK,CAAC;MAC/C,MAAM;QAAEF;MAAc,CAAC,GAAGR,IAAI;MAC9B,MAAM;QAAEoB;MAAY,CAAC,GAAGZ,aAAa;MACrC,MAAMa,SAAS,GAAGD,WAAW,CAACE,YAAY,CAAC,CAAC;MAC5CD,SAAS,CAACE,eAAe,CAAC,CAAC;MAE3B,MAAMC,OAAO,GAAGC,QAAQ,CAACC,aAAa,CAAE,KAAM,CAAC;MAC/C,MAAMC,IAAI,GAAGhD,UAAU,CAAE6C,OAAQ,CAAC;MAClCG,IAAI,CAACC,MAAM,cACV1C,IAAA,CAACF,kBAAkB;QAClB6C,IAAI,EAAGvC,YAAY,CAAEI,YAAY,CAAEN,QAAS,CAAE,CAAC,CAACyC;MAAM,CACtD,CACF,CAAC;MACDJ,QAAQ,CAACK,IAAI,CAACC,WAAW,CAAEP,OAAQ,CAAC;MACpCA,OAAO,CAACQ,KAAK,CAACC,QAAQ,GAAG,UAAU;MACnCT,OAAO,CAACQ,KAAK,CAACE,GAAG,GAAG,GAAG;MACvBV,OAAO,CAACQ,KAAK,CAACG,IAAI,GAAG,GAAG;MACxBX,OAAO,CAACQ,KAAK,CAACI,MAAM,GAAG,MAAM;MAC7BZ,OAAO,CAACQ,KAAK,CAACK,aAAa,GAAG,MAAM;;MAEpC;MACA;MACA;MACA;MACA;MACA,MAAMC,WAAW,GAAG9B,aAAa,CAACkB,aAAa,CAAE,KAAM,CAAC;MACxD;MACA;MACAY,WAAW,CAACN,KAAK,CAACO,KAAK,GAAG,KAAK;MAC/BD,WAAW,CAACN,KAAK,CAACQ,MAAM,GAAG,KAAK;MAChCF,WAAW,CAACN,KAAK,CAACC,QAAQ,GAAG,OAAO;MACpCK,WAAW,CAACN,KAAK,CAACS,UAAU,GAAG,QAAQ;MACvCjC,aAAa,CAACsB,IAAI,CAACC,WAAW,CAAEO,WAAY,CAAC;MAC7CpC,KAAK,CAACc,YAAY,CAAC0B,YAAY,CAAEJ,WAAW,EAAE,CAAC,EAAE,CAAE,CAAC;MAEpD,IAAIK,MAAM,GAAG;QAAEC,CAAC,EAAE,CAAC;QAAEC,CAAC,EAAE;MAAE,CAAC;MAE3B,IAAKpB,QAAQ,KAAKjB,aAAa,EAAG;QACjC,MAAMsC,KAAK,GAAG1B,WAAW,CAAC2B,YAAY;QACtC,IAAKD,KAAK,EAAG;UACZ,MAAME,IAAI,GAAGF,KAAK,CAACG,qBAAqB,CAAC,CAAC;UAC1CN,MAAM,GAAG;YAAEC,CAAC,EAAEI,IAAI,CAACb,IAAI;YAAEU,CAAC,EAAEG,IAAI,CAACd;UAAI,CAAC;QACvC;MACD;;MAEA;MACAS,MAAM,CAACC,CAAC,IAAI,EAAE;MAEd,SAASM,IAAIA,CAAEC,CAAC,EAAG;QAClB3B,OAAO,CAACQ,KAAK,CAACoB,SAAS,GAAG,cACzBD,CAAC,CAACE,OAAO,GAAGV,MAAM,CAACC,CAAC,OACbO,CAAC,CAACG,OAAO,GAAGX,MAAM,CAACE,CAAC,MAAO;MACpC;MAEAK,IAAI,CAAEhD,KAAM,CAAC;MAEb,SAASqD,GAAGA,CAAA,EAAG;QACd/C,aAAa,CAACgD,mBAAmB,CAAE,UAAU,EAAEN,IAAK,CAAC;QACrD1C,aAAa,CAACgD,mBAAmB,CAAE,SAAS,EAAED,GAAI,CAAC;QACnD/B,OAAO,CAACiC,MAAM,CAAC,CAAC;QAChBnB,WAAW,CAACmB,MAAM,CAAC,CAAC;QACpB1D,kBAAkB,CAAC,CAAC;QACpB0B,QAAQ,CAACK,IAAI,CAAC4B,SAAS,CAACD,MAAM,CAC7B,kCACD,CAAC;QACDjD,aAAa,CAACmD,eAAe,CAACD,SAAS,CAACD,MAAM,CAC7C,aACD,CAAC;MACF;MAEAjD,aAAa,CAACoD,gBAAgB,CAAE,UAAU,EAAEV,IAAK,CAAC;MAClD1C,aAAa,CAACoD,gBAAgB,CAAE,SAAS,EAAEL,GAAI,CAAC;MAChD/C,aAAa,CAACoD,gBAAgB,CAAE,MAAM,EAAEL,GAAI,CAAC;MAE7CzD,mBAAmB,CAAE,CAAEV,QAAQ,CAAG,CAAC;MACnC;MACAqC,QAAQ,CAACK,IAAI,CAAC4B,SAAS,CAACG,GAAG,CAC1B,kCACD,CAAC;MACDrD,aAAa,CAACmD,eAAe,CAACD,SAAS,CAACG,GAAG,CAAE,aAAc,CAAC;IAC7D;IAEA7D,IAAI,CAAC4D,gBAAgB,CAAE,SAAS,EAAE3D,SAAU,CAAC;IAC7CD,IAAI,CAAC4D,gBAAgB,CAAE,WAAW,EAAEtD,WAAY,CAAC;IAEjD,OAAO,MAAM;MACZN,IAAI,CAACwD,mBAAmB,CAAE,SAAS,EAAEvD,SAAU,CAAC;MAChDD,IAAI,CAACwD,mBAAmB,CAAE,WAAW,EAAElD,WAAY,CAAC;IACrD,CAAC;EACF,CAAC,EACD,CACClB,QAAQ,EACRC,UAAU,EACVE,oBAAoB,EACpBI,gBAAgB,EAChBC,WAAW,EACXJ,SAAS,EACTK,cAAc,EACdJ,iBAAiB,EACjBK,mBAAmB,EACnBC,kBAAkB,CAEpB,CAAC;AACF","ignoreList":[]}