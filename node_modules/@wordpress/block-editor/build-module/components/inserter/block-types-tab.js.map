{"version":3,"names":["__","_x","useMemo","useEffect","forwardRef","useAsyncList","BlockTypesList","InserterPanel","useBlockTypesState","InserterListbox","orderBy","InserterNoResults","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","getBlockNamespace","item","name","split","MAX_SUGGESTED_ITEMS","EMPTY_ARRAY","BlockTypesTabPanel","items","collections","categories","onSelectItem","onHover","showMostUsedBlocks","className","suggestedItems","slice","uncategorizedItems","filter","category","itemsPerCollection","result","Object","keys","forEach","namespace","length","currentlyRenderedCategories","didRenderAllCategories","collectionEntries","entries","currentlyRenderedCollections","children","title","onSelect","label","map","categoryItems","slug","icon","collection","collectionItems","BlockTypesTab","rootClientId","onInsert","ref","itemsForCurrentRoot","itemsRemaining","isAllowedInCurrentRoot","push"],"sources":["@wordpress/block-editor/src/components/inserter/block-types-tab.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __, _x } from '@wordpress/i18n';\nimport { useMemo, useEffect, forwardRef } from '@wordpress/element';\nimport { useAsyncList } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport BlockTypesList from '../block-types-list';\nimport InserterPanel from './panel';\nimport useBlockTypesState from './hooks/use-block-types-state';\nimport InserterListbox from '../inserter-listbox';\nimport { orderBy } from '../../utils/sorting';\nimport InserterNoResults from './no-results';\n\nconst getBlockNamespace = ( item ) => item.name.split( '/' )[ 0 ];\n\nconst MAX_SUGGESTED_ITEMS = 6;\n\n/**\n * Shared reference to an empty array for cases where it is important to avoid\n * returning a new array reference on every invocation and rerendering the component.\n *\n * @type {Array}\n */\nconst EMPTY_ARRAY = [];\n\nexport function BlockTypesTabPanel( {\n\titems,\n\tcollections,\n\tcategories,\n\tonSelectItem,\n\tonHover,\n\tshowMostUsedBlocks,\n\tclassName,\n} ) {\n\tconst suggestedItems = useMemo( () => {\n\t\treturn orderBy( items, 'frecency', 'desc' ).slice(\n\t\t\t0,\n\t\t\tMAX_SUGGESTED_ITEMS\n\t\t);\n\t}, [ items ] );\n\n\tconst uncategorizedItems = useMemo( () => {\n\t\treturn items.filter( ( item ) => ! item.category );\n\t}, [ items ] );\n\n\tconst itemsPerCollection = useMemo( () => {\n\t\t// Create a new Object to avoid mutating collection.\n\t\tconst result = { ...collections };\n\t\tObject.keys( collections ).forEach( ( namespace ) => {\n\t\t\tresult[ namespace ] = items.filter(\n\t\t\t\t( item ) => getBlockNamespace( item ) === namespace\n\t\t\t);\n\t\t\tif ( result[ namespace ].length === 0 ) {\n\t\t\t\tdelete result[ namespace ];\n\t\t\t}\n\t\t} );\n\n\t\treturn result;\n\t}, [ items, collections ] );\n\n\t// Hide block preview on unmount.\n\tuseEffect( () => () => onHover( null ), [] );\n\n\t/**\n\t * The inserter contains a big number of blocks and opening it is a costful operation.\n\t * The rendering is the most costful part of it, in order to improve the responsiveness\n\t * of the \"opening\" action, these lazy lists allow us to render the inserter category per category,\n\t * once all the categories are rendered, we start rendering the collections and the uncategorized block types.\n\t */\n\tconst currentlyRenderedCategories = useAsyncList( categories );\n\tconst didRenderAllCategories =\n\t\tcategories.length === currentlyRenderedCategories.length;\n\n\t// Async List requires an array.\n\tconst collectionEntries = useMemo( () => {\n\t\treturn Object.entries( collections );\n\t}, [ collections ] );\n\tconst currentlyRenderedCollections = useAsyncList(\n\t\tdidRenderAllCategories ? collectionEntries : EMPTY_ARRAY\n\t);\n\n\treturn (\n\t\t<div className={ className }>\n\t\t\t{ showMostUsedBlocks &&\n\t\t\t\t// Only show the most used blocks if the total amount of block\n\t\t\t\t// is larger than 1 row, otherwise it is not so useful.\n\t\t\t\titems.length > 3 &&\n\t\t\t\t!! suggestedItems.length && (\n\t\t\t\t\t<InserterPanel title={ _x( 'Most used', 'blocks' ) }>\n\t\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\t\titems={ suggestedItems }\n\t\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\t\tlabel={ _x( 'Most used', 'blocks' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</InserterPanel>\n\t\t\t\t) }\n\n\t\t\t{ currentlyRenderedCategories.map( ( category ) => {\n\t\t\t\tconst categoryItems = items.filter(\n\t\t\t\t\t( item ) => item.category === category.slug\n\t\t\t\t);\n\t\t\t\tif ( ! categoryItems || ! categoryItems.length ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn (\n\t\t\t\t\t<InserterPanel\n\t\t\t\t\t\tkey={ category.slug }\n\t\t\t\t\t\ttitle={ category.title }\n\t\t\t\t\t\ticon={ category.icon }\n\t\t\t\t\t>\n\t\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\t\titems={ categoryItems }\n\t\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\t\tlabel={ category.title }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</InserterPanel>\n\t\t\t\t);\n\t\t\t} ) }\n\n\t\t\t{ didRenderAllCategories && uncategorizedItems.length > 0 && (\n\t\t\t\t<InserterPanel\n\t\t\t\t\tclassName=\"block-editor-inserter__uncategorized-blocks-panel\"\n\t\t\t\t\ttitle={ __( 'Uncategorized' ) }\n\t\t\t\t>\n\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\titems={ uncategorizedItems }\n\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\tlabel={ __( 'Uncategorized' ) }\n\t\t\t\t\t/>\n\t\t\t\t</InserterPanel>\n\t\t\t) }\n\n\t\t\t{ currentlyRenderedCollections.map(\n\t\t\t\t( [ namespace, collection ] ) => {\n\t\t\t\t\tconst collectionItems = itemsPerCollection[ namespace ];\n\t\t\t\t\tif ( ! collectionItems || ! collectionItems.length ) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<InserterPanel\n\t\t\t\t\t\t\tkey={ namespace }\n\t\t\t\t\t\t\ttitle={ collection.title }\n\t\t\t\t\t\t\ticon={ collection.icon }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\t\t\titems={ collectionItems }\n\t\t\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\t\t\tlabel={ collection.title }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</InserterPanel>\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t) }\n\t\t</div>\n\t);\n}\n\nexport function BlockTypesTab(\n\t{ rootClientId, onInsert, onHover, showMostUsedBlocks },\n\tref\n) {\n\tconst [ items, categories, collections, onSelectItem ] = useBlockTypesState(\n\t\trootClientId,\n\t\tonInsert\n\t);\n\n\tif ( ! items.length ) {\n\t\treturn <InserterNoResults />;\n\t}\n\n\tconst itemsForCurrentRoot = [];\n\tconst itemsRemaining = [];\n\n\tfor ( const item of items ) {\n\t\t// Skip reusable blocks, they moved to the patterns tab.\n\t\tif ( item.category === 'reusable' ) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif ( item.isAllowedInCurrentRoot ) {\n\t\t\titemsForCurrentRoot.push( item );\n\t\t} else {\n\t\t\titemsRemaining.push( item );\n\t\t}\n\t}\n\n\treturn (\n\t\t<InserterListbox>\n\t\t\t<div ref={ ref }>\n\t\t\t\t{ !! itemsForCurrentRoot.length && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<BlockTypesTabPanel\n\t\t\t\t\t\t\titems={ itemsForCurrentRoot }\n\t\t\t\t\t\t\tcategories={ categories }\n\t\t\t\t\t\t\tcollections={ collections }\n\t\t\t\t\t\t\tonSelectItem={ onSelectItem }\n\t\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\t\tshowMostUsedBlocks={ showMostUsedBlocks }\n\t\t\t\t\t\t\tclassName=\"block-editor-inserter__insertable-blocks-at-selection\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t\t<BlockTypesTabPanel\n\t\t\t\t\titems={ itemsRemaining }\n\t\t\t\t\tcategories={ categories }\n\t\t\t\t\tcollections={ collections }\n\t\t\t\t\tonSelectItem={ onSelectItem }\n\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\tshowMostUsedBlocks={ showMostUsedBlocks }\n\t\t\t\t\tclassName=\"block-editor-inserter__all-blocks\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</InserterListbox>\n\t);\n}\n\nexport default forwardRef( BlockTypesTab );\n"],"mappings":"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","ignoreList":[]}