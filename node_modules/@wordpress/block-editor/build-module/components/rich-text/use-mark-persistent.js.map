{"version":3,"names":["useLayoutEffect","useRef","useDispatch","store","blockEditorStore","useMarkPersistent","html","value","previousTextRef","hasActiveFormats","activeFormats","length","__unstableMarkLastChangeAsPersistent","current","text","timeout","window","setTimeout","clearTimeout"],"sources":["@wordpress/block-editor/src/components/rich-text/use-mark-persistent.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useLayoutEffect, useRef } from '@wordpress/element';\nimport { useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\n\nexport function useMarkPersistent( { html, value } ) {\n\tconst previousTextRef = useRef();\n\tconst hasActiveFormats = !! value.activeFormats?.length;\n\tconst { __unstableMarkLastChangeAsPersistent } =\n\t\tuseDispatch( blockEditorStore );\n\n\t// Must be set synchronously to make sure it applies to the last change.\n\tuseLayoutEffect( () => {\n\t\t// Ignore mount.\n\t\tif ( ! previousTextRef.current ) {\n\t\t\tpreviousTextRef.current = value.text;\n\t\t\treturn;\n\t\t}\n\n\t\t// Text input, so don't create an undo level for every character.\n\t\t// Create an undo level after 1 second of no input.\n\t\tif ( previousTextRef.current !== value.text ) {\n\t\t\tconst timeout = window.setTimeout( () => {\n\t\t\t\t__unstableMarkLastChangeAsPersistent();\n\t\t\t}, 1000 );\n\t\t\tpreviousTextRef.current = value.text;\n\t\t\treturn () => {\n\t\t\t\twindow.clearTimeout( timeout );\n\t\t\t};\n\t\t}\n\n\t\t__unstableMarkLastChangeAsPersistent();\n\t}, [ html, hasActiveFormats ] );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,eAAe,EAAEC,MAAM,QAAQ,oBAAoB;AAC5D,SAASC,WAAW,QAAQ,iBAAiB;;AAE7C;AACA;AACA;AACA,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,aAAa;AAEvD,OAAO,SAASC,iBAAiBA,CAAE;EAAEC,IAAI;EAAEC;AAAM,CAAC,EAAG;EACpD,MAAMC,eAAe,GAAGP,MAAM,CAAC,CAAC;EAChC,MAAMQ,gBAAgB,GAAG,CAAC,CAAEF,KAAK,CAACG,aAAa,EAAEC,MAAM;EACvD,MAAM;IAAEC;EAAqC,CAAC,GAC7CV,WAAW,CAAEE,gBAAiB,CAAC;;EAEhC;EACAJ,eAAe,CAAE,MAAM;IACtB;IACA,IAAK,CAAEQ,eAAe,CAACK,OAAO,EAAG;MAChCL,eAAe,CAACK,OAAO,GAAGN,KAAK,CAACO,IAAI;MACpC;IACD;;IAEA;IACA;IACA,IAAKN,eAAe,CAACK,OAAO,KAAKN,KAAK,CAACO,IAAI,EAAG;MAC7C,MAAMC,OAAO,GAAGC,MAAM,CAACC,UAAU,CAAE,MAAM;QACxCL,oCAAoC,CAAC,CAAC;MACvC,CAAC,EAAE,IAAK,CAAC;MACTJ,eAAe,CAACK,OAAO,GAAGN,KAAK,CAACO,IAAI;MACpC,OAAO,MAAM;QACZE,MAAM,CAACE,YAAY,CAAEH,OAAQ,CAAC;MAC/B,CAAC;IACF;IAEAH,oCAAoC,CAAC,CAAC;EACvC,CAAC,EAAE,CAAEN,IAAI,EAAEG,gBAAgB,CAAG,CAAC;AAChC","ignoreList":[]}