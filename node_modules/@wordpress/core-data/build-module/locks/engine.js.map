{"version":3,"names":["reducer","isLockAvailable","getPendingLockRequests","createLocks","state","undefined","type","processPendingLockRequests","request","store","path","exclusive","notifyAcquired","lock","acquire","Promise","resolve","release"],"sources":["@wordpress/core-data/src/locks/engine.js"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport reducer from './reducer';\nimport { isLockAvailable, getPendingLockRequests } from './selectors';\n\nexport default function createLocks() {\n\tlet state = reducer( undefined, { type: '@@INIT' } );\n\n\tfunction processPendingLockRequests() {\n\t\tfor ( const request of getPendingLockRequests( state ) ) {\n\t\t\tconst { store, path, exclusive, notifyAcquired } = request;\n\t\t\tif ( isLockAvailable( state, store, path, { exclusive } ) ) {\n\t\t\t\tconst lock = { store, path, exclusive };\n\t\t\t\tstate = reducer( state, {\n\t\t\t\t\ttype: 'GRANT_LOCK_REQUEST',\n\t\t\t\t\tlock,\n\t\t\t\t\trequest,\n\t\t\t\t} );\n\t\t\t\tnotifyAcquired( lock );\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction acquire( store, path, exclusive ) {\n\t\treturn new Promise( ( resolve ) => {\n\t\t\tstate = reducer( state, {\n\t\t\t\ttype: 'ENQUEUE_LOCK_REQUEST',\n\t\t\t\trequest: { store, path, exclusive, notifyAcquired: resolve },\n\t\t\t} );\n\t\t\tprocessPendingLockRequests();\n\t\t} );\n\t}\n\tfunction release( lock ) {\n\t\tstate = reducer( state, {\n\t\t\ttype: 'RELEASE_LOCK',\n\t\t\tlock,\n\t\t} );\n\t\tprocessPendingLockRequests();\n\t}\n\n\treturn { acquire, release };\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAOA,OAAO,MAAM,WAAW;AAC/B,SAASC,eAAe,EAAEC,sBAAsB,QAAQ,aAAa;AAErE,eAAe,SAASC,WAAWA,CAAA,EAAG;EACrC,IAAIC,KAAK,GAAGJ,OAAO,CAAEK,SAAS,EAAE;IAAEC,IAAI,EAAE;EAAS,CAAE,CAAC;EAEpD,SAASC,0BAA0BA,CAAA,EAAG;IACrC,KAAM,MAAMC,OAAO,IAAIN,sBAAsB,CAAEE,KAAM,CAAC,EAAG;MACxD,MAAM;QAAEK,KAAK;QAAEC,IAAI;QAAEC,SAAS;QAAEC;MAAe,CAAC,GAAGJ,OAAO;MAC1D,IAAKP,eAAe,CAAEG,KAAK,EAAEK,KAAK,EAAEC,IAAI,EAAE;QAAEC;MAAU,CAAE,CAAC,EAAG;QAC3D,MAAME,IAAI,GAAG;UAAEJ,KAAK;UAAEC,IAAI;UAAEC;QAAU,CAAC;QACvCP,KAAK,GAAGJ,OAAO,CAAEI,KAAK,EAAE;UACvBE,IAAI,EAAE,oBAAoB;UAC1BO,IAAI;UACJL;QACD,CAAE,CAAC;QACHI,cAAc,CAAEC,IAAK,CAAC;MACvB;IACD;EACD;EAEA,SAASC,OAAOA,CAAEL,KAAK,EAAEC,IAAI,EAAEC,SAAS,EAAG;IAC1C,OAAO,IAAII,OAAO,CAAIC,OAAO,IAAM;MAClCZ,KAAK,GAAGJ,OAAO,CAAEI,KAAK,EAAE;QACvBE,IAAI,EAAE,sBAAsB;QAC5BE,OAAO,EAAE;UAAEC,KAAK;UAAEC,IAAI;UAAEC,SAAS;UAAEC,cAAc,EAAEI;QAAQ;MAC5D,CAAE,CAAC;MACHT,0BAA0B,CAAC,CAAC;IAC7B,CAAE,CAAC;EACJ;EACA,SAASU,OAAOA,CAAEJ,IAAI,EAAG;IACxBT,KAAK,GAAGJ,OAAO,CAAEI,KAAK,EAAE;MACvBE,IAAI,EAAE,cAAc;MACpBO;IACD,CAAE,CAAC;IACHN,0BAA0B,CAAC,CAAC;EAC7B;EAEA,OAAO;IAAEO,OAAO;IAAEG;EAAQ,CAAC;AAC5B","ignoreList":[]}