{"version":3,"names":["_apiFetch","_interopRequireDefault","require","maxItems","chunk","arr","chunkSize","tmp","cache","length","push","splice","defaultProcessor","requests","preflightResponse","apiFetch","path","method","endpoints","args","results","batchRequests","batchResponse","data","validation","map","request","body","headers","batchResults","failed","responses","response","error","result","status","output"],"sources":["@wordpress/core-data/src/batch/default-processor.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\n\n/**\n * Maximum number of requests to place in a single batch request. Obtained by\n * sending a preflight OPTIONS request to /batch/v1/.\n *\n * @type {number?}\n */\nlet maxItems = null;\n\nfunction chunk( arr, chunkSize ) {\n\tconst tmp = [ ...arr ];\n\tconst cache = [];\n\twhile ( tmp.length ) {\n\t\tcache.push( tmp.splice( 0, chunkSize ) );\n\t}\n\n\treturn cache;\n}\n\n/**\n * Default batch processor. Sends its input requests to /batch/v1.\n *\n * @param {Array} requests List of API requests to perform at once.\n *\n * @return {Promise} Promise that resolves to a list of objects containing\n *                   either `output` (if that request was successful) or `error`\n *                   (if not ).\n */\nexport default async function defaultProcessor( requests ) {\n\tif ( maxItems === null ) {\n\t\tconst preflightResponse = await apiFetch( {\n\t\t\tpath: '/batch/v1',\n\t\t\tmethod: 'OPTIONS',\n\t\t} );\n\t\tmaxItems = preflightResponse.endpoints[ 0 ].args.requests.maxItems;\n\t}\n\n\tconst results = [];\n\n\t// @ts-ignore We would have crashed or never gotten to this point if we hadn't received the maxItems count.\n\tfor ( const batchRequests of chunk( requests, maxItems ) ) {\n\t\tconst batchResponse = await apiFetch( {\n\t\t\tpath: '/batch/v1',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\tvalidation: 'require-all-validate',\n\t\t\t\trequests: batchRequests.map( ( request ) => ( {\n\t\t\t\t\tpath: request.path,\n\t\t\t\t\tbody: request.data, // Rename 'data' to 'body'.\n\t\t\t\t\tmethod: request.method,\n\t\t\t\t\theaders: request.headers,\n\t\t\t\t} ) ),\n\t\t\t},\n\t\t} );\n\n\t\tlet batchResults;\n\n\t\tif ( batchResponse.failed ) {\n\t\t\tbatchResults = batchResponse.responses.map( ( response ) => ( {\n\t\t\t\terror: response?.body,\n\t\t\t} ) );\n\t\t} else {\n\t\t\tbatchResults = batchResponse.responses.map( ( response ) => {\n\t\t\t\tconst result = {};\n\t\t\t\tif ( response.status >= 200 && response.status < 300 ) {\n\t\t\t\t\tresult.output = response.body;\n\t\t\t\t} else {\n\t\t\t\t\tresult.error = response.body;\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t} );\n\t\t}\n\n\t\tresults.push( ...batchResults );\n\t}\n\n\treturn results;\n}\n"],"mappings":";;;;;;;AAGA,IAAAA,SAAA,GAAAC,sBAAA,CAAAC,OAAA;AAHA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIC,QAAQ,GAAG,IAAI;AAEnB,SAASC,KAAKA,CAAEC,GAAG,EAAEC,SAAS,EAAG;EAChC,MAAMC,GAAG,GAAG,CAAE,GAAGF,GAAG,CAAE;EACtB,MAAMG,KAAK,GAAG,EAAE;EAChB,OAAQD,GAAG,CAACE,MAAM,EAAG;IACpBD,KAAK,CAACE,IAAI,CAAEH,GAAG,CAACI,MAAM,CAAE,CAAC,EAAEL,SAAU,CAAE,CAAC;EACzC;EAEA,OAAOE,KAAK;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,eAAeI,gBAAgBA,CAAEC,QAAQ,EAAG;EAC1D,IAAKV,QAAQ,KAAK,IAAI,EAAG;IACxB,MAAMW,iBAAiB,GAAG,MAAM,IAAAC,iBAAQ,EAAE;MACzCC,IAAI,EAAE,WAAW;MACjBC,MAAM,EAAE;IACT,CAAE,CAAC;IACHd,QAAQ,GAAGW,iBAAiB,CAACI,SAAS,CAAE,CAAC,CAAE,CAACC,IAAI,CAACN,QAAQ,CAACV,QAAQ;EACnE;EAEA,MAAMiB,OAAO,GAAG,EAAE;;EAElB;EACA,KAAM,MAAMC,aAAa,IAAIjB,KAAK,CAAES,QAAQ,EAAEV,QAAS,CAAC,EAAG;IAC1D,MAAMmB,aAAa,GAAG,MAAM,IAAAP,iBAAQ,EAAE;MACrCC,IAAI,EAAE,WAAW;MACjBC,MAAM,EAAE,MAAM;MACdM,IAAI,EAAE;QACLC,UAAU,EAAE,sBAAsB;QAClCX,QAAQ,EAAEQ,aAAa,CAACI,GAAG,CAAIC,OAAO,KAAQ;UAC7CV,IAAI,EAAEU,OAAO,CAACV,IAAI;UAClBW,IAAI,EAAED,OAAO,CAACH,IAAI;UAAE;UACpBN,MAAM,EAAES,OAAO,CAACT,MAAM;UACtBW,OAAO,EAAEF,OAAO,CAACE;QAClB,CAAC,CAAG;MACL;IACD,CAAE,CAAC;IAEH,IAAIC,YAAY;IAEhB,IAAKP,aAAa,CAACQ,MAAM,EAAG;MAC3BD,YAAY,GAAGP,aAAa,CAACS,SAAS,CAACN,GAAG,CAAIO,QAAQ,KAAQ;QAC7DC,KAAK,EAAED,QAAQ,EAAEL;MAClB,CAAC,CAAG,CAAC;IACN,CAAC,MAAM;MACNE,YAAY,GAAGP,aAAa,CAACS,SAAS,CAACN,GAAG,CAAIO,QAAQ,IAAM;QAC3D,MAAME,MAAM,GAAG,CAAC,CAAC;QACjB,IAAKF,QAAQ,CAACG,MAAM,IAAI,GAAG,IAAIH,QAAQ,CAACG,MAAM,GAAG,GAAG,EAAG;UACtDD,MAAM,CAACE,MAAM,GAAGJ,QAAQ,CAACL,IAAI;QAC9B,CAAC,MAAM;UACNO,MAAM,CAACD,KAAK,GAAGD,QAAQ,CAACL,IAAI;QAC7B;QACA,OAAOO,MAAM;MACd,CAAE,CAAC;IACJ;IAEAd,OAAO,CAACV,IAAI,CAAE,GAAGmB,YAAa,CAAC;EAChC;EAEA,OAAOT,OAAO;AACf","ignoreList":[]}