{"version":3,"names":["_reducer","_interopRequireDefault","require","_selectors","createLocks","state","reducer","undefined","type","processPendingLockRequests","request","getPendingLockRequests","store","path","exclusive","notifyAcquired","isLockAvailable","lock","acquire","Promise","resolve","release"],"sources":["@wordpress/core-data/src/locks/engine.js"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport reducer from './reducer';\nimport { isLockAvailable, getPendingLockRequests } from './selectors';\n\nexport default function createLocks() {\n\tlet state = reducer( undefined, { type: '@@INIT' } );\n\n\tfunction processPendingLockRequests() {\n\t\tfor ( const request of getPendingLockRequests( state ) ) {\n\t\t\tconst { store, path, exclusive, notifyAcquired } = request;\n\t\t\tif ( isLockAvailable( state, store, path, { exclusive } ) ) {\n\t\t\t\tconst lock = { store, path, exclusive };\n\t\t\t\tstate = reducer( state, {\n\t\t\t\t\ttype: 'GRANT_LOCK_REQUEST',\n\t\t\t\t\tlock,\n\t\t\t\t\trequest,\n\t\t\t\t} );\n\t\t\t\tnotifyAcquired( lock );\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction acquire( store, path, exclusive ) {\n\t\treturn new Promise( ( resolve ) => {\n\t\t\tstate = reducer( state, {\n\t\t\t\ttype: 'ENQUEUE_LOCK_REQUEST',\n\t\t\t\trequest: { store, path, exclusive, notifyAcquired: resolve },\n\t\t\t} );\n\t\t\tprocessPendingLockRequests();\n\t\t} );\n\t}\n\tfunction release( lock ) {\n\t\tstate = reducer( state, {\n\t\t\ttype: 'RELEASE_LOCK',\n\t\t\tlock,\n\t\t} );\n\t\tprocessPendingLockRequests();\n\t}\n\n\treturn { acquire, release };\n}\n"],"mappings":";;;;;;;AAGA,IAAAA,QAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,UAAA,GAAAD,OAAA;AAJA;AACA;AACA;;AAIe,SAASE,WAAWA,CAAA,EAAG;EACrC,IAAIC,KAAK,GAAG,IAAAC,gBAAO,EAAEC,SAAS,EAAE;IAAEC,IAAI,EAAE;EAAS,CAAE,CAAC;EAEpD,SAASC,0BAA0BA,CAAA,EAAG;IACrC,KAAM,MAAMC,OAAO,IAAI,IAAAC,iCAAsB,EAAEN,KAAM,CAAC,EAAG;MACxD,MAAM;QAAEO,KAAK;QAAEC,IAAI;QAAEC,SAAS;QAAEC;MAAe,CAAC,GAAGL,OAAO;MAC1D,IAAK,IAAAM,0BAAe,EAAEX,KAAK,EAAEO,KAAK,EAAEC,IAAI,EAAE;QAAEC;MAAU,CAAE,CAAC,EAAG;QAC3D,MAAMG,IAAI,GAAG;UAAEL,KAAK;UAAEC,IAAI;UAAEC;QAAU,CAAC;QACvCT,KAAK,GAAG,IAAAC,gBAAO,EAAED,KAAK,EAAE;UACvBG,IAAI,EAAE,oBAAoB;UAC1BS,IAAI;UACJP;QACD,CAAE,CAAC;QACHK,cAAc,CAAEE,IAAK,CAAC;MACvB;IACD;EACD;EAEA,SAASC,OAAOA,CAAEN,KAAK,EAAEC,IAAI,EAAEC,SAAS,EAAG;IAC1C,OAAO,IAAIK,OAAO,CAAIC,OAAO,IAAM;MAClCf,KAAK,GAAG,IAAAC,gBAAO,EAAED,KAAK,EAAE;QACvBG,IAAI,EAAE,sBAAsB;QAC5BE,OAAO,EAAE;UAAEE,KAAK;UAAEC,IAAI;UAAEC,SAAS;UAAEC,cAAc,EAAEK;QAAQ;MAC5D,CAAE,CAAC;MACHX,0BAA0B,CAAC,CAAC;IAC7B,CAAE,CAAC;EACJ;EACA,SAASY,OAAOA,CAAEJ,IAAI,EAAG;IACxBZ,KAAK,GAAG,IAAAC,gBAAO,EAAED,KAAK,EAAE;MACvBG,IAAI,EAAE,cAAc;MACpBS;IACD,CAAE,CAAC;IACHR,0BAA0B,CAAC,CAAC;EAC7B;EAEA,OAAO;IAAES,OAAO;IAAEG;EAAQ,CAAC;AAC5B","ignoreList":[]}