{"version":3,"names":["_blockEditor","require","_blocks","_i18n","__experimentalConvertBlockToStatic","clientId","registry","oldBlock","select","blockEditorStore","getBlock","reusableBlock","getEditedEntityRecord","attributes","ref","newBlocks","parse","content","dispatch","replaceBlocks","exports","__experimentalConvertBlocksToReusable","clientIds","title","syncType","meta","wp_pattern_sync_status","undefined","__","serialize","getBlocksByClientId","status","updatedRecord","saveEntityRecord","newBlock","createBlock","id","__experimentalSetEditingReusableBlock","__experimentalDeleteReusableBlock","allBlocks","getBlocks","associatedBlocks","filter","block","isReusableBlock","associatedBlockClientIds","map","length","removeBlocks","deleteEntityRecord","isEditing","type"],"sources":["@wordpress/reusable-blocks/src/store/actions.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport {\n\tcreateBlock,\n\tisReusableBlock,\n\tparse,\n\tserialize,\n} from '@wordpress/blocks';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Returns a generator converting a reusable block into a static block.\n *\n * @param {string} clientId The client ID of the block to attach.\n */\nexport const __experimentalConvertBlockToStatic =\n\t( clientId ) =>\n\t( { registry } ) => {\n\t\tconst oldBlock = registry\n\t\t\t.select( blockEditorStore )\n\t\t\t.getBlock( clientId );\n\t\tconst reusableBlock = registry\n\t\t\t.select( 'core' )\n\t\t\t.getEditedEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\t'wp_block',\n\t\t\t\toldBlock.attributes.ref\n\t\t\t);\n\n\t\tconst newBlocks = parse(\n\t\t\ttypeof reusableBlock.content === 'function'\n\t\t\t\t? reusableBlock.content( reusableBlock )\n\t\t\t\t: reusableBlock.content\n\t\t);\n\t\tregistry\n\t\t\t.dispatch( blockEditorStore )\n\t\t\t.replaceBlocks( oldBlock.clientId, newBlocks );\n\t};\n\n/**\n * Returns a generator converting one or more static blocks into a pattern.\n *\n * @param {string[]}             clientIds The client IDs of the block to detach.\n * @param {string}               title     Pattern title.\n * @param {undefined|'unsynced'} syncType  They way block is synced, current undefined (synced) and 'unsynced'.\n */\nexport const __experimentalConvertBlocksToReusable =\n\t( clientIds, title, syncType ) =>\n\tasync ( { registry, dispatch } ) => {\n\t\tconst meta =\n\t\t\tsyncType === 'unsynced'\n\t\t\t\t? {\n\t\t\t\t\t\twp_pattern_sync_status: syncType,\n\t\t\t\t  }\n\t\t\t\t: undefined;\n\n\t\tconst reusableBlock = {\n\t\t\ttitle: title || __( 'Untitled pattern block' ),\n\t\t\tcontent: serialize(\n\t\t\t\tregistry\n\t\t\t\t\t.select( blockEditorStore )\n\t\t\t\t\t.getBlocksByClientId( clientIds )\n\t\t\t),\n\t\t\tstatus: 'publish',\n\t\t\tmeta,\n\t\t};\n\n\t\tconst updatedRecord = await registry\n\t\t\t.dispatch( 'core' )\n\t\t\t.saveEntityRecord( 'postType', 'wp_block', reusableBlock );\n\n\t\tif ( syncType === 'unsynced' ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newBlock = createBlock( 'core/block', {\n\t\t\tref: updatedRecord.id,\n\t\t} );\n\t\tregistry\n\t\t\t.dispatch( blockEditorStore )\n\t\t\t.replaceBlocks( clientIds, newBlock );\n\t\tdispatch.__experimentalSetEditingReusableBlock(\n\t\t\tnewBlock.clientId,\n\t\t\ttrue\n\t\t);\n\t};\n\n/**\n * Returns a generator deleting a reusable block.\n *\n * @param {string} id The ID of the reusable block to delete.\n */\nexport const __experimentalDeleteReusableBlock =\n\t( id ) =>\n\tasync ( { registry } ) => {\n\t\tconst reusableBlock = registry\n\t\t\t.select( 'core' )\n\t\t\t.getEditedEntityRecord( 'postType', 'wp_block', id );\n\n\t\t// Don't allow a reusable block with a temporary ID to be deleted.\n\t\tif ( ! reusableBlock ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Remove any other blocks that reference this reusable block.\n\t\tconst allBlocks = registry.select( blockEditorStore ).getBlocks();\n\t\tconst associatedBlocks = allBlocks.filter(\n\t\t\t( block ) => isReusableBlock( block ) && block.attributes.ref === id\n\t\t);\n\t\tconst associatedBlockClientIds = associatedBlocks.map(\n\t\t\t( block ) => block.clientId\n\t\t);\n\n\t\t// Remove the parsed block.\n\t\tif ( associatedBlockClientIds.length ) {\n\t\t\tregistry\n\t\t\t\t.dispatch( blockEditorStore )\n\t\t\t\t.removeBlocks( associatedBlockClientIds );\n\t\t}\n\n\t\tawait registry\n\t\t\t.dispatch( 'core' )\n\t\t\t.deleteEntityRecord( 'postType', 'wp_block', id );\n\t};\n\n/**\n * Returns an action descriptor for SET_EDITING_REUSABLE_BLOCK action.\n *\n * @param {string}  clientId  The clientID of the reusable block to target.\n * @param {boolean} isEditing Whether the block should be in editing state.\n * @return {Object} Action descriptor.\n */\nexport function __experimentalSetEditingReusableBlock( clientId, isEditing ) {\n\treturn {\n\t\ttype: 'SET_EDITING_REUSABLE_BLOCK',\n\t\tclientId,\n\t\tisEditing,\n\t};\n}\n"],"mappings":"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","ignoreList":[]}