{"version":3,"names":["Component","__","DEFAULT_EMPTY_GALLERY","getFeaturedImageMediaFrame","wp","window","media","view","MediaFrame","Select","extend","featuredImageToolbar","toolbar","createSelectToolbar","text","l10n","setFeaturedImage","state","options","editState","selection","get","EditImage","model","single","controller","render","content","set","loadEditor","createStates","on","states","add","FeaturedImage","editImage","getSingleMediaFrame","Library","library","query","multiple","title","priority","filterable","getGalleryDetailsMediaFrame","Post","galleryToolbar","editing","Toolbar","items","insert","style","updateGallery","insertGallery","requires","click","close","trigger","setState","reset","id","createGalleryTitle","editable","type","GalleryEdit","menu","displaySettings","GalleryAdd","slimImageObject","img","attrSet","reduce","result","key","hasOwnProperty","getAttachmentsCollection","ids","order","orderby","post__in","posts_per_page","MediaUpload","constructor","arguments","openModal","bind","onOpen","onSelect","onUpdate","onClose","initializeListeners","frame","buildAndSetGalleryFrame","addToGallery","allowedTypes","value","props","lastGalleryValue","remove","currentState","length","GalleryDetailsMediaFrame","attachments","Selection","models","toJSON","mimeType","buildAndSetFeatureImageFrame","featuredImageId","featuredImageFrame","settings","post","buildAndSetSingleMediaFrame","frameConfig","singleImageFrame","componentWillUnmount","selections","selectedImages","map","attachment","updateCollection","mode","hasMedia","Array","isArray","isGallery","gallery","valueArray","forEach","more","done","detach","frameContent","collection","toArray","mirroring","_hasMore","unstableFeaturedImageFlow","modalClass","$el","addClass","open"],"sources":["@wordpress/media-utils/src/components/media-upload/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\nconst DEFAULT_EMPTY_GALLERY = [];\n\n/**\n * Prepares the Featured Image toolbars and frames.\n *\n * @return {window.wp.media.view.MediaFrame.Select} The default media workflow.\n */\nconst getFeaturedImageMediaFrame = () => {\n\tconst { wp } = window;\n\n\treturn wp.media.view.MediaFrame.Select.extend( {\n\t\t/**\n\t\t * Enables the Set Featured Image Button.\n\t\t *\n\t\t * @param {Object} toolbar toolbar for featured image state\n\t\t * @return {void}\n\t\t */\n\t\tfeaturedImageToolbar( toolbar ) {\n\t\t\tthis.createSelectToolbar( toolbar, {\n\t\t\t\ttext: wp.media.view.l10n.setFeaturedImage,\n\t\t\t\tstate: this.options.state,\n\t\t\t} );\n\t\t},\n\n\t\t/**\n\t\t * Handle the edit state requirements of selected media item.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\teditState() {\n\t\t\tconst selection = this.state( 'featured-image' ).get( 'selection' );\n\t\t\tconst view = new wp.media.view.EditImage( {\n\t\t\t\tmodel: selection.single(),\n\t\t\t\tcontroller: this,\n\t\t\t} ).render();\n\n\t\t\t// Set the view to the EditImage frame using the selected image.\n\t\t\tthis.content.set( view );\n\n\t\t\t// After bringing in the frame, load the actual editor via an ajax call.\n\t\t\tview.loadEditor();\n\t\t},\n\n\t\t/**\n\t\t * Create the default states.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\tcreateStates: function createStates() {\n\t\t\tthis.on(\n\t\t\t\t'toolbar:create:featured-image',\n\t\t\t\tthis.featuredImageToolbar,\n\t\t\t\tthis\n\t\t\t);\n\t\t\tthis.on( 'content:render:edit-image', this.editState, this );\n\n\t\t\tthis.states.add( [\n\t\t\t\tnew wp.media.controller.FeaturedImage(),\n\t\t\t\tnew wp.media.controller.EditImage( {\n\t\t\t\t\tmodel: this.options.editImage,\n\t\t\t\t} ),\n\t\t\t] );\n\t\t},\n\t} );\n};\n\n/**\n * Prepares the default frame for selecting a single media item.\n *\n * @return {window.wp.media.view.MediaFrame.Select} The default media workflow.\n */\nconst getSingleMediaFrame = () => {\n\tconst { wp } = window;\n\n\t// Extend the default Select frame, and use the same `createStates` method as in core,\n\t// but with the addition of `filterable: 'uploaded'` to the Library state, so that\n\t// the user can filter the media library by uploaded media.\n\treturn wp.media.view.MediaFrame.Select.extend( {\n\t\t/**\n\t\t * Create the default states on the frame.\n\t\t */\n\t\tcreateStates() {\n\t\t\tconst options = this.options;\n\n\t\t\tif ( this.options.states ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Add the default states.\n\t\t\tthis.states.add( [\n\t\t\t\t// Main states.\n\t\t\t\tnew wp.media.controller.Library( {\n\t\t\t\t\tlibrary: wp.media.query( options.library ),\n\t\t\t\t\tmultiple: options.multiple,\n\t\t\t\t\ttitle: options.title,\n\t\t\t\t\tpriority: 20,\n\t\t\t\t\tfilterable: 'uploaded', // Allow filtering by uploaded images.\n\t\t\t\t} ),\n\t\t\t\tnew wp.media.controller.EditImage( {\n\t\t\t\t\tmodel: options.editImage,\n\t\t\t\t} ),\n\t\t\t] );\n\t\t},\n\t} );\n};\n\n/**\n * Prepares the Gallery toolbars and frames.\n *\n * @return {window.wp.media.view.MediaFrame.Post} The default media workflow.\n */\nconst getGalleryDetailsMediaFrame = () => {\n\tconst { wp } = window;\n\t/**\n\t * Custom gallery details frame.\n\t *\n\t * @see https://github.com/xwp/wp-core-media-widgets/blob/905edbccfc2a623b73a93dac803c5335519d7837/wp-admin/js/widgets/media-gallery-widget.js\n\t * @class GalleryDetailsMediaFrame\n\t * @class\n\t */\n\treturn wp.media.view.MediaFrame.Post.extend( {\n\t\t/**\n\t\t * Set up gallery toolbar.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\tgalleryToolbar() {\n\t\t\tconst editing = this.state().get( 'editing' );\n\t\t\tthis.toolbar.set(\n\t\t\t\tnew wp.media.view.Toolbar( {\n\t\t\t\t\tcontroller: this,\n\t\t\t\t\titems: {\n\t\t\t\t\t\tinsert: {\n\t\t\t\t\t\t\tstyle: 'primary',\n\t\t\t\t\t\t\ttext: editing\n\t\t\t\t\t\t\t\t? wp.media.view.l10n.updateGallery\n\t\t\t\t\t\t\t\t: wp.media.view.l10n.insertGallery,\n\t\t\t\t\t\t\tpriority: 80,\n\t\t\t\t\t\t\trequires: { library: true },\n\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * @fires wp.media.controller.State#update\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tconst controller = this.controller,\n\t\t\t\t\t\t\t\t\tstate = controller.state();\n\n\t\t\t\t\t\t\t\tcontroller.close();\n\t\t\t\t\t\t\t\tstate.trigger(\n\t\t\t\t\t\t\t\t\t'update',\n\t\t\t\t\t\t\t\t\tstate.get( 'library' )\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t// Restore and reset the default state.\n\t\t\t\t\t\t\t\tcontroller.setState( controller.options.state );\n\t\t\t\t\t\t\t\tcontroller.reset();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t} )\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Handle the edit state requirements of selected media item.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\teditState() {\n\t\t\tconst selection = this.state( 'gallery' ).get( 'selection' );\n\t\t\tconst view = new wp.media.view.EditImage( {\n\t\t\t\tmodel: selection.single(),\n\t\t\t\tcontroller: this,\n\t\t\t} ).render();\n\n\t\t\t// Set the view to the EditImage frame using the selected image.\n\t\t\tthis.content.set( view );\n\n\t\t\t// After bringing in the frame, load the actual editor via an ajax call.\n\t\t\tview.loadEditor();\n\t\t},\n\n\t\t/**\n\t\t * Create the default states.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\tcreateStates: function createStates() {\n\t\t\tthis.on( 'toolbar:create:main-gallery', this.galleryToolbar, this );\n\t\t\tthis.on( 'content:render:edit-image', this.editState, this );\n\n\t\t\tthis.states.add( [\n\t\t\t\tnew wp.media.controller.Library( {\n\t\t\t\t\tid: 'gallery',\n\t\t\t\t\ttitle: wp.media.view.l10n.createGalleryTitle,\n\t\t\t\t\tpriority: 40,\n\t\t\t\t\ttoolbar: 'main-gallery',\n\t\t\t\t\tfilterable: 'uploaded',\n\t\t\t\t\tmultiple: 'add',\n\t\t\t\t\teditable: false,\n\n\t\t\t\t\tlibrary: wp.media.query( {\n\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t...this.options.library,\n\t\t\t\t\t} ),\n\t\t\t\t} ),\n\t\t\t\tnew wp.media.controller.EditImage( {\n\t\t\t\t\tmodel: this.options.editImage,\n\t\t\t\t} ),\n\n\t\t\t\tnew wp.media.controller.GalleryEdit( {\n\t\t\t\t\tlibrary: this.options.selection,\n\t\t\t\t\tediting: this.options.editing,\n\t\t\t\t\tmenu: 'gallery',\n\t\t\t\t\tdisplaySettings: false,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t} ),\n\n\t\t\t\tnew wp.media.controller.GalleryAdd(),\n\t\t\t] );\n\t\t},\n\t} );\n};\n\n// The media library image object contains numerous attributes\n// we only need this set to display the image in the library.\nconst slimImageObject = ( img ) => {\n\tconst attrSet = [\n\t\t'sizes',\n\t\t'mime',\n\t\t'type',\n\t\t'subtype',\n\t\t'id',\n\t\t'url',\n\t\t'alt',\n\t\t'link',\n\t\t'caption',\n\t];\n\treturn attrSet.reduce( ( result, key ) => {\n\t\tif ( img?.hasOwnProperty( key ) ) {\n\t\t\tresult[ key ] = img[ key ];\n\t\t}\n\t\treturn result;\n\t}, {} );\n};\n\nconst getAttachmentsCollection = ( ids ) => {\n\tconst { wp } = window;\n\n\treturn wp.media.query( {\n\t\torder: 'ASC',\n\t\torderby: 'post__in',\n\t\tpost__in: ids,\n\t\tposts_per_page: -1,\n\t\tquery: true,\n\t\ttype: 'image',\n\t} );\n};\n\nclass MediaUpload extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.openModal = this.openModal.bind( this );\n\t\tthis.onOpen = this.onOpen.bind( this );\n\t\tthis.onSelect = this.onSelect.bind( this );\n\t\tthis.onUpdate = this.onUpdate.bind( this );\n\t\tthis.onClose = this.onClose.bind( this );\n\t}\n\n\tinitializeListeners() {\n\t\t// When an image is selected in the media frame...\n\t\tthis.frame.on( 'select', this.onSelect );\n\t\tthis.frame.on( 'update', this.onUpdate );\n\t\tthis.frame.on( 'open', this.onOpen );\n\t\tthis.frame.on( 'close', this.onClose );\n\t}\n\n\t/**\n\t * Sets the Gallery frame and initializes listeners.\n\t *\n\t * @return {void}\n\t */\n\tbuildAndSetGalleryFrame() {\n\t\tconst {\n\t\t\taddToGallery = false,\n\t\t\tallowedTypes,\n\t\t\tmultiple = false,\n\t\t\tvalue = DEFAULT_EMPTY_GALLERY,\n\t\t} = this.props;\n\n\t\t// If the value did not changed there is no need to rebuild the frame,\n\t\t// we can continue to use the existing one.\n\t\tif ( value === this.lastGalleryValue ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { wp } = window;\n\n\t\tthis.lastGalleryValue = value;\n\n\t\t// If a frame already existed remove it.\n\t\tif ( this.frame ) {\n\t\t\tthis.frame.remove();\n\t\t}\n\t\tlet currentState;\n\t\tif ( addToGallery ) {\n\t\t\tcurrentState = 'gallery-library';\n\t\t} else {\n\t\t\tcurrentState = value && value.length ? 'gallery-edit' : 'gallery';\n\t\t}\n\t\tif ( ! this.GalleryDetailsMediaFrame ) {\n\t\t\tthis.GalleryDetailsMediaFrame = getGalleryDetailsMediaFrame();\n\t\t}\n\t\tconst attachments = getAttachmentsCollection( value );\n\t\tconst selection = new wp.media.model.Selection( attachments.models, {\n\t\t\tprops: attachments.props.toJSON(),\n\t\t\tmultiple,\n\t\t} );\n\t\tthis.frame = new this.GalleryDetailsMediaFrame( {\n\t\t\tmimeType: allowedTypes,\n\t\t\tstate: currentState,\n\t\t\tmultiple,\n\t\t\tselection,\n\t\t\tediting: !! value?.length,\n\t\t} );\n\t\twp.media.frame = this.frame;\n\t\tthis.initializeListeners();\n\t}\n\n\t/**\n\t * Initializes the Media Library requirements for the featured image flow.\n\t *\n\t * @return {void}\n\t */\n\tbuildAndSetFeatureImageFrame() {\n\t\tconst { wp } = window;\n\t\tconst { value: featuredImageId, multiple, allowedTypes } = this.props;\n\t\tconst featuredImageFrame = getFeaturedImageMediaFrame();\n\t\tconst attachments = getAttachmentsCollection( featuredImageId );\n\t\tconst selection = new wp.media.model.Selection( attachments.models, {\n\t\t\tprops: attachments.props.toJSON(),\n\t\t} );\n\t\tthis.frame = new featuredImageFrame( {\n\t\t\tmimeType: allowedTypes,\n\t\t\tstate: 'featured-image',\n\t\t\tmultiple,\n\t\t\tselection,\n\t\t\tediting: featuredImageId,\n\t\t} );\n\t\twp.media.frame = this.frame;\n\t\t// In order to select the current featured image when opening\n\t\t// the media library we have to set the appropriate settings.\n\t\t// Currently they are set in php for the post editor, but\n\t\t// not for site editor.\n\t\twp.media.view.settings.post = {\n\t\t\t...wp.media.view.settings.post,\n\t\t\tfeaturedImageId: featuredImageId || -1,\n\t\t};\n\t}\n\n\t/**\n\t * Initializes the Media Library requirements for the single image flow.\n\t *\n\t * @return {void}\n\t */\n\tbuildAndSetSingleMediaFrame() {\n\t\tconst { wp } = window;\n\t\tconst {\n\t\t\tallowedTypes,\n\t\t\tmultiple = false,\n\t\t\ttitle = __( 'Select or Upload Media' ),\n\t\t\tvalue,\n\t\t} = this.props;\n\n\t\tconst frameConfig = {\n\t\t\ttitle,\n\t\t\tmultiple,\n\t\t};\n\t\tif ( !! allowedTypes ) {\n\t\t\tframeConfig.library = { type: allowedTypes };\n\t\t}\n\n\t\t// If a frame already exists, remove it.\n\t\tif ( this.frame ) {\n\t\t\tthis.frame.remove();\n\t\t}\n\n\t\tconst singleImageFrame = getSingleMediaFrame();\n\t\tconst attachments = getAttachmentsCollection( value );\n\t\tconst selection = new wp.media.model.Selection( attachments.models, {\n\t\t\tprops: attachments.props.toJSON(),\n\t\t} );\n\t\tthis.frame = new singleImageFrame( {\n\t\t\tmimeType: allowedTypes,\n\t\t\tmultiple,\n\t\t\tselection,\n\t\t\t...frameConfig,\n\t\t} );\n\t\twp.media.frame = this.frame;\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.frame?.remove();\n\t}\n\n\tonUpdate( selections ) {\n\t\tconst { onSelect, multiple = false } = this.props;\n\t\tconst state = this.frame.state();\n\t\tconst selectedImages = selections || state.get( 'selection' );\n\n\t\tif ( ! selectedImages || ! selectedImages.models.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( multiple ) {\n\t\t\tonSelect(\n\t\t\t\tselectedImages.models.map( ( model ) =>\n\t\t\t\t\tslimImageObject( model.toJSON() )\n\t\t\t\t)\n\t\t\t);\n\t\t} else {\n\t\t\tonSelect( slimImageObject( selectedImages.models[ 0 ].toJSON() ) );\n\t\t}\n\t}\n\n\tonSelect() {\n\t\tconst { onSelect, multiple = false } = this.props;\n\t\t// Get media attachment details from the frame state.\n\t\tconst attachment = this.frame.state().get( 'selection' ).toJSON();\n\t\tonSelect( multiple ? attachment : attachment[ 0 ] );\n\t}\n\n\tonOpen() {\n\t\tconst { wp } = window;\n\t\tconst { value } = this.props;\n\t\tthis.updateCollection();\n\n\t\t//Handle active tab in media model on model open.\n\t\tif ( this.props.mode ) {\n\t\t\tthis.frame.content.mode( this.props.mode );\n\t\t}\n\n\t\t// Handle both this.props.value being either (number[]) multiple ids\n\t\t// (for galleries) or a (number) singular id (e.g. image block).\n\t\tconst hasMedia = Array.isArray( value ) ? !! value?.length : !! value;\n\n\t\tif ( ! hasMedia ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isGallery = this.props.gallery;\n\t\tconst selection = this.frame.state().get( 'selection' );\n\t\tconst valueArray = Array.isArray( value ) ? value : [ value ];\n\n\t\tif ( ! isGallery ) {\n\t\t\tvalueArray.forEach( ( id ) => {\n\t\t\t\tselection.add( wp.media.attachment( id ) );\n\t\t\t} );\n\t\t}\n\n\t\t// Load the images so they are available in the media modal.\n\t\tconst attachments = getAttachmentsCollection( valueArray );\n\n\t\t// Once attachments are loaded, set the current selection.\n\t\tattachments.more().done( function () {\n\t\t\tif ( isGallery && attachments?.models?.length ) {\n\t\t\t\tselection.add( attachments.models );\n\t\t\t}\n\t\t} );\n\t}\n\n\tonClose() {\n\t\tconst { onClose } = this.props;\n\n\t\tif ( onClose ) {\n\t\t\tonClose();\n\t\t}\n\n\t\tthis.frame.detach();\n\t}\n\n\tupdateCollection() {\n\t\tconst frameContent = this.frame.content.get();\n\t\tif ( frameContent && frameContent.collection ) {\n\t\t\tconst collection = frameContent.collection;\n\n\t\t\t// Clean all attachments we have in memory.\n\t\t\tcollection\n\t\t\t\t.toArray()\n\t\t\t\t.forEach( ( model ) => model.trigger( 'destroy', model ) );\n\n\t\t\t// Reset has more flag, if library had small amount of items all items may have been loaded before.\n\t\t\tcollection.mirroring._hasMore = true;\n\n\t\t\t// Request items.\n\t\t\tcollection.more();\n\t\t}\n\t}\n\n\topenModal() {\n\t\tconst {\n\t\t\tgallery = false,\n\t\t\tunstableFeaturedImageFlow = false,\n\t\t\tmodalClass,\n\t\t} = this.props;\n\n\t\tif ( gallery ) {\n\t\t\tthis.buildAndSetGalleryFrame();\n\t\t} else {\n\t\t\tthis.buildAndSetSingleMediaFrame();\n\t\t}\n\n\t\tif ( modalClass ) {\n\t\t\tthis.frame.$el.addClass( modalClass );\n\t\t}\n\n\t\tif ( unstableFeaturedImageFlow ) {\n\t\t\tthis.buildAndSetFeatureImageFrame();\n\t\t}\n\t\tthis.initializeListeners();\n\t\tthis.frame.open();\n\t}\n\n\trender() {\n\t\treturn this.props.render( { open: this.openModal } );\n\t}\n}\n\nexport default MediaUpload;\n"],"mappings":"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","ignoreList":[]}